{"version":3,"file":"index-5045d49c.js","sources":["../../node_modules/tweakpane/dist/tweakpane.js","../../js/params.js","../../js/core/EventManager.js","../../js/core/ServiceContainer.js","../../js/core/SceneManager.js","../../js/interfaces/IGameSystem.js","../../js/core/SystemManager.js","../../js/core/InputManager.js","../../js/core/GameEngine.js","../../js/interfaces/GameEvents.js","../../js/systems/GameStateSystem.js","../../js/components/Transform.js","../../js/components/Renderer.js","../../js/systems/PlayerSystem.js","../../js/factories/NPCFactory.js","../../js/systems/NPCSystem.js","../../js/systems/PoliceSystem.js","../../js/systems/UISystem.js","../../js/systems/VisualFXSystem.js","../../js/main.js"],"sourcesContent":["/*! Tweakpane 4.0.5 (c) 2016 cocopon, licensed under the MIT license. */\nfunction forceCast(v) {\n    return v;\n}\nfunction isEmpty(value) {\n    return value === null || value === undefined;\n}\nfunction isObject$1(value) {\n    return value !== null && typeof value === 'object';\n}\nfunction isRecord(value) {\n    return value !== null && typeof value === 'object';\n}\nfunction deepEqualsArray(a1, a2) {\n    if (a1.length !== a2.length) {\n        return false;\n    }\n    for (let i = 0; i < a1.length; i++) {\n        if (a1[i] !== a2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction deepMerge(r1, r2) {\n    const keys = Array.from(new Set([...Object.keys(r1), ...Object.keys(r2)]));\n    return keys.reduce((result, key) => {\n        const v1 = r1[key];\n        const v2 = r2[key];\n        return isRecord(v1) && isRecord(v2)\n            ? Object.assign(Object.assign({}, result), { [key]: deepMerge(v1, v2) }) : Object.assign(Object.assign({}, result), { [key]: key in r2 ? v2 : v1 });\n    }, {});\n}\n\nfunction isBinding(value) {\n    if (!isObject$1(value)) {\n        return false;\n    }\n    return 'target' in value;\n}\n\nconst CREATE_MESSAGE_MAP = {\n    alreadydisposed: () => 'View has been already disposed',\n    invalidparams: (context) => `Invalid parameters for '${context.name}'`,\n    nomatchingcontroller: (context) => `No matching controller for '${context.key}'`,\n    nomatchingview: (context) => `No matching view for '${JSON.stringify(context.params)}'`,\n    notbindable: () => `Value is not bindable`,\n    notcompatible: (context) => `Not compatible with  plugin '${context.id}'`,\n    propertynotfound: (context) => `Property '${context.name}' not found`,\n    shouldneverhappen: () => 'This error should never happen',\n};\nclass TpError {\n    static alreadyDisposed() {\n        return new TpError({ type: 'alreadydisposed' });\n    }\n    static notBindable() {\n        return new TpError({\n            type: 'notbindable',\n        });\n    }\n    static notCompatible(bundleId, id) {\n        return new TpError({\n            type: 'notcompatible',\n            context: {\n                id: `${bundleId}.${id}`,\n            },\n        });\n    }\n    static propertyNotFound(name) {\n        return new TpError({\n            type: 'propertynotfound',\n            context: {\n                name: name,\n            },\n        });\n    }\n    static shouldNeverHappen() {\n        return new TpError({ type: 'shouldneverhappen' });\n    }\n    constructor(config) {\n        var _a;\n        this.message =\n            (_a = CREATE_MESSAGE_MAP[config.type](forceCast(config.context))) !== null && _a !== void 0 ? _a : 'Unexpected error';\n        this.name = this.constructor.name;\n        this.stack = new Error(this.message).stack;\n        this.type = config.type;\n    }\n    toString() {\n        return this.message;\n    }\n}\n\nclass BindingTarget {\n    constructor(obj, key) {\n        this.obj_ = obj;\n        this.key = key;\n    }\n    static isBindable(obj) {\n        if (obj === null) {\n            return false;\n        }\n        if (typeof obj !== 'object' && typeof obj !== 'function') {\n            return false;\n        }\n        return true;\n    }\n    read() {\n        return this.obj_[this.key];\n    }\n    write(value) {\n        this.obj_[this.key] = value;\n    }\n    writeProperty(name, value) {\n        const valueObj = this.read();\n        if (!BindingTarget.isBindable(valueObj)) {\n            throw TpError.notBindable();\n        }\n        if (!(name in valueObj)) {\n            throw TpError.propertyNotFound(name);\n        }\n        valueObj[name] = value;\n    }\n}\n\nclass Emitter {\n    constructor() {\n        this.observers_ = {};\n    }\n    on(eventName, handler, opt_options) {\n        var _a;\n        let observers = this.observers_[eventName];\n        if (!observers) {\n            observers = this.observers_[eventName] = [];\n        }\n        observers.push({\n            handler: handler,\n            key: (_a = opt_options === null || opt_options === void 0 ? void 0 : opt_options.key) !== null && _a !== void 0 ? _a : handler,\n        });\n        return this;\n    }\n    off(eventName, key) {\n        const observers = this.observers_[eventName];\n        if (observers) {\n            this.observers_[eventName] = observers.filter((observer) => {\n                return observer.key !== key;\n            });\n        }\n        return this;\n    }\n    emit(eventName, event) {\n        const observers = this.observers_[eventName];\n        if (!observers) {\n            return;\n        }\n        observers.forEach((observer) => {\n            observer.handler(event);\n        });\n    }\n}\n\nclass ComplexValue {\n    constructor(initialValue, config) {\n        var _a;\n        this.constraint_ = config === null || config === void 0 ? void 0 : config.constraint;\n        this.equals_ = (_a = config === null || config === void 0 ? void 0 : config.equals) !== null && _a !== void 0 ? _a : ((v1, v2) => v1 === v2);\n        this.emitter = new Emitter();\n        this.rawValue_ = initialValue;\n    }\n    get constraint() {\n        return this.constraint_;\n    }\n    get rawValue() {\n        return this.rawValue_;\n    }\n    set rawValue(rawValue) {\n        this.setRawValue(rawValue, {\n            forceEmit: false,\n            last: true,\n        });\n    }\n    setRawValue(rawValue, options) {\n        const opts = options !== null && options !== void 0 ? options : {\n            forceEmit: false,\n            last: true,\n        };\n        const constrainedValue = this.constraint_\n            ? this.constraint_.constrain(rawValue)\n            : rawValue;\n        const prevValue = this.rawValue_;\n        const changed = !this.equals_(prevValue, constrainedValue);\n        if (!changed && !opts.forceEmit) {\n            return;\n        }\n        this.emitter.emit('beforechange', {\n            sender: this,\n        });\n        this.rawValue_ = constrainedValue;\n        this.emitter.emit('change', {\n            options: opts,\n            previousRawValue: prevValue,\n            rawValue: constrainedValue,\n            sender: this,\n        });\n    }\n}\n\nclass PrimitiveValue {\n    constructor(initialValue) {\n        this.emitter = new Emitter();\n        this.value_ = initialValue;\n    }\n    get rawValue() {\n        return this.value_;\n    }\n    set rawValue(value) {\n        this.setRawValue(value, {\n            forceEmit: false,\n            last: true,\n        });\n    }\n    setRawValue(value, options) {\n        const opts = options !== null && options !== void 0 ? options : {\n            forceEmit: false,\n            last: true,\n        };\n        const prevValue = this.value_;\n        if (prevValue === value && !opts.forceEmit) {\n            return;\n        }\n        this.emitter.emit('beforechange', {\n            sender: this,\n        });\n        this.value_ = value;\n        this.emitter.emit('change', {\n            options: opts,\n            previousRawValue: prevValue,\n            rawValue: this.value_,\n            sender: this,\n        });\n    }\n}\n\nclass ReadonlyPrimitiveValue {\n    constructor(value) {\n        this.emitter = new Emitter();\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value_ = value;\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\n\nfunction createValue(initialValue, config) {\n    const constraint = config === null || config === void 0 ? void 0 : config.constraint;\n    const equals = config === null || config === void 0 ? void 0 : config.equals;\n    if (!constraint && !equals) {\n        return new PrimitiveValue(initialValue);\n    }\n    return new ComplexValue(initialValue, config);\n}\nfunction createReadonlyValue(value) {\n    return [\n        new ReadonlyPrimitiveValue(value),\n        (rawValue, options) => {\n            value.setRawValue(rawValue, options);\n        },\n    ];\n}\n\nclass ValueMap {\n    constructor(valueMap) {\n        this.emitter = new Emitter();\n        this.valMap_ = valueMap;\n        for (const key in this.valMap_) {\n            const v = this.valMap_[key];\n            v.emitter.on('change', () => {\n                this.emitter.emit('change', {\n                    key: key,\n                    sender: this,\n                });\n            });\n        }\n    }\n    static createCore(initialValue) {\n        const keys = Object.keys(initialValue);\n        return keys.reduce((o, key) => {\n            return Object.assign(o, {\n                [key]: createValue(initialValue[key]),\n            });\n        }, {});\n    }\n    static fromObject(initialValue) {\n        const core = this.createCore(initialValue);\n        return new ValueMap(core);\n    }\n    get(key) {\n        return this.valMap_[key].rawValue;\n    }\n    set(key, value) {\n        this.valMap_[key].rawValue = value;\n    }\n    value(key) {\n        return this.valMap_[key];\n    }\n}\n\nclass DefiniteRangeConstraint {\n    constructor(config) {\n        this.values = ValueMap.fromObject({\n            max: config.max,\n            min: config.min,\n        });\n    }\n    constrain(value) {\n        const max = this.values.get('max');\n        const min = this.values.get('min');\n        return Math.min(Math.max(value, min), max);\n    }\n}\n\nclass RangeConstraint {\n    constructor(config) {\n        this.values = ValueMap.fromObject({\n            max: config.max,\n            min: config.min,\n        });\n    }\n    constrain(value) {\n        const max = this.values.get('max');\n        const min = this.values.get('min');\n        let result = value;\n        if (!isEmpty(min)) {\n            result = Math.max(result, min);\n        }\n        if (!isEmpty(max)) {\n            result = Math.min(result, max);\n        }\n        return result;\n    }\n}\n\nclass StepConstraint {\n    constructor(step, origin = 0) {\n        this.step = step;\n        this.origin = origin;\n    }\n    constrain(value) {\n        const o = this.origin % this.step;\n        const r = Math.round((value - o) / this.step);\n        return o + r * this.step;\n    }\n}\n\nclass NumberLiteralNode {\n    constructor(text) {\n        this.text = text;\n    }\n    evaluate() {\n        return Number(this.text);\n    }\n    toString() {\n        return this.text;\n    }\n}\nconst BINARY_OPERATION_MAP = {\n    '**': (v1, v2) => Math.pow(v1, v2),\n    '*': (v1, v2) => v1 * v2,\n    '/': (v1, v2) => v1 / v2,\n    '%': (v1, v2) => v1 % v2,\n    '+': (v1, v2) => v1 + v2,\n    '-': (v1, v2) => v1 - v2,\n    '<<': (v1, v2) => v1 << v2,\n    '>>': (v1, v2) => v1 >> v2,\n    '>>>': (v1, v2) => v1 >>> v2,\n    '&': (v1, v2) => v1 & v2,\n    '^': (v1, v2) => v1 ^ v2,\n    '|': (v1, v2) => v1 | v2,\n};\nclass BinaryOperationNode {\n    constructor(operator, left, right) {\n        this.left = left;\n        this.operator = operator;\n        this.right = right;\n    }\n    evaluate() {\n        const op = BINARY_OPERATION_MAP[this.operator];\n        if (!op) {\n            throw new Error(`unexpected binary operator: '${this.operator}`);\n        }\n        return op(this.left.evaluate(), this.right.evaluate());\n    }\n    toString() {\n        return [\n            'b(',\n            this.left.toString(),\n            this.operator,\n            this.right.toString(),\n            ')',\n        ].join(' ');\n    }\n}\nconst UNARY_OPERATION_MAP = {\n    '+': (v) => v,\n    '-': (v) => -v,\n    '~': (v) => ~v,\n};\nclass UnaryOperationNode {\n    constructor(operator, expr) {\n        this.operator = operator;\n        this.expression = expr;\n    }\n    evaluate() {\n        const op = UNARY_OPERATION_MAP[this.operator];\n        if (!op) {\n            throw new Error(`unexpected unary operator: '${this.operator}`);\n        }\n        return op(this.expression.evaluate());\n    }\n    toString() {\n        return ['u(', this.operator, this.expression.toString(), ')'].join(' ');\n    }\n}\n\nfunction combineReader(parsers) {\n    return (text, cursor) => {\n        for (let i = 0; i < parsers.length; i++) {\n            const result = parsers[i](text, cursor);\n            if (result !== '') {\n                return result;\n            }\n        }\n        return '';\n    };\n}\nfunction readWhitespace(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^\\s+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readNonZeroDigit(text, cursor) {\n    const ch = text.substr(cursor, 1);\n    return ch.match(/^[1-9]$/) ? ch : '';\n}\nfunction readDecimalDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-9]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readSignedInteger(text, cursor) {\n    const ds = readDecimalDigits(text, cursor);\n    if (ds !== '') {\n        return ds;\n    }\n    const sign = text.substr(cursor, 1);\n    cursor += 1;\n    if (sign !== '-' && sign !== '+') {\n        return '';\n    }\n    const sds = readDecimalDigits(text, cursor);\n    if (sds === '') {\n        return '';\n    }\n    return sign + sds;\n}\nfunction readExponentPart(text, cursor) {\n    const e = text.substr(cursor, 1);\n    cursor += 1;\n    if (e.toLowerCase() !== 'e') {\n        return '';\n    }\n    const si = readSignedInteger(text, cursor);\n    if (si === '') {\n        return '';\n    }\n    return e + si;\n}\nfunction readDecimalIntegerLiteral(text, cursor) {\n    const ch = text.substr(cursor, 1);\n    if (ch === '0') {\n        return ch;\n    }\n    const nzd = readNonZeroDigit(text, cursor);\n    cursor += nzd.length;\n    if (nzd === '') {\n        return '';\n    }\n    return nzd + readDecimalDigits(text, cursor);\n}\nfunction readDecimalLiteral1(text, cursor) {\n    const dil = readDecimalIntegerLiteral(text, cursor);\n    cursor += dil.length;\n    if (dil === '') {\n        return '';\n    }\n    const dot = text.substr(cursor, 1);\n    cursor += dot.length;\n    if (dot !== '.') {\n        return '';\n    }\n    const dds = readDecimalDigits(text, cursor);\n    cursor += dds.length;\n    return dil + dot + dds + readExponentPart(text, cursor);\n}\nfunction readDecimalLiteral2(text, cursor) {\n    const dot = text.substr(cursor, 1);\n    cursor += dot.length;\n    if (dot !== '.') {\n        return '';\n    }\n    const dds = readDecimalDigits(text, cursor);\n    cursor += dds.length;\n    if (dds === '') {\n        return '';\n    }\n    return dot + dds + readExponentPart(text, cursor);\n}\nfunction readDecimalLiteral3(text, cursor) {\n    const dil = readDecimalIntegerLiteral(text, cursor);\n    cursor += dil.length;\n    if (dil === '') {\n        return '';\n    }\n    return dil + readExponentPart(text, cursor);\n}\nconst readDecimalLiteral = combineReader([\n    readDecimalLiteral1,\n    readDecimalLiteral2,\n    readDecimalLiteral3,\n]);\nfunction parseBinaryDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[01]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readBinaryIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0b') {\n        return '';\n    }\n    const bds = parseBinaryDigits(text, cursor);\n    if (bds === '') {\n        return '';\n    }\n    return prefix + bds;\n}\nfunction readOctalDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-7]+/);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readOctalIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0o') {\n        return '';\n    }\n    const ods = readOctalDigits(text, cursor);\n    if (ods === '') {\n        return '';\n    }\n    return prefix + ods;\n}\nfunction readHexDigits(text, cursor) {\n    var _a;\n    const m = text.substr(cursor).match(/^[0-9a-f]+/i);\n    return (_a = (m && m[0])) !== null && _a !== void 0 ? _a : '';\n}\nfunction readHexIntegerLiteral(text, cursor) {\n    const prefix = text.substr(cursor, 2);\n    cursor += prefix.length;\n    if (prefix.toLowerCase() !== '0x') {\n        return '';\n    }\n    const hds = readHexDigits(text, cursor);\n    if (hds === '') {\n        return '';\n    }\n    return prefix + hds;\n}\nconst readNonDecimalIntegerLiteral = combineReader([\n    readBinaryIntegerLiteral,\n    readOctalIntegerLiteral,\n    readHexIntegerLiteral,\n]);\nconst readNumericLiteral = combineReader([\n    readNonDecimalIntegerLiteral,\n    readDecimalLiteral,\n]);\n\nfunction parseLiteral(text, cursor) {\n    const num = readNumericLiteral(text, cursor);\n    cursor += num.length;\n    if (num === '') {\n        return null;\n    }\n    return {\n        evaluable: new NumberLiteralNode(num),\n        cursor: cursor,\n    };\n}\nfunction parseParenthesizedExpression(text, cursor) {\n    const op = text.substr(cursor, 1);\n    cursor += op.length;\n    if (op !== '(') {\n        return null;\n    }\n    const expr = parseExpression(text, cursor);\n    if (!expr) {\n        return null;\n    }\n    cursor = expr.cursor;\n    cursor += readWhitespace(text, cursor).length;\n    const cl = text.substr(cursor, 1);\n    cursor += cl.length;\n    if (cl !== ')') {\n        return null;\n    }\n    return {\n        evaluable: expr.evaluable,\n        cursor: cursor,\n    };\n}\nfunction parsePrimaryExpression(text, cursor) {\n    var _a;\n    return ((_a = parseLiteral(text, cursor)) !== null && _a !== void 0 ? _a : parseParenthesizedExpression(text, cursor));\n}\nfunction parseUnaryExpression(text, cursor) {\n    const expr = parsePrimaryExpression(text, cursor);\n    if (expr) {\n        return expr;\n    }\n    const op = text.substr(cursor, 1);\n    cursor += op.length;\n    if (op !== '+' && op !== '-' && op !== '~') {\n        return null;\n    }\n    const num = parseUnaryExpression(text, cursor);\n    if (!num) {\n        return null;\n    }\n    cursor = num.cursor;\n    return {\n        cursor: cursor,\n        evaluable: new UnaryOperationNode(op, num.evaluable),\n    };\n}\nfunction readBinaryOperator(ops, text, cursor) {\n    cursor += readWhitespace(text, cursor).length;\n    const op = ops.filter((op) => text.startsWith(op, cursor))[0];\n    if (!op) {\n        return null;\n    }\n    cursor += op.length;\n    cursor += readWhitespace(text, cursor).length;\n    return {\n        cursor: cursor,\n        operator: op,\n    };\n}\nfunction createBinaryOperationExpressionParser(exprParser, ops) {\n    return (text, cursor) => {\n        const firstExpr = exprParser(text, cursor);\n        if (!firstExpr) {\n            return null;\n        }\n        cursor = firstExpr.cursor;\n        let expr = firstExpr.evaluable;\n        for (;;) {\n            const op = readBinaryOperator(ops, text, cursor);\n            if (!op) {\n                break;\n            }\n            cursor = op.cursor;\n            const nextExpr = exprParser(text, cursor);\n            if (!nextExpr) {\n                return null;\n            }\n            cursor = nextExpr.cursor;\n            expr = new BinaryOperationNode(op.operator, expr, nextExpr.evaluable);\n        }\n        return expr\n            ? {\n                cursor: cursor,\n                evaluable: expr,\n            }\n            : null;\n    };\n}\nconst parseBinaryOperationExpression = [\n    ['**'],\n    ['*', '/', '%'],\n    ['+', '-'],\n    ['<<', '>>>', '>>'],\n    ['&'],\n    ['^'],\n    ['|'],\n].reduce((parser, ops) => {\n    return createBinaryOperationExpressionParser(parser, ops);\n}, parseUnaryExpression);\nfunction parseExpression(text, cursor) {\n    cursor += readWhitespace(text, cursor).length;\n    return parseBinaryOperationExpression(text, cursor);\n}\nfunction parseEcmaNumberExpression(text) {\n    const expr = parseExpression(text, 0);\n    if (!expr) {\n        return null;\n    }\n    const cursor = expr.cursor + readWhitespace(text, expr.cursor).length;\n    if (cursor !== text.length) {\n        return null;\n    }\n    return expr.evaluable;\n}\n\nfunction parseNumber(text) {\n    var _a;\n    const r = parseEcmaNumberExpression(text);\n    return (_a = r === null || r === void 0 ? void 0 : r.evaluate()) !== null && _a !== void 0 ? _a : null;\n}\nfunction numberFromUnknown(value) {\n    if (typeof value === 'number') {\n        return value;\n    }\n    if (typeof value === 'string') {\n        const pv = parseNumber(value);\n        if (!isEmpty(pv)) {\n            return pv;\n        }\n    }\n    return 0;\n}\nfunction numberToString(value) {\n    return String(value);\n}\nfunction createNumberFormatter(digits) {\n    return (value) => {\n        return value.toFixed(Math.max(Math.min(digits, 20), 0));\n    };\n}\n\nfunction mapRange(value, start1, end1, start2, end2) {\n    const p = (value - start1) / (end1 - start1);\n    return start2 + p * (end2 - start2);\n}\nfunction getDecimalDigits(value) {\n    const text = String(value.toFixed(10));\n    const frac = text.split('.')[1];\n    return frac.replace(/0+$/, '').length;\n}\nfunction constrainRange(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\nfunction loopRange(value, max) {\n    return ((value % max) + max) % max;\n}\nfunction getSuitableDecimalDigits(params, rawValue) {\n    return !isEmpty(params.step)\n        ? getDecimalDigits(params.step)\n        : Math.max(getDecimalDigits(rawValue), 2);\n}\nfunction getSuitableKeyScale(params) {\n    var _a;\n    return (_a = params.step) !== null && _a !== void 0 ? _a : 1;\n}\nfunction getSuitablePointerScale(params, rawValue) {\n    var _a;\n    const base = Math.abs((_a = params.step) !== null && _a !== void 0 ? _a : rawValue);\n    return base === 0 ? 0.1 : Math.pow(10, Math.floor(Math.log10(base)) - 1);\n}\nfunction createStepConstraint(params, initialValue) {\n    if (!isEmpty(params.step)) {\n        return new StepConstraint(params.step, initialValue);\n    }\n    return null;\n}\nfunction createRangeConstraint(params) {\n    if (!isEmpty(params.max) && !isEmpty(params.min)) {\n        return new DefiniteRangeConstraint({\n            max: params.max,\n            min: params.min,\n        });\n    }\n    if (!isEmpty(params.max) || !isEmpty(params.min)) {\n        return new RangeConstraint({\n            max: params.max,\n            min: params.min,\n        });\n    }\n    return null;\n}\nfunction createNumberTextPropsObject(params, initialValue) {\n    var _a, _b, _c;\n    return {\n        formatter: (_a = params.format) !== null && _a !== void 0 ? _a : createNumberFormatter(getSuitableDecimalDigits(params, initialValue)),\n        keyScale: (_b = params.keyScale) !== null && _b !== void 0 ? _b : getSuitableKeyScale(params),\n        pointerScale: (_c = params.pointerScale) !== null && _c !== void 0 ? _c : getSuitablePointerScale(params, initialValue),\n    };\n}\nfunction createNumberTextInputParamsParser(p) {\n    return {\n        format: p.optional.function,\n        keyScale: p.optional.number,\n        max: p.optional.number,\n        min: p.optional.number,\n        pointerScale: p.optional.number,\n        step: p.optional.number,\n    };\n}\n\nfunction createPointAxis(config) {\n    return {\n        constraint: config.constraint,\n        textProps: ValueMap.fromObject(createNumberTextPropsObject(config.params, config.initialValue)),\n    };\n}\n\nclass BladeApi {\n    constructor(controller) {\n        this.controller = controller;\n    }\n    get element() {\n        return this.controller.view.element;\n    }\n    get disabled() {\n        return this.controller.viewProps.get('disabled');\n    }\n    set disabled(disabled) {\n        this.controller.viewProps.set('disabled', disabled);\n    }\n    get hidden() {\n        return this.controller.viewProps.get('hidden');\n    }\n    set hidden(hidden) {\n        this.controller.viewProps.set('hidden', hidden);\n    }\n    dispose() {\n        this.controller.viewProps.set('disposed', true);\n    }\n    importState(state) {\n        return this.controller.importState(state);\n    }\n    exportState() {\n        return this.controller.exportState();\n    }\n}\n\nclass TpEvent {\n    constructor(target) {\n        this.target = target;\n    }\n}\nclass TpChangeEvent extends TpEvent {\n    constructor(target, value, last) {\n        super(target);\n        this.value = value;\n        this.last = last !== null && last !== void 0 ? last : true;\n    }\n}\nclass TpFoldEvent extends TpEvent {\n    constructor(target, expanded) {\n        super(target);\n        this.expanded = expanded;\n    }\n}\nclass TpTabSelectEvent extends TpEvent {\n    constructor(target, index) {\n        super(target);\n        this.index = index;\n    }\n}\nclass TpMouseEvent extends TpEvent {\n    constructor(target, nativeEvent) {\n        super(target);\n        this.native = nativeEvent;\n    }\n}\n\nclass BindingApi extends BladeApi {\n    constructor(controller) {\n        super(controller);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', this.onValueChange_);\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get key() {\n        return this.controller.value.binding.target.key;\n    }\n    get tag() {\n        return this.controller.tag;\n    }\n    set tag(tag) {\n        this.controller.tag = tag;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n    refresh() {\n        this.controller.value.fetch();\n    }\n    onValueChange_(ev) {\n        const value = this.controller.value;\n        this.emitter_.emit('change', new TpChangeEvent(this, forceCast(value.binding.target.read()), ev.options.last));\n    }\n}\n\nclass InputBindingValue {\n    constructor(value, binding) {\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.binding = binding;\n        this.value_ = value;\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n        this.emitter = new Emitter();\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    set rawValue(rawValue) {\n        this.value_.rawValue = rawValue;\n    }\n    setRawValue(rawValue, options) {\n        this.value_.setRawValue(rawValue, options);\n    }\n    fetch() {\n        this.value_.rawValue = this.binding.read();\n    }\n    push() {\n        this.binding.write(this.value_.rawValue);\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.push();\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\nfunction isInputBindingValue(v) {\n    if (!('binding' in v)) {\n        return false;\n    }\n    const b = v['binding'];\n    return isBinding(b) && 'read' in b && 'write' in b;\n}\n\nfunction parseObject(value, keyToParserMap) {\n    const keys = Object.keys(keyToParserMap);\n    const result = keys.reduce((tmp, key) => {\n        if (tmp === undefined) {\n            return undefined;\n        }\n        const parser = keyToParserMap[key];\n        const result = parser(value[key]);\n        return result.succeeded\n            ? Object.assign(Object.assign({}, tmp), { [key]: result.value }) : undefined;\n    }, {});\n    return forceCast(result);\n}\nfunction parseArray(value, parseItem) {\n    return value.reduce((tmp, item) => {\n        if (tmp === undefined) {\n            return undefined;\n        }\n        const result = parseItem(item);\n        if (!result.succeeded || result.value === undefined) {\n            return undefined;\n        }\n        return [...tmp, result.value];\n    }, []);\n}\nfunction isObject(value) {\n    if (value === null) {\n        return false;\n    }\n    return typeof value === 'object';\n}\nfunction createMicroParserBuilder(parse) {\n    return (optional) => (v) => {\n        if (!optional && v === undefined) {\n            return {\n                succeeded: false,\n                value: undefined,\n            };\n        }\n        if (optional && v === undefined) {\n            return {\n                succeeded: true,\n                value: undefined,\n            };\n        }\n        const result = parse(v);\n        return result !== undefined\n            ? {\n                succeeded: true,\n                value: result,\n            }\n            : {\n                succeeded: false,\n                value: undefined,\n            };\n    };\n}\nfunction createMicroParserBuilders(optional) {\n    return {\n        custom: (parse) => createMicroParserBuilder(parse)(optional),\n        boolean: createMicroParserBuilder((v) => typeof v === 'boolean' ? v : undefined)(optional),\n        number: createMicroParserBuilder((v) => typeof v === 'number' ? v : undefined)(optional),\n        string: createMicroParserBuilder((v) => typeof v === 'string' ? v : undefined)(optional),\n        function: createMicroParserBuilder((v) =>\n        typeof v === 'function' ? v : undefined)(optional),\n        constant: (value) => createMicroParserBuilder((v) => (v === value ? value : undefined))(optional),\n        raw: createMicroParserBuilder((v) => v)(optional),\n        object: (keyToParserMap) => createMicroParserBuilder((v) => {\n            if (!isObject(v)) {\n                return undefined;\n            }\n            return parseObject(v, keyToParserMap);\n        })(optional),\n        array: (itemParser) => createMicroParserBuilder((v) => {\n            if (!Array.isArray(v)) {\n                return undefined;\n            }\n            return parseArray(v, itemParser);\n        })(optional),\n    };\n}\nconst MicroParsers = {\n    optional: createMicroParserBuilders(true),\n    required: createMicroParserBuilders(false),\n};\nfunction parseRecord(value, keyToParserMap) {\n    const map = keyToParserMap(MicroParsers);\n    const result = MicroParsers.required.object(map)(value);\n    return result.succeeded ? result.value : undefined;\n}\n\nfunction importBladeState(state, superImport, parser, callback) {\n    if (superImport && !superImport(state)) {\n        return false;\n    }\n    const result = parseRecord(state, parser);\n    return result ? callback(result) : false;\n}\nfunction exportBladeState(superExport, thisState) {\n    var _a;\n    return deepMerge((_a = superExport === null || superExport === void 0 ? void 0 : superExport()) !== null && _a !== void 0 ? _a : {}, thisState);\n}\n\nfunction isValueBladeController(bc) {\n    return 'value' in bc;\n}\n\nfunction isBindingValue(v) {\n    if (!isObject$1(v) || !('binding' in v)) {\n        return false;\n    }\n    const b = v.binding;\n    return isBinding(b);\n}\n\nconst SVG_NS = 'http://www.w3.org/2000/svg';\nfunction forceReflow(element) {\n    element.offsetHeight;\n}\nfunction disableTransitionTemporarily(element, callback) {\n    const t = element.style.transition;\n    element.style.transition = 'none';\n    callback();\n    element.style.transition = t;\n}\nfunction supportsTouch(doc) {\n    return doc.ontouchstart !== undefined;\n}\nfunction getGlobalObject() {\n    return globalThis;\n}\nfunction getWindowDocument() {\n    const globalObj = forceCast(getGlobalObject());\n    return globalObj.document;\n}\nfunction getCanvasContext(canvasElement) {\n    const win = canvasElement.ownerDocument.defaultView;\n    if (!win) {\n        return null;\n    }\n    const isBrowser = 'document' in win;\n    return isBrowser\n        ? canvasElement.getContext('2d', {\n            willReadFrequently: true,\n        })\n        : null;\n}\nconst ICON_ID_TO_INNER_HTML_MAP = {\n    check: '<path d=\"M2 8l4 4l8 -8\"/>',\n    dropdown: '<path d=\"M5 7h6l-3 3 z\"/>',\n    p2dpad: '<path d=\"M8 4v8\"/><path d=\"M4 8h8\"/><circle cx=\"12\" cy=\"12\" r=\"1.2\"/>',\n};\nfunction createSvgIconElement(document, iconId) {\n    const elem = document.createElementNS(SVG_NS, 'svg');\n    elem.innerHTML = ICON_ID_TO_INNER_HTML_MAP[iconId];\n    return elem;\n}\nfunction insertElementAt(parentElement, element, index) {\n    parentElement.insertBefore(element, parentElement.children[index]);\n}\nfunction removeElement(element) {\n    if (element.parentElement) {\n        element.parentElement.removeChild(element);\n    }\n}\nfunction removeChildElements(element) {\n    while (element.children.length > 0) {\n        element.removeChild(element.children[0]);\n    }\n}\nfunction removeChildNodes(element) {\n    while (element.childNodes.length > 0) {\n        element.removeChild(element.childNodes[0]);\n    }\n}\nfunction findNextTarget(ev) {\n    if (ev.relatedTarget) {\n        return forceCast(ev.relatedTarget);\n    }\n    if ('explicitOriginalTarget' in ev) {\n        return ev.explicitOriginalTarget;\n    }\n    return null;\n}\n\nfunction bindValue(value, applyValue) {\n    value.emitter.on('change', (ev) => {\n        applyValue(ev.rawValue);\n    });\n    applyValue(value.rawValue);\n}\nfunction bindValueMap(valueMap, key, applyValue) {\n    bindValue(valueMap.value(key), applyValue);\n}\n\nconst PREFIX = 'tp';\nfunction ClassName(viewName) {\n    const fn = (opt_elementName, opt_modifier) => {\n        return [\n            PREFIX,\n            '-',\n            viewName,\n            'v',\n            opt_elementName ? `_${opt_elementName}` : '',\n            opt_modifier ? `-${opt_modifier}` : '',\n        ].join('');\n    };\n    return fn;\n}\n\nconst cn$r = ClassName('lbl');\nfunction createLabelNode(doc, label) {\n    const frag = doc.createDocumentFragment();\n    const lineNodes = label.split('\\n').map((line) => {\n        return doc.createTextNode(line);\n    });\n    lineNodes.forEach((lineNode, index) => {\n        if (index > 0) {\n            frag.appendChild(doc.createElement('br'));\n        }\n        frag.appendChild(lineNode);\n    });\n    return frag;\n}\nclass LabelView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$r());\n        config.viewProps.bindClassModifiers(this.element);\n        const labelElem = doc.createElement('div');\n        labelElem.classList.add(cn$r('l'));\n        bindValueMap(config.props, 'label', (value) => {\n            if (isEmpty(value)) {\n                this.element.classList.add(cn$r(undefined, 'nol'));\n            }\n            else {\n                this.element.classList.remove(cn$r(undefined, 'nol'));\n                removeChildNodes(labelElem);\n                labelElem.appendChild(createLabelNode(doc, value));\n            }\n        });\n        this.element.appendChild(labelElem);\n        this.labelElement = labelElem;\n        const valueElem = doc.createElement('div');\n        valueElem.classList.add(cn$r('v'));\n        this.element.appendChild(valueElem);\n        this.valueElement = valueElem;\n    }\n}\n\nclass LabelController {\n    constructor(doc, config) {\n        this.props = config.props;\n        this.valueController = config.valueController;\n        this.viewProps = config.valueController.viewProps;\n        this.view = new LabelView(doc, {\n            props: config.props,\n            viewProps: this.viewProps,\n        });\n        this.view.valueElement.appendChild(this.valueController.view.element);\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            label: p.optional.string,\n        }), (result) => {\n            this.props.set('label', result.label);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            label: this.props.get('label'),\n        });\n    }\n}\n\nfunction getAllBladePositions() {\n    return ['veryfirst', 'first', 'last', 'verylast'];\n}\n\nconst cn$q = ClassName('');\nconst POS_TO_CLASS_NAME_MAP = {\n    veryfirst: 'vfst',\n    first: 'fst',\n    last: 'lst',\n    verylast: 'vlst',\n};\nclass BladeController {\n    constructor(config) {\n        this.parent_ = null;\n        this.blade = config.blade;\n        this.view = config.view;\n        this.viewProps = config.viewProps;\n        const elem = this.view.element;\n        this.blade.value('positions').emitter.on('change', () => {\n            getAllBladePositions().forEach((pos) => {\n                elem.classList.remove(cn$q(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n            });\n            this.blade.get('positions').forEach((pos) => {\n                elem.classList.add(cn$q(undefined, POS_TO_CLASS_NAME_MAP[pos]));\n            });\n        });\n        this.viewProps.handleDispose(() => {\n            removeElement(elem);\n        });\n    }\n    get parent() {\n        return this.parent_;\n    }\n    set parent(parent) {\n        this.parent_ = parent;\n        this.viewProps.set('parent', this.parent_ ? this.parent_.viewProps : null);\n    }\n    importState(state) {\n        return importBladeState(state, null, (p) => ({\n            disabled: p.required.boolean,\n            hidden: p.required.boolean,\n        }), (result) => {\n            this.viewProps.importState(result);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(null, Object.assign({}, this.viewProps.exportState()));\n    }\n}\n\nclass LabeledValueBladeController extends BladeController {\n    constructor(doc, config) {\n        if (config.value !== config.valueController.value) {\n            throw TpError.shouldNeverHappen();\n        }\n        const viewProps = config.valueController.viewProps;\n        const lc = new LabelController(doc, {\n            blade: config.blade,\n            props: config.props,\n            valueController: config.valueController,\n        });\n        super(Object.assign(Object.assign({}, config), { view: new LabelView(doc, {\n                props: config.props,\n                viewProps: viewProps,\n            }), viewProps: viewProps }));\n        this.labelController = lc;\n        this.value = config.value;\n        this.valueController = config.valueController;\n        this.view.valueElement.appendChild(this.valueController.view.element);\n    }\n    importState(state) {\n        return importBladeState(state, (s) => {\n            var _a, _b, _c;\n            return super.importState(s) &&\n                this.labelController.importProps(s) &&\n                ((_c = (_b = (_a = this.valueController).importProps) === null || _b === void 0 ? void 0 : _b.call(_a, state)) !== null && _c !== void 0 ? _c : true);\n        }, (p) => ({\n            value: p.optional.raw,\n        }), (result) => {\n            if (result.value) {\n                this.value.rawValue = result.value;\n            }\n            return true;\n        });\n    }\n    exportState() {\n        var _a, _b, _c;\n        return exportBladeState(() => super.exportState(), Object.assign(Object.assign({ value: this.value.rawValue }, this.labelController.exportProps()), ((_c = (_b = (_a = this.valueController).exportProps) === null || _b === void 0 ? void 0 : _b.call(_a)) !== null && _c !== void 0 ? _c : {})));\n    }\n}\n\nfunction excludeValue(state) {\n    const result = Object.assign({}, state);\n    delete result.value;\n    return result;\n}\nclass BindingController extends LabeledValueBladeController {\n    constructor(doc, config) {\n        super(doc, config);\n        this.tag = config.tag;\n    }\n    importState(state) {\n        return importBladeState(state,\n        (_s) => super.importState(excludeValue(state)), (p) => ({\n            tag: p.optional.string,\n        }), (result) => {\n            this.tag = result.tag;\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => excludeValue(super.exportState()), {\n            binding: {\n                key: this.value.binding.target.key,\n                value: this.value.binding.target.read(),\n            },\n            tag: this.tag,\n        });\n    }\n}\nfunction isBindingController(bc) {\n    return isValueBladeController(bc) && isBindingValue(bc.value);\n}\n\nclass InputBindingController extends BindingController {\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            binding: p.required.object({\n                value: p.required.raw,\n            }),\n        }), (result) => {\n            this.value.binding.inject(result.binding.value);\n            this.value.fetch();\n            return true;\n        });\n    }\n}\nfunction isInputBindingController(bc) {\n    return isValueBladeController(bc) && isInputBindingValue(bc.value);\n}\n\nfunction fillBuffer(buffer, bufferSize) {\n    while (buffer.length < bufferSize) {\n        buffer.push(undefined);\n    }\n}\nfunction initializeBuffer(bufferSize) {\n    const buffer = [];\n    fillBuffer(buffer, bufferSize);\n    return buffer;\n}\nfunction createTrimmedBuffer(buffer) {\n    const index = buffer.indexOf(undefined);\n    return forceCast(index < 0 ? buffer : buffer.slice(0, index));\n}\nfunction createPushedBuffer(buffer, newValue) {\n    const newBuffer = [...createTrimmedBuffer(buffer), newValue];\n    if (newBuffer.length > buffer.length) {\n        newBuffer.splice(0, newBuffer.length - buffer.length);\n    }\n    else {\n        fillBuffer(newBuffer, buffer.length);\n    }\n    return newBuffer;\n}\n\nclass MonitorBindingValue {\n    constructor(config) {\n        this.emitter = new Emitter();\n        this.onTick_ = this.onTick_.bind(this);\n        this.onValueBeforeChange_ = this.onValueBeforeChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.binding = config.binding;\n        this.value_ = createValue(initializeBuffer(config.bufferSize));\n        this.value_.emitter.on('beforechange', this.onValueBeforeChange_);\n        this.value_.emitter.on('change', this.onValueChange_);\n        this.ticker = config.ticker;\n        this.ticker.emitter.on('tick', this.onTick_);\n        this.fetch();\n    }\n    get rawValue() {\n        return this.value_.rawValue;\n    }\n    set rawValue(rawValue) {\n        this.value_.rawValue = rawValue;\n    }\n    setRawValue(rawValue, options) {\n        this.value_.setRawValue(rawValue, options);\n    }\n    fetch() {\n        this.value_.rawValue = createPushedBuffer(this.value_.rawValue, this.binding.read());\n    }\n    onTick_() {\n        this.fetch();\n    }\n    onValueBeforeChange_(ev) {\n        this.emitter.emit('beforechange', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n    onValueChange_(ev) {\n        this.emitter.emit('change', Object.assign(Object.assign({}, ev), { sender: this }));\n    }\n}\nfunction isMonitorBindingValue(v) {\n    if (!('binding' in v)) {\n        return false;\n    }\n    const b = v['binding'];\n    return isBinding(b) && 'read' in b && !('write' in b);\n}\n\nclass MonitorBindingController extends BindingController {\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            binding: {\n                readonly: true,\n            },\n        });\n    }\n}\nfunction isMonitorBindingController(bc) {\n    return (isValueBladeController(bc) &&\n        isMonitorBindingValue(bc.value));\n}\n\nclass ButtonApi extends BladeApi {\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get title() {\n        var _a;\n        return (_a = this.controller.buttonController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n    }\n    set title(title) {\n        this.controller.buttonController.props.set('title', title);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        const emitter = this.controller.buttonController.emitter;\n        emitter.on(eventName, (ev) => {\n            bh(new TpMouseEvent(this, ev.nativeEvent));\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        const emitter = this.controller.buttonController.emitter;\n        emitter.off(eventName, handler);\n        return this;\n    }\n}\n\nfunction applyClass(elem, className, active) {\n    if (active) {\n        elem.classList.add(className);\n    }\n    else {\n        elem.classList.remove(className);\n    }\n}\nfunction valueToClassName(elem, className) {\n    return (value) => {\n        applyClass(elem, className, value);\n    };\n}\nfunction bindValueToTextContent(value, elem) {\n    bindValue(value, (text) => {\n        elem.textContent = text !== null && text !== void 0 ? text : '';\n    });\n}\n\nconst cn$p = ClassName('btn');\nclass ButtonView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$p());\n        config.viewProps.bindClassModifiers(this.element);\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$p('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$p('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n    }\n}\n\nclass ButtonController {\n    constructor(doc, config) {\n        this.emitter = new Emitter();\n        this.onClick_ = this.onClick_.bind(this);\n        this.props = config.props;\n        this.viewProps = config.viewProps;\n        this.view = new ButtonView(doc, {\n            props: this.props,\n            viewProps: this.viewProps,\n        });\n        this.view.buttonElement.addEventListener('click', this.onClick_);\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            title: p.optional.string,\n        }), (result) => {\n            this.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            title: this.props.get('title'),\n        });\n    }\n    onClick_(ev) {\n        this.emitter.emit('click', {\n            nativeEvent: ev,\n            sender: this,\n        });\n    }\n}\n\nclass ButtonBladeController extends BladeController {\n    constructor(doc, config) {\n        const bc = new ButtonController(doc, {\n            props: config.buttonProps,\n            viewProps: config.viewProps,\n        });\n        const lc = new LabelController(doc, {\n            blade: config.blade,\n            props: config.labelProps,\n            valueController: bc,\n        });\n        super({\n            blade: config.blade,\n            view: lc.view,\n            viewProps: config.viewProps,\n        });\n        this.buttonController = bc;\n        this.labelController = lc;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s) &&\n            this.buttonController.importProps(s) &&\n            this.labelController.importProps(s), () => ({}), () => true);\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), Object.assign(Object.assign({}, this.buttonController.exportProps()), this.labelController.exportProps()));\n    }\n}\n\nclass Semver {\n    constructor(text) {\n        const [core, prerelease] = text.split('-');\n        const coreComps = core.split('.');\n        this.major = parseInt(coreComps[0], 10);\n        this.minor = parseInt(coreComps[1], 10);\n        this.patch = parseInt(coreComps[2], 10);\n        this.prerelease = prerelease !== null && prerelease !== void 0 ? prerelease : null;\n    }\n    toString() {\n        const core = [this.major, this.minor, this.patch].join('.');\n        return this.prerelease !== null ? [core, this.prerelease].join('-') : core;\n    }\n}\n\nconst VERSION$1 = new Semver('2.0.5');\n\nfunction createPlugin(plugin) {\n    return Object.assign({ core: VERSION$1 }, plugin);\n}\n\nconst ButtonBladePlugin = createPlugin({\n    id: 'button',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            title: p.required.string,\n            view: p.required.constant('button'),\n            label: p.optional.string,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new ButtonBladeController(args.document, {\n            blade: args.blade,\n            buttonProps: ValueMap.fromObject({\n                title: args.params.title,\n            }),\n            labelProps: ValueMap.fromObject({\n                label: args.params.label,\n            }),\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (args.controller instanceof ButtonBladeController) {\n            return new ButtonApi(args.controller);\n        }\n        return null;\n    },\n});\n\nfunction addButtonAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'button' }));\n}\nfunction addFolderAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'folder' }));\n}\nfunction addTabAsBlade(api, params) {\n    return api.addBlade(Object.assign(Object.assign({}, params), { view: 'tab' }));\n}\n\nfunction isRefreshable(value) {\n    if (!isObject$1(value)) {\n        return false;\n    }\n    return 'refresh' in value && typeof value.refresh === 'function';\n}\n\nfunction createBindingTarget(obj, key) {\n    if (!BindingTarget.isBindable(obj)) {\n        throw TpError.notBindable();\n    }\n    return new BindingTarget(obj, key);\n}\nclass RackApi {\n    constructor(controller, pool) {\n        this.onRackValueChange_ = this.onRackValueChange_.bind(this);\n        this.controller_ = controller;\n        this.emitter_ = new Emitter();\n        this.pool_ = pool;\n        const rack = this.controller_.rack;\n        rack.emitter.on('valuechange', this.onRackValueChange_);\n    }\n    get children() {\n        return this.controller_.rack.children.map((bc) => this.pool_.createApi(bc));\n    }\n    addBinding(object, key, opt_params) {\n        const params = opt_params !== null && opt_params !== void 0 ? opt_params : {};\n        const doc = this.controller_.element.ownerDocument;\n        const bc = this.pool_.createBinding(doc, createBindingTarget(object, key), params);\n        const api = this.pool_.createBindingApi(bc);\n        return this.add(api, params.index);\n    }\n    addFolder(params) {\n        return addFolderAsBlade(this, params);\n    }\n    addButton(params) {\n        return addButtonAsBlade(this, params);\n    }\n    addTab(params) {\n        return addTabAsBlade(this, params);\n    }\n    add(api, opt_index) {\n        const bc = api.controller;\n        this.controller_.rack.add(bc, opt_index);\n        return api;\n    }\n    remove(api) {\n        this.controller_.rack.remove(api.controller);\n    }\n    addBlade(params) {\n        const doc = this.controller_.element.ownerDocument;\n        const bc = this.pool_.createBlade(doc, params);\n        const api = this.pool_.createApi(bc);\n        return this.add(api, params.index);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n    refresh() {\n        this.children.forEach((c) => {\n            if (isRefreshable(c)) {\n                c.refresh();\n            }\n        });\n    }\n    onRackValueChange_(ev) {\n        const bc = ev.bladeController;\n        const api = this.pool_.createApi(bc);\n        const binding = isBindingValue(bc.value) ? bc.value.binding : null;\n        this.emitter_.emit('change', new TpChangeEvent(api, binding ? binding.target.read() : bc.value.rawValue, ev.options.last));\n    }\n}\n\nclass ContainerBladeApi extends BladeApi {\n    constructor(controller, pool) {\n        super(controller);\n        this.rackApi_ = new RackApi(controller.rackController, pool);\n    }\n    refresh() {\n        this.rackApi_.refresh();\n    }\n}\n\nclass ContainerBladeController extends BladeController {\n    constructor(config) {\n        super({\n            blade: config.blade,\n            view: config.view,\n            viewProps: config.rackController.viewProps,\n        });\n        this.rackController = config.rackController;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            children: p.required.array(p.required.raw),\n        }), (result) => {\n            return this.rackController.rack.children.every((c, index) => {\n                return c.importState(result.children[index]);\n            });\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            children: this.rackController.rack.children.map((c) => c.exportState()),\n        });\n    }\n}\nfunction isContainerBladeController(bc) {\n    return 'rackController' in bc;\n}\n\nclass NestedOrderedSet {\n    constructor(extract) {\n        this.emitter = new Emitter();\n        this.items_ = [];\n        this.cache_ = new Set();\n        this.onSubListAdd_ = this.onSubListAdd_.bind(this);\n        this.onSubListRemove_ = this.onSubListRemove_.bind(this);\n        this.extract_ = extract;\n    }\n    get items() {\n        return this.items_;\n    }\n    allItems() {\n        return Array.from(this.cache_);\n    }\n    find(callback) {\n        for (const item of this.allItems()) {\n            if (callback(item)) {\n                return item;\n            }\n        }\n        return null;\n    }\n    includes(item) {\n        return this.cache_.has(item);\n    }\n    add(item, opt_index) {\n        if (this.includes(item)) {\n            throw TpError.shouldNeverHappen();\n        }\n        const index = opt_index !== undefined ? opt_index : this.items_.length;\n        this.items_.splice(index, 0, item);\n        this.cache_.add(item);\n        const subList = this.extract_(item);\n        if (subList) {\n            subList.emitter.on('add', this.onSubListAdd_);\n            subList.emitter.on('remove', this.onSubListRemove_);\n            subList.allItems().forEach((i) => {\n                this.cache_.add(i);\n            });\n        }\n        this.emitter.emit('add', {\n            index: index,\n            item: item,\n            root: this,\n            target: this,\n        });\n    }\n    remove(item) {\n        const index = this.items_.indexOf(item);\n        if (index < 0) {\n            return;\n        }\n        this.items_.splice(index, 1);\n        this.cache_.delete(item);\n        const subList = this.extract_(item);\n        if (subList) {\n            subList.allItems().forEach((i) => {\n                this.cache_.delete(i);\n            });\n            subList.emitter.off('add', this.onSubListAdd_);\n            subList.emitter.off('remove', this.onSubListRemove_);\n        }\n        this.emitter.emit('remove', {\n            index: index,\n            item: item,\n            root: this,\n            target: this,\n        });\n    }\n    onSubListAdd_(ev) {\n        this.cache_.add(ev.item);\n        this.emitter.emit('add', {\n            index: ev.index,\n            item: ev.item,\n            root: this,\n            target: ev.target,\n        });\n    }\n    onSubListRemove_(ev) {\n        this.cache_.delete(ev.item);\n        this.emitter.emit('remove', {\n            index: ev.index,\n            item: ev.item,\n            root: this,\n            target: ev.target,\n        });\n    }\n}\n\nfunction findValueBladeController(bcs, v) {\n    for (let i = 0; i < bcs.length; i++) {\n        const bc = bcs[i];\n        if (isValueBladeController(bc) && bc.value === v) {\n            return bc;\n        }\n    }\n    return null;\n}\nfunction findSubBladeControllerSet(bc) {\n    return isContainerBladeController(bc)\n        ? bc.rackController.rack['bcSet_']\n        : null;\n}\nclass Rack {\n    constructor(config) {\n        var _a, _b;\n        this.emitter = new Emitter();\n        this.onBladePositionsChange_ = this.onBladePositionsChange_.bind(this);\n        this.onSetAdd_ = this.onSetAdd_.bind(this);\n        this.onSetRemove_ = this.onSetRemove_.bind(this);\n        this.onChildDispose_ = this.onChildDispose_.bind(this);\n        this.onChildPositionsChange_ = this.onChildPositionsChange_.bind(this);\n        this.onChildValueChange_ = this.onChildValueChange_.bind(this);\n        this.onChildViewPropsChange_ = this.onChildViewPropsChange_.bind(this);\n        this.onRackLayout_ = this.onRackLayout_.bind(this);\n        this.onRackValueChange_ = this.onRackValueChange_.bind(this);\n        this.blade_ = (_a = config.blade) !== null && _a !== void 0 ? _a : null;\n        (_b = this.blade_) === null || _b === void 0 ? void 0 : _b.value('positions').emitter.on('change', this.onBladePositionsChange_);\n        this.viewProps = config.viewProps;\n        this.bcSet_ = new NestedOrderedSet(findSubBladeControllerSet);\n        this.bcSet_.emitter.on('add', this.onSetAdd_);\n        this.bcSet_.emitter.on('remove', this.onSetRemove_);\n    }\n    get children() {\n        return this.bcSet_.items;\n    }\n    add(bc, opt_index) {\n        var _a;\n        (_a = bc.parent) === null || _a === void 0 ? void 0 : _a.remove(bc);\n        bc.parent = this;\n        this.bcSet_.add(bc, opt_index);\n    }\n    remove(bc) {\n        bc.parent = null;\n        this.bcSet_.remove(bc);\n    }\n    find(finder) {\n        return this.bcSet_.allItems().filter(finder);\n    }\n    onSetAdd_(ev) {\n        this.updatePositions_();\n        const root = ev.target === ev.root;\n        this.emitter.emit('add', {\n            bladeController: ev.item,\n            index: ev.index,\n            root: root,\n            sender: this,\n        });\n        if (!root) {\n            return;\n        }\n        const bc = ev.item;\n        bc.viewProps.emitter.on('change', this.onChildViewPropsChange_);\n        bc.blade\n            .value('positions')\n            .emitter.on('change', this.onChildPositionsChange_);\n        bc.viewProps.handleDispose(this.onChildDispose_);\n        if (isValueBladeController(bc)) {\n            bc.value.emitter.on('change', this.onChildValueChange_);\n        }\n        else if (isContainerBladeController(bc)) {\n            const rack = bc.rackController.rack;\n            if (rack) {\n                const emitter = rack.emitter;\n                emitter.on('layout', this.onRackLayout_);\n                emitter.on('valuechange', this.onRackValueChange_);\n            }\n        }\n    }\n    onSetRemove_(ev) {\n        this.updatePositions_();\n        const root = ev.target === ev.root;\n        this.emitter.emit('remove', {\n            bladeController: ev.item,\n            root: root,\n            sender: this,\n        });\n        if (!root) {\n            return;\n        }\n        const bc = ev.item;\n        if (isValueBladeController(bc)) {\n            bc.value.emitter.off('change', this.onChildValueChange_);\n        }\n        else if (isContainerBladeController(bc)) {\n            const rack = bc.rackController.rack;\n            if (rack) {\n                const emitter = rack.emitter;\n                emitter.off('layout', this.onRackLayout_);\n                emitter.off('valuechange', this.onRackValueChange_);\n            }\n        }\n    }\n    updatePositions_() {\n        const visibleItems = this.bcSet_.items.filter((bc) => !bc.viewProps.get('hidden'));\n        const firstVisibleItem = visibleItems[0];\n        const lastVisibleItem = visibleItems[visibleItems.length - 1];\n        this.bcSet_.items.forEach((bc) => {\n            const ps = [];\n            if (bc === firstVisibleItem) {\n                ps.push('first');\n                if (!this.blade_ ||\n                    this.blade_.get('positions').includes('veryfirst')) {\n                    ps.push('veryfirst');\n                }\n            }\n            if (bc === lastVisibleItem) {\n                ps.push('last');\n                if (!this.blade_ || this.blade_.get('positions').includes('verylast')) {\n                    ps.push('verylast');\n                }\n            }\n            bc.blade.set('positions', ps);\n        });\n    }\n    onChildPositionsChange_() {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onChildViewPropsChange_(_ev) {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onChildDispose_() {\n        const disposedUcs = this.bcSet_.items.filter((bc) => {\n            return bc.viewProps.get('disposed');\n        });\n        disposedUcs.forEach((bc) => {\n            this.bcSet_.remove(bc);\n        });\n    }\n    onChildValueChange_(ev) {\n        const bc = findValueBladeController(this.find(isValueBladeController), ev.sender);\n        if (!bc) {\n            throw TpError.alreadyDisposed();\n        }\n        this.emitter.emit('valuechange', {\n            bladeController: bc,\n            options: ev.options,\n            sender: this,\n        });\n    }\n    onRackLayout_(_) {\n        this.updatePositions_();\n        this.emitter.emit('layout', {\n            sender: this,\n        });\n    }\n    onRackValueChange_(ev) {\n        this.emitter.emit('valuechange', {\n            bladeController: ev.bladeController,\n            options: ev.options,\n            sender: this,\n        });\n    }\n    onBladePositionsChange_() {\n        this.updatePositions_();\n    }\n}\n\nclass RackController {\n    constructor(config) {\n        this.onRackAdd_ = this.onRackAdd_.bind(this);\n        this.onRackRemove_ = this.onRackRemove_.bind(this);\n        this.element = config.element;\n        this.viewProps = config.viewProps;\n        const rack = new Rack({\n            blade: config.root ? undefined : config.blade,\n            viewProps: config.viewProps,\n        });\n        rack.emitter.on('add', this.onRackAdd_);\n        rack.emitter.on('remove', this.onRackRemove_);\n        this.rack = rack;\n        this.viewProps.handleDispose(() => {\n            for (let i = this.rack.children.length - 1; i >= 0; i--) {\n                const bc = this.rack.children[i];\n                bc.viewProps.set('disposed', true);\n            }\n        });\n    }\n    onRackAdd_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        insertElementAt(this.element, ev.bladeController.view.element, ev.index);\n    }\n    onRackRemove_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        removeElement(ev.bladeController.view.element);\n    }\n}\n\nfunction createBlade() {\n    return new ValueMap({\n        positions: createValue([], {\n            equals: deepEqualsArray,\n        }),\n    });\n}\n\nclass Foldable extends ValueMap {\n    constructor(valueMap) {\n        super(valueMap);\n    }\n    static create(expanded) {\n        const coreObj = {\n            completed: true,\n            expanded: expanded,\n            expandedHeight: null,\n            shouldFixHeight: false,\n            temporaryExpanded: null,\n        };\n        const core = ValueMap.createCore(coreObj);\n        return new Foldable(core);\n    }\n    get styleExpanded() {\n        var _a;\n        return (_a = this.get('temporaryExpanded')) !== null && _a !== void 0 ? _a : this.get('expanded');\n    }\n    get styleHeight() {\n        if (!this.styleExpanded) {\n            return '0';\n        }\n        const exHeight = this.get('expandedHeight');\n        if (this.get('shouldFixHeight') && !isEmpty(exHeight)) {\n            return `${exHeight}px`;\n        }\n        return 'auto';\n    }\n    bindExpandedClass(elem, expandedClassName) {\n        const onExpand = () => {\n            const expanded = this.styleExpanded;\n            if (expanded) {\n                elem.classList.add(expandedClassName);\n            }\n            else {\n                elem.classList.remove(expandedClassName);\n            }\n        };\n        bindValueMap(this, 'expanded', onExpand);\n        bindValueMap(this, 'temporaryExpanded', onExpand);\n    }\n    cleanUpTransition() {\n        this.set('shouldFixHeight', false);\n        this.set('expandedHeight', null);\n        this.set('completed', true);\n    }\n}\nfunction computeExpandedFolderHeight(folder, containerElement) {\n    let height = 0;\n    disableTransitionTemporarily(containerElement, () => {\n        folder.set('expandedHeight', null);\n        folder.set('temporaryExpanded', true);\n        forceReflow(containerElement);\n        height = containerElement.clientHeight;\n        folder.set('temporaryExpanded', null);\n        forceReflow(containerElement);\n    });\n    return height;\n}\nfunction applyHeight(foldable, elem) {\n    elem.style.height = foldable.styleHeight;\n}\nfunction bindFoldable(foldable, elem) {\n    foldable.value('expanded').emitter.on('beforechange', () => {\n        foldable.set('completed', false);\n        if (isEmpty(foldable.get('expandedHeight'))) {\n            const h = computeExpandedFolderHeight(foldable, elem);\n            if (h > 0) {\n                foldable.set('expandedHeight', h);\n            }\n        }\n        foldable.set('shouldFixHeight', true);\n        forceReflow(elem);\n    });\n    foldable.emitter.on('change', () => {\n        applyHeight(foldable, elem);\n    });\n    applyHeight(foldable, elem);\n    elem.addEventListener('transitionend', (ev) => {\n        if (ev.propertyName !== 'height') {\n            return;\n        }\n        foldable.cleanUpTransition();\n    });\n}\n\nclass FolderApi extends ContainerBladeApi {\n    constructor(controller, pool) {\n        super(controller, pool);\n        this.emitter_ = new Emitter();\n        this.controller.foldable\n            .value('expanded')\n            .emitter.on('change', (ev) => {\n            this.emitter_.emit('fold', new TpFoldEvent(this, ev.sender.rawValue));\n        });\n        this.rackApi_.on('change', (ev) => {\n            this.emitter_.emit('change', ev);\n        });\n    }\n    get expanded() {\n        return this.controller.foldable.get('expanded');\n    }\n    set expanded(expanded) {\n        this.controller.foldable.set('expanded', expanded);\n    }\n    get title() {\n        return this.controller.props.get('title');\n    }\n    set title(title) {\n        this.controller.props.set('title', title);\n    }\n    get children() {\n        return this.rackApi_.children;\n    }\n    addBinding(object, key, opt_params) {\n        return this.rackApi_.addBinding(object, key, opt_params);\n    }\n    addFolder(params) {\n        return this.rackApi_.addFolder(params);\n    }\n    addButton(params) {\n        return this.rackApi_.addButton(params);\n    }\n    addTab(params) {\n        return this.rackApi_.addTab(params);\n    }\n    add(api, opt_index) {\n        return this.rackApi_.add(api, opt_index);\n    }\n    remove(api) {\n        this.rackApi_.remove(api);\n    }\n    addBlade(params) {\n        return this.rackApi_.addBlade(params);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n}\n\nconst bladeContainerClassName = ClassName('cnt');\n\nclass FolderView {\n    constructor(doc, config) {\n        var _a;\n        this.className_ = ClassName((_a = config.viewName) !== null && _a !== void 0 ? _a : 'fld');\n        this.element = doc.createElement('div');\n        this.element.classList.add(this.className_(), bladeContainerClassName());\n        config.viewProps.bindClassModifiers(this.element);\n        this.foldable_ = config.foldable;\n        this.foldable_.bindExpandedClass(this.element, this.className_(undefined, 'expanded'));\n        bindValueMap(this.foldable_, 'completed', valueToClassName(this.element, this.className_(undefined, 'cpl')));\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(this.className_('b'));\n        bindValueMap(config.props, 'title', (title) => {\n            if (isEmpty(title)) {\n                this.element.classList.add(this.className_(undefined, 'not'));\n            }\n            else {\n                this.element.classList.remove(this.className_(undefined, 'not'));\n            }\n        });\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const indentElem = doc.createElement('div');\n        indentElem.classList.add(this.className_('i'));\n        this.element.appendChild(indentElem);\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(this.className_('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n        this.titleElement = titleElem;\n        const markElem = doc.createElement('div');\n        markElem.classList.add(this.className_('m'));\n        this.buttonElement.appendChild(markElem);\n        const containerElem = doc.createElement('div');\n        containerElem.classList.add(this.className_('c'));\n        this.element.appendChild(containerElem);\n        this.containerElement = containerElem;\n    }\n}\n\nclass FolderController extends ContainerBladeController {\n    constructor(doc, config) {\n        var _a;\n        const foldable = Foldable.create((_a = config.expanded) !== null && _a !== void 0 ? _a : true);\n        const view = new FolderView(doc, {\n            foldable: foldable,\n            props: config.props,\n            viewName: config.root ? 'rot' : undefined,\n            viewProps: config.viewProps,\n        });\n        super(Object.assign(Object.assign({}, config), { rackController: new RackController({\n                blade: config.blade,\n                element: view.containerElement,\n                root: config.root,\n                viewProps: config.viewProps,\n            }), view: view }));\n        this.onTitleClick_ = this.onTitleClick_.bind(this);\n        this.props = config.props;\n        this.foldable = foldable;\n        bindFoldable(this.foldable, this.view.containerElement);\n        this.rackController.rack.emitter.on('add', () => {\n            this.foldable.cleanUpTransition();\n        });\n        this.rackController.rack.emitter.on('remove', () => {\n            this.foldable.cleanUpTransition();\n        });\n        this.view.buttonElement.addEventListener('click', this.onTitleClick_);\n    }\n    get document() {\n        return this.view.element.ownerDocument;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            expanded: p.required.boolean,\n            title: p.optional.string,\n        }), (result) => {\n            this.foldable.set('expanded', result.expanded);\n            this.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            expanded: this.foldable.get('expanded'),\n            title: this.props.get('title'),\n        });\n    }\n    onTitleClick_() {\n        this.foldable.set('expanded', !this.foldable.get('expanded'));\n    }\n}\n\nconst FolderBladePlugin = createPlugin({\n    id: 'folder',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            title: p.required.string,\n            view: p.required.constant('folder'),\n            expanded: p.optional.boolean,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new FolderController(args.document, {\n            blade: args.blade,\n            expanded: args.params.expanded,\n            props: ValueMap.fromObject({\n                title: args.params.title,\n            }),\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof FolderController)) {\n            return null;\n        }\n        return new FolderApi(args.controller, args.pool);\n    },\n});\n\nconst cn$o = ClassName('');\nfunction valueToModifier(elem, modifier) {\n    return valueToClassName(elem, cn$o(undefined, modifier));\n}\nclass ViewProps extends ValueMap {\n    constructor(valueMap) {\n        var _a;\n        super(valueMap);\n        this.onDisabledChange_ = this.onDisabledChange_.bind(this);\n        this.onParentChange_ = this.onParentChange_.bind(this);\n        this.onParentGlobalDisabledChange_ =\n            this.onParentGlobalDisabledChange_.bind(this);\n        [this.globalDisabled_, this.setGlobalDisabled_] = createReadonlyValue(createValue(this.getGlobalDisabled_()));\n        this.value('disabled').emitter.on('change', this.onDisabledChange_);\n        this.value('parent').emitter.on('change', this.onParentChange_);\n        (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n    }\n    static create(opt_initialValue) {\n        var _a, _b, _c;\n        const initialValue = opt_initialValue !== null && opt_initialValue !== void 0 ? opt_initialValue : {};\n        return new ViewProps(ValueMap.createCore({\n            disabled: (_a = initialValue.disabled) !== null && _a !== void 0 ? _a : false,\n            disposed: false,\n            hidden: (_b = initialValue.hidden) !== null && _b !== void 0 ? _b : false,\n            parent: (_c = initialValue.parent) !== null && _c !== void 0 ? _c : null,\n        }));\n    }\n    get globalDisabled() {\n        return this.globalDisabled_;\n    }\n    bindClassModifiers(elem) {\n        bindValue(this.globalDisabled_, valueToModifier(elem, 'disabled'));\n        bindValueMap(this, 'hidden', valueToModifier(elem, 'hidden'));\n    }\n    bindDisabled(target) {\n        bindValue(this.globalDisabled_, (disabled) => {\n            target.disabled = disabled;\n        });\n    }\n    bindTabIndex(elem) {\n        bindValue(this.globalDisabled_, (disabled) => {\n            elem.tabIndex = disabled ? -1 : 0;\n        });\n    }\n    handleDispose(callback) {\n        this.value('disposed').emitter.on('change', (disposed) => {\n            if (disposed) {\n                callback();\n            }\n        });\n    }\n    importState(state) {\n        this.set('disabled', state.disabled);\n        this.set('hidden', state.hidden);\n    }\n    exportState() {\n        return {\n            disabled: this.get('disabled'),\n            hidden: this.get('hidden'),\n        };\n    }\n    getGlobalDisabled_() {\n        const parent = this.get('parent');\n        const parentDisabled = parent ? parent.globalDisabled.rawValue : false;\n        return parentDisabled || this.get('disabled');\n    }\n    updateGlobalDisabled_() {\n        this.setGlobalDisabled_(this.getGlobalDisabled_());\n    }\n    onDisabledChange_() {\n        this.updateGlobalDisabled_();\n    }\n    onParentGlobalDisabledChange_() {\n        this.updateGlobalDisabled_();\n    }\n    onParentChange_(ev) {\n        var _a;\n        const prevParent = ev.previousRawValue;\n        prevParent === null || prevParent === void 0 ? void 0 : prevParent.globalDisabled.emitter.off('change', this.onParentGlobalDisabledChange_);\n        (_a = this.get('parent')) === null || _a === void 0 ? void 0 : _a.globalDisabled.emitter.on('change', this.onParentGlobalDisabledChange_);\n        this.updateGlobalDisabled_();\n    }\n}\n\nconst cn$n = ClassName('tbp');\nclass TabPageView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$n());\n        config.viewProps.bindClassModifiers(this.element);\n        const containerElem = doc.createElement('div');\n        containerElem.classList.add(cn$n('c'));\n        this.element.appendChild(containerElem);\n        this.containerElement = containerElem;\n    }\n}\n\nconst cn$m = ClassName('tbi');\nclass TabItemView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$m());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValueMap(config.props, 'selected', (selected) => {\n            if (selected) {\n                this.element.classList.add(cn$m(undefined, 'sel'));\n            }\n            else {\n                this.element.classList.remove(cn$m(undefined, 'sel'));\n            }\n        });\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$m('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$m('t'));\n        bindValueToTextContent(config.props.value('title'), titleElem);\n        this.buttonElement.appendChild(titleElem);\n        this.titleElement = titleElem;\n    }\n}\n\nclass TabItemController {\n    constructor(doc, config) {\n        this.emitter = new Emitter();\n        this.onClick_ = this.onClick_.bind(this);\n        this.props = config.props;\n        this.viewProps = config.viewProps;\n        this.view = new TabItemView(doc, {\n            props: config.props,\n            viewProps: config.viewProps,\n        });\n        this.view.buttonElement.addEventListener('click', this.onClick_);\n    }\n    onClick_() {\n        this.emitter.emit('click', {\n            sender: this,\n        });\n    }\n}\n\nclass TabPageController extends ContainerBladeController {\n    constructor(doc, config) {\n        const view = new TabPageView(doc, {\n            viewProps: config.viewProps,\n        });\n        super(Object.assign(Object.assign({}, config), { rackController: new RackController({\n                blade: config.blade,\n                element: view.containerElement,\n                viewProps: config.viewProps,\n            }), view: view }));\n        this.onItemClick_ = this.onItemClick_.bind(this);\n        this.ic_ = new TabItemController(doc, {\n            props: config.itemProps,\n            viewProps: ViewProps.create(),\n        });\n        this.ic_.emitter.on('click', this.onItemClick_);\n        this.props = config.props;\n        bindValueMap(this.props, 'selected', (selected) => {\n            this.itemController.props.set('selected', selected);\n            this.viewProps.set('hidden', !selected);\n        });\n    }\n    get itemController() {\n        return this.ic_;\n    }\n    importState(state) {\n        return importBladeState(state, (s) => super.importState(s), (p) => ({\n            selected: p.required.boolean,\n            title: p.required.string,\n        }), (result) => {\n            this.ic_.props.set('selected', result.selected);\n            this.ic_.props.set('title', result.title);\n            return true;\n        });\n    }\n    exportState() {\n        return exportBladeState(() => super.exportState(), {\n            selected: this.ic_.props.get('selected'),\n            title: this.ic_.props.get('title'),\n        });\n    }\n    onItemClick_() {\n        this.props.set('selected', true);\n    }\n}\n\nclass TabApi extends ContainerBladeApi {\n    constructor(controller, pool) {\n        super(controller, pool);\n        this.emitter_ = new Emitter();\n        this.onSelect_ = this.onSelect_.bind(this);\n        this.pool_ = pool;\n        this.rackApi_.on('change', (ev) => {\n            this.emitter_.emit('change', ev);\n        });\n        this.controller.tab.selectedIndex.emitter.on('change', this.onSelect_);\n    }\n    get pages() {\n        return this.rackApi_.children;\n    }\n    addPage(params) {\n        const doc = this.controller.view.element.ownerDocument;\n        const pc = new TabPageController(doc, {\n            blade: createBlade(),\n            itemProps: ValueMap.fromObject({\n                selected: false,\n                title: params.title,\n            }),\n            props: ValueMap.fromObject({\n                selected: false,\n            }),\n            viewProps: ViewProps.create(),\n        });\n        const papi = this.pool_.createApi(pc);\n        return this.rackApi_.add(papi, params.index);\n    }\n    removePage(index) {\n        this.rackApi_.remove(this.rackApi_.children[index]);\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n    onSelect_(ev) {\n        this.emitter_.emit('select', new TpTabSelectEvent(this, ev.rawValue));\n    }\n}\n\nclass TabPageApi extends ContainerBladeApi {\n    get title() {\n        var _a;\n        return (_a = this.controller.itemController.props.get('title')) !== null && _a !== void 0 ? _a : '';\n    }\n    set title(title) {\n        this.controller.itemController.props.set('title', title);\n    }\n    get selected() {\n        return this.controller.props.get('selected');\n    }\n    set selected(selected) {\n        this.controller.props.set('selected', selected);\n    }\n    get children() {\n        return this.rackApi_.children;\n    }\n    addButton(params) {\n        return this.rackApi_.addButton(params);\n    }\n    addFolder(params) {\n        return this.rackApi_.addFolder(params);\n    }\n    addTab(params) {\n        return this.rackApi_.addTab(params);\n    }\n    add(api, opt_index) {\n        this.rackApi_.add(api, opt_index);\n    }\n    remove(api) {\n        this.rackApi_.remove(api);\n    }\n    addBinding(object, key, opt_params) {\n        return this.rackApi_.addBinding(object, key, opt_params);\n    }\n    addBlade(params) {\n        return this.rackApi_.addBlade(params);\n    }\n}\n\nconst INDEX_NOT_SELECTED = -1;\nclass Tab {\n    constructor() {\n        this.onItemSelectedChange_ = this.onItemSelectedChange_.bind(this);\n        this.empty = createValue(true);\n        this.selectedIndex = createValue(INDEX_NOT_SELECTED);\n        this.items_ = [];\n    }\n    add(item, opt_index) {\n        const index = opt_index !== null && opt_index !== void 0 ? opt_index : this.items_.length;\n        this.items_.splice(index, 0, item);\n        item.emitter.on('change', this.onItemSelectedChange_);\n        this.keepSelection_();\n    }\n    remove(item) {\n        const index = this.items_.indexOf(item);\n        if (index < 0) {\n            return;\n        }\n        this.items_.splice(index, 1);\n        item.emitter.off('change', this.onItemSelectedChange_);\n        this.keepSelection_();\n    }\n    keepSelection_() {\n        if (this.items_.length === 0) {\n            this.selectedIndex.rawValue = INDEX_NOT_SELECTED;\n            this.empty.rawValue = true;\n            return;\n        }\n        const firstSelIndex = this.items_.findIndex((s) => s.rawValue);\n        if (firstSelIndex < 0) {\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === 0;\n            });\n            this.selectedIndex.rawValue = 0;\n        }\n        else {\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === firstSelIndex;\n            });\n            this.selectedIndex.rawValue = firstSelIndex;\n        }\n        this.empty.rawValue = false;\n    }\n    onItemSelectedChange_(ev) {\n        if (ev.rawValue) {\n            const index = this.items_.findIndex((s) => s === ev.sender);\n            this.items_.forEach((s, i) => {\n                s.rawValue = i === index;\n            });\n            this.selectedIndex.rawValue = index;\n        }\n        else {\n            this.keepSelection_();\n        }\n    }\n}\n\nconst cn$l = ClassName('tab');\nclass TabView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$l(), bladeContainerClassName());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.empty, valueToClassName(this.element, cn$l(undefined, 'nop')));\n        const titleElem = doc.createElement('div');\n        titleElem.classList.add(cn$l('t'));\n        this.element.appendChild(titleElem);\n        this.itemsElement = titleElem;\n        const indentElem = doc.createElement('div');\n        indentElem.classList.add(cn$l('i'));\n        this.element.appendChild(indentElem);\n        const contentsElem = doc.createElement('div');\n        contentsElem.classList.add(cn$l('c'));\n        this.element.appendChild(contentsElem);\n        this.contentsElement = contentsElem;\n    }\n}\n\nclass TabController extends ContainerBladeController {\n    constructor(doc, config) {\n        const tab = new Tab();\n        const view = new TabView(doc, {\n            empty: tab.empty,\n            viewProps: config.viewProps,\n        });\n        super({\n            blade: config.blade,\n            rackController: new RackController({\n                blade: config.blade,\n                element: view.contentsElement,\n                viewProps: config.viewProps,\n            }),\n            view: view,\n        });\n        this.onRackAdd_ = this.onRackAdd_.bind(this);\n        this.onRackRemove_ = this.onRackRemove_.bind(this);\n        const rack = this.rackController.rack;\n        rack.emitter.on('add', this.onRackAdd_);\n        rack.emitter.on('remove', this.onRackRemove_);\n        this.tab = tab;\n    }\n    add(pc, opt_index) {\n        this.rackController.rack.add(pc, opt_index);\n    }\n    remove(index) {\n        this.rackController.rack.remove(this.rackController.rack.children[index]);\n    }\n    onRackAdd_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        const pc = ev.bladeController;\n        insertElementAt(this.view.itemsElement, pc.itemController.view.element, ev.index);\n        pc.itemController.viewProps.set('parent', this.viewProps);\n        this.tab.add(pc.props.value('selected'));\n    }\n    onRackRemove_(ev) {\n        if (!ev.root) {\n            return;\n        }\n        const pc = ev.bladeController;\n        removeElement(pc.itemController.view.element);\n        pc.itemController.viewProps.set('parent', null);\n        this.tab.remove(pc.props.value('selected'));\n    }\n}\n\nconst TabBladePlugin = createPlugin({\n    id: 'tab',\n    type: 'blade',\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            pages: p.required.array(p.required.object({ title: p.required.string })),\n            view: p.required.constant('tab'),\n        }));\n        if (!result || result.pages.length === 0) {\n            return null;\n        }\n        return { params: result };\n    },\n    controller(args) {\n        const c = new TabController(args.document, {\n            blade: args.blade,\n            viewProps: args.viewProps,\n        });\n        args.params.pages.forEach((p) => {\n            const pc = new TabPageController(args.document, {\n                blade: createBlade(),\n                itemProps: ValueMap.fromObject({\n                    selected: false,\n                    title: p.title,\n                }),\n                props: ValueMap.fromObject({\n                    selected: false,\n                }),\n                viewProps: ViewProps.create(),\n            });\n            c.add(pc);\n        });\n        return c;\n    },\n    api(args) {\n        if (args.controller instanceof TabController) {\n            return new TabApi(args.controller, args.pool);\n        }\n        if (args.controller instanceof TabPageController) {\n            return new TabPageApi(args.controller, args.pool);\n        }\n        return null;\n    },\n});\n\nfunction createBladeController(plugin, args) {\n    const ac = plugin.accept(args.params);\n    if (!ac) {\n        return null;\n    }\n    const params = parseRecord(args.params, (p) => ({\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n    }));\n    return plugin.controller({\n        blade: createBlade(),\n        document: args.document,\n        params: forceCast(Object.assign(Object.assign({}, ac.params), { disabled: params === null || params === void 0 ? void 0 : params.disabled, hidden: params === null || params === void 0 ? void 0 : params.hidden })),\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n}\n\nclass ListInputBindingApi extends BindingApi {\n    get options() {\n        return this.controller.valueController.props.get('options');\n    }\n    set options(options) {\n        this.controller.valueController.props.set('options', options);\n    }\n}\n\nclass ManualTicker {\n    constructor() {\n        this.disabled = false;\n        this.emitter = new Emitter();\n    }\n    dispose() { }\n    tick() {\n        if (this.disabled) {\n            return;\n        }\n        this.emitter.emit('tick', {\n            sender: this,\n        });\n    }\n}\n\nclass IntervalTicker {\n    constructor(doc, interval) {\n        this.disabled_ = false;\n        this.timerId_ = null;\n        this.onTick_ = this.onTick_.bind(this);\n        this.doc_ = doc;\n        this.emitter = new Emitter();\n        this.interval_ = interval;\n        this.setTimer_();\n    }\n    get disabled() {\n        return this.disabled_;\n    }\n    set disabled(inactive) {\n        this.disabled_ = inactive;\n        if (this.disabled_) {\n            this.clearTimer_();\n        }\n        else {\n            this.setTimer_();\n        }\n    }\n    dispose() {\n        this.clearTimer_();\n    }\n    clearTimer_() {\n        if (this.timerId_ === null) {\n            return;\n        }\n        const win = this.doc_.defaultView;\n        if (win) {\n            win.clearInterval(this.timerId_);\n        }\n        this.timerId_ = null;\n    }\n    setTimer_() {\n        this.clearTimer_();\n        if (this.interval_ <= 0) {\n            return;\n        }\n        const win = this.doc_.defaultView;\n        if (win) {\n            this.timerId_ = win.setInterval(this.onTick_, this.interval_);\n        }\n    }\n    onTick_() {\n        if (this.disabled_) {\n            return;\n        }\n        this.emitter.emit('tick', {\n            sender: this,\n        });\n    }\n}\n\nclass CompositeConstraint {\n    constructor(constraints) {\n        this.constraints = constraints;\n    }\n    constrain(value) {\n        return this.constraints.reduce((result, c) => {\n            return c.constrain(result);\n        }, value);\n    }\n}\nfunction findConstraint(c, constraintClass) {\n    if (c instanceof constraintClass) {\n        return c;\n    }\n    if (c instanceof CompositeConstraint) {\n        const result = c.constraints.reduce((tmpResult, sc) => {\n            if (tmpResult) {\n                return tmpResult;\n            }\n            return sc instanceof constraintClass ? sc : null;\n        }, null);\n        if (result) {\n            return result;\n        }\n    }\n    return null;\n}\n\nclass ListConstraint {\n    constructor(options) {\n        this.values = ValueMap.fromObject({\n            options: options,\n        });\n    }\n    constrain(value) {\n        const opts = this.values.get('options');\n        if (opts.length === 0) {\n            return value;\n        }\n        const matched = opts.filter((item) => {\n            return item.value === value;\n        }).length > 0;\n        return matched ? value : opts[0].value;\n    }\n}\n\nfunction parseListOptions(value) {\n    var _a;\n    const p = MicroParsers;\n    if (Array.isArray(value)) {\n        return (_a = parseRecord({ items: value }, (p) => ({\n            items: p.required.array(p.required.object({\n                text: p.required.string,\n                value: p.required.raw,\n            })),\n        }))) === null || _a === void 0 ? void 0 : _a.items;\n    }\n    if (typeof value === 'object') {\n        return p.required.raw(value)\n            .value;\n    }\n    return undefined;\n}\nfunction normalizeListOptions(options) {\n    if (Array.isArray(options)) {\n        return options;\n    }\n    const items = [];\n    Object.keys(options).forEach((text) => {\n        items.push({ text: text, value: options[text] });\n    });\n    return items;\n}\nfunction createListConstraint(options) {\n    return !isEmpty(options)\n        ? new ListConstraint(normalizeListOptions(forceCast(options)))\n        : null;\n}\n\nconst cn$k = ClassName('lst');\nclass ListView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.props_ = config.props;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$k());\n        config.viewProps.bindClassModifiers(this.element);\n        const selectElem = doc.createElement('select');\n        selectElem.classList.add(cn$k('s'));\n        config.viewProps.bindDisabled(selectElem);\n        this.element.appendChild(selectElem);\n        this.selectElement = selectElem;\n        const markElem = doc.createElement('div');\n        markElem.classList.add(cn$k('m'));\n        markElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n        this.element.appendChild(markElem);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value_ = config.value;\n        bindValueMap(this.props_, 'options', (opts) => {\n            removeChildElements(this.selectElement);\n            opts.forEach((item) => {\n                const optionElem = doc.createElement('option');\n                optionElem.textContent = item.text;\n                this.selectElement.appendChild(optionElem);\n            });\n            this.update_();\n        });\n    }\n    update_() {\n        const values = this.props_.get('options').map((o) => o.value);\n        this.selectElement.selectedIndex = values.indexOf(this.value_.rawValue);\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass ListController {\n    constructor(doc, config) {\n        this.onSelectChange_ = this.onSelectChange_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new ListView(doc, {\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.selectElement.addEventListener('change', this.onSelectChange_);\n    }\n    onSelectChange_(e) {\n        const selectElem = forceCast(e.currentTarget);\n        this.value.rawValue =\n            this.props.get('options')[selectElem.selectedIndex].value;\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            options: p.required.custom(parseListOptions),\n        }), (result) => {\n            this.props.set('options', normalizeListOptions(result.options));\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            options: this.props.get('options'),\n        });\n    }\n}\n\nconst cn$j = ClassName('pop');\nclass PopupView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$j());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.shows, valueToClassName(this.element, cn$j(undefined, 'v')));\n    }\n}\n\nclass PopupController {\n    constructor(doc, config) {\n        this.shows = createValue(false);\n        this.viewProps = config.viewProps;\n        this.view = new PopupView(doc, {\n            shows: this.shows,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst cn$i = ClassName('txt');\nclass TextView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$i());\n        config.viewProps.bindClassModifiers(this.element);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$i('i'));\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value_ = config.value;\n        this.refresh();\n    }\n    refresh() {\n        const formatter = this.props_.get('formatter');\n        this.inputElement.value = formatter(this.value_.rawValue);\n    }\n    onChange_() {\n        this.refresh();\n    }\n}\n\nclass TextController {\n    constructor(doc, config) {\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.parser_ = config.parser;\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new TextView(doc, {\n            props: config.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n    }\n    onInputChange_(e) {\n        const inputElem = forceCast(e.currentTarget);\n        const value = inputElem.value;\n        const parsedValue = this.parser_(value);\n        if (!isEmpty(parsedValue)) {\n            this.value.rawValue = parsedValue;\n        }\n        this.view.refresh();\n    }\n}\n\nfunction boolToString(value) {\n    return String(value);\n}\nfunction boolFromUnknown(value) {\n    if (value === 'false') {\n        return false;\n    }\n    return !!value;\n}\nfunction BooleanFormatter(value) {\n    return boolToString(value);\n}\n\nfunction composeParsers(parsers) {\n    return (text) => {\n        return parsers.reduce((result, parser) => {\n            if (result !== null) {\n                return result;\n            }\n            return parser(text);\n        }, null);\n    };\n}\n\nconst innerFormatter = createNumberFormatter(0);\nfunction formatPercentage(value) {\n    return innerFormatter(value) + '%';\n}\n\nfunction stringFromUnknown(value) {\n    return String(value);\n}\nfunction formatString(value) {\n    return value;\n}\n\nfunction connectValues({ primary, secondary, forward, backward, }) {\n    let changing = false;\n    function preventFeedback(callback) {\n        if (changing) {\n            return;\n        }\n        changing = true;\n        callback();\n        changing = false;\n    }\n    primary.emitter.on('change', (ev) => {\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n    });\n    secondary.emitter.on('change', (ev) => {\n        preventFeedback(() => {\n            primary.setRawValue(backward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n        preventFeedback(() => {\n            secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), ev.options);\n        });\n    });\n    preventFeedback(() => {\n        secondary.setRawValue(forward(primary.rawValue, secondary.rawValue), {\n            forceEmit: false,\n            last: true,\n        });\n    });\n}\n\nfunction getStepForKey(keyScale, keys) {\n    const step = keyScale * (keys.altKey ? 0.1 : 1) * (keys.shiftKey ? 10 : 1);\n    if (keys.upKey) {\n        return +step;\n    }\n    else if (keys.downKey) {\n        return -step;\n    }\n    return 0;\n}\nfunction getVerticalStepKeys(ev) {\n    return {\n        altKey: ev.altKey,\n        downKey: ev.key === 'ArrowDown',\n        shiftKey: ev.shiftKey,\n        upKey: ev.key === 'ArrowUp',\n    };\n}\nfunction getHorizontalStepKeys(ev) {\n    return {\n        altKey: ev.altKey,\n        downKey: ev.key === 'ArrowLeft',\n        shiftKey: ev.shiftKey,\n        upKey: ev.key === 'ArrowRight',\n    };\n}\nfunction isVerticalArrowKey(key) {\n    return key === 'ArrowUp' || key === 'ArrowDown';\n}\nfunction isArrowKey(key) {\n    return isVerticalArrowKey(key) || key === 'ArrowLeft' || key === 'ArrowRight';\n}\n\nfunction computeOffset$1(ev, elem) {\n    var _a, _b;\n    const win = elem.ownerDocument.defaultView;\n    const rect = elem.getBoundingClientRect();\n    return {\n        x: ev.pageX - (((_a = (win && win.scrollX)) !== null && _a !== void 0 ? _a : 0) + rect.left),\n        y: ev.pageY - (((_b = (win && win.scrollY)) !== null && _b !== void 0 ? _b : 0) + rect.top),\n    };\n}\nclass PointerHandler {\n    constructor(element) {\n        this.lastTouch_ = null;\n        this.onDocumentMouseMove_ = this.onDocumentMouseMove_.bind(this);\n        this.onDocumentMouseUp_ = this.onDocumentMouseUp_.bind(this);\n        this.onMouseDown_ = this.onMouseDown_.bind(this);\n        this.onTouchEnd_ = this.onTouchEnd_.bind(this);\n        this.onTouchMove_ = this.onTouchMove_.bind(this);\n        this.onTouchStart_ = this.onTouchStart_.bind(this);\n        this.elem_ = element;\n        this.emitter = new Emitter();\n        element.addEventListener('touchstart', this.onTouchStart_, {\n            passive: false,\n        });\n        element.addEventListener('touchmove', this.onTouchMove_, {\n            passive: true,\n        });\n        element.addEventListener('touchend', this.onTouchEnd_);\n        element.addEventListener('mousedown', this.onMouseDown_);\n    }\n    computePosition_(offset) {\n        const rect = this.elem_.getBoundingClientRect();\n        return {\n            bounds: {\n                width: rect.width,\n                height: rect.height,\n            },\n            point: offset\n                ? {\n                    x: offset.x,\n                    y: offset.y,\n                }\n                : null,\n        };\n    }\n    onMouseDown_(ev) {\n        var _a;\n        ev.preventDefault();\n        (_a = ev.currentTarget) === null || _a === void 0 ? void 0 : _a.focus();\n        const doc = this.elem_.ownerDocument;\n        doc.addEventListener('mousemove', this.onDocumentMouseMove_);\n        doc.addEventListener('mouseup', this.onDocumentMouseUp_);\n        this.emitter.emit('down', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onDocumentMouseMove_(ev) {\n        this.emitter.emit('move', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onDocumentMouseUp_(ev) {\n        const doc = this.elem_.ownerDocument;\n        doc.removeEventListener('mousemove', this.onDocumentMouseMove_);\n        doc.removeEventListener('mouseup', this.onDocumentMouseUp_);\n        this.emitter.emit('up', {\n            altKey: ev.altKey,\n            data: this.computePosition_(computeOffset$1(ev, this.elem_)),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n    onTouchStart_(ev) {\n        ev.preventDefault();\n        const touch = ev.targetTouches.item(0);\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('down', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n        this.lastTouch_ = touch;\n    }\n    onTouchMove_(ev) {\n        const touch = ev.targetTouches.item(0);\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('move', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n        this.lastTouch_ = touch;\n    }\n    onTouchEnd_(ev) {\n        var _a;\n        const touch = (_a = ev.targetTouches.item(0)) !== null && _a !== void 0 ? _a : this.lastTouch_;\n        const rect = this.elem_.getBoundingClientRect();\n        this.emitter.emit('up', {\n            altKey: ev.altKey,\n            data: this.computePosition_(touch\n                ? {\n                    x: touch.clientX - rect.left,\n                    y: touch.clientY - rect.top,\n                }\n                : undefined),\n            sender: this,\n            shiftKey: ev.shiftKey,\n        });\n    }\n}\n\nconst cn$h = ClassName('txt');\nclass NumberTextView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$h(), cn$h(undefined, 'num'));\n        if (config.arrayPosition) {\n            this.element.classList.add(cn$h(undefined, config.arrayPosition));\n        }\n        config.viewProps.bindClassModifiers(this.element);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$h('i'));\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        this.onDraggingChange_ = this.onDraggingChange_.bind(this);\n        this.dragging_ = config.dragging;\n        this.dragging_.emitter.on('change', this.onDraggingChange_);\n        this.element.classList.add(cn$h());\n        this.inputElement.classList.add(cn$h('i'));\n        const knobElem = doc.createElement('div');\n        knobElem.classList.add(cn$h('k'));\n        this.element.appendChild(knobElem);\n        this.knobElement = knobElem;\n        const guideElem = doc.createElementNS(SVG_NS, 'svg');\n        guideElem.classList.add(cn$h('g'));\n        this.knobElement.appendChild(guideElem);\n        const bodyElem = doc.createElementNS(SVG_NS, 'path');\n        bodyElem.classList.add(cn$h('gb'));\n        guideElem.appendChild(bodyElem);\n        this.guideBodyElem_ = bodyElem;\n        const headElem = doc.createElementNS(SVG_NS, 'path');\n        headElem.classList.add(cn$h('gh'));\n        guideElem.appendChild(headElem);\n        this.guideHeadElem_ = headElem;\n        const tooltipElem = doc.createElement('div');\n        tooltipElem.classList.add(ClassName('tt')());\n        this.knobElement.appendChild(tooltipElem);\n        this.tooltipElem_ = tooltipElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value = config.value;\n        this.refresh();\n    }\n    onDraggingChange_(ev) {\n        if (ev.rawValue === null) {\n            this.element.classList.remove(cn$h(undefined, 'drg'));\n            return;\n        }\n        this.element.classList.add(cn$h(undefined, 'drg'));\n        const x = ev.rawValue / this.props_.get('pointerScale');\n        const aox = x + (x > 0 ? -1 : x < 0 ? +1 : 0);\n        const adx = constrainRange(-aox, -4, +4);\n        this.guideHeadElem_.setAttributeNS(null, 'd', [`M ${aox + adx},0 L${aox},4 L${aox + adx},8`, `M ${x},-1 L${x},9`].join(' '));\n        this.guideBodyElem_.setAttributeNS(null, 'd', `M 0,4 L${x},4`);\n        const formatter = this.props_.get('formatter');\n        this.tooltipElem_.textContent = formatter(this.value.rawValue);\n        this.tooltipElem_.style.left = `${x}px`;\n    }\n    refresh() {\n        const formatter = this.props_.get('formatter');\n        this.inputElement.value = formatter(this.value.rawValue);\n    }\n    onChange_() {\n        this.refresh();\n    }\n}\n\nclass NumberTextController {\n    constructor(doc, config) {\n        var _a;\n        this.originRawValue_ = 0;\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.onInputKeyDown_ = this.onInputKeyDown_.bind(this);\n        this.onInputKeyUp_ = this.onInputKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.parser_ = config.parser;\n        this.props = config.props;\n        this.sliderProps_ = (_a = config.sliderProps) !== null && _a !== void 0 ? _a : null;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.dragging_ = createValue(null);\n        this.view = new NumberTextView(doc, {\n            arrayPosition: config.arrayPosition,\n            dragging: this.dragging_,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n        this.view.inputElement.addEventListener('keydown', this.onInputKeyDown_);\n        this.view.inputElement.addEventListener('keyup', this.onInputKeyUp_);\n        const ph = new PointerHandler(this.view.knobElement);\n        ph.emitter.on('down', this.onPointerDown_);\n        ph.emitter.on('move', this.onPointerMove_);\n        ph.emitter.on('up', this.onPointerUp_);\n    }\n    constrainValue_(value) {\n        var _a, _b;\n        const min = (_a = this.sliderProps_) === null || _a === void 0 ? void 0 : _a.get('min');\n        const max = (_b = this.sliderProps_) === null || _b === void 0 ? void 0 : _b.get('max');\n        let v = value;\n        if (min !== undefined) {\n            v = Math.max(v, min);\n        }\n        if (max !== undefined) {\n            v = Math.min(v, max);\n        }\n        return v;\n    }\n    onInputChange_(e) {\n        const inputElem = forceCast(e.currentTarget);\n        const value = inputElem.value;\n        const parsedValue = this.parser_(value);\n        if (!isEmpty(parsedValue)) {\n            this.value.rawValue = this.constrainValue_(parsedValue);\n        }\n        this.view.refresh();\n    }\n    onInputKeyDown_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getVerticalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.constrainValue_(this.value.rawValue + step), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onInputKeyUp_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getVerticalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onPointerDown_() {\n        this.originRawValue_ = this.value.rawValue;\n        this.dragging_.rawValue = 0;\n    }\n    computeDraggingValue_(data) {\n        if (!data.point) {\n            return null;\n        }\n        const dx = data.point.x - data.bounds.width / 2;\n        return this.constrainValue_(this.originRawValue_ + dx * this.props.get('pointerScale'));\n    }\n    onPointerMove_(ev) {\n        const v = this.computeDraggingValue_(ev.data);\n        if (v === null) {\n            return;\n        }\n        this.value.setRawValue(v, {\n            forceEmit: false,\n            last: false,\n        });\n        this.dragging_.rawValue = this.value.rawValue - this.originRawValue_;\n    }\n    onPointerUp_(ev) {\n        const v = this.computeDraggingValue_(ev.data);\n        if (v === null) {\n            return;\n        }\n        this.value.setRawValue(v, {\n            forceEmit: true,\n            last: true,\n        });\n        this.dragging_.rawValue = null;\n    }\n}\n\nconst cn$g = ClassName('sld');\nclass SliderView {\n    constructor(doc, config) {\n        this.onChange_ = this.onChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$g());\n        config.viewProps.bindClassModifiers(this.element);\n        const trackElem = doc.createElement('div');\n        trackElem.classList.add(cn$g('t'));\n        config.viewProps.bindTabIndex(trackElem);\n        this.element.appendChild(trackElem);\n        this.trackElement = trackElem;\n        const knobElem = doc.createElement('div');\n        knobElem.classList.add(cn$g('k'));\n        this.trackElement.appendChild(knobElem);\n        this.knobElement = knobElem;\n        config.value.emitter.on('change', this.onChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const p = constrainRange(mapRange(this.value.rawValue, this.props_.get('min'), this.props_.get('max'), 0, 100), 0, 100);\n        this.knobElement.style.width = `${p}%`;\n    }\n    onChange_() {\n        this.update_();\n    }\n}\n\nclass SliderController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDownOrMove_ = this.onPointerDownOrMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.props = config.props;\n        this.view = new SliderView(doc, {\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.trackElement);\n        this.ptHandler_.emitter.on('down', this.onPointerDownOrMove_);\n        this.ptHandler_.emitter.on('move', this.onPointerDownOrMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.trackElement.addEventListener('keydown', this.onKeyDown_);\n        this.view.trackElement.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        this.value.setRawValue(mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, this.props.get('min'), this.props.get('max')), opts);\n    }\n    onPointerDownOrMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue + step, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(this.props.get('keyScale'), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$f = ClassName('sldtxt');\nclass SliderTextView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$f());\n        const sliderElem = doc.createElement('div');\n        sliderElem.classList.add(cn$f('s'));\n        this.sliderView_ = config.sliderView;\n        sliderElem.appendChild(this.sliderView_.element);\n        this.element.appendChild(sliderElem);\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$f('t'));\n        this.textView_ = config.textView;\n        textElem.appendChild(this.textView_.element);\n        this.element.appendChild(textElem);\n    }\n}\n\nclass SliderTextController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.sliderC_ = new SliderController(doc, {\n            props: config.sliderProps,\n            value: config.value,\n            viewProps: this.viewProps,\n        });\n        this.textC_ = new NumberTextController(doc, {\n            parser: config.parser,\n            props: config.textProps,\n            sliderProps: config.sliderProps,\n            value: config.value,\n            viewProps: config.viewProps,\n        });\n        this.view = new SliderTextView(doc, {\n            sliderView: this.sliderC_.view,\n            textView: this.textC_.view,\n        });\n    }\n    get sliderController() {\n        return this.sliderC_;\n    }\n    get textController() {\n        return this.textC_;\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n        }), (result) => {\n            const sliderProps = this.sliderC_.props;\n            sliderProps.set('max', result.max);\n            sliderProps.set('min', result.min);\n            return true;\n        });\n    }\n    exportProps() {\n        const sliderProps = this.sliderC_.props;\n        return exportBladeState(null, {\n            max: sliderProps.get('max'),\n            min: sliderProps.get('min'),\n        });\n    }\n}\nfunction createSliderTextProps(config) {\n    return {\n        sliderProps: new ValueMap({\n            keyScale: config.keyScale,\n            max: config.max,\n            min: config.min,\n        }),\n        textProps: new ValueMap({\n            formatter: createValue(config.formatter),\n            keyScale: config.keyScale,\n            pointerScale: createValue(config.pointerScale),\n        }),\n    };\n}\n\nconst CSS_VAR_MAP = {\n    containerUnitSize: 'cnt-usz',\n};\nfunction getCssVar(key) {\n    return `--${CSS_VAR_MAP[key]}`;\n}\n\nfunction createPointDimensionParser(p) {\n    return createNumberTextInputParamsParser(p);\n}\nfunction parsePointDimensionParams(value) {\n    if (!isRecord(value)) {\n        return undefined;\n    }\n    return parseRecord(value, createPointDimensionParser);\n}\nfunction createDimensionConstraint(params, initialValue) {\n    if (!params) {\n        return undefined;\n    }\n    const constraints = [];\n    const cs = createStepConstraint(params, initialValue);\n    if (cs) {\n        constraints.push(cs);\n    }\n    const rs = createRangeConstraint(params);\n    if (rs) {\n        constraints.push(rs);\n    }\n    return new CompositeConstraint(constraints);\n}\n\nfunction isCompatible(ver) {\n    if (!ver) {\n        return false;\n    }\n    return ver.major === VERSION$1.major;\n}\n\nfunction parsePickerLayout(value) {\n    if (value === 'inline' || value === 'popup') {\n        return value;\n    }\n    return undefined;\n}\n\nfunction writePrimitive(target, value) {\n    target.write(value);\n}\n\nconst cn$e = ClassName('ckb');\nclass CheckboxView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$e());\n        config.viewProps.bindClassModifiers(this.element);\n        const labelElem = doc.createElement('label');\n        labelElem.classList.add(cn$e('l'));\n        this.element.appendChild(labelElem);\n        this.labelElement = labelElem;\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$e('i'));\n        inputElem.type = 'checkbox';\n        this.labelElement.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.viewProps.bindDisabled(this.inputElement);\n        const wrapperElem = doc.createElement('div');\n        wrapperElem.classList.add(cn$e('w'));\n        this.labelElement.appendChild(wrapperElem);\n        const markElem = createSvgIconElement(doc, 'check');\n        wrapperElem.appendChild(markElem);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        this.inputElement.checked = this.value.rawValue;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass CheckboxController {\n    constructor(doc, config) {\n        this.onInputChange_ = this.onInputChange_.bind(this);\n        this.onLabelMouseDown_ = this.onLabelMouseDown_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new CheckboxView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view.inputElement.addEventListener('change', this.onInputChange_);\n        this.view.labelElement.addEventListener('mousedown', this.onLabelMouseDown_);\n    }\n    onInputChange_(ev) {\n        const inputElem = forceCast(ev.currentTarget);\n        this.value.rawValue = inputElem.checked;\n        ev.preventDefault();\n        ev.stopPropagation();\n    }\n    onLabelMouseDown_(ev) {\n        ev.preventDefault();\n    }\n}\n\nfunction createConstraint$6(params) {\n    const constraints = [];\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst BooleanInputPlugin = createPlugin({\n    id: 'input-bool',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'boolean') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            options: p.optional.custom(parseListOptions),\n            readonly: p.optional.constant(false),\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => boolFromUnknown,\n        constraint: (args) => createConstraint$6(args.params),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(doc, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new CheckboxController(doc, {\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'boolean') {\n            return null;\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst cn$d = ClassName('col');\nclass ColorView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$d());\n        config.foldable.bindExpandedClass(this.element, cn$d(undefined, 'expanded'));\n        bindValueMap(config.foldable, 'completed', valueToClassName(this.element, cn$d(undefined, 'cpl')));\n        const headElem = doc.createElement('div');\n        headElem.classList.add(cn$d('h'));\n        this.element.appendChild(headElem);\n        const swatchElem = doc.createElement('div');\n        swatchElem.classList.add(cn$d('s'));\n        headElem.appendChild(swatchElem);\n        this.swatchElement = swatchElem;\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$d('t'));\n        headElem.appendChild(textElem);\n        this.textElement = textElem;\n        if (config.pickerLayout === 'inline') {\n            const pickerElem = doc.createElement('div');\n            pickerElem.classList.add(cn$d('p'));\n            this.element.appendChild(pickerElem);\n            this.pickerElement = pickerElem;\n        }\n        else {\n            this.pickerElement = null;\n        }\n    }\n}\n\nfunction rgbToHslInt(r, g, b) {\n    const rp = constrainRange(r / 255, 0, 1);\n    const gp = constrainRange(g / 255, 0, 1);\n    const bp = constrainRange(b / 255, 0, 1);\n    const cmax = Math.max(rp, gp, bp);\n    const cmin = Math.min(rp, gp, bp);\n    const c = cmax - cmin;\n    let h = 0;\n    let s = 0;\n    const l = (cmin + cmax) / 2;\n    if (c !== 0) {\n        s = c / (1 - Math.abs(cmax + cmin - 1));\n        if (rp === cmax) {\n            h = (gp - bp) / c;\n        }\n        else if (gp === cmax) {\n            h = 2 + (bp - rp) / c;\n        }\n        else {\n            h = 4 + (rp - gp) / c;\n        }\n        h = h / 6 + (h < 0 ? 1 : 0);\n    }\n    return [h * 360, s * 100, l * 100];\n}\nfunction hslToRgbInt(h, s, l) {\n    const hp = ((h % 360) + 360) % 360;\n    const sp = constrainRange(s / 100, 0, 1);\n    const lp = constrainRange(l / 100, 0, 1);\n    const c = (1 - Math.abs(2 * lp - 1)) * sp;\n    const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n    const m = lp - c / 2;\n    let rp, gp, bp;\n    if (hp >= 0 && hp < 60) {\n        [rp, gp, bp] = [c, x, 0];\n    }\n    else if (hp >= 60 && hp < 120) {\n        [rp, gp, bp] = [x, c, 0];\n    }\n    else if (hp >= 120 && hp < 180) {\n        [rp, gp, bp] = [0, c, x];\n    }\n    else if (hp >= 180 && hp < 240) {\n        [rp, gp, bp] = [0, x, c];\n    }\n    else if (hp >= 240 && hp < 300) {\n        [rp, gp, bp] = [x, 0, c];\n    }\n    else {\n        [rp, gp, bp] = [c, 0, x];\n    }\n    return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n}\nfunction rgbToHsvInt(r, g, b) {\n    const rp = constrainRange(r / 255, 0, 1);\n    const gp = constrainRange(g / 255, 0, 1);\n    const bp = constrainRange(b / 255, 0, 1);\n    const cmax = Math.max(rp, gp, bp);\n    const cmin = Math.min(rp, gp, bp);\n    const d = cmax - cmin;\n    let h;\n    if (d === 0) {\n        h = 0;\n    }\n    else if (cmax === rp) {\n        h = 60 * (((((gp - bp) / d) % 6) + 6) % 6);\n    }\n    else if (cmax === gp) {\n        h = 60 * ((bp - rp) / d + 2);\n    }\n    else {\n        h = 60 * ((rp - gp) / d + 4);\n    }\n    const s = cmax === 0 ? 0 : d / cmax;\n    const v = cmax;\n    return [h, s * 100, v * 100];\n}\nfunction hsvToRgbInt(h, s, v) {\n    const hp = loopRange(h, 360);\n    const sp = constrainRange(s / 100, 0, 1);\n    const vp = constrainRange(v / 100, 0, 1);\n    const c = vp * sp;\n    const x = c * (1 - Math.abs(((hp / 60) % 2) - 1));\n    const m = vp - c;\n    let rp, gp, bp;\n    if (hp >= 0 && hp < 60) {\n        [rp, gp, bp] = [c, x, 0];\n    }\n    else if (hp >= 60 && hp < 120) {\n        [rp, gp, bp] = [x, c, 0];\n    }\n    else if (hp >= 120 && hp < 180) {\n        [rp, gp, bp] = [0, c, x];\n    }\n    else if (hp >= 180 && hp < 240) {\n        [rp, gp, bp] = [0, x, c];\n    }\n    else if (hp >= 240 && hp < 300) {\n        [rp, gp, bp] = [x, 0, c];\n    }\n    else {\n        [rp, gp, bp] = [c, 0, x];\n    }\n    return [(rp + m) * 255, (gp + m) * 255, (bp + m) * 255];\n}\nfunction hslToHsvInt(h, s, l) {\n    const sd = l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100);\n    return [\n        h,\n        sd !== 0 ? (s * (100 - Math.abs(2 * l - 100))) / sd : 0,\n        l + (s * (100 - Math.abs(2 * l - 100))) / (2 * 100),\n    ];\n}\nfunction hsvToHslInt(h, s, v) {\n    const sd = 100 - Math.abs((v * (200 - s)) / 100 - 100);\n    return [h, sd !== 0 ? (s * v) / sd : 0, (v * (200 - s)) / (2 * 100)];\n}\nfunction removeAlphaComponent(comps) {\n    return [comps[0], comps[1], comps[2]];\n}\nfunction appendAlphaComponent(comps, alpha) {\n    return [comps[0], comps[1], comps[2], alpha];\n}\nconst MODE_CONVERTER_MAP = {\n    hsl: {\n        hsl: (h, s, l) => [h, s, l],\n        hsv: hslToHsvInt,\n        rgb: hslToRgbInt,\n    },\n    hsv: {\n        hsl: hsvToHslInt,\n        hsv: (h, s, v) => [h, s, v],\n        rgb: hsvToRgbInt,\n    },\n    rgb: {\n        hsl: rgbToHslInt,\n        hsv: rgbToHsvInt,\n        rgb: (r, g, b) => [r, g, b],\n    },\n};\nfunction getColorMaxComponents(mode, type) {\n    return [\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 360,\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n        type === 'float' ? 1 : mode === 'rgb' ? 255 : 100,\n    ];\n}\nfunction loopHueRange(hue, max) {\n    return hue === max ? max : loopRange(hue, max);\n}\nfunction constrainColorComponents(components, mode, type) {\n    var _a;\n    const ms = getColorMaxComponents(mode, type);\n    return [\n        mode === 'rgb'\n            ? constrainRange(components[0], 0, ms[0])\n            : loopHueRange(components[0], ms[0]),\n        constrainRange(components[1], 0, ms[1]),\n        constrainRange(components[2], 0, ms[2]),\n        constrainRange((_a = components[3]) !== null && _a !== void 0 ? _a : 1, 0, 1),\n    ];\n}\nfunction convertColorType(comps, mode, from, to) {\n    const fms = getColorMaxComponents(mode, from);\n    const tms = getColorMaxComponents(mode, to);\n    return comps.map((c, index) => (c / fms[index]) * tms[index]);\n}\nfunction convertColor(components, from, to) {\n    const intComps = convertColorType(components, from.mode, from.type, 'int');\n    const result = MODE_CONVERTER_MAP[from.mode][to.mode](...intComps);\n    return convertColorType(result, to.mode, 'int', to.type);\n}\n\nclass IntColor {\n    static black() {\n        return new IntColor([0, 0, 0], 'rgb');\n    }\n    constructor(comps, mode) {\n        this.type = 'int';\n        this.mode = mode;\n        this.comps_ = constrainColorComponents(comps, mode, this.type);\n    }\n    getComponents(opt_mode) {\n        return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type: this.type }), this.comps_[3]);\n    }\n    toRgbaObject() {\n        const rgbComps = this.getComponents('rgb');\n        return {\n            r: rgbComps[0],\n            g: rgbComps[1],\n            b: rgbComps[2],\n            a: rgbComps[3],\n        };\n    }\n}\n\nconst cn$c = ClassName('colp');\nclass ColorPickerView {\n    constructor(doc, config) {\n        this.alphaViews_ = null;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$c());\n        config.viewProps.bindClassModifiers(this.element);\n        const hsvElem = doc.createElement('div');\n        hsvElem.classList.add(cn$c('hsv'));\n        const svElem = doc.createElement('div');\n        svElem.classList.add(cn$c('sv'));\n        this.svPaletteView_ = config.svPaletteView;\n        svElem.appendChild(this.svPaletteView_.element);\n        hsvElem.appendChild(svElem);\n        const hElem = doc.createElement('div');\n        hElem.classList.add(cn$c('h'));\n        this.hPaletteView_ = config.hPaletteView;\n        hElem.appendChild(this.hPaletteView_.element);\n        hsvElem.appendChild(hElem);\n        this.element.appendChild(hsvElem);\n        const rgbElem = doc.createElement('div');\n        rgbElem.classList.add(cn$c('rgb'));\n        this.textsView_ = config.textsView;\n        rgbElem.appendChild(this.textsView_.element);\n        this.element.appendChild(rgbElem);\n        if (config.alphaViews) {\n            this.alphaViews_ = {\n                palette: config.alphaViews.palette,\n                text: config.alphaViews.text,\n            };\n            const aElem = doc.createElement('div');\n            aElem.classList.add(cn$c('a'));\n            const apElem = doc.createElement('div');\n            apElem.classList.add(cn$c('ap'));\n            apElem.appendChild(this.alphaViews_.palette.element);\n            aElem.appendChild(apElem);\n            const atElem = doc.createElement('div');\n            atElem.classList.add(cn$c('at'));\n            atElem.appendChild(this.alphaViews_.text.element);\n            aElem.appendChild(atElem);\n            this.element.appendChild(aElem);\n        }\n    }\n    get allFocusableElements() {\n        const elems = [\n            this.svPaletteView_.element,\n            this.hPaletteView_.element,\n            this.textsView_.modeSelectElement,\n            ...this.textsView_.inputViews.map((v) => v.inputElement),\n        ];\n        if (this.alphaViews_) {\n            elems.push(this.alphaViews_.palette.element, this.alphaViews_.text.inputElement);\n        }\n        return elems;\n    }\n}\n\nfunction parseColorType(value) {\n    return value === 'int' ? 'int' : value === 'float' ? 'float' : undefined;\n}\nfunction parseColorInputParams(params) {\n    return parseRecord(params, (p) => ({\n        color: p.optional.object({\n            alpha: p.optional.boolean,\n            type: p.optional.custom(parseColorType),\n        }),\n        expanded: p.optional.boolean,\n        picker: p.optional.custom(parsePickerLayout),\n        readonly: p.optional.constant(false),\n    }));\n}\nfunction getKeyScaleForColor(forAlpha) {\n    return forAlpha ? 0.1 : 1;\n}\nfunction extractColorType(params) {\n    var _a;\n    return (_a = params.color) === null || _a === void 0 ? void 0 : _a.type;\n}\n\nclass FloatColor {\n    constructor(comps, mode) {\n        this.type = 'float';\n        this.mode = mode;\n        this.comps_ = constrainColorComponents(comps, mode, this.type);\n    }\n    getComponents(opt_mode) {\n        return appendAlphaComponent(convertColor(removeAlphaComponent(this.comps_), { mode: this.mode, type: this.type }, { mode: opt_mode !== null && opt_mode !== void 0 ? opt_mode : this.mode, type: this.type }), this.comps_[3]);\n    }\n    toRgbaObject() {\n        const rgbComps = this.getComponents('rgb');\n        return {\n            r: rgbComps[0],\n            g: rgbComps[1],\n            b: rgbComps[2],\n            a: rgbComps[3],\n        };\n    }\n}\n\nconst TYPE_TO_CONSTRUCTOR_MAP = {\n    int: (comps, mode) => new IntColor(comps, mode),\n    float: (comps, mode) => new FloatColor(comps, mode),\n};\nfunction createColor(comps, mode, type) {\n    return TYPE_TO_CONSTRUCTOR_MAP[type](comps, mode);\n}\nfunction isFloatColor(c) {\n    return c.type === 'float';\n}\nfunction isIntColor(c) {\n    return c.type === 'int';\n}\nfunction convertFloatToInt(cf) {\n    const comps = cf.getComponents();\n    const ms = getColorMaxComponents(cf.mode, 'int');\n    return new IntColor([\n        Math.round(mapRange(comps[0], 0, 1, 0, ms[0])),\n        Math.round(mapRange(comps[1], 0, 1, 0, ms[1])),\n        Math.round(mapRange(comps[2], 0, 1, 0, ms[2])),\n        comps[3],\n    ], cf.mode);\n}\nfunction convertIntToFloat(ci) {\n    const comps = ci.getComponents();\n    const ms = getColorMaxComponents(ci.mode, 'int');\n    return new FloatColor([\n        mapRange(comps[0], 0, ms[0], 0, 1),\n        mapRange(comps[1], 0, ms[1], 0, 1),\n        mapRange(comps[2], 0, ms[2], 0, 1),\n        comps[3],\n    ], ci.mode);\n}\nfunction mapColorType(c, type) {\n    if (c.type === type) {\n        return c;\n    }\n    if (isIntColor(c) && type === 'float') {\n        return convertIntToFloat(c);\n    }\n    if (isFloatColor(c) && type === 'int') {\n        return convertFloatToInt(c);\n    }\n    throw TpError.shouldNeverHappen();\n}\n\nfunction equalsStringColorFormat(f1, f2) {\n    return (f1.alpha === f2.alpha &&\n        f1.mode === f2.mode &&\n        f1.notation === f2.notation &&\n        f1.type === f2.type);\n}\nfunction parseCssNumberOrPercentage(text, max) {\n    const m = text.match(/^(.+)%$/);\n    if (!m) {\n        return Math.min(parseFloat(text), max);\n    }\n    return Math.min(parseFloat(m[1]) * 0.01 * max, max);\n}\nconst ANGLE_TO_DEG_MAP = {\n    deg: (angle) => angle,\n    grad: (angle) => (angle * 360) / 400,\n    rad: (angle) => (angle * 360) / (2 * Math.PI),\n    turn: (angle) => angle * 360,\n};\nfunction parseCssNumberOrAngle(text) {\n    const m = text.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);\n    if (!m) {\n        return parseFloat(text);\n    }\n    const angle = parseFloat(m[1]);\n    const unit = m[2];\n    return ANGLE_TO_DEG_MAP[unit](angle);\n}\nfunction parseFunctionalRgbColorComponents(text) {\n    const m = text.match(/^rgb\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrPercentage(m[1], 255),\n        parseCssNumberOrPercentage(m[2], 255),\n        parseCssNumberOrPercentage(m[3], 255),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalRgbColor(text) {\n    const comps = parseFunctionalRgbColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseFunctionalRgbaColorComponents(text) {\n    const m = text.match(/^rgba\\(\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrPercentage(m[1], 255),\n        parseCssNumberOrPercentage(m[2], 255),\n        parseCssNumberOrPercentage(m[3], 255),\n        parseCssNumberOrPercentage(m[4], 1),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalRgbaColor(text) {\n    const comps = parseFunctionalRgbaColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseFunctionalHslColorComponents(text) {\n    const m = text.match(/^hsl\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrAngle(m[1]),\n        parseCssNumberOrPercentage(m[2], 100),\n        parseCssNumberOrPercentage(m[3], 100),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalHslColor(text) {\n    const comps = parseFunctionalHslColorComponents(text);\n    return comps ? new IntColor(comps, 'hsl') : null;\n}\nfunction parseHslaColorComponents(text) {\n    const m = text.match(/^hsla\\(\\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*([0-9A-Fa-f.]+%?)\\s*\\)$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseCssNumberOrAngle(m[1]),\n        parseCssNumberOrPercentage(m[2], 100),\n        parseCssNumberOrPercentage(m[3], 100),\n        parseCssNumberOrPercentage(m[4], 1),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction parseFunctionalHslaColor(text) {\n    const comps = parseHslaColorComponents(text);\n    return comps ? new IntColor(comps, 'hsl') : null;\n}\nfunction parseHexRgbColorComponents(text) {\n    const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n    if (mRgb) {\n        return [\n            parseInt(mRgb[1] + mRgb[1], 16),\n            parseInt(mRgb[2] + mRgb[2], 16),\n            parseInt(mRgb[3] + mRgb[3], 16),\n        ];\n    }\n    const mRrggbb = text.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n    if (mRrggbb) {\n        return [\n            parseInt(mRrggbb[1], 16),\n            parseInt(mRrggbb[2], 16),\n            parseInt(mRrggbb[3], 16),\n        ];\n    }\n    return null;\n}\nfunction parseHexRgbColor(text) {\n    const comps = parseHexRgbColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseHexRgbaColorComponents(text) {\n    const mRgb = text.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);\n    if (mRgb) {\n        return [\n            parseInt(mRgb[1] + mRgb[1], 16),\n            parseInt(mRgb[2] + mRgb[2], 16),\n            parseInt(mRgb[3] + mRgb[3], 16),\n            mapRange(parseInt(mRgb[4] + mRgb[4], 16), 0, 255, 0, 1),\n        ];\n    }\n    const mRrggbb = text.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);\n    if (mRrggbb) {\n        return [\n            parseInt(mRrggbb[1], 16),\n            parseInt(mRrggbb[2], 16),\n            parseInt(mRrggbb[3], 16),\n            mapRange(parseInt(mRrggbb[4], 16), 0, 255, 0, 1),\n        ];\n    }\n    return null;\n}\nfunction parseHexRgbaColor(text) {\n    const comps = parseHexRgbaColorComponents(text);\n    return comps ? new IntColor(comps, 'rgb') : null;\n}\nfunction parseObjectRgbColorComponents(text) {\n    const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseFloat(m[1]),\n        parseFloat(m[2]),\n        parseFloat(m[3]),\n    ];\n    if (isNaN(comps[0]) || isNaN(comps[1]) || isNaN(comps[2])) {\n        return null;\n    }\n    return comps;\n}\nfunction createObjectRgbColorParser(type) {\n    return (text) => {\n        const comps = parseObjectRgbColorComponents(text);\n        return comps ? createColor(comps, 'rgb', type) : null;\n    };\n}\nfunction parseObjectRgbaColorComponents(text) {\n    const m = text.match(/^\\{\\s*r\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*g\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*b\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*,\\s*a\\s*:\\s*([0-9A-Fa-f.]+%?)\\s*\\}$/);\n    if (!m) {\n        return null;\n    }\n    const comps = [\n        parseFloat(m[1]),\n        parseFloat(m[2]),\n        parseFloat(m[3]),\n        parseFloat(m[4]),\n    ];\n    if (isNaN(comps[0]) ||\n        isNaN(comps[1]) ||\n        isNaN(comps[2]) ||\n        isNaN(comps[3])) {\n        return null;\n    }\n    return comps;\n}\nfunction createObjectRgbaColorParser(type) {\n    return (text) => {\n        const comps = parseObjectRgbaColorComponents(text);\n        return comps ? createColor(comps, 'rgb', type) : null;\n    };\n}\nconst PARSER_AND_RESULT = [\n    {\n        parser: parseHexRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'hex',\n        },\n    },\n    {\n        parser: parseHexRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'hex',\n        },\n    },\n    {\n        parser: parseFunctionalRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseFunctionalRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseFunctionalHslColorComponents,\n        result: {\n            alpha: false,\n            mode: 'hsl',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseHslaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'hsl',\n            notation: 'func',\n        },\n    },\n    {\n        parser: parseObjectRgbColorComponents,\n        result: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'object',\n        },\n    },\n    {\n        parser: parseObjectRgbaColorComponents,\n        result: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'object',\n        },\n    },\n];\nfunction detectStringColor(text) {\n    return PARSER_AND_RESULT.reduce((prev, { parser, result: detection }) => {\n        if (prev) {\n            return prev;\n        }\n        return parser(text) ? detection : null;\n    }, null);\n}\nfunction detectStringColorFormat(text, type = 'int') {\n    const r = detectStringColor(text);\n    if (!r) {\n        return null;\n    }\n    if (r.notation === 'hex' && type !== 'float') {\n        return Object.assign(Object.assign({}, r), { type: 'int' });\n    }\n    if (r.notation === 'func') {\n        return Object.assign(Object.assign({}, r), { type: type });\n    }\n    return null;\n}\nfunction createColorStringParser(type) {\n    const parsers = [\n        parseHexRgbColor,\n        parseHexRgbaColor,\n        parseFunctionalRgbColor,\n        parseFunctionalRgbaColor,\n        parseFunctionalHslColor,\n        parseFunctionalHslaColor,\n    ];\n    if (type === 'int') {\n        parsers.push(createObjectRgbColorParser('int'), createObjectRgbaColorParser('int'));\n    }\n    if (type === 'float') {\n        parsers.push(createObjectRgbColorParser('float'), createObjectRgbaColorParser('float'));\n    }\n    const parser = composeParsers(parsers);\n    return (text) => {\n        const result = parser(text);\n        return result ? mapColorType(result, type) : null;\n    };\n}\nfunction readIntColorString(value) {\n    const parser = createColorStringParser('int');\n    if (typeof value !== 'string') {\n        return IntColor.black();\n    }\n    const result = parser(value);\n    return result !== null && result !== void 0 ? result : IntColor.black();\n}\nfunction zerofill(comp) {\n    const hex = constrainRange(Math.floor(comp), 0, 255).toString(16);\n    return hex.length === 1 ? `0${hex}` : hex;\n}\nfunction colorToHexRgbString(value, prefix = '#') {\n    const hexes = removeAlphaComponent(value.getComponents('rgb'))\n        .map(zerofill)\n        .join('');\n    return `${prefix}${hexes}`;\n}\nfunction colorToHexRgbaString(value, prefix = '#') {\n    const rgbaComps = value.getComponents('rgb');\n    const hexes = [rgbaComps[0], rgbaComps[1], rgbaComps[2], rgbaComps[3] * 255]\n        .map(zerofill)\n        .join('');\n    return `${prefix}${hexes}`;\n}\nfunction colorToFunctionalRgbString(value) {\n    const formatter = createNumberFormatter(0);\n    const ci = mapColorType(value, 'int');\n    const comps = removeAlphaComponent(ci.getComponents('rgb')).map((comp) => formatter(comp));\n    return `rgb(${comps.join(', ')})`;\n}\nfunction colorToFunctionalRgbaString(value) {\n    const aFormatter = createNumberFormatter(2);\n    const rgbFormatter = createNumberFormatter(0);\n    const ci = mapColorType(value, 'int');\n    const comps = ci.getComponents('rgb').map((comp, index) => {\n        const formatter = index === 3 ? aFormatter : rgbFormatter;\n        return formatter(comp);\n    });\n    return `rgba(${comps.join(', ')})`;\n}\nfunction colorToFunctionalHslString(value) {\n    const formatters = [\n        createNumberFormatter(0),\n        formatPercentage,\n        formatPercentage,\n    ];\n    const ci = mapColorType(value, 'int');\n    const comps = removeAlphaComponent(ci.getComponents('hsl')).map((comp, index) => formatters[index](comp));\n    return `hsl(${comps.join(', ')})`;\n}\nfunction colorToFunctionalHslaString(value) {\n    const formatters = [\n        createNumberFormatter(0),\n        formatPercentage,\n        formatPercentage,\n        createNumberFormatter(2),\n    ];\n    const ci = mapColorType(value, 'int');\n    const comps = ci\n        .getComponents('hsl')\n        .map((comp, index) => formatters[index](comp));\n    return `hsla(${comps.join(', ')})`;\n}\nfunction colorToObjectRgbString(value, type) {\n    const formatter = createNumberFormatter(type === 'float' ? 2 : 0);\n    const names = ['r', 'g', 'b'];\n    const cc = mapColorType(value, type);\n    const comps = removeAlphaComponent(cc.getComponents('rgb')).map((comp, index) => `${names[index]}: ${formatter(comp)}`);\n    return `{${comps.join(', ')}}`;\n}\nfunction createObjectRgbColorFormatter(type) {\n    return (value) => colorToObjectRgbString(value, type);\n}\nfunction colorToObjectRgbaString(value, type) {\n    const aFormatter = createNumberFormatter(2);\n    const rgbFormatter = createNumberFormatter(type === 'float' ? 2 : 0);\n    const names = ['r', 'g', 'b', 'a'];\n    const cc = mapColorType(value, type);\n    const comps = cc.getComponents('rgb').map((comp, index) => {\n        const formatter = index === 3 ? aFormatter : rgbFormatter;\n        return `${names[index]}: ${formatter(comp)}`;\n    });\n    return `{${comps.join(', ')}}`;\n}\nfunction createObjectRgbaColorFormatter(type) {\n    return (value) => colorToObjectRgbaString(value, type);\n}\nconst FORMAT_AND_STRINGIFIERS = [\n    {\n        format: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'hex',\n            type: 'int',\n        },\n        stringifier: colorToHexRgbString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'hex',\n            type: 'int',\n        },\n        stringifier: colorToHexRgbaString,\n    },\n    {\n        format: {\n            alpha: false,\n            mode: 'rgb',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalRgbString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'rgb',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalRgbaString,\n    },\n    {\n        format: {\n            alpha: false,\n            mode: 'hsl',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalHslString,\n    },\n    {\n        format: {\n            alpha: true,\n            mode: 'hsl',\n            notation: 'func',\n            type: 'int',\n        },\n        stringifier: colorToFunctionalHslaString,\n    },\n    ...['int', 'float'].reduce((prev, type) => {\n        return [\n            ...prev,\n            {\n                format: {\n                    alpha: false,\n                    mode: 'rgb',\n                    notation: 'object',\n                    type: type,\n                },\n                stringifier: createObjectRgbColorFormatter(type),\n            },\n            {\n                format: {\n                    alpha: true,\n                    mode: 'rgb',\n                    notation: 'object',\n                    type: type,\n                },\n                stringifier: createObjectRgbaColorFormatter(type),\n            },\n        ];\n    }, []),\n];\nfunction findColorStringifier(format) {\n    return FORMAT_AND_STRINGIFIERS.reduce((prev, fas) => {\n        if (prev) {\n            return prev;\n        }\n        return equalsStringColorFormat(fas.format, format)\n            ? fas.stringifier\n            : null;\n    }, null);\n}\n\nconst cn$b = ClassName('apl');\nclass APaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$b());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const barElem = doc.createElement('div');\n        barElem.classList.add(cn$b('b'));\n        this.element.appendChild(barElem);\n        const colorElem = doc.createElement('div');\n        colorElem.classList.add(cn$b('c'));\n        barElem.appendChild(colorElem);\n        this.colorElem_ = colorElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$b('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        const previewElem = doc.createElement('div');\n        previewElem.classList.add(cn$b('p'));\n        this.markerElem_.appendChild(previewElem);\n        this.previewElem_ = previewElem;\n        this.update_();\n    }\n    update_() {\n        const c = this.value.rawValue;\n        const rgbaComps = c.getComponents('rgb');\n        const leftColor = new IntColor([rgbaComps[0], rgbaComps[1], rgbaComps[2], 0], 'rgb');\n        const rightColor = new IntColor([rgbaComps[0], rgbaComps[1], rgbaComps[2], 255], 'rgb');\n        const gradientComps = [\n            'to right',\n            colorToFunctionalRgbaString(leftColor),\n            colorToFunctionalRgbaString(rightColor),\n        ];\n        this.colorElem_.style.background = `linear-gradient(${gradientComps.join(',')})`;\n        this.previewElem_.style.backgroundColor = colorToFunctionalRgbaString(c);\n        const left = mapRange(rgbaComps[3], 0, 1, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass APaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new APaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const alpha = d.point.x / d.bounds.width;\n        const c = this.value.rawValue;\n        const [h, s, v] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, s, v, alpha], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(true), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const [h, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, s, v, a + step], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(true), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$a = ClassName('coltxt');\nfunction createModeSelectElement(doc) {\n    const selectElem = doc.createElement('select');\n    const items = [\n        { text: 'RGB', value: 'rgb' },\n        { text: 'HSL', value: 'hsl' },\n        { text: 'HSV', value: 'hsv' },\n        { text: 'HEX', value: 'hex' },\n    ];\n    selectElem.appendChild(items.reduce((frag, item) => {\n        const optElem = doc.createElement('option');\n        optElem.textContent = item.text;\n        optElem.value = item.value;\n        frag.appendChild(optElem);\n        return frag;\n    }, doc.createDocumentFragment()));\n    return selectElem;\n}\nclass ColorTextsView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$a());\n        config.viewProps.bindClassModifiers(this.element);\n        const modeElem = doc.createElement('div');\n        modeElem.classList.add(cn$a('m'));\n        this.modeElem_ = createModeSelectElement(doc);\n        this.modeElem_.classList.add(cn$a('ms'));\n        modeElem.appendChild(this.modeSelectElement);\n        config.viewProps.bindDisabled(this.modeElem_);\n        const modeMarkerElem = doc.createElement('div');\n        modeMarkerElem.classList.add(cn$a('mm'));\n        modeMarkerElem.appendChild(createSvgIconElement(doc, 'dropdown'));\n        modeElem.appendChild(modeMarkerElem);\n        this.element.appendChild(modeElem);\n        const inputsElem = doc.createElement('div');\n        inputsElem.classList.add(cn$a('w'));\n        this.element.appendChild(inputsElem);\n        this.inputsElem_ = inputsElem;\n        this.inputViews_ = config.inputViews;\n        this.applyInputViews_();\n        bindValue(config.mode, (mode) => {\n            this.modeElem_.value = mode;\n        });\n    }\n    get modeSelectElement() {\n        return this.modeElem_;\n    }\n    get inputViews() {\n        return this.inputViews_;\n    }\n    set inputViews(inputViews) {\n        this.inputViews_ = inputViews;\n        this.applyInputViews_();\n    }\n    applyInputViews_() {\n        removeChildElements(this.inputsElem_);\n        const doc = this.element.ownerDocument;\n        this.inputViews_.forEach((v) => {\n            const compElem = doc.createElement('div');\n            compElem.classList.add(cn$a('c'));\n            compElem.appendChild(v.element);\n            this.inputsElem_.appendChild(compElem);\n        });\n    }\n}\n\nfunction createFormatter$2(type) {\n    return createNumberFormatter(type === 'float' ? 2 : 0);\n}\nfunction createConstraint$5(mode, type, index) {\n    const max = getColorMaxComponents(mode, type)[index];\n    return new DefiniteRangeConstraint({\n        min: 0,\n        max: max,\n    });\n}\nfunction createComponentController(doc, config, index) {\n    return new NumberTextController(doc, {\n        arrayPosition: index === 0 ? 'fst' : index === 3 - 1 ? 'lst' : 'mid',\n        parser: config.parser,\n        props: ValueMap.fromObject({\n            formatter: createFormatter$2(config.colorType),\n            keyScale: getKeyScaleForColor(false),\n            pointerScale: config.colorType === 'float' ? 0.01 : 1,\n        }),\n        value: createValue(0, {\n            constraint: createConstraint$5(config.colorMode, config.colorType, index),\n        }),\n        viewProps: config.viewProps,\n    });\n}\nfunction createComponentControllers(doc, config) {\n    const cc = {\n        colorMode: config.colorMode,\n        colorType: config.colorType,\n        parser: parseNumber,\n        viewProps: config.viewProps,\n    };\n    return [0, 1, 2].map((i) => {\n        const c = createComponentController(doc, cc, i);\n        connectValues({\n            primary: config.value,\n            secondary: c.value,\n            forward(p) {\n                const mc = mapColorType(p, config.colorType);\n                return mc.getComponents(config.colorMode)[i];\n            },\n            backward(p, s) {\n                const pickedMode = config.colorMode;\n                const mc = mapColorType(p, config.colorType);\n                const comps = mc.getComponents(pickedMode);\n                comps[i] = s;\n                const c = createColor(appendAlphaComponent(removeAlphaComponent(comps), comps[3]), pickedMode, config.colorType);\n                return mapColorType(c, 'int');\n            },\n        });\n        return c;\n    });\n}\nfunction createHexController(doc, config) {\n    const c = new TextController(doc, {\n        parser: createColorStringParser('int'),\n        props: ValueMap.fromObject({\n            formatter: colorToHexRgbString,\n        }),\n        value: createValue(IntColor.black()),\n        viewProps: config.viewProps,\n    });\n    connectValues({\n        primary: config.value,\n        secondary: c.value,\n        forward: (p) => new IntColor(removeAlphaComponent(p.getComponents()), p.mode),\n        backward: (p, s) => new IntColor(appendAlphaComponent(removeAlphaComponent(s.getComponents(p.mode)), p.getComponents()[3]), p.mode),\n    });\n    return [c];\n}\nfunction isColorMode(mode) {\n    return mode !== 'hex';\n}\nclass ColorTextsController {\n    constructor(doc, config) {\n        this.onModeSelectChange_ = this.onModeSelectChange_.bind(this);\n        this.colorType_ = config.colorType;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.colorMode = createValue(this.value.rawValue.mode);\n        this.ccs_ = this.createComponentControllers_(doc);\n        this.view = new ColorTextsView(doc, {\n            mode: this.colorMode,\n            inputViews: [this.ccs_[0].view, this.ccs_[1].view, this.ccs_[2].view],\n            viewProps: this.viewProps,\n        });\n        this.view.modeSelectElement.addEventListener('change', this.onModeSelectChange_);\n    }\n    createComponentControllers_(doc) {\n        const mode = this.colorMode.rawValue;\n        if (isColorMode(mode)) {\n            return createComponentControllers(doc, {\n                colorMode: mode,\n                colorType: this.colorType_,\n                value: this.value,\n                viewProps: this.viewProps,\n            });\n        }\n        return createHexController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n    onModeSelectChange_(ev) {\n        const selectElem = ev.currentTarget;\n        this.colorMode.rawValue = selectElem.value;\n        this.ccs_ = this.createComponentControllers_(this.view.element.ownerDocument);\n        this.view.inputViews = this.ccs_.map((cc) => cc.view);\n    }\n}\n\nconst cn$9 = ClassName('hpl');\nclass HPaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$9());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const colorElem = doc.createElement('div');\n        colorElem.classList.add(cn$9('c'));\n        this.element.appendChild(colorElem);\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$9('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        this.update_();\n    }\n    update_() {\n        const c = this.value.rawValue;\n        const [h] = c.getComponents('hsv');\n        this.markerElem_.style.backgroundColor = colorToFunctionalRgbString(new IntColor([h, 100, 100], 'hsv'));\n        const left = mapRange(h, 0, 360, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass HPaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new HPaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const hue = mapRange(constrainRange(d.point.x, 0, d.bounds.width), 0, d.bounds.width, 0, 360);\n        const c = this.value.rawValue;\n        const [, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([hue, s, v, a], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(false), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const [h, s, v, a] = c.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h + step, s, v, a], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const step = getStepForKey(getKeyScaleForColor(false), getHorizontalStepKeys(ev));\n        if (step === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nconst cn$8 = ClassName('svp');\nconst CANVAS_RESOL = 64;\nclass SvPaletteView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.value = config.value;\n        this.value.emitter.on('change', this.onValueChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$8());\n        config.viewProps.bindClassModifiers(this.element);\n        config.viewProps.bindTabIndex(this.element);\n        const canvasElem = doc.createElement('canvas');\n        canvasElem.height = CANVAS_RESOL;\n        canvasElem.width = CANVAS_RESOL;\n        canvasElem.classList.add(cn$8('c'));\n        this.element.appendChild(canvasElem);\n        this.canvasElement = canvasElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$8('m'));\n        this.element.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        this.update_();\n    }\n    update_() {\n        const ctx = getCanvasContext(this.canvasElement);\n        if (!ctx) {\n            return;\n        }\n        const c = this.value.rawValue;\n        const hsvComps = c.getComponents('hsv');\n        const width = this.canvasElement.width;\n        const height = this.canvasElement.height;\n        const imgData = ctx.getImageData(0, 0, width, height);\n        const data = imgData.data;\n        for (let iy = 0; iy < height; iy++) {\n            for (let ix = 0; ix < width; ix++) {\n                const s = mapRange(ix, 0, width, 0, 100);\n                const v = mapRange(iy, 0, height, 100, 0);\n                const rgbComps = hsvToRgbInt(hsvComps[0], s, v);\n                const i = (iy * width + ix) * 4;\n                data[i] = rgbComps[0];\n                data[i + 1] = rgbComps[1];\n                data[i + 2] = rgbComps[2];\n                data[i + 3] = 255;\n            }\n        }\n        ctx.putImageData(imgData, 0, 0);\n        const left = mapRange(hsvComps[1], 0, 100, 0, 100);\n        this.markerElem_.style.left = `${left}%`;\n        const top = mapRange(hsvComps[2], 0, 100, 100, 0);\n        this.markerElem_.style.top = `${top}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass SvPaletteController {\n    constructor(doc, config) {\n        this.onKeyDown_ = this.onKeyDown_.bind(this);\n        this.onKeyUp_ = this.onKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new SvPaletteView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.element);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.element.addEventListener('keydown', this.onKeyDown_);\n        this.view.element.addEventListener('keyup', this.onKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const saturation = mapRange(d.point.x, 0, d.bounds.width, 0, 100);\n        const value = mapRange(d.point.y, 0, d.bounds.height, 100, 0);\n        const [h, , , a] = this.value.rawValue.getComponents('hsv');\n        this.value.setRawValue(new IntColor([h, saturation, value, a], 'hsv'), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onKeyDown_(ev) {\n        if (isArrowKey(ev.key)) {\n            ev.preventDefault();\n        }\n        const [h, s, v, a] = this.value.rawValue.getComponents('hsv');\n        const keyScale = getKeyScaleForColor(false);\n        const ds = getStepForKey(keyScale, getHorizontalStepKeys(ev));\n        const dv = getStepForKey(keyScale, getVerticalStepKeys(ev));\n        if (ds === 0 && dv === 0) {\n            return;\n        }\n        this.value.setRawValue(new IntColor([h, s + ds, v + dv, a], 'hsv'), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onKeyUp_(ev) {\n        const keyScale = getKeyScaleForColor(false);\n        const ds = getStepForKey(keyScale, getHorizontalStepKeys(ev));\n        const dv = getStepForKey(keyScale, getVerticalStepKeys(ev));\n        if (ds === 0 && dv === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nclass ColorPickerController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.hPaletteC_ = new HPaletteController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.svPaletteC_ = new SvPaletteController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.alphaIcs_ = config.supportsAlpha\n            ? {\n                palette: new APaletteController(doc, {\n                    value: this.value,\n                    viewProps: this.viewProps,\n                }),\n                text: new NumberTextController(doc, {\n                    parser: parseNumber,\n                    props: ValueMap.fromObject({\n                        pointerScale: 0.01,\n                        keyScale: 0.1,\n                        formatter: createNumberFormatter(2),\n                    }),\n                    value: createValue(0, {\n                        constraint: new DefiniteRangeConstraint({ min: 0, max: 1 }),\n                    }),\n                    viewProps: this.viewProps,\n                }),\n            }\n            : null;\n        if (this.alphaIcs_) {\n            connectValues({\n                primary: this.value,\n                secondary: this.alphaIcs_.text.value,\n                forward: (p) => p.getComponents()[3],\n                backward: (p, s) => {\n                    const comps = p.getComponents();\n                    comps[3] = s;\n                    return new IntColor(comps, p.mode);\n                },\n            });\n        }\n        this.textsC_ = new ColorTextsController(doc, {\n            colorType: config.colorType,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new ColorPickerView(doc, {\n            alphaViews: this.alphaIcs_\n                ? {\n                    palette: this.alphaIcs_.palette.view,\n                    text: this.alphaIcs_.text.view,\n                }\n                : null,\n            hPaletteView: this.hPaletteC_.view,\n            supportsAlpha: config.supportsAlpha,\n            svPaletteView: this.svPaletteC_.view,\n            textsView: this.textsC_.view,\n            viewProps: this.viewProps,\n        });\n    }\n    get textsController() {\n        return this.textsC_;\n    }\n}\n\nconst cn$7 = ClassName('colsw');\nclass ColorSwatchView {\n    constructor(doc, config) {\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$7());\n        config.viewProps.bindClassModifiers(this.element);\n        const swatchElem = doc.createElement('div');\n        swatchElem.classList.add(cn$7('sw'));\n        this.element.appendChild(swatchElem);\n        this.swatchElem_ = swatchElem;\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$7('b'));\n        config.viewProps.bindDisabled(buttonElem);\n        this.element.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        this.update_();\n    }\n    update_() {\n        const value = this.value.rawValue;\n        this.swatchElem_.style.backgroundColor = colorToHexRgbaString(value);\n    }\n    onValueChange_() {\n        this.update_();\n    }\n}\n\nclass ColorSwatchController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new ColorSwatchView(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nclass ColorController {\n    constructor(doc, config) {\n        this.onButtonBlur_ = this.onButtonBlur_.bind(this);\n        this.onButtonClick_ = this.onButtonClick_.bind(this);\n        this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n        this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.foldable_ = Foldable.create(config.expanded);\n        this.swatchC_ = new ColorSwatchController(doc, {\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        const buttonElem = this.swatchC_.view.buttonElement;\n        buttonElem.addEventListener('blur', this.onButtonBlur_);\n        buttonElem.addEventListener('click', this.onButtonClick_);\n        this.textC_ = new TextController(doc, {\n            parser: config.parser,\n            props: ValueMap.fromObject({\n                formatter: config.formatter,\n            }),\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new ColorView(doc, {\n            foldable: this.foldable_,\n            pickerLayout: config.pickerLayout,\n        });\n        this.view.swatchElement.appendChild(this.swatchC_.view.element);\n        this.view.textElement.appendChild(this.textC_.view.element);\n        this.popC_ =\n            config.pickerLayout === 'popup'\n                ? new PopupController(doc, {\n                    viewProps: this.viewProps,\n                })\n                : null;\n        const pickerC = new ColorPickerController(doc, {\n            colorType: config.colorType,\n            supportsAlpha: config.supportsAlpha,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        pickerC.view.allFocusableElements.forEach((elem) => {\n            elem.addEventListener('blur', this.onPopupChildBlur_);\n            elem.addEventListener('keydown', this.onPopupChildKeydown_);\n        });\n        this.pickerC_ = pickerC;\n        if (this.popC_) {\n            this.view.element.appendChild(this.popC_.view.element);\n            this.popC_.view.element.appendChild(pickerC.view.element);\n            connectValues({\n                primary: this.foldable_.value('expanded'),\n                secondary: this.popC_.shows,\n                forward: (p) => p,\n                backward: (_, s) => s,\n            });\n        }\n        else if (this.view.pickerElement) {\n            this.view.pickerElement.appendChild(this.pickerC_.view.element);\n            bindFoldable(this.foldable_, this.view.pickerElement);\n        }\n    }\n    get textController() {\n        return this.textC_;\n    }\n    onButtonBlur_(e) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.view.element;\n        const nextTarget = forceCast(e.relatedTarget);\n        if (!nextTarget || !elem.contains(nextTarget)) {\n            this.popC_.shows.rawValue = false;\n        }\n    }\n    onButtonClick_() {\n        this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n        if (this.foldable_.get('expanded')) {\n            this.pickerC_.view.allFocusableElements[0].focus();\n        }\n    }\n    onPopupChildBlur_(ev) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.popC_.view.element;\n        const nextTarget = findNextTarget(ev);\n        if (nextTarget && elem.contains(nextTarget)) {\n            return;\n        }\n        if (nextTarget &&\n            nextTarget === this.swatchC_.view.buttonElement &&\n            !supportsTouch(elem.ownerDocument)) {\n            return;\n        }\n        this.popC_.shows.rawValue = false;\n    }\n    onPopupChildKeydown_(ev) {\n        if (this.popC_) {\n            if (ev.key === 'Escape') {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        else if (this.view.pickerElement) {\n            if (ev.key === 'Escape') {\n                this.swatchC_.view.buttonElement.focus();\n            }\n        }\n    }\n}\n\nfunction colorToRgbNumber(value) {\n    return removeAlphaComponent(value.getComponents('rgb')).reduce((result, comp) => {\n        return (result << 8) | (Math.floor(comp) & 0xff);\n    }, 0);\n}\nfunction colorToRgbaNumber(value) {\n    return (value.getComponents('rgb').reduce((result, comp, index) => {\n        const hex = Math.floor(index === 3 ? comp * 255 : comp) & 0xff;\n        return (result << 8) | hex;\n    }, 0) >>> 0);\n}\nfunction numberToRgbColor(num) {\n    return new IntColor([(num >> 16) & 0xff, (num >> 8) & 0xff, num & 0xff], 'rgb');\n}\nfunction numberToRgbaColor(num) {\n    return new IntColor([\n        (num >> 24) & 0xff,\n        (num >> 16) & 0xff,\n        (num >> 8) & 0xff,\n        mapRange(num & 0xff, 0, 255, 0, 1),\n    ], 'rgb');\n}\nfunction colorFromRgbNumber(value) {\n    if (typeof value !== 'number') {\n        return IntColor.black();\n    }\n    return numberToRgbColor(value);\n}\nfunction colorFromRgbaNumber(value) {\n    if (typeof value !== 'number') {\n        return IntColor.black();\n    }\n    return numberToRgbaColor(value);\n}\n\nfunction isRgbColorComponent(obj, key) {\n    if (typeof obj !== 'object' || isEmpty(obj)) {\n        return false;\n    }\n    return key in obj && typeof obj[key] === 'number';\n}\nfunction isRgbColorObject(obj) {\n    return (isRgbColorComponent(obj, 'r') &&\n        isRgbColorComponent(obj, 'g') &&\n        isRgbColorComponent(obj, 'b'));\n}\nfunction isRgbaColorObject(obj) {\n    return isRgbColorObject(obj) && isRgbColorComponent(obj, 'a');\n}\nfunction isColorObject(obj) {\n    return isRgbColorObject(obj);\n}\nfunction equalsColor(v1, v2) {\n    if (v1.mode !== v2.mode) {\n        return false;\n    }\n    if (v1.type !== v2.type) {\n        return false;\n    }\n    const comps1 = v1.getComponents();\n    const comps2 = v2.getComponents();\n    for (let i = 0; i < comps1.length; i++) {\n        if (comps1[i] !== comps2[i]) {\n            return false;\n        }\n    }\n    return true;\n}\nfunction createColorComponentsFromRgbObject(obj) {\n    return 'a' in obj ? [obj.r, obj.g, obj.b, obj.a] : [obj.r, obj.g, obj.b];\n}\n\nfunction createColorStringWriter(format) {\n    const stringify = findColorStringifier(format);\n    return stringify\n        ? (target, value) => {\n            writePrimitive(target, stringify(value));\n        }\n        : null;\n}\nfunction createColorNumberWriter(supportsAlpha) {\n    const colorToNumber = supportsAlpha ? colorToRgbaNumber : colorToRgbNumber;\n    return (target, value) => {\n        writePrimitive(target, colorToNumber(value));\n    };\n}\nfunction writeRgbaColorObject(target, value, type) {\n    const cc = mapColorType(value, type);\n    const obj = cc.toRgbaObject();\n    target.writeProperty('r', obj.r);\n    target.writeProperty('g', obj.g);\n    target.writeProperty('b', obj.b);\n    target.writeProperty('a', obj.a);\n}\nfunction writeRgbColorObject(target, value, type) {\n    const cc = mapColorType(value, type);\n    const obj = cc.toRgbaObject();\n    target.writeProperty('r', obj.r);\n    target.writeProperty('g', obj.g);\n    target.writeProperty('b', obj.b);\n}\nfunction createColorObjectWriter(supportsAlpha, type) {\n    return (target, inValue) => {\n        if (supportsAlpha) {\n            writeRgbaColorObject(target, inValue, type);\n        }\n        else {\n            writeRgbColorObject(target, inValue, type);\n        }\n    };\n}\n\nfunction shouldSupportAlpha$1(inputParams) {\n    var _a;\n    if ((_a = inputParams === null || inputParams === void 0 ? void 0 : inputParams.color) === null || _a === void 0 ? void 0 : _a.alpha) {\n        return true;\n    }\n    return false;\n}\nfunction createFormatter$1(supportsAlpha) {\n    return supportsAlpha\n        ? (v) => colorToHexRgbaString(v, '0x')\n        : (v) => colorToHexRgbString(v, '0x');\n}\nfunction isForColor(params) {\n    if ('color' in params) {\n        return true;\n    }\n    if (params.view === 'color') {\n        return true;\n    }\n    return false;\n}\nconst NumberColorInputPlugin = createPlugin({\n    id: 'input-color-number',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        if (!isForColor(params)) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { supportsAlpha: shouldSupportAlpha$1(params) }),\n            }\n            : null;\n    },\n    binding: {\n        reader: (args) => {\n            return args.params.supportsAlpha\n                ? colorFromRgbaNumber\n                : colorFromRgbNumber;\n        },\n        equals: equalsColor,\n        writer: (args) => {\n            return createColorNumberWriter(args.params.supportsAlpha);\n        },\n    },\n    controller: (args) => {\n        var _a, _b;\n        return new ColorController(args.document, {\n            colorType: 'int',\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: createFormatter$1(args.params.supportsAlpha),\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: args.params.supportsAlpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nfunction colorFromObject(value, type) {\n    if (!isColorObject(value)) {\n        return mapColorType(IntColor.black(), type);\n    }\n    if (type === 'int') {\n        const comps = createColorComponentsFromRgbObject(value);\n        return new IntColor(comps, 'rgb');\n    }\n    if (type === 'float') {\n        const comps = createColorComponentsFromRgbObject(value);\n        return new FloatColor(comps, 'rgb');\n    }\n    return mapColorType(IntColor.black(), 'int');\n}\n\nfunction shouldSupportAlpha(initialValue) {\n    return isRgbaColorObject(initialValue);\n}\nfunction createColorObjectBindingReader(type) {\n    return (value) => {\n        const c = colorFromObject(value, type);\n        return mapColorType(c, 'int');\n    };\n}\nfunction createColorObjectFormatter(supportsAlpha, type) {\n    return (value) => {\n        if (supportsAlpha) {\n            return colorToObjectRgbaString(value, type);\n        }\n        return colorToObjectRgbString(value, type);\n    };\n}\nconst ObjectColorInputPlugin = createPlugin({\n    id: 'input-color-object',\n    type: 'input',\n    accept: (value, params) => {\n        var _a;\n        if (!isColorObject(value)) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { colorType: (_a = extractColorType(params)) !== null && _a !== void 0 ? _a : 'int' }),\n            }\n            : null;\n    },\n    binding: {\n        reader: (args) => createColorObjectBindingReader(args.params.colorType),\n        equals: equalsColor,\n        writer: (args) => createColorObjectWriter(shouldSupportAlpha(args.initialValue), args.params.colorType),\n    },\n    controller: (args) => {\n        var _a, _b;\n        const supportsAlpha = isRgbaColorObject(args.initialValue);\n        return new ColorController(args.document, {\n            colorType: args.params.colorType,\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: createColorObjectFormatter(supportsAlpha, args.params.colorType),\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: supportsAlpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nconst StringColorInputPlugin = createPlugin({\n    id: 'input-color-string',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        if (params.view === 'text') {\n            return null;\n        }\n        const format = detectStringColorFormat(value, extractColorType(params));\n        if (!format) {\n            return null;\n        }\n        const stringifier = findColorStringifier(format);\n        if (!stringifier) {\n            return null;\n        }\n        const result = parseColorInputParams(params);\n        return result\n            ? {\n                initialValue: value,\n                params: Object.assign(Object.assign({}, result), { format: format, stringifier: stringifier }),\n            }\n            : null;\n    },\n    binding: {\n        reader: () => readIntColorString,\n        equals: equalsColor,\n        writer: (args) => {\n            const writer = createColorStringWriter(args.params.format);\n            if (!writer) {\n                throw TpError.notBindable();\n            }\n            return writer;\n        },\n    },\n    controller: (args) => {\n        var _a, _b;\n        return new ColorController(args.document, {\n            colorType: args.params.format.type,\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            formatter: args.params.stringifier,\n            parser: createColorStringParser('int'),\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            supportsAlpha: args.params.format.alpha,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass PointNdConstraint {\n    constructor(config) {\n        this.components = config.components;\n        this.asm_ = config.assembly;\n    }\n    constrain(value) {\n        const comps = this.asm_\n            .toComponents(value)\n            .map((comp, index) => { var _a, _b; return (_b = (_a = this.components[index]) === null || _a === void 0 ? void 0 : _a.constrain(comp)) !== null && _b !== void 0 ? _b : comp; });\n        return this.asm_.fromComponents(comps);\n    }\n}\n\nconst cn$6 = ClassName('pndtxt');\nclass PointNdTextView {\n    constructor(doc, config) {\n        this.textViews = config.textViews;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$6());\n        this.textViews.forEach((v) => {\n            const axisElem = doc.createElement('div');\n            axisElem.classList.add(cn$6('a'));\n            axisElem.appendChild(v.element);\n            this.element.appendChild(axisElem);\n        });\n    }\n}\n\nfunction createAxisController(doc, config, index) {\n    return new NumberTextController(doc, {\n        arrayPosition: index === 0 ? 'fst' : index === config.axes.length - 1 ? 'lst' : 'mid',\n        parser: config.parser,\n        props: config.axes[index].textProps,\n        value: createValue(0, {\n            constraint: config.axes[index].constraint,\n        }),\n        viewProps: config.viewProps,\n    });\n}\nclass PointNdTextController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.acs_ = config.axes.map((_, index) => createAxisController(doc, config, index));\n        this.acs_.forEach((c, index) => {\n            connectValues({\n                primary: this.value,\n                secondary: c.value,\n                forward: (p) => config.assembly.toComponents(p)[index],\n                backward: (p, s) => {\n                    const comps = config.assembly.toComponents(p);\n                    comps[index] = s;\n                    return config.assembly.fromComponents(comps);\n                },\n            });\n        });\n        this.view = new PointNdTextView(doc, {\n            textViews: this.acs_.map((ac) => ac.view),\n        });\n    }\n    get textControllers() {\n        return this.acs_;\n    }\n}\n\nclass SliderInputBindingApi extends BindingApi {\n    get max() {\n        return this.controller.valueController.sliderController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.sliderController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.sliderController.props.get('min');\n    }\n    set min(max) {\n        this.controller.valueController.sliderController.props.set('min', max);\n    }\n}\n\nfunction createConstraint$4(params, initialValue) {\n    const constraints = [];\n    const sc = createStepConstraint(params, initialValue);\n    if (sc) {\n        constraints.push(sc);\n    }\n    const rc = createRangeConstraint(params);\n    if (rc) {\n        constraints.push(rc);\n    }\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst NumberInputPlugin = createPlugin({\n    id: 'input-number',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createNumberTextInputParamsParser(p)), { options: p.optional.custom(parseListOptions), readonly: p.optional.constant(false) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => numberFromUnknown,\n        constraint: (args) => createConstraint$4(args.params, args.initialValue),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(args.document, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        const textPropsObj = createNumberTextPropsObject(args.params, value.rawValue);\n        const drc = c && findConstraint(c, DefiniteRangeConstraint);\n        if (drc) {\n            return new SliderTextController(args.document, Object.assign(Object.assign({}, createSliderTextProps(Object.assign(Object.assign({}, textPropsObj), { keyScale: createValue(textPropsObj.keyScale), max: drc.values.value('max'), min: drc.values.value('min') }))), { parser: parseNumber, value: value, viewProps: args.viewProps }));\n        }\n        return new NumberTextController(args.document, {\n            parser: parseNumber,\n            props: ValueMap.fromObject(textPropsObj),\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'number') {\n            return null;\n        }\n        if (args.controller.valueController instanceof SliderTextController) {\n            return new SliderInputBindingApi(args.controller);\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nclass Point2d {\n    constructor(x = 0, y = 0) {\n        this.x = x;\n        this.y = y;\n    }\n    getComponents() {\n        return [this.x, this.y];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        if (typeof x !== 'number' || typeof y !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n        };\n    }\n}\nconst Point2dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point2d(...comps),\n};\n\nconst cn$5 = ClassName('p2d');\nclass Point2dView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$5());\n        config.viewProps.bindClassModifiers(this.element);\n        bindValue(config.expanded, valueToClassName(this.element, cn$5(undefined, 'expanded')));\n        const headElem = doc.createElement('div');\n        headElem.classList.add(cn$5('h'));\n        this.element.appendChild(headElem);\n        const buttonElem = doc.createElement('button');\n        buttonElem.classList.add(cn$5('b'));\n        buttonElem.appendChild(createSvgIconElement(doc, 'p2dpad'));\n        config.viewProps.bindDisabled(buttonElem);\n        headElem.appendChild(buttonElem);\n        this.buttonElement = buttonElem;\n        const textElem = doc.createElement('div');\n        textElem.classList.add(cn$5('t'));\n        headElem.appendChild(textElem);\n        this.textElement = textElem;\n        if (config.pickerLayout === 'inline') {\n            const pickerElem = doc.createElement('div');\n            pickerElem.classList.add(cn$5('p'));\n            this.element.appendChild(pickerElem);\n            this.pickerElement = pickerElem;\n        }\n        else {\n            this.pickerElement = null;\n        }\n    }\n}\n\nconst cn$4 = ClassName('p2dp');\nclass Point2dPickerView {\n    constructor(doc, config) {\n        this.onFoldableChange_ = this.onFoldableChange_.bind(this);\n        this.onPropsChange_ = this.onPropsChange_.bind(this);\n        this.onValueChange_ = this.onValueChange_.bind(this);\n        this.props_ = config.props;\n        this.props_.emitter.on('change', this.onPropsChange_);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$4());\n        if (config.layout === 'popup') {\n            this.element.classList.add(cn$4(undefined, 'p'));\n        }\n        config.viewProps.bindClassModifiers(this.element);\n        const padElem = doc.createElement('div');\n        padElem.classList.add(cn$4('p'));\n        config.viewProps.bindTabIndex(padElem);\n        this.element.appendChild(padElem);\n        this.padElement = padElem;\n        const svgElem = doc.createElementNS(SVG_NS, 'svg');\n        svgElem.classList.add(cn$4('g'));\n        this.padElement.appendChild(svgElem);\n        this.svgElem_ = svgElem;\n        const xAxisElem = doc.createElementNS(SVG_NS, 'line');\n        xAxisElem.classList.add(cn$4('ax'));\n        xAxisElem.setAttributeNS(null, 'x1', '0');\n        xAxisElem.setAttributeNS(null, 'y1', '50%');\n        xAxisElem.setAttributeNS(null, 'x2', '100%');\n        xAxisElem.setAttributeNS(null, 'y2', '50%');\n        this.svgElem_.appendChild(xAxisElem);\n        const yAxisElem = doc.createElementNS(SVG_NS, 'line');\n        yAxisElem.classList.add(cn$4('ax'));\n        yAxisElem.setAttributeNS(null, 'x1', '50%');\n        yAxisElem.setAttributeNS(null, 'y1', '0');\n        yAxisElem.setAttributeNS(null, 'x2', '50%');\n        yAxisElem.setAttributeNS(null, 'y2', '100%');\n        this.svgElem_.appendChild(yAxisElem);\n        const lineElem = doc.createElementNS(SVG_NS, 'line');\n        lineElem.classList.add(cn$4('l'));\n        lineElem.setAttributeNS(null, 'x1', '50%');\n        lineElem.setAttributeNS(null, 'y1', '50%');\n        this.svgElem_.appendChild(lineElem);\n        this.lineElem_ = lineElem;\n        const markerElem = doc.createElement('div');\n        markerElem.classList.add(cn$4('m'));\n        this.padElement.appendChild(markerElem);\n        this.markerElem_ = markerElem;\n        config.value.emitter.on('change', this.onValueChange_);\n        this.value = config.value;\n        this.update_();\n    }\n    get allFocusableElements() {\n        return [this.padElement];\n    }\n    update_() {\n        const [x, y] = this.value.rawValue.getComponents();\n        const max = this.props_.get('max');\n        const px = mapRange(x, -max, +max, 0, 100);\n        const py = mapRange(y, -max, +max, 0, 100);\n        const ipy = this.props_.get('invertsY') ? 100 - py : py;\n        this.lineElem_.setAttributeNS(null, 'x2', `${px}%`);\n        this.lineElem_.setAttributeNS(null, 'y2', `${ipy}%`);\n        this.markerElem_.style.left = `${px}%`;\n        this.markerElem_.style.top = `${ipy}%`;\n    }\n    onValueChange_() {\n        this.update_();\n    }\n    onPropsChange_() {\n        this.update_();\n    }\n    onFoldableChange_() {\n        this.update_();\n    }\n}\n\nfunction computeOffset(ev, keyScales, invertsY) {\n    return [\n        getStepForKey(keyScales[0], getHorizontalStepKeys(ev)),\n        getStepForKey(keyScales[1], getVerticalStepKeys(ev)) * (invertsY ? 1 : -1),\n    ];\n}\nclass Point2dPickerController {\n    constructor(doc, config) {\n        this.onPadKeyDown_ = this.onPadKeyDown_.bind(this);\n        this.onPadKeyUp_ = this.onPadKeyUp_.bind(this);\n        this.onPointerDown_ = this.onPointerDown_.bind(this);\n        this.onPointerMove_ = this.onPointerMove_.bind(this);\n        this.onPointerUp_ = this.onPointerUp_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new Point2dPickerView(doc, {\n            layout: config.layout,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.ptHandler_ = new PointerHandler(this.view.padElement);\n        this.ptHandler_.emitter.on('down', this.onPointerDown_);\n        this.ptHandler_.emitter.on('move', this.onPointerMove_);\n        this.ptHandler_.emitter.on('up', this.onPointerUp_);\n        this.view.padElement.addEventListener('keydown', this.onPadKeyDown_);\n        this.view.padElement.addEventListener('keyup', this.onPadKeyUp_);\n    }\n    handlePointerEvent_(d, opts) {\n        if (!d.point) {\n            return;\n        }\n        const max = this.props.get('max');\n        const px = mapRange(d.point.x, 0, d.bounds.width, -max, +max);\n        const py = mapRange(this.props.get('invertsY') ? d.bounds.height - d.point.y : d.point.y, 0, d.bounds.height, -max, +max);\n        this.value.setRawValue(new Point2d(px, py), opts);\n    }\n    onPointerDown_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerMove_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPointerUp_(ev) {\n        this.handlePointerEvent_(ev.data, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n    onPadKeyDown_(ev) {\n        if (isArrowKey(ev.key)) {\n            ev.preventDefault();\n        }\n        const [dx, dy] = computeOffset(ev, [this.props.get('xKeyScale'), this.props.get('yKeyScale')], this.props.get('invertsY'));\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        this.value.setRawValue(new Point2d(this.value.rawValue.x + dx, this.value.rawValue.y + dy), {\n            forceEmit: false,\n            last: false,\n        });\n    }\n    onPadKeyUp_(ev) {\n        const [dx, dy] = computeOffset(ev, [this.props.get('xKeyScale'), this.props.get('yKeyScale')], this.props.get('invertsY'));\n        if (dx === 0 && dy === 0) {\n            return;\n        }\n        this.value.setRawValue(this.value.rawValue, {\n            forceEmit: true,\n            last: true,\n        });\n    }\n}\n\nclass Point2dController {\n    constructor(doc, config) {\n        var _a, _b;\n        this.onPopupChildBlur_ = this.onPopupChildBlur_.bind(this);\n        this.onPopupChildKeydown_ = this.onPopupChildKeydown_.bind(this);\n        this.onPadButtonBlur_ = this.onPadButtonBlur_.bind(this);\n        this.onPadButtonClick_ = this.onPadButtonClick_.bind(this);\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.foldable_ = Foldable.create(config.expanded);\n        this.popC_ =\n            config.pickerLayout === 'popup'\n                ? new PopupController(doc, {\n                    viewProps: this.viewProps,\n                })\n                : null;\n        const padC = new Point2dPickerController(doc, {\n            layout: config.pickerLayout,\n            props: new ValueMap({\n                invertsY: createValue(config.invertsY),\n                max: createValue(config.max),\n                xKeyScale: config.axes[0].textProps.value('keyScale'),\n                yKeyScale: config.axes[1].textProps.value('keyScale'),\n            }),\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        padC.view.allFocusableElements.forEach((elem) => {\n            elem.addEventListener('blur', this.onPopupChildBlur_);\n            elem.addEventListener('keydown', this.onPopupChildKeydown_);\n        });\n        this.pickerC_ = padC;\n        this.textC_ = new PointNdTextController(doc, {\n            assembly: Point2dAssembly,\n            axes: config.axes,\n            parser: config.parser,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        this.view = new Point2dView(doc, {\n            expanded: this.foldable_.value('expanded'),\n            pickerLayout: config.pickerLayout,\n            viewProps: this.viewProps,\n        });\n        this.view.textElement.appendChild(this.textC_.view.element);\n        (_a = this.view.buttonElement) === null || _a === void 0 ? void 0 : _a.addEventListener('blur', this.onPadButtonBlur_);\n        (_b = this.view.buttonElement) === null || _b === void 0 ? void 0 : _b.addEventListener('click', this.onPadButtonClick_);\n        if (this.popC_) {\n            this.view.element.appendChild(this.popC_.view.element);\n            this.popC_.view.element.appendChild(this.pickerC_.view.element);\n            connectValues({\n                primary: this.foldable_.value('expanded'),\n                secondary: this.popC_.shows,\n                forward: (p) => p,\n                backward: (_, s) => s,\n            });\n        }\n        else if (this.view.pickerElement) {\n            this.view.pickerElement.appendChild(this.pickerC_.view.element);\n            bindFoldable(this.foldable_, this.view.pickerElement);\n        }\n    }\n    get textController() {\n        return this.textC_;\n    }\n    onPadButtonBlur_(e) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.view.element;\n        const nextTarget = forceCast(e.relatedTarget);\n        if (!nextTarget || !elem.contains(nextTarget)) {\n            this.popC_.shows.rawValue = false;\n        }\n    }\n    onPadButtonClick_() {\n        this.foldable_.set('expanded', !this.foldable_.get('expanded'));\n        if (this.foldable_.get('expanded')) {\n            this.pickerC_.view.allFocusableElements[0].focus();\n        }\n    }\n    onPopupChildBlur_(ev) {\n        if (!this.popC_) {\n            return;\n        }\n        const elem = this.popC_.view.element;\n        const nextTarget = findNextTarget(ev);\n        if (nextTarget && elem.contains(nextTarget)) {\n            return;\n        }\n        if (nextTarget &&\n            nextTarget === this.view.buttonElement &&\n            !supportsTouch(elem.ownerDocument)) {\n            return;\n        }\n        this.popC_.shows.rawValue = false;\n    }\n    onPopupChildKeydown_(ev) {\n        if (this.popC_) {\n            if (ev.key === 'Escape') {\n                this.popC_.shows.rawValue = false;\n            }\n        }\n        else if (this.view.pickerElement) {\n            if (ev.key === 'Escape') {\n                this.view.buttonElement.focus();\n            }\n        }\n    }\n}\n\nfunction point2dFromUnknown(value) {\n    return Point2d.isObject(value)\n        ? new Point2d(value.x, value.y)\n        : new Point2d();\n}\nfunction writePoint2d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n}\n\nfunction createConstraint$3(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point2dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n        ],\n    });\n}\nfunction getSuitableMaxDimensionValue(params, rawValue) {\n    var _a, _b;\n    if (!isEmpty(params.min) || !isEmpty(params.max)) {\n        return Math.max(Math.abs((_a = params.min) !== null && _a !== void 0 ? _a : 0), Math.abs((_b = params.max) !== null && _b !== void 0 ? _b : 0));\n    }\n    const step = getSuitableKeyScale(params);\n    return Math.max(Math.abs(step) * 10, Math.abs(rawValue) * 10);\n}\nfunction getSuitableMax(params, initialValue) {\n    var _a, _b;\n    const xr = getSuitableMaxDimensionValue(deepMerge(params, ((_a = params.x) !== null && _a !== void 0 ? _a : {})), initialValue.x);\n    const yr = getSuitableMaxDimensionValue(deepMerge(params, ((_b = params.y) !== null && _b !== void 0 ? _b : {})), initialValue.y);\n    return Math.max(xr, yr);\n}\nfunction shouldInvertY(params) {\n    if (!('y' in params)) {\n        return false;\n    }\n    const yParams = params.y;\n    if (!yParams) {\n        return false;\n    }\n    return 'inverted' in yParams ? !!yParams.inverted : false;\n}\nconst Point2dInputPlugin = createPlugin({\n    id: 'input-point2d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point2d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { expanded: p.optional.boolean, picker: p.optional.custom(parsePickerLayout), readonly: p.optional.constant(false), x: p.optional.custom(parsePointDimensionParams), y: p.optional.object(Object.assign(Object.assign({}, createPointDimensionParser(p)), { inverted: p.optional.boolean })) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: () => point2dFromUnknown,\n        constraint: (args) => createConstraint$3(args.params, args.initialValue),\n        equals: Point2d.equals,\n        writer: () => writePoint2d,\n    },\n    controller: (args) => {\n        var _a, _b;\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [args.params.x, args.params.y];\n        return new Point2dController(doc, {\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            expanded: (_a = args.params.expanded) !== null && _a !== void 0 ? _a : false,\n            invertsY: shouldInvertY(args.params),\n            max: getSuitableMax(args.params, value.rawValue),\n            parser: parseNumber,\n            pickerLayout: (_b = args.params.picker) !== null && _b !== void 0 ? _b : 'popup',\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass Point3d {\n    constructor(x = 0, y = 0, z = 0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n    getComponents() {\n        return [this.x, this.y, this.z];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        const z = obj.z;\n        if (typeof x !== 'number' ||\n            typeof y !== 'number' ||\n            typeof z !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n            z: this.z,\n        };\n    }\n}\nconst Point3dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point3d(...comps),\n};\n\nfunction point3dFromUnknown(value) {\n    return Point3d.isObject(value)\n        ? new Point3d(value.x, value.y, value.z)\n        : new Point3d();\n}\nfunction writePoint3d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n    target.writeProperty('z', value.z);\n}\n\nfunction createConstraint$2(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point3dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.z), initialValue.z),\n        ],\n    });\n}\nconst Point3dInputPlugin = createPlugin({\n    id: 'input-point3d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point3d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { readonly: p.optional.constant(false), x: p.optional.custom(parsePointDimensionParams), y: p.optional.custom(parsePointDimensionParams), z: p.optional.custom(parsePointDimensionParams) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => point3dFromUnknown,\n        constraint: (args) => createConstraint$2(args.params, args.initialValue),\n        equals: Point3d.equals,\n        writer: (_args) => writePoint3d,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [args.params.x, args.params.y, args.params.z];\n        return new PointNdTextController(args.document, {\n            assembly: Point3dAssembly,\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            parser: parseNumber,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass Point4d {\n    constructor(x = 0, y = 0, z = 0, w = 0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n    }\n    getComponents() {\n        return [this.x, this.y, this.z, this.w];\n    }\n    static isObject(obj) {\n        if (isEmpty(obj)) {\n            return false;\n        }\n        const x = obj.x;\n        const y = obj.y;\n        const z = obj.z;\n        const w = obj.w;\n        if (typeof x !== 'number' ||\n            typeof y !== 'number' ||\n            typeof z !== 'number' ||\n            typeof w !== 'number') {\n            return false;\n        }\n        return true;\n    }\n    static equals(v1, v2) {\n        return v1.x === v2.x && v1.y === v2.y && v1.z === v2.z && v1.w === v2.w;\n    }\n    toObject() {\n        return {\n            x: this.x,\n            y: this.y,\n            z: this.z,\n            w: this.w,\n        };\n    }\n}\nconst Point4dAssembly = {\n    toComponents: (p) => p.getComponents(),\n    fromComponents: (comps) => new Point4d(...comps),\n};\n\nfunction point4dFromUnknown(value) {\n    return Point4d.isObject(value)\n        ? new Point4d(value.x, value.y, value.z, value.w)\n        : new Point4d();\n}\nfunction writePoint4d(target, value) {\n    target.writeProperty('x', value.x);\n    target.writeProperty('y', value.y);\n    target.writeProperty('z', value.z);\n    target.writeProperty('w', value.w);\n}\n\nfunction createConstraint$1(params, initialValue) {\n    return new PointNdConstraint({\n        assembly: Point4dAssembly,\n        components: [\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.x), initialValue.x),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.y), initialValue.y),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.z), initialValue.z),\n            createDimensionConstraint(Object.assign(Object.assign({}, params), params.w), initialValue.w),\n        ],\n    });\n}\nconst Point4dInputPlugin = createPlugin({\n    id: 'input-point4d',\n    type: 'input',\n    accept: (value, params) => {\n        if (!Point4d.isObject(value)) {\n            return null;\n        }\n        const result = parseRecord(params, (p) => (Object.assign(Object.assign({}, createPointDimensionParser(p)), { readonly: p.optional.constant(false), w: p.optional.custom(parsePointDimensionParams), x: p.optional.custom(parsePointDimensionParams), y: p.optional.custom(parsePointDimensionParams), z: p.optional.custom(parsePointDimensionParams) })));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => point4dFromUnknown,\n        constraint: (args) => createConstraint$1(args.params, args.initialValue),\n        equals: Point4d.equals,\n        writer: (_args) => writePoint4d,\n    },\n    controller: (args) => {\n        const value = args.value;\n        const c = args.constraint;\n        const dParams = [\n            args.params.x,\n            args.params.y,\n            args.params.z,\n            args.params.w,\n        ];\n        return new PointNdTextController(args.document, {\n            assembly: Point4dAssembly,\n            axes: value.rawValue.getComponents().map((comp, i) => {\n                var _a;\n                return createPointAxis({\n                    constraint: c.components[i],\n                    initialValue: comp,\n                    params: deepMerge(args.params, ((_a = dParams[i]) !== null && _a !== void 0 ? _a : {})),\n                });\n            }),\n            parser: parseNumber,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nfunction createConstraint(params) {\n    const constraints = [];\n    const lc = createListConstraint(params.options);\n    if (lc) {\n        constraints.push(lc);\n    }\n    return new CompositeConstraint(constraints);\n}\nconst StringInputPlugin = createPlugin({\n    id: 'input-string',\n    type: 'input',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            readonly: p.optional.constant(false),\n            options: p.optional.custom(parseListOptions),\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => stringFromUnknown,\n        constraint: (args) => createConstraint(args.params),\n        writer: (_args) => writePrimitive,\n    },\n    controller: (args) => {\n        const doc = args.document;\n        const value = args.value;\n        const c = args.constraint;\n        const lc = c && findConstraint(c, ListConstraint);\n        if (lc) {\n            return new ListController(doc, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new TextController(doc, {\n            parser: (v) => v,\n            props: ValueMap.fromObject({\n                formatter: formatString,\n            }),\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (typeof args.controller.value.rawValue !== 'string') {\n            return null;\n        }\n        if (args.controller.valueController instanceof ListController) {\n            return new ListInputBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst Constants = {\n    monitor: {\n        defaultInterval: 200,\n        defaultRows: 3,\n    },\n};\n\nconst cn$3 = ClassName('mll');\nclass MultiLogView {\n    constructor(doc, config) {\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.formatter_ = config.formatter;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$3());\n        config.viewProps.bindClassModifiers(this.element);\n        const textareaElem = doc.createElement('textarea');\n        textareaElem.classList.add(cn$3('i'));\n        textareaElem.style.height = `calc(var(${getCssVar('containerUnitSize')}) * ${config.rows})`;\n        textareaElem.readOnly = true;\n        config.viewProps.bindDisabled(textareaElem);\n        this.element.appendChild(textareaElem);\n        this.textareaElem_ = textareaElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const elem = this.textareaElem_;\n        const shouldScroll = elem.scrollTop === elem.scrollHeight - elem.clientHeight;\n        const lines = [];\n        this.value.rawValue.forEach((value) => {\n            if (value !== undefined) {\n                lines.push(this.formatter_(value));\n            }\n        });\n        elem.textContent = lines.join('\\n');\n        if (shouldScroll) {\n            elem.scrollTop = elem.scrollHeight;\n        }\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n}\n\nclass MultiLogController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new MultiLogView(doc, {\n            formatter: config.formatter,\n            rows: config.rows,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst cn$2 = ClassName('sgl');\nclass SingleLogView {\n    constructor(doc, config) {\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.formatter_ = config.formatter;\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$2());\n        config.viewProps.bindClassModifiers(this.element);\n        const inputElem = doc.createElement('input');\n        inputElem.classList.add(cn$2('i'));\n        inputElem.readOnly = true;\n        inputElem.type = 'text';\n        config.viewProps.bindDisabled(inputElem);\n        this.element.appendChild(inputElem);\n        this.inputElement = inputElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    update_() {\n        const values = this.value.rawValue;\n        const lastValue = values[values.length - 1];\n        this.inputElement.value =\n            lastValue !== undefined ? this.formatter_(lastValue) : '';\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n}\n\nclass SingleLogController {\n    constructor(doc, config) {\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.view = new SingleLogView(doc, {\n            formatter: config.formatter,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n    }\n}\n\nconst BooleanMonitorPlugin = createPlugin({\n    id: 'monitor-bool',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'boolean') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => boolFromUnknown,\n    },\n    controller: (args) => {\n        var _a;\n        if (args.value.rawValue.length === 1) {\n            return new SingleLogController(args.document, {\n                formatter: BooleanFormatter,\n                value: args.value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new MultiLogController(args.document, {\n            formatter: BooleanFormatter,\n            rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass GraphLogMonitorBindingApi extends BindingApi {\n    get max() {\n        return this.controller.valueController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.props.get('min');\n    }\n    set min(min) {\n        this.controller.valueController.props.set('min', min);\n    }\n}\n\nconst cn$1 = ClassName('grl');\nclass GraphLogView {\n    constructor(doc, config) {\n        this.onCursorChange_ = this.onCursorChange_.bind(this);\n        this.onValueUpdate_ = this.onValueUpdate_.bind(this);\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn$1());\n        config.viewProps.bindClassModifiers(this.element);\n        this.formatter_ = config.formatter;\n        this.props_ = config.props;\n        this.cursor_ = config.cursor;\n        this.cursor_.emitter.on('change', this.onCursorChange_);\n        const svgElem = doc.createElementNS(SVG_NS, 'svg');\n        svgElem.classList.add(cn$1('g'));\n        svgElem.style.height = `calc(var(${getCssVar('containerUnitSize')}) * ${config.rows})`;\n        this.element.appendChild(svgElem);\n        this.svgElem_ = svgElem;\n        const lineElem = doc.createElementNS(SVG_NS, 'polyline');\n        this.svgElem_.appendChild(lineElem);\n        this.lineElem_ = lineElem;\n        const tooltipElem = doc.createElement('div');\n        tooltipElem.classList.add(cn$1('t'), ClassName('tt')());\n        this.element.appendChild(tooltipElem);\n        this.tooltipElem_ = tooltipElem;\n        config.value.emitter.on('change', this.onValueUpdate_);\n        this.value = config.value;\n        this.update_();\n    }\n    get graphElement() {\n        return this.svgElem_;\n    }\n    update_() {\n        const { clientWidth: w, clientHeight: h } = this.element;\n        const maxIndex = this.value.rawValue.length - 1;\n        const min = this.props_.get('min');\n        const max = this.props_.get('max');\n        const points = [];\n        this.value.rawValue.forEach((v, index) => {\n            if (v === undefined) {\n                return;\n            }\n            const x = mapRange(index, 0, maxIndex, 0, w);\n            const y = mapRange(v, min, max, h, 0);\n            points.push([x, y].join(','));\n        });\n        this.lineElem_.setAttributeNS(null, 'points', points.join(' '));\n        const tooltipElem = this.tooltipElem_;\n        const value = this.value.rawValue[this.cursor_.rawValue];\n        if (value === undefined) {\n            tooltipElem.classList.remove(cn$1('t', 'a'));\n            return;\n        }\n        const tx = mapRange(this.cursor_.rawValue, 0, maxIndex, 0, w);\n        const ty = mapRange(value, min, max, h, 0);\n        tooltipElem.style.left = `${tx}px`;\n        tooltipElem.style.top = `${ty}px`;\n        tooltipElem.textContent = `${this.formatter_(value)}`;\n        if (!tooltipElem.classList.contains(cn$1('t', 'a'))) {\n            tooltipElem.classList.add(cn$1('t', 'a'), cn$1('t', 'in'));\n            forceReflow(tooltipElem);\n            tooltipElem.classList.remove(cn$1('t', 'in'));\n        }\n    }\n    onValueUpdate_() {\n        this.update_();\n    }\n    onCursorChange_() {\n        this.update_();\n    }\n}\n\nclass GraphLogController {\n    constructor(doc, config) {\n        this.onGraphMouseMove_ = this.onGraphMouseMove_.bind(this);\n        this.onGraphMouseLeave_ = this.onGraphMouseLeave_.bind(this);\n        this.onGraphPointerDown_ = this.onGraphPointerDown_.bind(this);\n        this.onGraphPointerMove_ = this.onGraphPointerMove_.bind(this);\n        this.onGraphPointerUp_ = this.onGraphPointerUp_.bind(this);\n        this.props = config.props;\n        this.value = config.value;\n        this.viewProps = config.viewProps;\n        this.cursor_ = createValue(-1);\n        this.view = new GraphLogView(doc, {\n            cursor: this.cursor_,\n            formatter: config.formatter,\n            rows: config.rows,\n            props: this.props,\n            value: this.value,\n            viewProps: this.viewProps,\n        });\n        if (!supportsTouch(doc)) {\n            this.view.element.addEventListener('mousemove', this.onGraphMouseMove_);\n            this.view.element.addEventListener('mouseleave', this.onGraphMouseLeave_);\n        }\n        else {\n            const ph = new PointerHandler(this.view.element);\n            ph.emitter.on('down', this.onGraphPointerDown_);\n            ph.emitter.on('move', this.onGraphPointerMove_);\n            ph.emitter.on('up', this.onGraphPointerUp_);\n        }\n    }\n    importProps(state) {\n        return importBladeState(state, null, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n        }), (result) => {\n            this.props.set('max', result.max);\n            this.props.set('min', result.min);\n            return true;\n        });\n    }\n    exportProps() {\n        return exportBladeState(null, {\n            max: this.props.get('max'),\n            min: this.props.get('min'),\n        });\n    }\n    onGraphMouseLeave_() {\n        this.cursor_.rawValue = -1;\n    }\n    onGraphMouseMove_(ev) {\n        const { clientWidth: w } = this.view.element;\n        this.cursor_.rawValue = Math.floor(mapRange(ev.offsetX, 0, w, 0, this.value.rawValue.length));\n    }\n    onGraphPointerDown_(ev) {\n        this.onGraphPointerMove_(ev);\n    }\n    onGraphPointerMove_(ev) {\n        if (!ev.data.point) {\n            this.cursor_.rawValue = -1;\n            return;\n        }\n        this.cursor_.rawValue = Math.floor(mapRange(ev.data.point.x, 0, ev.data.bounds.width, 0, this.value.rawValue.length));\n    }\n    onGraphPointerUp_() {\n        this.cursor_.rawValue = -1;\n    }\n}\n\nfunction createFormatter(params) {\n    return !isEmpty(params.format) ? params.format : createNumberFormatter(2);\n}\nfunction createTextMonitor(args) {\n    var _a;\n    if (args.value.rawValue.length === 1) {\n        return new SingleLogController(args.document, {\n            formatter: createFormatter(args.params),\n            value: args.value,\n            viewProps: args.viewProps,\n        });\n    }\n    return new MultiLogController(args.document, {\n        formatter: createFormatter(args.params),\n        rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n        value: args.value,\n        viewProps: args.viewProps,\n    });\n}\nfunction createGraphMonitor(args) {\n    var _a, _b, _c;\n    return new GraphLogController(args.document, {\n        formatter: createFormatter(args.params),\n        rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n        props: ValueMap.fromObject({\n            max: (_b = args.params.max) !== null && _b !== void 0 ? _b : 100,\n            min: (_c = args.params.min) !== null && _c !== void 0 ? _c : 0,\n        }),\n        value: args.value,\n        viewProps: args.viewProps,\n    });\n}\nfunction shouldShowGraph(params) {\n    return params.view === 'graph';\n}\nconst NumberMonitorPlugin = createPlugin({\n    id: 'monitor-number',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'number') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            format: p.optional.function,\n            max: p.optional.number,\n            min: p.optional.number,\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n            view: p.optional.string,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        defaultBufferSize: (params) => (shouldShowGraph(params) ? 64 : 1),\n        reader: (_args) => numberFromUnknown,\n    },\n    controller: (args) => {\n        if (shouldShowGraph(args.params)) {\n            return createGraphMonitor(args);\n        }\n        return createTextMonitor(args);\n    },\n    api: (args) => {\n        if (args.controller.valueController instanceof GraphLogController) {\n            return new GraphLogMonitorBindingApi(args.controller);\n        }\n        return null;\n    },\n});\n\nconst StringMonitorPlugin = createPlugin({\n    id: 'monitor-string',\n    type: 'monitor',\n    accept: (value, params) => {\n        if (typeof value !== 'string') {\n            return null;\n        }\n        const result = parseRecord(params, (p) => ({\n            multiline: p.optional.boolean,\n            readonly: p.required.constant(true),\n            rows: p.optional.number,\n        }));\n        return result\n            ? {\n                initialValue: value,\n                params: result,\n            }\n            : null;\n    },\n    binding: {\n        reader: (_args) => stringFromUnknown,\n    },\n    controller: (args) => {\n        var _a;\n        const value = args.value;\n        const multiline = value.rawValue.length > 1 || args.params.multiline;\n        if (multiline) {\n            return new MultiLogController(args.document, {\n                formatter: formatString,\n                rows: (_a = args.params.rows) !== null && _a !== void 0 ? _a : Constants.monitor.defaultRows,\n                value: value,\n                viewProps: args.viewProps,\n            });\n        }\n        return new SingleLogController(args.document, {\n            formatter: formatString,\n            value: value,\n            viewProps: args.viewProps,\n        });\n    },\n});\n\nclass BladeApiCache {\n    constructor() {\n        this.map_ = new Map();\n    }\n    get(bc) {\n        var _a;\n        return (_a = this.map_.get(bc)) !== null && _a !== void 0 ? _a : null;\n    }\n    has(bc) {\n        return this.map_.has(bc);\n    }\n    add(bc, api) {\n        this.map_.set(bc, api);\n        bc.viewProps.handleDispose(() => {\n            this.map_.delete(bc);\n        });\n        return api;\n    }\n}\n\nclass ReadWriteBinding {\n    constructor(config) {\n        this.target = config.target;\n        this.reader_ = config.reader;\n        this.writer_ = config.writer;\n    }\n    read() {\n        return this.reader_(this.target.read());\n    }\n    write(value) {\n        this.writer_(this.target, value);\n    }\n    inject(value) {\n        this.write(this.reader_(value));\n    }\n}\n\nfunction createInputBindingController(plugin, args) {\n    var _a;\n    const result = plugin.accept(args.target.read(), args.params);\n    if (isEmpty(result)) {\n        return null;\n    }\n    const valueArgs = {\n        target: args.target,\n        initialValue: result.initialValue,\n        params: result.params,\n    };\n    const params = parseRecord(args.params, (p) => ({\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n        label: p.optional.string,\n        tag: p.optional.string,\n    }));\n    const reader = plugin.binding.reader(valueArgs);\n    const constraint = plugin.binding.constraint\n        ? plugin.binding.constraint(valueArgs)\n        : undefined;\n    const binding = new ReadWriteBinding({\n        reader: reader,\n        target: args.target,\n        writer: plugin.binding.writer(valueArgs),\n    });\n    const value = new InputBindingValue(createValue(reader(result.initialValue), {\n        constraint: constraint,\n        equals: plugin.binding.equals,\n    }), binding);\n    const controller = plugin.controller({\n        constraint: constraint,\n        document: args.document,\n        initialValue: result.initialValue,\n        params: result.params,\n        value: value,\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n    return new InputBindingController(args.document, {\n        blade: createBlade(),\n        props: ValueMap.fromObject({\n            label: 'label' in args.params ? (_a = params === null || params === void 0 ? void 0 : params.label) !== null && _a !== void 0 ? _a : null : args.target.key,\n        }),\n        tag: params === null || params === void 0 ? void 0 : params.tag,\n        value: value,\n        valueController: controller,\n    });\n}\n\nclass ReadonlyBinding {\n    constructor(config) {\n        this.target = config.target;\n        this.reader_ = config.reader;\n    }\n    read() {\n        return this.reader_(this.target.read());\n    }\n}\n\nfunction createTicker(document, interval) {\n    return interval === 0\n        ? new ManualTicker()\n        : new IntervalTicker(document, interval !== null && interval !== void 0 ? interval : Constants.monitor.defaultInterval);\n}\nfunction createMonitorBindingController(plugin, args) {\n    var _a, _b, _c;\n    const result = plugin.accept(args.target.read(), args.params);\n    if (isEmpty(result)) {\n        return null;\n    }\n    const bindingArgs = {\n        target: args.target,\n        initialValue: result.initialValue,\n        params: result.params,\n    };\n    const params = parseRecord(args.params, (p) => ({\n        bufferSize: p.optional.number,\n        disabled: p.optional.boolean,\n        hidden: p.optional.boolean,\n        interval: p.optional.number,\n        label: p.optional.string,\n    }));\n    const reader = plugin.binding.reader(bindingArgs);\n    const bufferSize = (_b = (_a = params === null || params === void 0 ? void 0 : params.bufferSize) !== null && _a !== void 0 ? _a : (plugin.binding.defaultBufferSize &&\n        plugin.binding.defaultBufferSize(result.params))) !== null && _b !== void 0 ? _b : 1;\n    const value = new MonitorBindingValue({\n        binding: new ReadonlyBinding({\n            reader: reader,\n            target: args.target,\n        }),\n        bufferSize: bufferSize,\n        ticker: createTicker(args.document, params === null || params === void 0 ? void 0 : params.interval),\n    });\n    const controller = plugin.controller({\n        document: args.document,\n        params: result.params,\n        value: value,\n        viewProps: ViewProps.create({\n            disabled: params === null || params === void 0 ? void 0 : params.disabled,\n            hidden: params === null || params === void 0 ? void 0 : params.hidden,\n        }),\n    });\n    controller.viewProps.bindDisabled(value.ticker);\n    controller.viewProps.handleDispose(() => {\n        value.ticker.dispose();\n    });\n    return new MonitorBindingController(args.document, {\n        blade: createBlade(),\n        props: ValueMap.fromObject({\n            label: 'label' in args.params ? (_c = params === null || params === void 0 ? void 0 : params.label) !== null && _c !== void 0 ? _c : null : args.target.key,\n        }),\n        value: value,\n        valueController: controller,\n    });\n}\n\nclass PluginPool {\n    constructor(apiCache) {\n        this.pluginsMap_ = {\n            blades: [],\n            inputs: [],\n            monitors: [],\n        };\n        this.apiCache_ = apiCache;\n    }\n    getAll() {\n        return [\n            ...this.pluginsMap_.blades,\n            ...this.pluginsMap_.inputs,\n            ...this.pluginsMap_.monitors,\n        ];\n    }\n    register(bundleId, r) {\n        if (!isCompatible(r.core)) {\n            throw TpError.notCompatible(bundleId, r.id);\n        }\n        if (r.type === 'blade') {\n            this.pluginsMap_.blades.unshift(r);\n        }\n        else if (r.type === 'input') {\n            this.pluginsMap_.inputs.unshift(r);\n        }\n        else if (r.type === 'monitor') {\n            this.pluginsMap_.monitors.unshift(r);\n        }\n    }\n    createInput_(document, target, params) {\n        return this.pluginsMap_.inputs.reduce((result, plugin) => result !== null && result !== void 0 ? result : createInputBindingController(plugin, {\n            document: document,\n            target: target,\n            params: params,\n        }), null);\n    }\n    createMonitor_(document, target, params) {\n        return this.pluginsMap_.monitors.reduce((result, plugin) => result !== null && result !== void 0 ? result : createMonitorBindingController(plugin, {\n            document: document,\n            params: params,\n            target: target,\n        }), null);\n    }\n    createBinding(doc, target, params) {\n        const initialValue = target.read();\n        if (isEmpty(initialValue)) {\n            throw new TpError({\n                context: {\n                    key: target.key,\n                },\n                type: 'nomatchingcontroller',\n            });\n        }\n        const ic = this.createInput_(doc, target, params);\n        if (ic) {\n            return ic;\n        }\n        const mc = this.createMonitor_(doc, target, params);\n        if (mc) {\n            return mc;\n        }\n        throw new TpError({\n            context: {\n                key: target.key,\n            },\n            type: 'nomatchingcontroller',\n        });\n    }\n    createBlade(document, params) {\n        const bc = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : createBladeController(plugin, {\n            document: document,\n            params: params,\n        }), null);\n        if (!bc) {\n            throw new TpError({\n                type: 'nomatchingview',\n                context: {\n                    params: params,\n                },\n            });\n        }\n        return bc;\n    }\n    createInputBindingApi_(bc) {\n        const api = this.pluginsMap_.inputs.reduce((result, plugin) => {\n            var _a, _b;\n            if (result) {\n                return result;\n            }\n            return ((_b = (_a = plugin.api) === null || _a === void 0 ? void 0 : _a.call(plugin, {\n                controller: bc,\n            })) !== null && _b !== void 0 ? _b : null);\n        }, null);\n        return this.apiCache_.add(bc, api !== null && api !== void 0 ? api : new BindingApi(bc));\n    }\n    createMonitorBindingApi_(bc) {\n        const api = this.pluginsMap_.monitors.reduce((result, plugin) => {\n            var _a, _b;\n            if (result) {\n                return result;\n            }\n            return ((_b = (_a = plugin.api) === null || _a === void 0 ? void 0 : _a.call(plugin, {\n                controller: bc,\n            })) !== null && _b !== void 0 ? _b : null);\n        }, null);\n        return this.apiCache_.add(bc, api !== null && api !== void 0 ? api : new BindingApi(bc));\n    }\n    createBindingApi(bc) {\n        if (this.apiCache_.has(bc)) {\n            return this.apiCache_.get(bc);\n        }\n        if (isInputBindingController(bc)) {\n            return this.createInputBindingApi_(bc);\n        }\n        if (isMonitorBindingController(bc)) {\n            return this.createMonitorBindingApi_(bc);\n        }\n        throw TpError.shouldNeverHappen();\n    }\n    createApi(bc) {\n        if (this.apiCache_.has(bc)) {\n            return this.apiCache_.get(bc);\n        }\n        if (isBindingController(bc)) {\n            return this.createBindingApi(bc);\n        }\n        const api = this.pluginsMap_.blades.reduce((result, plugin) => result !== null && result !== void 0 ? result : plugin.api({\n            controller: bc,\n            pool: this,\n        }), null);\n        if (!api) {\n            throw TpError.shouldNeverHappen();\n        }\n        return this.apiCache_.add(bc, api);\n    }\n}\n\nconst sharedCache = new BladeApiCache();\nfunction createDefaultPluginPool() {\n    const pool = new PluginPool(sharedCache);\n    [\n        Point2dInputPlugin,\n        Point3dInputPlugin,\n        Point4dInputPlugin,\n        StringInputPlugin,\n        NumberInputPlugin,\n        StringColorInputPlugin,\n        ObjectColorInputPlugin,\n        NumberColorInputPlugin,\n        BooleanInputPlugin,\n        BooleanMonitorPlugin,\n        StringMonitorPlugin,\n        NumberMonitorPlugin,\n        ButtonBladePlugin,\n        FolderBladePlugin,\n        TabBladePlugin,\n    ].forEach((p) => {\n        pool.register('core', p);\n    });\n    return pool;\n}\n\nclass ListBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get options() {\n        return this.controller.valueController.props.get('options');\n    }\n    set options(options) {\n        this.controller.valueController.props.set('options', options);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n}\n\nclass SeparatorBladeApi extends BladeApi {\n}\n\nclass SliderBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get max() {\n        return this.controller.valueController.sliderController.props.get('max');\n    }\n    set max(max) {\n        this.controller.valueController.sliderController.props.set('max', max);\n    }\n    get min() {\n        return this.controller.valueController.sliderController.props.get('min');\n    }\n    set min(min) {\n        this.controller.valueController.sliderController.props.set('min', min);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n}\n\nclass TextBladeApi extends BladeApi {\n    /**\n     * @hidden\n     */\n    constructor(controller) {\n        super(controller);\n        this.emitter_ = new Emitter();\n        this.controller.value.emitter.on('change', (ev) => {\n            this.emitter_.emit('change', new TpChangeEvent(this, ev.rawValue));\n        });\n    }\n    get label() {\n        return this.controller.labelController.props.get('label');\n    }\n    set label(label) {\n        this.controller.labelController.props.set('label', label);\n    }\n    get formatter() {\n        return this.controller.valueController.props.get('formatter');\n    }\n    set formatter(formatter) {\n        this.controller.valueController.props.set('formatter', formatter);\n    }\n    get value() {\n        return this.controller.value.rawValue;\n    }\n    set value(value) {\n        this.controller.value.rawValue = value;\n    }\n    on(eventName, handler) {\n        const bh = handler.bind(this);\n        this.emitter_.on(eventName, (ev) => {\n            bh(ev);\n        }, {\n            key: handler,\n        });\n        return this;\n    }\n    off(eventName, handler) {\n        this.emitter_.off(eventName, handler);\n        return this;\n    }\n}\n\nconst ListBladePlugin = (function () {\n    return {\n        id: 'list',\n        type: 'blade',\n        core: VERSION$1,\n        accept(params) {\n            const result = parseRecord(params, (p) => ({\n                options: p.required.custom(parseListOptions),\n                value: p.required.raw,\n                view: p.required.constant('list'),\n                label: p.optional.string,\n            }));\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            const lc = new ListConstraint(normalizeListOptions(args.params.options));\n            const value = createValue(args.params.value, {\n                constraint: lc,\n            });\n            const ic = new ListController(args.document, {\n                props: new ValueMap({\n                    options: lc.values.value('options'),\n                }),\n                value: value,\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueBladeController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                value: value,\n                valueController: ic,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueBladeController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof ListController)) {\n                return null;\n            }\n            return new ListBladeApi(args.controller);\n        },\n    };\n})();\n\nclass RootApi extends FolderApi {\n    /**\n     * @hidden\n     */\n    constructor(controller, pool) {\n        super(controller, pool);\n    }\n    get element() {\n        return this.controller.view.element;\n    }\n}\n\n/**\n * @hidden\n */\nclass RootController extends FolderController {\n    constructor(doc, config) {\n        super(doc, {\n            expanded: config.expanded,\n            blade: config.blade,\n            props: config.props,\n            root: true,\n            viewProps: config.viewProps,\n        });\n    }\n}\n\nconst cn = ClassName('spr');\n/**\n * @hidden\n */\nclass SeparatorView {\n    constructor(doc, config) {\n        this.element = doc.createElement('div');\n        this.element.classList.add(cn());\n        config.viewProps.bindClassModifiers(this.element);\n        const hrElem = doc.createElement('hr');\n        hrElem.classList.add(cn('r'));\n        this.element.appendChild(hrElem);\n    }\n}\n\n/**\n * @hidden\n */\nclass SeparatorController extends BladeController {\n    /**\n     * @hidden\n     */\n    constructor(doc, config) {\n        super(Object.assign(Object.assign({}, config), { view: new SeparatorView(doc, {\n                viewProps: config.viewProps,\n            }) }));\n    }\n}\n\nconst SeparatorBladePlugin = {\n    id: 'separator',\n    type: 'blade',\n    core: VERSION$1,\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            view: p.required.constant('separator'),\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        return new SeparatorController(args.document, {\n            blade: args.blade,\n            viewProps: args.viewProps,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof SeparatorController)) {\n            return null;\n        }\n        return new SeparatorBladeApi(args.controller);\n    },\n};\n\nconst SliderBladePlugin = {\n    id: 'slider',\n    type: 'blade',\n    core: VERSION$1,\n    accept(params) {\n        const result = parseRecord(params, (p) => ({\n            max: p.required.number,\n            min: p.required.number,\n            view: p.required.constant('slider'),\n            format: p.optional.function,\n            label: p.optional.string,\n            value: p.optional.number,\n        }));\n        return result ? { params: result } : null;\n    },\n    controller(args) {\n        var _a, _b;\n        const initialValue = (_a = args.params.value) !== null && _a !== void 0 ? _a : 0;\n        const drc = new DefiniteRangeConstraint({\n            max: args.params.max,\n            min: args.params.min,\n        });\n        const v = createValue(initialValue, {\n            constraint: drc,\n        });\n        const vc = new SliderTextController(args.document, Object.assign(Object.assign({}, createSliderTextProps({\n            formatter: (_b = args.params.format) !== null && _b !== void 0 ? _b : numberToString,\n            keyScale: createValue(1),\n            max: drc.values.value('max'),\n            min: drc.values.value('min'),\n            pointerScale: getSuitablePointerScale(args.params, initialValue),\n        })), { parser: parseNumber, value: v, viewProps: args.viewProps }));\n        return new LabeledValueBladeController(args.document, {\n            blade: args.blade,\n            props: ValueMap.fromObject({\n                label: args.params.label,\n            }),\n            value: v,\n            valueController: vc,\n        });\n    },\n    api(args) {\n        if (!(args.controller instanceof LabeledValueBladeController)) {\n            return null;\n        }\n        if (!(args.controller.valueController instanceof SliderTextController)) {\n            return null;\n        }\n        return new SliderBladeApi(args.controller);\n    },\n};\n\nconst TextBladePlugin = (function () {\n    return {\n        id: 'text',\n        type: 'blade',\n        core: VERSION$1,\n        accept(params) {\n            const result = parseRecord(params, (p) => ({\n                parse: p.required.function,\n                value: p.required.raw,\n                view: p.required.constant('text'),\n                format: p.optional.function,\n                label: p.optional.string,\n            }));\n            return result ? { params: result } : null;\n        },\n        controller(args) {\n            var _a;\n            const v = createValue(args.params.value);\n            const ic = new TextController(args.document, {\n                parser: args.params.parse,\n                props: ValueMap.fromObject({\n                    formatter: (_a = args.params.format) !== null && _a !== void 0 ? _a : ((v) => String(v)),\n                }),\n                value: v,\n                viewProps: args.viewProps,\n            });\n            return new LabeledValueBladeController(args.document, {\n                blade: args.blade,\n                props: ValueMap.fromObject({\n                    label: args.params.label,\n                }),\n                value: v,\n                valueController: ic,\n            });\n        },\n        api(args) {\n            if (!(args.controller instanceof LabeledValueBladeController)) {\n                return null;\n            }\n            if (!(args.controller.valueController instanceof TextController)) {\n                return null;\n            }\n            return new TextBladeApi(args.controller);\n        },\n    };\n})();\n\nfunction createDefaultWrapperElement(doc) {\n    const elem = doc.createElement('div');\n    elem.classList.add(ClassName('dfw')());\n    if (doc.body) {\n        doc.body.appendChild(elem);\n    }\n    return elem;\n}\nfunction embedStyle(doc, id, css) {\n    if (doc.querySelector(`style[data-tp-style=${id}]`)) {\n        return;\n    }\n    const styleElem = doc.createElement('style');\n    styleElem.dataset.tpStyle = id;\n    styleElem.textContent = css;\n    doc.head.appendChild(styleElem);\n}\n/**\n * The root pane of Tweakpane.\n */\nclass Pane extends RootApi {\n    constructor(opt_config) {\n        var _a, _b;\n        const config = opt_config !== null && opt_config !== void 0 ? opt_config : {};\n        const doc = (_a = config.document) !== null && _a !== void 0 ? _a : getWindowDocument();\n        const pool = createDefaultPluginPool();\n        const rootController = new RootController(doc, {\n            expanded: config.expanded,\n            blade: createBlade(),\n            props: ValueMap.fromObject({\n                title: config.title,\n            }),\n            viewProps: ViewProps.create(),\n        });\n        super(rootController, pool);\n        this.pool_ = pool;\n        this.containerElem_ = (_b = config.container) !== null && _b !== void 0 ? _b : createDefaultWrapperElement(doc);\n        this.containerElem_.appendChild(this.element);\n        this.doc_ = doc;\n        this.usesDefaultWrapper_ = !config.container;\n        this.setUpDefaultPlugins_();\n    }\n    get document() {\n        if (!this.doc_) {\n            throw TpError.alreadyDisposed();\n        }\n        return this.doc_;\n    }\n    dispose() {\n        const containerElem = this.containerElem_;\n        if (!containerElem) {\n            throw TpError.alreadyDisposed();\n        }\n        if (this.usesDefaultWrapper_) {\n            const parentElem = containerElem.parentElement;\n            if (parentElem) {\n                parentElem.removeChild(containerElem);\n            }\n        }\n        this.containerElem_ = null;\n        this.doc_ = null;\n        super.dispose();\n    }\n    registerPlugin(bundle) {\n        if (bundle.css) {\n            embedStyle(this.document, `plugin-${bundle.id}`, bundle.css);\n        }\n        const plugins = 'plugin' in bundle\n            ? [bundle.plugin]\n            : 'plugins' in bundle\n                ? bundle.plugins\n                : [];\n        plugins.forEach((p) => {\n            this.pool_.register(bundle.id, p);\n        });\n    }\n    setUpDefaultPlugins_() {\n        this.registerPlugin({\n            id: 'default',\n            // NOTE: This string literal will be replaced with the default CSS by Rollup at the compilation time\n            css: '.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:\"\";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:\"\";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:\"\";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:\"\";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:\"\";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:\"\";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:\"\";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:\"\";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:\"\";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:\"\";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:\"\";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:\"\";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',\n            plugins: [\n                ListBladePlugin,\n                SeparatorBladePlugin,\n                SliderBladePlugin,\n                TabBladePlugin,\n                TextBladePlugin,\n            ],\n        });\n    }\n}\n\nconst VERSION = new Semver('4.0.5');\n\nexport { BladeApi, ButtonApi, FolderApi, ListBladeApi, ListInputBindingApi, Pane, Semver, SeparatorBladeApi, SliderBladeApi, SliderInputBindingApi, TabApi, TabPageApi, TextBladeApi, TpChangeEvent, VERSION };\n","// params.js - Tweakable game parameters\nexport const params = {\n    // Planet settings\n    PLANET_DIAMETER: 60,\n    PLANET_SURFACE_OFFSET: 3, // Distance above surface\n    PLANET_INNER_SPHERE_SCALE: 1.0, // Scale factor for inner sphere (0.92 = 92% of outer sphere, more space for visibility)\n    PLANET_OUTER_SPHERE_SCALE: 1.02, // Scale factor for inner sphere (0.92 = 92% of outer sphere, more space for visibility)\n    PLANET_OUTER_OPACITY: 0.5, // Outer sphere opacity (more transparent to see inner sphere)\n    PLANET_INNER_OPACITY: 0.5, // Inner sphere opacity (more opaque to show details)\n    \n    // Player movement\n    PLAYER_SPEED: 20,\n    PLAYER_SIZE: 1.0,\n    \n    // Camera settings\n    CAMERA_DISTANCE: 20,\n    CAMERA_HEIGHT_OFFSET: 20,\n    \n    // Scene appearance\n    BACKGROUND_COLOR: 0x001122,  // Dark blue background\n    BACKGROUND_OPACITY: 1.0,     // Background opacity (0-1)\n    \n    // Predefined background colors\n    BACKGROUND_COLORS: {\n        BLACK: 0x000000,\n        DARK_BLUE: 0x001122,\n        DARK_PURPLE: 0x1a0524,\n        DARK_GREEN: 0x0d2818,\n        DARK_RED: 0x2a0a0a,\n        DEEP_SPACE: 0x020011,\n        TWILIGHT: 0x2c1810,\n        MIDNIGHT: 0x0f0f23\n    },\n    \n    // Background colors based on player mask\n    MASK_BACKGROUND_COLORS: {\n        null: 0x001122,        // Neutral - Default dark blue\n        1: 0x0a1a3a,         // Conservative - Deep blue\n        2: 0x3a0a0a,         // Social Justice - Deep red\n        3: 0x332211,         // Libertarian - Deep orange/brown\n        4: 0x0a2a0a,         // Nationalist - Deep green\n        5: 0x2a0a3a,         // Culture - Deep purple\n        6: 0x2a1a0a,         // Religious - Deep brown\n        7: 0x3a1a2a          // Antisystem - Deep pink\n    },\n\n    // Outrage system\n    OUTRAGE_INCREASE_RATE: 5.0,    // Per second in wrong crowd\n    OUTRAGE_DECAY_RATE: 1.0,        // Per second when not in crowd\n    OUTRAGE_POLICE_THRESHOLD: 10, // % to spawn police\n    \n    // Energy system\n    ENERGY_DEPLETION_RATE: 2,    // Per second when wearing mask\n    ENERGY_RECHARGE_RATE: 25,     // Per second in correct crowd\n    \n    // Crowd system\n    CROWD_COUNT: 12,              // Number of crowd clusters\n    CROWD_SIZE_MIN: 5,            // Minimum people per crowd\n    CROWD_SIZE_MAX: 50,           // Maximum people per crowd\n    CROWD_RADIUS: 4,              // Radius of crowd area\n    CROWD_DETECT_DISTANCE: 6,     // Distance to detect player\n    CROWD_KICKOUT_TIME: 30,       // Seconds before kickout\n    \n    // Police system\n    POLICE_SPEED_MULTIPLIER: 0.8, // Relative to player speed\n    POLICE_CATCH_DISTANCE: 2,     // Distance to catch player\n    POLICE_RETREAT_DISTANCE: 25,  // Distance to retreat when outrage low\n    POLICE_COLLISION_ENABLED: true,  // Enable/disable police collision system\n    POLICE_NPC_PUSH_RATIO: 0.7,     // How much NPCs are pushed by police (0-1)\n    POLICE_FORCE_RATIO: 0.3,        // How much police are pushed back (0-1)\n    \n    // Visual effects system\n    VISUAL_FX_ENABLED: true,         // Enable/disable visual effects\n    CAMERA_SHAKE_ENABLED: true,      // Enable/disable camera shake\n    CAMERA_SHAKE_INTENSITY: 0.15,    // Base camera shake intensity\n    CAMERA_SHAKE_FREQUENCY: 25,      // Camera shake frequency (Hz)\n    CAMERA_SHAKE_DURATION: 0.5,     // Camera shake duration (seconds)\n    TENSION_EFFECTS_ENABLED: true,   // Enable/disable tension effects\n    TENSION_MAX_INTENSITY: 0.8,     // Maximum tension effect intensity\n    TENSION_TRANSITION_SPEED: 2.0,  // Speed of tension effect transitions\n    TENSION_COLOR_SHIFT: 0.2,       // Amount of color shift during tension\n    TENSION_PULSE_SPEED: 3.0,       // Speed of pulsing effects\n    OVERLAY_EFFECTS_ENABLED: true,  // Enable/disable overlay effects\n    \n    // Score system\n    SCORE_ALPHA: 1.0,             // Multiplier for survival time\n    SCORE_BETA: 0.2,              // Multiplier for polarised people\n    \n    // Win conditions\n    ADULT_OUTRAGE_THRESHOLD: 10,  // % outrage for adult ending\n    ADULT_TIME_REQUIRED: 180,     // 3 minutes in seconds\n    CHAOS_OUTRAGE_THRESHOLD: 100, // % outrage for chaos ending\n    CHAOS_TIME_REQUIRED: 30,      // 30 seconds\n    \n    // NPC system parameters\n    NPC_SIZE: 1.0,                   // Size of individual NPCs\n    NPC_GROUP_SIZE: 20,              // Number of NPCs per group\n    NPC_BASE_SPEED: 2,               // Base movement speed for NPCs\n    NPC_SPEED_VARIATION: 8,\n    NPC_INTERACTION_RADIUS: 1.5,       // Distance for NPC-player interaction\n    NPC_GROUP_RADIUS: 30,             // Distance for NPCs to consider themselves in same group\n    NPC_WANDER_RADIUS: 20,            // Maximum distance for wandering behavior\n    NPC_MIN_STATE_DURATION: 2,       // Minimum time in seconds before state change\n    NPC_STATE_CHANGE_CHANCE: 0.01,    // Probability per second of state change\n    NPC_POSITIVE_INFLUENCE_RATE: 2,  // Outrage increase when NPC likes player mask\n    NPC_NEGATIVE_INFLUENCE_RATE: 1,  // Outrage decrease when NPC dislikes player mask\n    NPC_SAME_MASK_INFLUENCE: 0.01,       // Outrage reduction when same mask\n    NPC_DIFFERENT_MASK_INFLUENCE: 0.2,  // Outrage increase when different mask\n    NPC_ENERGY_DRAIN_RATE: 0.1,        // Energy drain when interacting negatively\n    NPC_PERSONAL_SPACE: 1.3,         // Minimum distance between NPCs (intimacy zone)\n    \n    // Flocking behavior parameters (Craig Reynolds algorithm)\n    NPC_FLOCKING_RADIUS: 4.0,        // Distance to consider other NPCs for flocking\n    NPC_SEPARATION_FORCE: 2.0,       // Force to avoid crowding (separation)\n    NPC_ALIGNMENT_FORCE: 2.0,        // Force to align with neighbors (alignment)\n    NPC_COHESION_FORCE: 5.0,         // Force to move toward group center (cohesion)\n    NPC_SEPARATION_RADIUS: 3.0,      // Distance for separation behavior\n    NPC_ALIGNMENT_RADIUS: 6.0,       // Distance for alignment behavior\n    NPC_COHESION_RADIUS: 8.0,        // Distance for cohesion behavior\n    NPC_MAX_FORCE: 4.0,              // Maximum force that can be applied\n    NPC_FLOCKING_WEIGHT: 0.9,        // Overall weight of flocking behavior\n    \n    NPC_WANDER_FORCE: 0.1,           // Strength of wandering behavior (reduced for flocking)\n    NPC_INTER_GROUP_REPULSION: 1.5,  // Repulsion force between different groups\n    NPC_INTER_GROUP_DISTANCE: 4.0,\n\n    // Additional crowd parameters\n    CROWD_SPREAD_FACTOR: 1.5,        // How spread out crowd members are\n    CROWD_FADE_TIME: 2.0,            // Time to fade crowd members in/out\n    CROWD_MOVEMENT_SPEED: 0.5,       // Speed of crowd movement\n    CROWD_PATIENCE: 60,              // Seconds before crowd gets impatient\n    \n    // Game balancing\n    GAME_SPEED_MULTIPLIER: 1.0,      // Overall game speed multiplier\n    DIFFICULTY_SCALING: 1.2,         // How much difficulty increases over time\n    PLAYER_INFLUENCE_RADIUS: 7.0,\n    PLAYER_ATTRACTION_FORCE: 0.5,\n    PLAYER_REPULSION_FORCE: 10.0,\n    \n    // Player-NPC collision system\n    PLAYER_NPC_COLLISION_ENABLED: true,  // Enable/disable physical collisions\n    PLAYER_NPC_COLLISION_RADIUS: 0.8,    // Collision radius multiplier (0.5 = half size overlap allowed)\n    PLAYER_NPC_PUSH_FORCE: 0.3,          // How strong the player pushes NPCs (1.0 = normal)\n    PLAYER_NPC_PUSH_VELOCITY: 0.1,       // How much velocity is added to pushed NPCs\n    \n    // Visual settings\n    PLANET_TEXTURE_SCALE: 0.5,       // Scale of planet texture (smaller = more detail)\n    LIGHTING_INTENSITY: 1.0,         // Ambient lighting intensity\n    SHADOW_QUALITY: 1.0,             // Shadow map resolution multiplier\n    \n    // Performance settings\n    MAX_VISIBLE_NPCS: 200,           // Maximum NPCs to render\n    LOD_DISTANCE: 50,                // Distance for level of detail switching\n    PHYSICS_STEP_SIZE: 0.016,        // Physics simulation step size\n    MAX_DELTA_TIME: 1/60,            // Maximum deltaTime to prevent physics issues (16.67ms)\n    \n    // Mobile/Touch settings\n    TOUCH_SENSITIVITY: 0.003,        // Sensitivity for touch movement\n    TOUCH_DEAD_ZONE: 0.1,           // Minimum touch movement to register\n};\n\n// Tweakpane integration for live parameter tuning\nimport { Pane } from 'tweakpane';\n\nlet pane = null;\n\n// Variables pour stocker les informations de déplacement instantané\nexport const playerMovementData = {\n    inputVector: { x: 0, y: 0 },\n    movementVector: { x: 0, y: 0, z: 0 },\n    forwardDirection: { x: 0, y: 0, z: 0 },\n    rightDirection: { x: 0, y: 0, z: 0 },\n    activeKeys: '',\n    position: { x: 0, y: 0, z: 0 },\n    speed: 0\n};\n\nexport function initTweakpane() {\n    if (!Pane) {\n        console.log('Tweakpane not available');\n        return;\n    }\n    \n    pane = new Pane({ \n        title: 'Déplacement Instantané ZQSD', \n        expanded: false,\n        width: 350\n    });\n    \n    // Affichage des touches actives\n    pane.addBlade({\n        view: 'text',\n        label: 'Touches actives',\n        parse: (v) => String(v),\n        value: ''\n    });\n    \n    // Vecteur d'entrée (input)\n    const inputFolder = pane.addFolder({ title: 'Vecteur d\\'entrée', expanded: true });\n    inputFolder.addBinding(playerMovementData.inputVector, 'x', { \n        label: 'Input X (Q/D)', \n        readonly: true,\n        format: (v) => v.toFixed(1)\n    });\n    inputFolder.addBinding(playerMovementData.inputVector, 'y', { \n        label: 'Input Y (Z/S)', \n        readonly: true,\n        format: (v) => v.toFixed(1)\n    });\n    \n    // Vecteur de déplacement instantané\n    const movementFolder = pane.addFolder({ title: 'Déplacement instantané', expanded: true });\n    movementFolder.addBinding(playerMovementData.movementVector, 'x', { \n        label: 'Movement X', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    movementFolder.addBinding(playerMovementData.movementVector, 'y', { \n        label: 'Movement Y', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    movementFolder.addBinding(playerMovementData.movementVector, 'z', { \n        label: 'Movement Z', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    \n    // Directions de référence\n    const directionsFolder = pane.addFolder({ title: 'Directions de référence', expanded: false });\n    directionsFolder.addBinding(playerMovementData.forwardDirection, 'x', { \n        label: 'Forward X', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    directionsFolder.addBinding(playerMovementData.forwardDirection, 'y', { \n        label: 'Forward Y', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    directionsFolder.addBinding(playerMovementData.forwardDirection, 'z', { \n        label: 'Forward Z', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    \n    directionsFolder.addBinding(playerMovementData.rightDirection, 'x', { \n        label: 'Right X', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    directionsFolder.addBinding(playerMovementData.rightDirection, 'y', { \n        label: 'Right Y', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    directionsFolder.addBinding(playerMovementData.rightDirection, 'z', { \n        label: 'Right Z', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    \n    // Position du joueur\n    const positionFolder = pane.addFolder({ title: 'Position du joueur', expanded: false });\n    positionFolder.addBinding(playerMovementData.position, 'x', { \n        label: 'Position X', \n        readonly: true,\n        format: (v) => v.toFixed(2)\n    });\n    positionFolder.addBinding(playerMovementData.position, 'y', { \n        label: 'Position Y', \n        readonly: true,\n        format: (v) => v.toFixed(2)\n    });\n    positionFolder.addBinding(playerMovementData.position, 'z', { \n        label: 'Position Z', \n        readonly: true,\n        format: (v) => v.toFixed(2)\n    });\n    \n    // Vitesse instantanée\n    pane.addBinding(playerMovementData, 'speed', { \n        label: 'Vitesse instantanée', \n        readonly: true,\n        format: (v) => v.toFixed(3)\n    });\n    \n    console.log('🎛️ Tweakpane initialized - Déplacement instantané ZQSD');\n}\n\n// Fonction pour mettre à jour les données de déplacement\nexport function updatePlayerMovementData(debugInfo) {\n    if (!debugInfo) return;\n    \n    // Mettre à jour les données\n    playerMovementData.inputVector.x = debugInfo.inputVector ? parseFloat(debugInfo.inputVector.split('(')[1].split(',')[0]) : 0;\n    playerMovementData.inputVector.y = debugInfo.inputVector ? parseFloat(debugInfo.inputVector.split(',')[1].split(')')[0]) : 0;\n    \n    if (debugInfo.movement) {\n        const movementMatch = debugInfo.movement.match(/\\(([-\\d.]+), ([-\\d.]+), ([-\\d.]+)\\)/);\n        if (movementMatch) {\n            playerMovementData.movementVector.x = parseFloat(movementMatch[1]);\n            playerMovementData.movementVector.y = parseFloat(movementMatch[2]);\n            playerMovementData.movementVector.z = parseFloat(movementMatch[3]);\n            \n            // Calculer la vitesse instantanée\n            playerMovementData.speed = Math.sqrt(\n                playerMovementData.movementVector.x * playerMovementData.movementVector.x +\n                playerMovementData.movementVector.y * playerMovementData.movementVector.y +\n                playerMovementData.movementVector.z * playerMovementData.movementVector.z\n            );\n        }\n    }\n    \n    if (debugInfo.forward) {\n        const forwardMatch = debugInfo.forward.match(/\\(([-\\d.]+), ([-\\d.]+), ([-\\d.]+)\\)/);\n        if (forwardMatch) {\n            playerMovementData.forwardDirection.x = parseFloat(forwardMatch[1]);\n            playerMovementData.forwardDirection.y = parseFloat(forwardMatch[2]);\n            playerMovementData.forwardDirection.z = parseFloat(forwardMatch[3]);\n        }\n    }\n    \n    if (debugInfo.right) {\n        const rightMatch = debugInfo.right.match(/\\(([-\\d.]+), ([-\\d.]+), ([-\\d.]+)\\)/);\n        if (rightMatch) {\n            playerMovementData.rightDirection.x = parseFloat(rightMatch[1]);\n            playerMovementData.rightDirection.y = parseFloat(rightMatch[2]);\n            playerMovementData.rightDirection.z = parseFloat(rightMatch[3]);\n        }\n    }\n    \n    if (debugInfo.position) {\n        const positionMatch = debugInfo.position.match(/\\(([-\\d.]+), ([-\\d.]+), ([-\\d.]+)\\)/);\n        if (positionMatch) {\n            playerMovementData.position.x = parseFloat(positionMatch[1]);\n            playerMovementData.position.y = parseFloat(positionMatch[2]);\n            playerMovementData.position.z = parseFloat(positionMatch[3]);\n        }\n    }\n    \n    playerMovementData.activeKeys = debugInfo.input || '';\n    \n    // Actualiser le panneau\n    if (pane) {\n        pane.refresh();\n    }\n}\n\n// Export pane for external access\nexport { pane }; ","// core/EventManager.js - Centralized event management following SOLID principles\r\n\r\nexport class EventManager {\r\n    constructor() {\r\n        this.listeners = new Map(); // eventType -> Set of listeners\r\n        this.onceListeners = new Map(); // eventType -> Set of one-time listeners\r\n        this.middlewares = []; // Array of middleware functions\r\n        this.isDebugging = false;\r\n    }\r\n\r\n    // Subscribe to an event\r\n    subscribe(eventType, listener, priority = 100) {\r\n        if (!this.listeners.has(eventType)) {\r\n            this.listeners.set(eventType, new Set());\r\n        }\r\n\r\n        const listenerWrapper = {\r\n            callback: listener,\r\n            priority: priority,\r\n            id: Symbol(),\r\n            createdAt: Date.now()\r\n        };\r\n\r\n        this.listeners.get(eventType).add(listenerWrapper);\r\n\r\n        // Sort listeners by priority (lower number = higher priority)\r\n        this.sortListeners(eventType);\r\n\r\n        if (this.isDebugging) {\r\n            console.log(`📡 Subscribed to event '${eventType}' with priority ${priority}`);\r\n        }\r\n\r\n        // Return unsubscribe function\r\n        return () => this.unsubscribe(eventType, listenerWrapper.id);\r\n    }\r\n\r\n    // Subscribe to an event only once\r\n    subscribeOnce(eventType, listener, priority = 100) {\r\n        if (!this.onceListeners.has(eventType)) {\r\n            this.onceListeners.set(eventType, new Set());\r\n        }\r\n\r\n        const listenerWrapper = {\r\n            callback: listener,\r\n            priority: priority,\r\n            id: Symbol(),\r\n            createdAt: Date.now()\r\n        };\r\n\r\n        this.onceListeners.get(eventType).add(listenerWrapper);\r\n        this.sortOnceListeners(eventType);\r\n\r\n        if (this.isDebugging) {\r\n            console.log(`📡 Subscribed once to event '${eventType}' with priority ${priority}`);\r\n        }\r\n\r\n        // Return unsubscribe function\r\n        return () => this.unsubscribeOnce(eventType, listenerWrapper.id);\r\n    }\r\n\r\n    // Unsubscribe from an event\r\n    unsubscribe(eventType, listenerId) {\r\n        if (!this.listeners.has(eventType)) return false;\r\n\r\n        const listeners = this.listeners.get(eventType);\r\n        for (const listener of listeners) {\r\n            if (listener.id === listenerId) {\r\n                listeners.delete(listener);\r\n                if (listeners.size === 0) {\r\n                    this.listeners.delete(eventType);\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Unsubscribe from once listeners\r\n    unsubscribeOnce(eventType, listenerId) {\r\n        if (!this.onceListeners.has(eventType)) return false;\r\n\r\n        const listeners = this.onceListeners.get(eventType);\r\n        for (const listener of listeners) {\r\n            if (listener.id === listenerId) {\r\n                listeners.delete(listener);\r\n                if (listeners.size === 0) {\r\n                    this.onceListeners.delete(eventType);\r\n                }\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Publish an event synchronously\r\n    publish(eventType, data = null, source = 'unknown') {\r\n        const event = this.createEvent(eventType, data, source);\r\n        \r\n        if (this.isDebugging) {\r\n            console.log(`📢 Publishing event '${eventType}' from '${source}'`, data);\r\n        }\r\n\r\n        // Apply middlewares\r\n        for (const middleware of this.middlewares) {\r\n            try {\r\n                const result = middleware(event);\r\n                if (result === false) {\r\n                    // Middleware cancelled the event\r\n                    if (this.isDebugging) {\r\n                        console.log(`🚫 Event '${eventType}' cancelled by middleware`);\r\n                    }\r\n                    return false;\r\n                }\r\n            } catch (error) {\r\n                console.error(`❌ Error in event middleware:`, error);\r\n            }\r\n        }\r\n\r\n        // Notify regular listeners\r\n        this.notifyListeners(eventType, event);\r\n\r\n        // Notify once listeners and remove them\r\n        this.notifyOnceListeners(eventType, event);\r\n\r\n        return true;\r\n    }\r\n\r\n    // Publish an event asynchronously\r\n    async publishAsync(eventType, data = null, source = 'unknown') {\r\n        const event = this.createEvent(eventType, data, source);\r\n        \r\n        if (this.isDebugging) {\r\n            console.log(`📢 Publishing async event '${eventType}' from '${source}'`, data);\r\n        }\r\n\r\n        // Apply middlewares\r\n        for (const middleware of this.middlewares) {\r\n            try {\r\n                const result = await middleware(event);\r\n                if (result === false) {\r\n                    if (this.isDebugging) {\r\n                        console.log(`🚫 Async event '${eventType}' cancelled by middleware`);\r\n                    }\r\n                    return false;\r\n                }\r\n            } catch (error) {\r\n                console.error(`❌ Error in async event middleware:`, error);\r\n            }\r\n        }\r\n\r\n        // Notify regular listeners\r\n        await this.notifyListenersAsync(eventType, event);\r\n\r\n        // Notify once listeners and remove them\r\n        await this.notifyOnceListenersAsync(eventType, event);\r\n\r\n        return true;\r\n    }\r\n\r\n    // Add middleware function\r\n    addMiddleware(middleware) {\r\n        this.middlewares.push(middleware);\r\n        if (this.isDebugging) {\r\n            console.log(`🔧 Added event middleware`);\r\n        }\r\n    }\r\n\r\n    // Remove middleware function\r\n    removeMiddleware(middleware) {\r\n        const index = this.middlewares.indexOf(middleware);\r\n        if (index !== -1) {\r\n            this.middlewares.splice(index, 1);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    // Clear all listeners for an event type\r\n    clearListeners(eventType) {\r\n        let cleared = 0;\r\n        \r\n        if (this.listeners.has(eventType)) {\r\n            cleared += this.listeners.get(eventType).size;\r\n            this.listeners.delete(eventType);\r\n        }\r\n        \r\n        if (this.onceListeners.has(eventType)) {\r\n            cleared += this.onceListeners.get(eventType).size;\r\n            this.onceListeners.delete(eventType);\r\n        }\r\n\r\n        if (this.isDebugging) {\r\n            console.log(`🧹 Cleared ${cleared} listeners for event '${eventType}'`);\r\n        }\r\n        \r\n        return cleared;\r\n    }\r\n\r\n    // Clear all listeners\r\n    clearAllListeners() {\r\n        const totalListeners = this.getTotalListenerCount();\r\n        this.listeners.clear();\r\n        this.onceListeners.clear();\r\n        \r\n        if (this.isDebugging) {\r\n            console.log(`🧹 Cleared all ${totalListeners} listeners`);\r\n        }\r\n        \r\n        return totalListeners;\r\n    }\r\n\r\n    // Get listener count for an event type\r\n    getListenerCount(eventType) {\r\n        const regular = this.listeners.has(eventType) ? this.listeners.get(eventType).size : 0;\r\n        const once = this.onceListeners.has(eventType) ? this.onceListeners.get(eventType).size : 0;\r\n        return regular + once;\r\n    }\r\n\r\n    // Get total listener count\r\n    getTotalListenerCount() {\r\n        let total = 0;\r\n        for (const listeners of this.listeners.values()) {\r\n            total += listeners.size;\r\n        }\r\n        for (const listeners of this.onceListeners.values()) {\r\n            total += listeners.size;\r\n        }\r\n        return total;\r\n    }\r\n\r\n    // Get all event types\r\n    getEventTypes() {\r\n        const types = new Set();\r\n        for (const type of this.listeners.keys()) {\r\n            types.add(type);\r\n        }\r\n        for (const type of this.onceListeners.keys()) {\r\n            types.add(type);\r\n        }\r\n        return Array.from(types);\r\n    }\r\n\r\n    // Get statistics\r\n    getStats() {\r\n        return {\r\n            eventTypes: this.getEventTypes().length,\r\n            totalListeners: this.getTotalListenerCount(),\r\n            middlewares: this.middlewares.length,\r\n            isDebugging: this.isDebugging\r\n        };\r\n    }\r\n\r\n    // Enable/disable debugging\r\n    setDebugging(enabled) {\r\n        this.isDebugging = enabled;\r\n        console.log(`🔍 Event debugging ${enabled ? 'enabled' : 'disabled'}`);\r\n    }\r\n\r\n    // Private methods\r\n    createEvent(type, data, source) {\r\n        return {\r\n            type: type,\r\n            data: data,\r\n            source: source,\r\n            timestamp: Date.now(),\r\n            id: Symbol()\r\n        };\r\n    }\r\n\r\n    sortListeners(eventType) {\r\n        if (!this.listeners.has(eventType)) return;\r\n        \r\n        const listeners = Array.from(this.listeners.get(eventType));\r\n        listeners.sort((a, b) => a.priority - b.priority);\r\n        this.listeners.set(eventType, new Set(listeners));\r\n    }\r\n\r\n    sortOnceListeners(eventType) {\r\n        if (!this.onceListeners.has(eventType)) return;\r\n        \r\n        const listeners = Array.from(this.onceListeners.get(eventType));\r\n        listeners.sort((a, b) => a.priority - b.priority);\r\n        this.onceListeners.set(eventType, new Set(listeners));\r\n    }\r\n\r\n    notifyListeners(eventType, event) {\r\n        if (!this.listeners.has(eventType)) return;\r\n\r\n        const listeners = Array.from(this.listeners.get(eventType));\r\n        for (const listener of listeners) {\r\n            try {\r\n                listener.callback(event);\r\n            } catch (error) {\r\n                console.error(`❌ Error in event listener for '${eventType}':`, error);\r\n            }\r\n        }\r\n    }\r\n\r\n    notifyOnceListeners(eventType, event) {\r\n        if (!this.onceListeners.has(eventType)) return;\r\n\r\n        const listeners = Array.from(this.onceListeners.get(eventType));\r\n        for (const listener of listeners) {\r\n            try {\r\n                listener.callback(event);\r\n            } catch (error) {\r\n                console.error(`❌ Error in once event listener for '${eventType}':`, error);\r\n            }\r\n        }\r\n        \r\n        // Clear once listeners after notification\r\n        this.onceListeners.delete(eventType);\r\n    }\r\n\r\n    async notifyListenersAsync(eventType, event) {\r\n        if (!this.listeners.has(eventType)) return;\r\n\r\n        const listeners = Array.from(this.listeners.get(eventType));\r\n        for (const listener of listeners) {\r\n            try {\r\n                await listener.callback(event);\r\n            } catch (error) {\r\n                console.error(`❌ Error in async event listener for '${eventType}':`, error);\r\n            }\r\n        }\r\n    }\r\n\r\n    async notifyOnceListenersAsync(eventType, event) {\r\n        if (!this.onceListeners.has(eventType)) return;\r\n\r\n        const listeners = Array.from(this.onceListeners.get(eventType));\r\n        for (const listener of listeners) {\r\n            try {\r\n                await listener.callback(event);\r\n            } catch (error) {\r\n                console.error(`❌ Error in async once event listener for '${eventType}':`, error);\r\n            }\r\n        }\r\n        \r\n        // Clear once listeners after notification\r\n        this.onceListeners.delete(eventType);\r\n    }\r\n}\r\n\r\n// Global event manager instance\r\nexport const eventManager = new EventManager(); ","// core/ServiceContainer.js - Dependency injection container following DIP\r\nimport { eventManager } from './EventManager.js';\r\n\r\nexport class ServiceContainer {\r\n    constructor() {\r\n        this.services = new Map();\r\n        this.singletons = new Map();\r\n        this.factories = new Map();\r\n    }\r\n\r\n    // Register a singleton service\r\n    registerSingleton(name, serviceClass, dependencies = []) {\r\n        this.services.set(name, {\r\n            type: 'singleton',\r\n            serviceClass,\r\n            dependencies,\r\n            instance: null\r\n        });\r\n    }\r\n\r\n    // Register a transient service (new instance each time)\r\n    registerTransient(name, serviceClass, dependencies = []) {\r\n        this.services.set(name, {\r\n            type: 'transient',\r\n            serviceClass,\r\n            dependencies\r\n        });\r\n    }\r\n\r\n    // Register a factory function\r\n    registerFactory(name, factoryFunction, dependencies = []) {\r\n        this.factories.set(name, {\r\n            factory: factoryFunction,\r\n            dependencies\r\n        });\r\n    }\r\n\r\n    // Register an existing instance\r\n    registerInstance(name, instance) {\r\n        this.singletons.set(name, instance);\r\n    }\r\n\r\n    // Resolve a service by name\r\n    resolve(name) {\r\n        // Check if it's a pre-registered instance\r\n        if (this.singletons.has(name)) {\r\n            return this.singletons.get(name);\r\n        }\r\n\r\n        // Check if it's a factory\r\n        if (this.factories.has(name)) {\r\n            return this.resolveFactory(name);\r\n        }\r\n\r\n        // Check if it's a registered service\r\n        if (this.services.has(name)) {\r\n            return this.resolveService(name);\r\n        }\r\n\r\n        throw new Error(`Service '${name}' not found in container`);\r\n    }\r\n\r\n    // Resolve a factory\r\n    resolveFactory(name) {\r\n        const factoryInfo = this.factories.get(name);\r\n        const dependencies = this.resolveDependencies(factoryInfo.dependencies);\r\n        return factoryInfo.factory(...dependencies);\r\n    }\r\n\r\n    // Resolve a registered service\r\n    resolveService(name) {\r\n        const serviceInfo = this.services.get(name);\r\n\r\n        if (serviceInfo.type === 'singleton') {\r\n            if (!serviceInfo.instance) {\r\n                serviceInfo.instance = this.createInstance(serviceInfo);\r\n            }\r\n            return serviceInfo.instance;\r\n        } else {\r\n            return this.createInstance(serviceInfo);\r\n        }\r\n    }\r\n\r\n    // Create an instance with dependency injection\r\n    createInstance(serviceInfo) {\r\n        const dependencies = this.resolveDependencies(serviceInfo.dependencies);\r\n        return new serviceInfo.serviceClass(...dependencies);\r\n    }\r\n\r\n    // Resolve an array of dependencies\r\n    resolveDependencies(dependencies) {\r\n        return dependencies.map(dep => this.resolve(dep));\r\n    }\r\n\r\n    // Check if a service is registered\r\n    has(name) {\r\n        return this.services.has(name) || \r\n               this.singletons.has(name) || \r\n               this.factories.has(name);\r\n    }\r\n\r\n    // Get all registered service names\r\n    getServiceNames() {\r\n        const names = new Set();\r\n        \r\n        for (const name of this.services.keys()) {\r\n            names.add(name);\r\n        }\r\n        \r\n        for (const name of this.singletons.keys()) {\r\n            names.add(name);\r\n        }\r\n        \r\n        for (const name of this.factories.keys()) {\r\n            names.add(name);\r\n        }\r\n        \r\n        return Array.from(names);\r\n    }\r\n\r\n    // Clear all services\r\n    clear() {\r\n        this.services.clear();\r\n        this.singletons.clear();\r\n        this.factories.clear();\r\n    }\r\n\r\n    // Debug: Get container statistics\r\n    getStats() {\r\n        return {\r\n            services: this.services.size,\r\n            singletons: this.singletons.size,\r\n            factories: this.factories.size,\r\n            total: this.services.size + this.singletons.size + this.factories.size\r\n        };\r\n    }\r\n\r\n    // Advanced: Register with configuration\r\n    register(name, config) {\r\n        const { \r\n            type = 'singleton', \r\n            serviceClass, \r\n            factory, \r\n            instance, \r\n            dependencies = [] \r\n        } = config;\r\n\r\n        if (instance) {\r\n            this.registerInstance(name, instance);\r\n        } else if (factory) {\r\n            this.registerFactory(name, factory, dependencies);\r\n        } else if (serviceClass) {\r\n            if (type === 'singleton') {\r\n                this.registerSingleton(name, serviceClass, dependencies);\r\n            } else {\r\n                this.registerTransient(name, serviceClass, dependencies);\r\n            }\r\n        } else {\r\n            throw new Error(`Invalid service configuration for '${name}'`);\r\n        }\r\n    }\r\n\r\n    // Create a scoped container (child container)\r\n    createScope() {\r\n        const scope = new ServiceContainer();\r\n        \r\n        // Copy parent services\r\n        for (const [name, config] of this.services) {\r\n            scope.services.set(name, { ...config });\r\n        }\r\n        \r\n        for (const [name, factory] of this.factories) {\r\n            scope.factories.set(name, factory);\r\n        }\r\n\r\n        // Singletons are inherited but not copied (remain in parent)\r\n        scope.parent = this;\r\n        \r\n        return scope;\r\n    }\r\n\r\n    // Resolve from parent if not found in current scope\r\n    resolveWithParent(name) {\r\n        try {\r\n            return this.resolve(name);\r\n        } catch (error) {\r\n            if (this.parent) {\r\n                return this.parent.resolveWithParent(name);\r\n            }\r\n            throw error;\r\n        }\r\n    }\r\n}\r\n\r\n// Global service container instance\r\nexport const serviceContainer = new ServiceContainer();\r\n\r\n// Register the event manager as a singleton\r\nserviceContainer.registerInstance('eventManager', eventManager); ","// core/SceneManager.js - Scene and rendering management following SRP\nimport { params } from '../params.js';\nimport { serviceContainer } from './ServiceContainer.js';\n\nexport class SceneManager {\n    constructor() {\n        this.canvas = null;\n        this.renderer = null;\n        this.scene = null;\n        this.camera = null;\n        this.planet = null;\n        this.innerPlanet = null;\n        this.planetRadius = 0;\n        \n        // HUD system for helpers (like drei HUD)\n        this.hudScene = null;\n        this.hudCamera = null;\n        this.hudRenderer = null;\n        this.hudCanvas = null;\n        this.showHelpers = false;\n    }\n\n    async initialize() {\n        // Get canvas and create renderer\n        this.canvas = document.getElementById('renderCanvas');\n        this.renderer = new THREE.WebGLRenderer({ \n            canvas: this.canvas, \n            antialias: true \n        });\n        \n        this.renderer.setSize(window.innerWidth, window.innerHeight);\n        this.renderer.setPixelRatio(window.devicePixelRatio);\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n\n        // Create scene\n        this.scene = new THREE.Scene();\n        // Initialize with neutral mask background color\n        this.scene.background = new THREE.Color(params.MASK_BACKGROUND_COLORS[null]);\n\n        // Create camera\n        this.camera = new THREE.PerspectiveCamera(\n            75, \n            window.innerWidth / window.innerHeight, \n            0.1, \n            1000\n        );\n        this.camera.position.set(0, params.CAMERA_DISTANCE, 0);\n        this.camera.lookAt(0, 0, 0);\n        \n        // Register camera in service container for other systems to access\n        serviceContainer.registerInstance('camera', this.camera);\n\n        // Create lights\n        this.createLights();\n\n        // Create planet\n        this.createPlanet();\n\n        // Add debugging helpers with HUD system\n        this.initializeHUD();\n\n        // Setup window resize handling\n        this.setupResizeHandler();\n\n        // Hide helpers by default\n        this.toggleHelpers(this.showHelpers);\n\n        console.log('🎬 Scene Manager initialized');\n        console.log('🎨 Background color initialized for neutral mask:', params.MASK_BACKGROUND_COLORS[null].toString(16));\n    }\n\n    createLights() {\n        // Ambient light - reduced intensity to let other lights show more effect\n        const ambientLight = new THREE.AmbientLight(0xfeefff, 0.8);\n        this.scene.add(ambientLight);\n\n        // Directional light with shadows - reduced intensity\n        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);\n        directionalLight.position.set(0, 20, 25);\n        directionalLight.castShadow = true;\n        directionalLight.shadow.mapSize.width = 2048;\n        directionalLight.shadow.mapSize.height = 2048;\n        directionalLight.shadow.camera.near = 0.5;\n        directionalLight.shadow.camera.far = 50;\n        directionalLight.shadow.camera.left = -50;\n        directionalLight.shadow.camera.right = 50;\n        directionalLight.shadow.camera.top = 50;\n        directionalLight.shadow.camera.bottom = -50;\n        this.scene.add(directionalLight);\n\n        // Camera-following directional light (always follows camera direction)\n        this.cameraLight = new THREE.DirectionalLight(0xffffff, 1.5);\n        this.cameraLight.position.set(0, 0, 0); // Will be updated in updateCamera\n        this.cameraLight.castShadow = false; // Disable shadows for performance\n        this.scene.add(this.cameraLight);\n        \n        console.log('💡 Camera-following directional light created');\n    }\n\n    createPlanet() {\n        const atmosphereRadius = params.PLANET_DIAMETER / 2 * params.PLANET_OUTER_SPHERE_SCALE;\n        const planetRadius = params.PLANET_DIAMETER / 2 * params.PLANET_INNER_SPHERE_SCALE;\n        \n        // Material parameters from the Three.js example\n        const roughnessLow = 0.25;\n        const roughnessHigh = 0.35;\n        \n        // Load planet textures\n        const textureLoader = new THREE.TextureLoader();\n        \n        // Load Earth textures with proper configuration (same as example)\n        const earthDayTexture = textureLoader.load('textures/planet_color.jpg');\n        earthDayTexture.colorSpace = THREE.SRGBColorSpace;\n        earthDayTexture.anisotropy = 8;\n        // No repeat wrapping - use default ClampToEdgeWrapping like example\n        // earthDayTexture.wrapS = THREE.ClampToEdgeWrapping;\n        // earthDayTexture.wrapT = THREE.ClampToEdgeWrapping;\n        // No repeat scaling - use natural UV mapping like example\n        \n        const earthBumpRoughnessCloudsTexture = textureLoader.load('textures/earth_bump_roughness_clouds_4096.jpg');\n        earthBumpRoughnessCloudsTexture.anisotropy = 8;\n        // No repeat wrapping - use default ClampToEdgeWrapping like example\n        // earthBumpRoughnessCloudsTexture.wrapS = THREE.ClampToEdgeWrapping;\n        // earthBumpRoughnessCloudsTexture.wrapT = THREE.ClampToEdgeWrapping;\n        // No repeat scaling - use natural UV mapping like example\n        \n        // Create outer planet (clouds atmosphere layer)\n        const outerGeometry = new THREE.SphereGeometry(atmosphereRadius, 64, 64);\n        \n        // Advanced outer material matching the example's atmosphere approach\n        const outerMaterial = new THREE.MeshStandardMaterial({\n            map: earthBumpRoughnessCloudsTexture,\n            transparent: true,\n            opacity: params.PLANET_OUTER_OPACITY,\n            side: THREE.BackSide, // Same as example's atmosphere\n            depthWrite: false, // Same as example for transparency\n            \n            // Use the texture channels for advanced effects\n            // Red channel: bump/elevation\n            // Green channel: roughness\n            // Blue channel: clouds\n            roughnessMap: earthBumpRoughnessCloudsTexture,\n            roughness: roughnessHigh, // Use high roughness for clouds\n            metalness: 0.0, // No metalness for clouds/atmosphere\n            \n            // Enhanced cloud rendering\n            alphaMap: earthBumpRoughnessCloudsTexture, // Use blue channel for cloud alpha\n            alphaTest: 0.01, // Lower alpha test like example\n            \n            // Lighting properties\n            envMapIntensity: 0.5 // Reduced for atmosphere\n        });\n        \n        // Custom shader chunks for advanced cloud effects (matching example logic)\n        outerMaterial.onBeforeCompile = (shader) => {\n            // Add cloud processing to fragment shader\n            shader.fragmentShader = shader.fragmentShader.replace(\n                '#include <map_fragment>',\n                `\n                #include <map_fragment>\n                \n                // Extract cloud strength from blue channel (same as example)\n                float cloudStrength = texture2D(map, vMapUv).b;\n                cloudStrength = smoothstep(0.2, 1.0, cloudStrength);\n                \n                // Enhance cloud appearance (same logic as example)\n                diffuseColor.rgb = mix(diffuseColor.rgb, vec3(1.0), cloudStrength * 2.0);\n                \n                // Apply cloud transparency\n                float alpha = cloudStrength;\n                diffuseColor.a = alpha;\n                `\n            );\n        };\n        \n        this.planet = new THREE.Mesh(outerGeometry, outerMaterial);\n        this.planet.receiveShadow = true;\n        this.planet.castShadow = false; // Atmosphere doesn't cast shadows\n        this.planet.renderOrder = 2; // Render after surface\n        this.scene.add(this.planet);\n        \n        // Create inner sphere (solid Earth surface - main globe)\n        const innerGeometry = new THREE.SphereGeometry(planetRadius, 64, 64);\n        \n        // Globe material matching the example's settings\n        const innerMaterial = new THREE.MeshStandardMaterial({\n            map: earthDayTexture,\n            transparent: false, // Surface is opaque\n            side: THREE.FrontSide,\n            \n            // Surface properties matching example\n            roughnessMap: earthBumpRoughnessCloudsTexture,\n            roughness: roughnessLow, // Base roughness\n            metalness: 0.0, // No metalness like example\n            \n            // Enhanced surface details\n            bumpMap: earthBumpRoughnessCloudsTexture,\n            bumpScale: 0.02, // Same as example\n            \n            // Lighting response\n            envMapIntensity: 1.0\n        });\n        \n        // Custom shader for enhanced Earth surface (matching example logic)\n        innerMaterial.onBeforeCompile = (shader) => {\n            // Add uniforms for roughness range\n            shader.uniforms.roughnessLow = { value: roughnessLow };\n            shader.uniforms.roughnessHigh = { value: roughnessHigh };\n            \n            // Add uniform declarations to fragment shader\n            shader.fragmentShader = shader.fragmentShader.replace(\n                'uniform float roughness;',\n                `uniform float roughness;\n                uniform float roughnessLow;\n                uniform float roughnessHigh;`\n            );\n            \n            shader.fragmentShader = shader.fragmentShader.replace(\n                '#include <map_fragment>',\n                `\n                #include <map_fragment>\n                \n                // Get cloud strength from blue channel for surface color mixing\n                float surfaceCloudsStrength = texture2D(roughnessMap, vMapUv).b;\n                surfaceCloudsStrength = smoothstep(0.2, 1.0, surfaceCloudsStrength);\n                \n                // Mix day texture with clouds (same as example)\n                diffuseColor.rgb = mix(diffuseColor.rgb, vec3(1.0), surfaceCloudsStrength * 2.0);\n                `\n            );\n            \n            shader.fragmentShader = shader.fragmentShader.replace(\n                '#include <roughnessmap_fragment>',\n                `\n                #include <roughnessmap_fragment>\n                \n                // Advanced roughness calculation (same as example)\n                float roughnessFromMap = texture2D(roughnessMap, vMapUv).g;\n                float roughnessCloudsStrength = texture2D(roughnessMap, vMapUv).b;\n                roughnessCloudsStrength = smoothstep(0.2, 1.0, roughnessCloudsStrength);\n                \n                // Use max of roughness and cloud step (same as example)\n                float finalRoughness = max(roughnessFromMap, step(0.01, roughnessCloudsStrength));\n                \n                // Remap between low and high roughness (same as example)\n                roughnessFactor = mix(roughnessLow, roughnessHigh, finalRoughness);\n                `\n            );\n        };\n        \n        this.innerPlanet = new THREE.Mesh(innerGeometry, innerMaterial);\n        this.innerPlanet.receiveShadow = true;\n        this.innerPlanet.castShadow = true;\n        this.innerPlanet.renderOrder = 1; // Render before atmosphere\n        this.scene.add(this.innerPlanet);\n        \n        this.planetRadius = atmosphereRadius;\n        \n        console.log('🌍 Earth planet created (Three.js example-based):', {\n            atmosphereRadius: atmosphereRadius,\n            planetRadius: planetRadius,\n            atmosphereOpacity: params.PLANET_OUTER_OPACITY,\n            textureMapping: 'Natural UV mapping (no repeat) - prevents polar distortion',\n            atmosphereTexture: 'earth_bump_roughness_clouds_4096.jpg (BackSide)',\n            surfaceTexture: 'planet_color.jpg (FrontSide)',\n            materialParameters: {\n                roughnessLow: roughnessLow,\n                roughnessHigh: roughnessHigh,\n                atmosphereRoughness: roughnessHigh,\n                surfaceBaseRoughness: roughnessLow,\n                metalness: 0.0\n            },\n            features: {\n                atmosphereLayer: 'Blue channel cloud processing with BackSide rendering',\n                surfaceDetails: 'Dynamic roughness mapping with texture channels',\n                cloudBlending: 'Surface-cloud color mixing at 2.0x multiplier',\n                textureChannels: 'R=Bump, G=Roughness, B=Clouds',\n                uvMapping: 'Standard spherical UV mapping without repetition'\n            },\n            shaderEnhancements: {\n                atmosphere: 'Cloud transparency with smoothstep(0.2, 1.0)',\n                surface: 'Roughness remapping between low/high values',\n                rendering: 'Surface first (order 1), atmosphere second (order 2)'\n            },\n            exampleCompliance: 'Full compatibility with Three.js WebGPU Earth example'\n        });\n        \n        // Debug: Check visibility and provide tips\n        if (params.PLANET_OUTER_OPACITY >= 1.0 && planetRadius < atmosphereRadius * 0.8) {\n            console.warn('⚠️  Surface may not be visible: atmosphere is opaque and surface is small');\n            console.log('💡 Three.js example-based suggestions:');\n            console.log('   - Reduce PLANET_OUTER_OPACITY to 0.7 for better atmosphere transparency');\n            console.log('   - Increase PLANET_INNER_SPHERE_SCALE to 0.95 for better surface visibility');\n            console.log('   - Use toggleCloudVisibility() method to debug atmosphere layer');\n            console.log('   - Use toggleAtmosphereSide() to test BackSide vs FrontSide rendering');\n        }\n    }\n\n    initializeHUD() {\n        // Create HUD canvas overlay\n        this.hudCanvas = document.createElement('canvas');\n        this.hudCanvas.style.cssText = `\n            position: fixed;\n            top: 10px;\n            left: 10px;\n            width: 200px;\n            height: 200px;\n            border: 2px solid #333;\n            border-radius: 8px;\n            background: rgba(0, 0, 0, 0.1);\n            z-index: 1000;\n            pointer-events: none;\n        `;\n        document.body.appendChild(this.hudCanvas);\n\n        // Create HUD renderer\n        this.hudRenderer = new THREE.WebGLRenderer({ \n            canvas: this.hudCanvas, \n            antialias: true,\n            alpha: true \n        });\n        this.hudRenderer.setSize(200, 200);\n        this.hudRenderer.setPixelRatio(window.devicePixelRatio);\n        this.hudRenderer.setClearColor(0x000000, 0.1);\n\n        // Create HUD scene\n        this.hudScene = new THREE.Scene();\n\n        // Create HUD camera (orthographic for better helper visibility)\n        this.hudCamera = new THREE.OrthographicCamera(-10, 10, 10, -10, 0.1, 100);\n        this.hudCamera.position.set(10, 10, 10);\n        this.hudCamera.lookAt(0, 0, 0);\n\n        // Add helpers to HUD scene\n        this.addHUDHelpers();\n\n        console.log('🔧 HUD system initialized with helpers');\n    }\n\n    addHUDHelpers() {\n        // Add axes helper to HUD scene\n        this.axesHelper = new THREE.AxesHelper(8);\n        this.hudScene.add(this.axesHelper);\n\n        // Create a mini camera representation for the HUD\n        this.createMiniCameraHelper();\n\n        // Add some ambient light to HUD scene\n        const hudLight = new THREE.AmbientLight(0xffffff, 0.8);\n        this.hudScene.add(hudLight);\n\n        // Add directional light for better visibility\n        const hudDirectionalLight = new THREE.DirectionalLight(0xffffff, 0.5);\n        hudDirectionalLight.position.set(5, 5, 5);\n        this.hudScene.add(hudDirectionalLight);\n\n        // Add labels for axes\n        this.addHUDLabels();\n\n        // Add player direction indicator\n        this.createPlayerDirectionIndicator();\n    }\n\n    createMiniCameraHelper() {\n        // Create a visual representation of the main camera in the HUD\n        const cameraGeometry = new THREE.ConeGeometry(0.5, 2, 4);\n        const cameraMaterial = new THREE.MeshLambertMaterial({ \n            color: 0x00ff00,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        this.miniCamera = new THREE.Mesh(cameraGeometry, cameraMaterial);\n        this.miniCamera.rotateX(-Math.PI / 2); // Point forward\n        this.hudScene.add(this.miniCamera);\n\n        // Add camera direction indicator\n        const directionGeometry = new THREE.CylinderGeometry(0.1, 0.1, 4, 8);\n        const directionMaterial = new THREE.MeshLambertMaterial({ \n            color: 0x00ff00,\n            transparent: true,\n            opacity: 0.6\n        });\n        \n        this.cameraDirection = new THREE.Mesh(directionGeometry, directionMaterial);\n        this.cameraDirection.rotateX(-Math.PI / 2);\n        this.cameraDirection.position.set(0, 0, 2);\n        this.hudScene.add(this.cameraDirection);\n    }\n\n    createPlayerDirectionIndicator() {\n        // Create an arrow to show player direction\n        const arrowGeometry = new THREE.ConeGeometry(0.3, 1.5, 6);\n        const arrowMaterial = new THREE.MeshLambertMaterial({ \n            color: 0xff4444,\n            transparent: true,\n            opacity: 0.8\n        });\n        \n        this.playerDirection = new THREE.Mesh(arrowGeometry, arrowMaterial);\n        this.playerDirection.position.set(0, 0, -4);\n        this.playerDirection.rotateX(-Math.PI / 2);\n        this.hudScene.add(this.playerDirection);\n    }\n\n    addHUDLabels() {\n        // Create text labels for axes (using HTML overlay)\n        const labelContainer = document.createElement('div');\n        labelContainer.style.cssText = `\n            position: fixed;\n            top: 10px;\n            left: 220px;\n            font-family: 'Courier New', monospace;\n            font-size: 11px;\n            color: white;\n            background: rgba(0, 0, 0, 0.8);\n            padding: 8px;\n            border-radius: 4px;\n            z-index: 1001;\n            line-height: 1.3;\n            border: 1px solid #333;\n            pointer-events: none;\n        `;\n        \n        labelContainer.innerHTML = `\n            <div style=\"color: #ff6b6b; font-weight: bold;\">🔴 X-Axis (Red)</div>\n            <div style=\"color: #6bcf7f; font-weight: bold;\">🟢 Y-Axis (Green)</div>\n            <div style=\"color: #4d9ef7; font-weight: bold;\">🔵 Z-Axis (Blue)</div>\n            <div style=\"color: #00ff00; font-weight: bold;\">📷 Camera (Green)</div>\n            <div style=\"color: #ff4444; font-weight: bold;\">🚀 Player Direction (Red)</div>\n            <div style=\"margin-top: 5px; color: #ccc;\">Press H to toggle</div>\n        `;\n        \n        this.hudLabels = labelContainer;\n        document.body.appendChild(labelContainer);\n    }\n\n    // Toggle HUD visibility\n    toggleHelpers(visible = null) {\n        this.showHelpers = visible !== null ? visible : !this.showHelpers;\n        \n        if (this.hudCanvas) {\n            this.hudCanvas.style.display = this.showHelpers ? 'block' : 'none';\n        }\n        \n        if (this.hudLabels) {\n            this.hudLabels.style.display = this.showHelpers ? 'block' : 'none';\n        }\n        \n        console.log(`🔧 HUD helpers ${this.showHelpers ? 'shown' : 'hidden'}`);\n    }\n\n    // Update HUD to reflect main camera orientation and player direction\n    updateHUD() {\n        if (!this.hudScene || !this.showHelpers) return;\n\n        // Update mini camera orientation to match main camera\n        if (this.miniCamera && this.cameraDirection) {\n            // Get main camera direction\n            const cameraDirection = new THREE.Vector3();\n            this.camera.getWorldDirection(cameraDirection);\n            \n            // Update mini camera rotation to show main camera direction\n            this.miniCamera.lookAt(cameraDirection);\n            this.cameraDirection.lookAt(cameraDirection);\n            \n            // Scale based on distance to make it more visible\n            const distance = this.camera.position.length();\n            const scale = Math.max(0.5, Math.min(2.0, distance / 20));\n            this.miniCamera.scale.setScalar(scale);\n        }\n\n        // Update player direction indicator\n        if (this.playerDirection) {\n            // Get player system to get player direction\n            const playerSystem = serviceContainer.resolve('playerSystem');\n            if (playerSystem) {\n                const playerPosition = playerSystem.getPlayerPosition();\n                const playerNormal = playerSystem.getPlayerNormal();\n                \n                // Position the player direction indicator\n                this.playerDirection.position.copy(playerNormal.clone().multiplyScalar(-6));\n                this.playerDirection.lookAt(playerNormal);\n            }\n        }\n    }\n\n    addPlanetVariation(geometry) {\n        // Add some procedural variation to the planet\n        const positions = geometry.attributes.position;\n        const vertices = positions.array;\n        \n        for (let i = 0; i < vertices.length; i += 3) {\n            const x = vertices[i];\n            const y = vertices[i + 1];\n            const z = vertices[i + 2];\n            \n            // Add some noise to make the planet less perfectly spherical\n            const noise = (Math.sin(x * 0.1) + Math.cos(y * 0.1) + Math.sin(z * 0.1)) * 0.1;\n            const length = Math.sqrt(x * x + y * y + z * z);\n            const normalizedX = x / length;\n            const normalizedY = y / length;\n            const normalizedZ = z / length;\n            \n            vertices[i] = normalizedX * (length + noise);\n            vertices[i + 1] = normalizedY * (length + noise);\n            vertices[i + 2] = normalizedZ * (length + noise);\n        }\n        \n        positions.needsUpdate = true;\n        geometry.computeVertexNormals();\n    }\n\n    setupResizeHandler() {\n        window.addEventListener('resize', () => {\n            this.camera.aspect = window.innerWidth / window.innerHeight;\n            this.camera.updateProjectionMatrix();\n            this.renderer.setSize(window.innerWidth, window.innerHeight);\n        });\n    }\n\n    // Update camera based on player position\n    updateCamera(playerPosition) {\n        if (playerPosition) {\n            // Calculate camera position relative to player\n            const playerNormal = playerPosition.clone().normalize();\n            const cameraOffset = playerNormal.clone().multiplyScalar(params.CAMERA_DISTANCE);\n            const cameraPosition = playerPosition.clone().add(cameraOffset);\n            \n            // Apply camera shake if available\n            if (this.cameraShakeOffset) {\n                cameraPosition.add(this.cameraShakeOffset);\n            }\n            \n            this.camera.position.copy(cameraPosition);\n            this.camera.lookAt(playerPosition);\n            \n            // Robust camera orientation using quaternion-based approach\n            // This avoids singularities and discontinuities\n            this.updateCameraOrientation(playerPosition);\n            \n            // Update camera-following light position\n            this.updateCameraLight(playerPosition);\n        }\n    }\n\n    updateCameraOrientation(playerPosition) {\n        // Store previous camera up vector to maintain continuity\n        if (!this.lastCameraUp) {\n            this.lastCameraUp = new THREE.Vector3(0, 1, 0);\n        }\n        \n        const playerNormal = playerPosition.clone().normalize();\n        const cameraToPlayer = playerPosition.clone().sub(this.camera.position).normalize();\n        \n        // Calculate desired camera right vector by projecting last up vector\n        // onto the plane perpendicular to the camera-to-player direction\n        const lastUpProjected = this.lastCameraUp.clone();\n        const projectionLength = lastUpProjected.dot(cameraToPlayer);\n        lastUpProjected.addScaledVector(cameraToPlayer, -projectionLength);\n        \n        // If projection is too small, use a fallback based on world coordinates\n        if (lastUpProjected.length() < 0.1) {\n            // Use the most stable world axis that's not aligned with camera direction\n            const worldX = new THREE.Vector3(1, 0, 0);\n            const worldY = new THREE.Vector3(0, 1, 0);\n            const worldZ = new THREE.Vector3(0, 0, 1);\n            \n            const dotX = Math.abs(cameraToPlayer.dot(worldX));\n            const dotY = Math.abs(cameraToPlayer.dot(worldY));\n            const dotZ = Math.abs(cameraToPlayer.dot(worldZ));\n            \n            if (dotX < dotY && dotX < dotZ) {\n                lastUpProjected.copy(worldX);\n            } else if (dotY < dotZ) {\n                lastUpProjected.copy(worldY);\n            } else {\n                lastUpProjected.copy(worldZ);\n            }\n            \n            // Project chosen axis onto plane perpendicular to camera direction\n            const proj = lastUpProjected.dot(cameraToPlayer);\n            lastUpProjected.addScaledVector(cameraToPlayer, -proj);\n        }\n        \n        lastUpProjected.normalize();\n        \n        // Calculate camera right vector\n        const cameraRight = new THREE.Vector3().crossVectors(cameraToPlayer, lastUpProjected);\n        cameraRight.normalize();\n        \n        // Calculate final camera up vector\n        const cameraUp = new THREE.Vector3().crossVectors(cameraRight, cameraToPlayer);\n        cameraUp.normalize();\n        \n        // Update camera orientation\n        this.camera.up.copy(cameraUp);\n        \n        // Store for next frame to maintain continuity\n        this.lastCameraUp.copy(cameraUp);\n    }\n\n    // Update camera-following directional light position and direction\n    updateCameraLight(playerPosition) {\n        if (this.cameraLight) {\n            // Calculate player normal vector\n            const playerNormal = playerPosition.clone().normalize();\n            \n            // Get camera up vector for positioning light above camera\n            const cameraUp = this.camera.up.clone();\n            \n            // Get camera right vector for positioning light to the right\n            const cameraRight = new THREE.Vector3();\n            cameraRight.crossVectors(this.camera.up, new THREE.Vector3().copy(playerPosition).sub(this.camera.position).normalize());\n            cameraRight.normalize();\n            \n            // Position directional light above and to the right of camera\n            const upOffset = cameraUp.multiplyScalar(150); // 25 units above camera\n            const rightOffset = cameraRight.multiplyScalar(-150); // 15 units to the right of camera\n            const lightPosition = this.camera.position.clone().add(upOffset).add(rightOffset);\n            \n            this.cameraLight.position.copy(lightPosition);\n            \n            // Make directional light point towards scene center\n            const sceneCenter = new THREE.Vector3(0, 0, 0);\n            this.cameraLight.lookAt(sceneCenter);\n            \n            // Optionally adjust light intensity based on distance to player\n            const distanceToPlayer = this.camera.position.distanceTo(playerPosition);\n            const intensityScale = Math.max(0.8, Math.min(2.0, 30 / distanceToPlayer));\n            this.cameraLight.intensity = 1.5 * intensityScale;\n        }\n    }\n\n    // Render the scene and HUD\n    render() {\n        // Render main scene\n        this.renderer.render(this.scene, this.camera);\n        \n        // Update and render HUD\n        this.updateHUD();\n        if (this.hudRenderer && this.hudScene && this.showHelpers) {\n            this.hudRenderer.render(this.hudScene, this.hudCamera);\n        }\n    }\n\n    // Add object to scene\n    addObject(object) {\n        this.scene.add(object);\n    }\n\n    // Remove object from scene\n    removeObject(object) {\n        this.scene.remove(object);\n    }\n\n    // Get scene reference for other systems\n    getScene() {\n        return this.scene;\n    }\n\n    // Get planet reference\n    getPlanet() {\n        return this.planet;\n    }\n\n    // Get inner planet reference\n    getInnerPlanet() {\n        return this.innerPlanet;\n    }\n\n    // Get planet radius\n    getPlanetRadius() {\n        return this.planetRadius;\n    }\n\n    // Get inner planet radius\n    getAtmosphereRadius() {\n        return this.planetRadius * params.PLANET_OUTER_SPHERE_SCALE;\n    }\n\n    // Set background color\n    setBackgroundColor(color) {\n        if (this.scene && this.scene.background) {\n            this.scene.background = new THREE.Color(color);\n        }\n    }\n\n    // Get current background color\n    getBackgroundColor() {\n        return this.scene && this.scene.background ? this.scene.background.getHex() : 0x000000;\n    }\n\n    // Set background color using predefined colors\n    setBackgroundFromPreset(colorName) {\n        const color = params.BACKGROUND_COLORS[colorName];\n        if (color !== undefined) {\n            this.setBackgroundColor(color);\n            console.log(`🎨 Background color set to ${colorName} (${color.toString(16)})`);\n        } else {\n            console.warn(`🎨 Background color preset \"${colorName}\" not found. Available presets:`, Object.keys(params.BACKGROUND_COLORS));\n        }\n    }\n\n    // Set background color based on player mask\n    setBackgroundFromMask(maskType) {\n        const color = params.MASK_BACKGROUND_COLORS[maskType];\n        if (color !== undefined) {\n            this.setBackgroundColor(color);\n            const maskName = this.getMaskName(maskType);\n            console.log(`🎭 Background color changed to match ${maskName} mask (${color.toString(16)})`);\n        } else {\n            console.warn(`🎭 Background color for mask \"${maskType}\" not found. Available masks:`, Object.keys(params.MASK_BACKGROUND_COLORS));\n        }\n    }\n\n    // Get mask name for logging\n    getMaskName(maskType) {\n        const maskNames = {\n            null: 'Neutral',\n            1: 'Conservative',\n            2: 'Social Justice',\n            3: 'Libertarian',\n            4: 'Nationalist',\n            5: 'Culture',\n            6: 'Religious',\n            7: 'Antisystem'\n        };\n        return maskNames[maskType] || 'Unknown';\n    }\n\n    // Test all mask background colors (for debugging)\n    testAllMaskColors() {\n        console.log('🎨 Testing all mask background colors:');\n        const masks = [null, 1, 2, 3, 4, 5, 6, 7];\n        let currentIndex = 0;\n        \n        const testNext = () => {\n            if (currentIndex < masks.length) {\n                const maskType = masks[currentIndex];\n                this.setBackgroundFromMask(maskType);\n                currentIndex++;\n                setTimeout(testNext, 2000); // Change color every 2 seconds\n            } else {\n                console.log('🎨 Mask color test completed');\n                this.setBackgroundFromMask(null); // Return to neutral\n            }\n        };\n        \n        testNext();\n    }\n\n    // Debug methods for planet visibility\n    toggleInnerSphereVisibility() {\n        if (this.innerPlanet) {\n            this.innerPlanet.visible = !this.innerPlanet.visible;\n            console.log(`🌍 Inner sphere visibility: ${this.innerPlanet.visible ? 'ON' : 'OFF'}`);\n        }\n    }\n\n    // Debug method for texture scale testing (disabled for proper Earth mapping)\n    setPlanetTextureScale(scale = 1.0) {\n        console.log(`🌍 Texture scaling disabled for proper Earth UV mapping (requested scale: ${scale})`);\n        console.log(`💡 Earth textures use natural UV mapping without repeat to avoid polar distortion`);\n    }\n\n    // Debug method for adjusting inner sphere material properties\n    setInnerSphereReflectivity(roughness = 0.1, metalness = 0.6, clearcoat = 0.8) {\n        if (this.innerPlanet && this.innerPlanet.material) {\n            const material = this.innerPlanet.material;\n            material.roughness = roughness;\n            material.metalness = metalness;\n            material.clearcoat = clearcoat;\n            material.needsUpdate = true;\n            console.log(`✨ Inner sphere reflectivity updated:`, {\n                roughness: roughness,\n                metalness: metalness,\n                clearcoat: clearcoat\n            });\n        }\n    }\n\n    // Debug method for displacement scale testing\n    setDisplacementScale(scale = 0.5) {\n        if (this.innerPlanet && this.innerPlanet.material) {\n            this.innerPlanet.material.displacementScale = scale;\n            this.innerPlanet.material.needsUpdate = true;\n            console.log(`🌍 Inner sphere displacement scale set to: ${scale}`);\n        }\n    }\n\n    // Debug method for adjusting camera directional light\n    setCameraDirectionalLightParams(intensity = 1.5) {\n        if (this.cameraLight) {\n            this.cameraLight.intensity = intensity;\n            console.log(`💡 Camera directional light updated:`, {\n                intensity: intensity,\n                position: this.cameraLight.position,\n                rotation: this.cameraLight.rotation\n            });\n        }\n    }\n\n    // Enhanced Earth texture debug methods (matching example parameters)\n    toggleCloudVisibility() {\n        if (this.planet) {\n            this.planet.visible = !this.planet.visible;\n            console.log(`☁️ Atmosphere layer visibility: ${this.planet.visible ? 'ON' : 'OFF'}`);\n        }\n    }\n\n    adjustAtmosphereOpacity(opacity = 0.7) {\n        if (this.planet && this.planet.material) {\n            this.planet.material.opacity = opacity;\n            this.planet.material.transparent = opacity < 1.0;\n            console.log(`☁️ Atmosphere opacity set to: ${opacity}`);\n        }\n    }\n\n    adjustRoughnessRange(roughnessLow = 0.25, roughnessHigh = 0.35) {\n        if (this.innerPlanet && this.innerPlanet.material) {\n            // Update shader uniforms if they exist\n            if (this.innerPlanet.material.uniforms) {\n                this.innerPlanet.material.uniforms.roughnessLow.value = roughnessLow;\n                this.innerPlanet.material.uniforms.roughnessHigh.value = roughnessHigh;\n            }\n            console.log(`🌍 Roughness range set to: ${roughnessLow} - ${roughnessHigh}`);\n        }\n    }\n\n    adjustSurfaceBumpScale(scale = 0.02) {\n        if (this.innerPlanet && this.innerPlanet.material) {\n            this.innerPlanet.material.bumpScale = scale;\n            console.log(`🌍 Surface bump scale set to: ${scale}`);\n        }\n    }\n\n    adjustAtmosphereRoughness(roughness = 0.35) {\n        if (this.planet && this.planet.material) {\n            this.planet.material.roughness = roughness;\n            console.log(`☁️ Atmosphere roughness set to: ${roughness}`);\n        }\n    }\n\n    toggleAtmosphereSide() {\n        if (this.planet && this.planet.material) {\n            const material = this.planet.material;\n            if (material.side === THREE.BackSide) {\n                material.side = THREE.FrontSide;\n                console.log('☁️ Atmosphere side: FRONT');\n            } else {\n                material.side = THREE.BackSide;\n                console.log('☁️ Atmosphere side: BACK');\n            }\n            material.needsUpdate = true;\n        }\n    }\n\n    // Test Earth texture effects in sequence (matching example parameters)\n    testEarthTextureEffects() {\n        console.log('🌍 Testing Earth texture effects (example-based)...');\n        \n        const tests = [\n            { name: 'Normal State', action: () => this.resetEarthTextures() },\n            { name: 'Surface Only', action: () => this.toggleCloudVisibility() },\n            { name: 'Atmosphere Only', action: () => this.toggleInnerSphereVisibility() },\n            { name: 'High Atmosphere Opacity', action: () => this.adjustAtmosphereOpacity(0.9) },\n            { name: 'Low Atmosphere Opacity', action: () => this.adjustAtmosphereOpacity(0.3) },\n            { name: 'Enhanced Bump Scale', action: () => this.adjustSurfaceBumpScale(0.1) },\n            { name: 'Reduced Bump Scale', action: () => this.adjustSurfaceBumpScale(0.005) },\n            { name: 'High Roughness Range', action: () => this.adjustRoughnessRange(0.4, 0.6) },\n            { name: 'Low Roughness Range', action: () => this.adjustRoughnessRange(0.1, 0.2) },\n            { name: 'Front Side Atmosphere', action: () => this.toggleAtmosphereSide() },\n            { name: 'Rough Atmosphere', action: () => this.adjustAtmosphereRoughness(0.8) }\n        ];\n        \n        let currentIndex = 0;\n        \n        const runNextTest = () => {\n            if (currentIndex < tests.length) {\n                const test = tests[currentIndex];\n                console.log(`🧪 Testing: ${test.name}`);\n                test.action();\n                currentIndex++;\n                setTimeout(runNextTest, 3000); // 3 seconds per test\n            } else {\n                console.log('🌍 Earth texture test completed - resetting to example defaults');\n                this.resetEarthTextures();\n            }\n        };\n        \n        runNextTest();\n    }\n\n    // Reset all Earth texture effects to example defaults\n    resetEarthTextures() {\n        // Reset atmosphere layer\n        if (this.planet) {\n            this.planet.visible = true;\n            if (this.planet.material) {\n                this.planet.material.opacity = params.PLANET_OUTER_OPACITY;\n                this.planet.material.transparent = params.PLANET_OUTER_OPACITY < 1.0;\n                this.planet.material.side = THREE.BackSide;\n                this.planet.material.roughness = 0.35; // roughnessHigh\n                this.planet.material.needsUpdate = true;\n            }\n        }\n        \n        // Reset surface\n        if (this.innerPlanet) {\n            this.innerPlanet.visible = true;\n            if (this.innerPlanet.material) {\n                this.innerPlanet.material.roughness = 0.25; // roughnessLow base\n                this.innerPlanet.material.bumpScale = 0.02;\n                \n                // Reset shader uniforms\n                if (this.innerPlanet.material.uniforms) {\n                    this.innerPlanet.material.uniforms.roughnessLow.value = 0.25;\n                    this.innerPlanet.material.uniforms.roughnessHigh.value = 0.35;\n                }\n            }\n        }\n        \n        console.log('🌍 Earth textures reset to example defaults');\n    }\n\n    // Get detailed Earth texture information (example-based)\n    getEarthTextureInfo() {\n        const atmosphereMaterial = this.planet?.material;\n        const surfaceMaterial = this.innerPlanet?.material;\n        \n        return {\n            atmosphere: {\n                visible: this.planet?.visible || false,\n                opacity: atmosphereMaterial?.opacity || 'N/A',\n                roughness: atmosphereMaterial?.roughness || 'N/A',\n                side: atmosphereMaterial?.side === THREE.BackSide ? 'BackSide' : 'FrontSide',\n                metalness: atmosphereMaterial?.metalness || 'N/A',\n                texture: 'earth_bump_roughness_clouds_4096.jpg',\n                channels: {\n                    red: 'Bump/Elevation',\n                    green: 'Roughness',\n                    blue: 'Clouds/Alpha'\n                },\n                features: ['Cloud transparency', 'Atmospheric scattering', 'Volume rendering']\n            },\n            surface: {\n                visible: this.innerPlanet?.visible || false,\n                baseRoughness: surfaceMaterial?.roughness || 'N/A',\n                bumpScale: surfaceMaterial?.bumpScale || 'N/A',\n                metalness: surfaceMaterial?.metalness || 'N/A',\n                transparent: surfaceMaterial?.transparent || false,\n                texture: 'planet_color.jpg',\n                roughnessTexture: 'earth_bump_roughness_clouds_4096.jpg',\n                features: ['Dynamic roughness mapping', 'Cloud-surface blending', 'Multi-channel texturing']\n            },\n            shaderEnhancements: {\n                atmosphere: 'Blue channel cloud processing with smoothstep',\n                surface: 'Advanced roughness remapping between low/high values',\n                rendering: 'Surface first, then atmosphere (BackSide)'\n            },\n            exampleParameters: {\n                roughnessLow: 0.25,\n                roughnessHigh: 0.35,\n                cloudSmoothstep: '0.2 to 1.0',\n                cloudMultiplier: '2.0x for brightness',\n                renderOrder: 'Surface (1) → Atmosphere (2)'\n            }\n        };\n    }\n\n    // Debug method for testing directional light colors\n    setCameraDirectionalLightColor(color = 0xffffff) {\n        if (this.cameraLight) {\n            this.cameraLight.color.setHex(color);\n            console.log(`💡 Camera directional light color set to: ${color.toString(16)}`);\n        }\n    }\n\n    // Test different directional light colors for enhanced visual effect\n    testDirectionalLightColors() {\n        console.log('🎨 Testing directional light colors...');\n        const colors = [\n            { name: 'White', color: 0xffffff },\n            { name: 'Warm White', color: 0xfff8dc },\n            { name: 'Cool Blue', color: 0xb3d9ff },\n            { name: 'Golden', color: 0xffd700 },\n            { name: 'Cyan', color: 0x00ffff },\n            { name: 'Magenta', color: 0xff00ff }\n        ];\n        \n        let currentIndex = 0;\n        \n        const testNext = () => {\n            if (currentIndex < colors.length) {\n                const colorData = colors[currentIndex];\n                this.setCameraDirectionalLightColor(colorData.color);\n                console.log(`🎨 Testing ${colorData.name} directional light`);\n                currentIndex++;\n                setTimeout(testNext, 2000); // Change color every 2 seconds\n            } else {\n                console.log('🎨 Directional light color test completed');\n                this.setCameraDirectionalLightColor(0xffffff); // Return to white\n            }\n        };\n        \n        testNext();\n    }\n\n    // Update planet texture scale and persist to params (disabled for proper Earth mapping)\n    updatePlanetTextureScale(scale = 1.0) {\n        console.log(`🌍 Planet texture scaling disabled for proper Earth UV mapping (requested scale: ${scale})`);\n        console.log(`💡 PLANET_TEXTURE_SCALE parameter is ignored for Earth textures to prevent polar distortion`);\n    }\n\n    toggleOuterSphereVisibility() {\n        if (this.planet) {\n            this.planet.visible = !this.planet.visible;\n            console.log(`🌍 Outer sphere visibility: ${this.planet.visible ? 'ON' : 'OFF'}`);\n        }\n    }\n\n    // Temporarily make outer sphere transparent to see inner sphere\n    toggleOuterSphereTransparency() {\n        if (this.planet && this.planet.material) {\n            const material = this.planet.material;\n            if (material.opacity >= 1.0) {\n                material.transparent = true;\n                material.opacity = 0.3;\n                console.log('🌍 Outer sphere made transparent (0.3)');\n            } else {\n                material.transparent = false;\n                material.opacity = 1.0;\n                console.log('🌍 Outer sphere made opaque (1.0)');\n            }\n        }\n    }\n\n    // Get planet debug info\n    getPlanetDebugInfo() {\n        return {\n            atmosphereRadius: this.planetRadius,\n            planetRadius: this.getInnerPlanetRadius(),\n            atmosphereOpacity: this.planet?.material?.opacity || 'N/A',\n            surfaceOpacity: this.innerPlanet?.material?.opacity || 'N/A',\n            atmosphereVisible: this.planet?.visible || false,\n            surfaceVisible: this.innerPlanet?.visible || false,\n            atmosphereRenderOrder: this.planet?.renderOrder || 'N/A',\n            surfaceRenderOrder: this.innerPlanet?.renderOrder || 'N/A',\n            textureMapping: 'Natural UV mapping (no repeat)',\n            atmosphereTexture: 'earth_bump_roughness_clouds_4096.jpg',\n            surfaceTexture: 'planet_color.jpg',\n            uvMapping: 'Standard spherical UV without distortion'\n        };\n    }\n\n    // Cleanup\n    shutdown() {\n        if (this.renderer) {\n            this.renderer.dispose();\n        }\n        \n        // Clean up HUD\n        if (this.hudRenderer) {\n            this.hudRenderer.dispose();\n        }\n        \n        if (this.hudCanvas) {\n            document.body.removeChild(this.hudCanvas);\n            this.hudCanvas = null;\n        }\n        \n        if (this.hudLabels) {\n            document.body.removeChild(this.hudLabels);\n            this.hudLabels = null;\n        }\n        \n        // Clean up camera directional light\n        if (this.cameraLight) {\n            this.scene.remove(this.cameraLight);\n            this.cameraLight = null;\n        }\n        \n        if (this.scene) {\n            // Clean up scene objects\n            while (this.scene.children.length > 0) {\n                this.scene.remove(this.scene.children[0]);\n            }\n        }\n\n        console.log('🎬 Scene Manager shutdown');\n    }\n} ","// interfaces/IGameSystem.js - Interface for game systems\r\nimport { eventManager } from '../core/EventManager.js';\r\n\r\nexport class IGameSystem {\r\n    constructor(name) {\r\n        if (this.constructor === IGameSystem) {\r\n            throw new Error('Cannot instantiate abstract class IGameSystem');\r\n        }\r\n        this.name = name;\r\n        this.enabled = true;\r\n        this.eventManager = eventManager;\r\n        this.eventSubscriptions = []; // Track subscriptions for cleanup\r\n    }\r\n\r\n    // Abstract methods that must be implemented\r\n    initialize(sceneManager) {\r\n        throw new Error('initialize() must be implemented by subclass');\r\n    }\r\n\r\n    update(deltaTime) {\r\n        throw new Error('update() must be implemented by subclass');\r\n    }\r\n\r\n    shutdown() {\r\n        // Cleanup event subscriptions\r\n        this.cleanupEventSubscriptions();\r\n        // Subclasses should override this method for their own cleanup\r\n        throw new Error('shutdown() must be implemented by subclass');\r\n    }\r\n\r\n    // Optional hooks\r\n    onGameStateChange(newState) {\r\n        // Override if needed\r\n    }\r\n\r\n    onPlayerAction(action) {\r\n        // Override if needed\r\n    }\r\n\r\n    // System control\r\n    enable() {\r\n        this.enabled = true;\r\n    }\r\n\r\n    disable() {\r\n        this.enabled = false;\r\n    }\r\n\r\n    // Event management helper methods\r\n    subscribeToEvent(eventType, callback, priority = 100) {\r\n        const unsubscribe = this.eventManager.subscribe(eventType, callback, priority);\r\n        this.eventSubscriptions.push(unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    subscribeToEventOnce(eventType, callback, priority = 100) {\r\n        const unsubscribe = this.eventManager.subscribeOnce(eventType, callback, priority);\r\n        this.eventSubscriptions.push(unsubscribe);\r\n        return unsubscribe;\r\n    }\r\n\r\n    publishEvent(eventType, data = null, source = null) {\r\n        const eventSource = source || this.name;\r\n        return this.eventManager.publish(eventType, data, eventSource);\r\n    }\r\n\r\n    publishEventAsync(eventType, data = null, source = null) {\r\n        const eventSource = source || this.name;\r\n        return this.eventManager.publishAsync(eventType, data, eventSource);\r\n    }\r\n\r\n    cleanupEventSubscriptions() {\r\n        for (const unsubscribe of this.eventSubscriptions) {\r\n            if (typeof unsubscribe === 'function') {\r\n                unsubscribe();\r\n            }\r\n        }\r\n        this.eventSubscriptions = [];\r\n    }\r\n} ","// core/SystemManager.js - System coordination following SRP\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\n\r\nexport class SystemManager {\r\n    constructor() {\r\n        this.systems = new Map();\r\n        this.systemOrder = [];\r\n        this.sceneManager = null;\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        this.sceneManager = sceneManager;\r\n        \r\n        // Initialize all registered systems\r\n        for (const systemName of this.systemOrder) {\r\n            const system = this.systems.get(systemName);\r\n            if (system && system.enabled) {\r\n                try {\r\n                    await system.initialize(sceneManager);\r\n                    console.log(`✅ ${systemName} system initialized`);\r\n                } catch (error) {\r\n                    console.error(`❌ Failed to initialize ${systemName}:`, error);\r\n                }\r\n            }\r\n        }\r\n\r\n        console.log('🔧 System Manager initialized');\r\n    }\r\n\r\n    // Register a new system\r\n    registerSystem(name, system, priority = 100) {\r\n        if (!(system instanceof IGameSystem)) {\r\n            throw new Error(`System ${name} must extend IGameSystem`);\r\n        }\r\n\r\n        this.systems.set(name, system);\r\n        \r\n        // Insert in order based on priority (lower number = higher priority)\r\n        const insertIndex = this.systemOrder.findIndex(\r\n            systemName => this.systems.get(systemName).priority > priority\r\n        );\r\n        \r\n        if (insertIndex === -1) {\r\n            this.systemOrder.push(name);\r\n        } else {\r\n            this.systemOrder.splice(insertIndex, 0, name);\r\n        }\r\n\r\n        system.priority = priority;\r\n        console.log(`📋 Registered system: ${name} (priority: ${priority})`);\r\n    }\r\n\r\n    // Unregister a system\r\n    unregisterSystem(name) {\r\n        if (this.systems.has(name)) {\r\n            const system = this.systems.get(name);\r\n            system.shutdown();\r\n            this.systems.delete(name);\r\n            \r\n            const index = this.systemOrder.indexOf(name);\r\n            if (index > -1) {\r\n                this.systemOrder.splice(index, 1);\r\n            }\r\n            \r\n            console.log(`🗑️ Unregistered system: ${name}`);\r\n        }\r\n    }\r\n\r\n    // Get a system by name\r\n    getSystem(name) {\r\n        return this.systems.get(name);\r\n    }\r\n\r\n    // Enable/disable systems\r\n    enableSystem(name) {\r\n        const system = this.systems.get(name);\r\n        if (system) {\r\n            system.enable();\r\n            console.log(`🟢 Enabled system: ${name}`);\r\n        }\r\n    }\r\n\r\n    disableSystem(name) {\r\n        const system = this.systems.get(name);\r\n        if (system) {\r\n            system.disable();\r\n            console.log(`🔴 Disabled system: ${name}`);\r\n        }\r\n    }\r\n\r\n    // Update all systems\r\n    update(deltaTime) {\r\n        for (const systemName of this.systemOrder) {\r\n            const system = this.systems.get(systemName);\r\n            if (system && system.enabled) {\r\n                try {\r\n                    system.update(deltaTime);\r\n                } catch (error) {\r\n                    console.error(`❌ Error updating ${systemName}:`, error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Notify all systems of game state changes\r\n    notifyGameStateChange(newState) {\r\n        for (const system of this.systems.values()) {\r\n            if (system.enabled) {\r\n                try {\r\n                    system.onGameStateChange(newState);\r\n                } catch (error) {\r\n                    console.error(`❌ Error in game state notification:`, error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Notify all systems of player actions\r\n    notifyPlayerAction(action) {\r\n        for (const system of this.systems.values()) {\r\n            if (system.enabled) {\r\n                try {\r\n                    system.onPlayerAction(action);\r\n                } catch (error) {\r\n                    console.error(`❌ Error in player action notification:`, error);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Get system statistics\r\n    getSystemStats() {\r\n        const stats = {\r\n            totalSystems: this.systems.size,\r\n            enabledSystems: 0,\r\n            disabledSystems: 0,\r\n            systems: []\r\n        };\r\n\r\n        for (const [name, system] of this.systems) {\r\n            if (system.enabled) {\r\n                stats.enabledSystems++;\r\n            } else {\r\n                stats.disabledSystems++;\r\n            }\r\n\r\n            stats.systems.push({\r\n                name,\r\n                enabled: system.enabled,\r\n                priority: system.priority || 100\r\n            });\r\n        }\r\n\r\n        return stats;\r\n    }\r\n\r\n    // Shutdown all systems\r\n    shutdown() {\r\n        console.log('🔧 Shutting down System Manager...');\r\n        \r\n        // Shutdown in reverse order\r\n        for (let i = this.systemOrder.length - 1; i >= 0; i--) {\r\n            const systemName = this.systemOrder[i];\r\n            const system = this.systems.get(systemName);\r\n            if (system) {\r\n                try {\r\n                    system.shutdown();\r\n                    console.log(`✅ ${systemName} system shutdown`);\r\n                } catch (error) {\r\n                    console.error(`❌ Error shutting down ${systemName}:`, error);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.systems.clear();\r\n        this.systemOrder = [];\r\n        console.log('🔧 System Manager shutdown complete');\r\n    }\r\n} ","// core/InputManager.js - Centralized input management following SRP\n// \n// Features:\n// - Keyboard and mouse input handling\n// - Touch controls for mobile devices\n// - Automatic fullscreen on landscape orientation (mobile)\n// \n// Usage example:\n// const inputManager = new InputManager();\n// await inputManager.initialize();\n// inputManager.setAutoFullscreen(true);  // Enable automatic fullscreen\n// inputManager.toggleFullscreen();       // Manual fullscreen toggle\n//\nexport class InputManager {\n    constructor() {\n        this.keys = new Map();\n        this.mousePosition = { x: 0, y: 0 };\n        this.mouseButtons = new Map();\n        this.inputListeners = new Map();\n        this.canvas = null;\n        \n        // Touch controls\n        this.touchActive = false;\n        this.touchOrigin = { x: 0, y: 0 };\n        this.touchCurrent = { x: 0, y: 0 };\n        this.touchMovement = { x: 0, y: 0 };\n        this.touchSensitivity = 0.05; // Much higher sensitivity for mobile testing\n        this.isMobile = this.detectMobile();\n        \n        // Orientation and fullscreen management\n        this.isFullscreen = false;\n        this.currentOrientation = null;\n        this.orientationLocked = false;\n        this.autoFullscreenEnabled = true; // Enable by default on mobile\n        this.wantsFullscreen = false; // Flag to enter fullscreen on next user interaction\n        this.fullscreenPromptShown = false; // Prevent spam\n        \n\n    }\n\n    async initialize() {\n        this.canvas = document.getElementById('renderCanvas');\n        \n        // Make canvas focusable\n        this.canvas.setAttribute('tabindex', '0');\n        this.canvas.focus();\n\n        this.setupKeyboardListeners();\n        this.setupMouseListeners();\n        \n        // Setup touch controls for mobile (or force enable for testing)\n        if (this.isMobile || true) { // Force enable for testing\n            this.setupTouchListeners();\n            console.log('📱 Touch controls enabled for mobile');\n        }\n        \n        // Setup orientation and fullscreen management for mobile\n        if (this.isMobile) {\n            this.setupOrientationHandling();\n            console.log('🔄 Orientation and fullscreen management enabled');\n        }\n\n        console.log('🎮 Input Manager initialized');\n    }\n\n    setupKeyboardListeners() {\n        // Global keyboard listeners\n        window.addEventListener('keydown', (event) => {\n            // Prevent repeated events when a key is held down\n            if (event.repeat) return;\n\n            const key = event.key.toLowerCase();\n            this.keys.set(key, true);\n            this.notifyListeners('keydown', { key, originalEvent: event });\n            \n            // Prevent default for game keys\n            if (this.isGameKey(key)) {\n                event.preventDefault();\n            }\n        });\n\n        window.addEventListener('keyup', (event) => {\n            const key = event.key.toLowerCase();\n            this.keys.set(key, false);\n            this.notifyListeners('keyup', { key, originalEvent: event });\n            \n            if (this.isGameKey(key)) {\n                event.preventDefault();\n            }\n        });\n\n        // Canvas-specific listeners\n        this.canvas.addEventListener('keydown', (event) => {\n            const key = event.key.toLowerCase();\n            this.notifyListeners('canvas-keydown', { key, originalEvent: event });\n            event.preventDefault();\n        });\n\n        this.canvas.addEventListener('keyup', (event) => {\n            const key = event.key.toLowerCase();\n            this.notifyListeners('canvas-keyup', { key, originalEvent: event });\n            event.preventDefault();\n        });\n    }\n\n    setupMouseListeners() {\n        // Mouse move - passive for better performance\n        this.canvas.addEventListener('mousemove', (event) => {\n            this.mousePosition.x = event.clientX;\n            this.mousePosition.y = event.clientY;\n            this.notifyListeners('mousemove', { \n                x: event.clientX, \n                y: event.clientY, \n                originalEvent: event \n            });\n        }, { passive: true });\n\n        // Mouse buttons - not passive as we might need to prevent default\n        this.canvas.addEventListener('mousedown', (event) => {\n            this.mouseButtons.set(event.button, true);\n            \n            // Try to enter fullscreen on user interaction (if landscape)\n            this.tryEnterFullscreenOnInteraction();\n            \n            this.notifyListeners('mousedown', { \n                button: event.button, \n                x: event.clientX, \n                y: event.clientY, \n                originalEvent: event \n            });\n        });\n\n        this.canvas.addEventListener('mouseup', (event) => {\n            this.mouseButtons.set(event.button, false);\n            this.notifyListeners('mouseup', { \n                button: event.button, \n                x: event.clientX, \n                y: event.clientY, \n                originalEvent: event \n            });\n        });\n\n        // Wheel - passive for better performance as we don't prevent default\n        this.canvas.addEventListener('wheel', (event) => {\n            this.notifyListeners('wheel', { \n                deltaY: event.deltaY, \n                deltaX: event.deltaX,\n                originalEvent: event \n            });\n        }, { passive: true });\n\n        // Context menu prevention for better game experience\n        this.canvas.addEventListener('contextmenu', (event) => {\n            event.preventDefault();\n        });\n\n        // Focus handling\n        this.canvas.addEventListener('focus', () => {\n            console.log('🎮 Canvas focused');\n        }, { passive: true });\n\n        this.canvas.addEventListener('blur', () => {\n            console.log('🎮 Canvas lost focus');\n            // Clear key states when canvas loses focus to prevent stuck keys\n            this.keys.clear();\n        }, { passive: true });\n    }\n\n    setupOrientationHandling() {\n        // Listen to orientation changes\n        window.addEventListener('orientationchange', () => {\n            // Wait for orientation change to complete\n            setTimeout(() => {\n                this.handleOrientationChange();\n            }, 100);\n        });\n        \n        // Also listen to resize events as backup\n        window.addEventListener('resize', () => {\n            this.handleOrientationChange();\n        });\n        \n        // Check initial orientation\n        this.handleOrientationChange();\n        \n        // Listen to fullscreen changes to keep state in sync\n        document.addEventListener('fullscreenchange', () => {\n            this.isFullscreen = !!document.fullscreenElement;\n            if (this.isFullscreen) {\n                this.wantsFullscreen = false; // Reset flag when entering fullscreen\n                this.fullscreenPromptShown = false; // Allow prompt to show again later\n            }\n        });\n        \n        document.addEventListener('webkitfullscreenchange', () => {\n            this.isFullscreen = !!document.webkitFullscreenElement;\n            if (this.isFullscreen) {\n                this.wantsFullscreen = false;\n                this.fullscreenPromptShown = false;\n            }\n        });\n        \n        document.addEventListener('mozfullscreenchange', () => {\n            this.isFullscreen = !!document.mozFullScreenElement;\n            if (this.isFullscreen) {\n                this.wantsFullscreen = false;\n                this.fullscreenPromptShown = false;\n            }\n        });\n        \n        document.addEventListener('msfullscreenchange', () => {\n            this.isFullscreen = !!document.msFullscreenElement;\n            if (this.isFullscreen) {\n                this.wantsFullscreen = false;\n                this.fullscreenPromptShown = false;\n            }\n        });\n    }\n\n    handleOrientationChange() {\n        if (!this.isMobile) return;\n        \n        const orientation = this.getOrientation();\n        \n        // Only act if orientation actually changed\n        if (orientation === this.currentOrientation) return;\n        \n        this.currentOrientation = orientation;\n        \n        // Only auto-enter fullscreen if enabled\n        if (this.isAutoFullscreenEnabled()) {\n            if (orientation === 'landscape') {\n                // Store the intention to enter fullscreen\n                this.wantsFullscreen = true;\n                console.log('🔄 Landscape detected - fullscreen will be enabled on next user interaction');\n            } else if (orientation === 'portrait') {\n                this.wantsFullscreen = false;\n                this.exitFullscreen();\n            }\n        }\n        \n        console.log(`🔄 Orientation changed to ${orientation}`);\n    }\n\n    getOrientation() {\n        // Check screen orientation API first\n        if (screen.orientation) {\n            return screen.orientation.angle === 0 || screen.orientation.angle === 180 ? 'portrait' : 'landscape';\n        }\n        \n        // Fallback to window orientation\n        if (window.orientation !== undefined) {\n            return Math.abs(window.orientation) === 90 ? 'landscape' : 'portrait';\n        }\n        \n        // Final fallback to window dimensions\n        return window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';\n    }\n\n    async enterFullscreen() {\n        if (this.isFullscreen) return;\n        \n        try {\n            // Check if we can enter fullscreen (permissions check)\n            if (!document.fullscreenEnabled && !document.webkitFullscreenEnabled && \n                !document.mozFullScreenEnabled && !document.msFullscreenEnabled) {\n                console.warn('❌ Fullscreen is not supported by this browser');\n                return false;\n            }\n            \n            // Try different fullscreen methods\n            const element = document.documentElement;\n            \n            if (element.requestFullscreen) {\n                await element.requestFullscreen();\n            } else if (element.webkitRequestFullscreen) {\n                await element.webkitRequestFullscreen();\n            } else if (element.mozRequestFullScreen) {\n                await element.mozRequestFullScreen();\n            } else if (element.msRequestFullscreen) {\n                await element.msRequestFullscreen();\n            }\n            \n            this.isFullscreen = true;\n            console.log('📱 Entered fullscreen mode');\n            return true;\n        } catch (error) {\n            console.warn('❌ Could not enter fullscreen (user gesture required):', error.message);\n            this.showFullscreenPrompt();\n            return false;\n        }\n    }\n\n    async exitFullscreen() {\n        if (!this.isFullscreen) return;\n        \n        try {\n            if (document.exitFullscreen) {\n                await document.exitFullscreen();\n            } else if (document.webkitExitFullscreen) {\n                await document.webkitExitFullscreen();\n            } else if (document.mozCancelFullScreen) {\n                await document.mozCancelFullScreen();\n            } else if (document.msExitFullscreen) {\n                await document.msExitFullscreen();\n            }\n            \n            this.isFullscreen = false;\n            console.log('📱 Exited fullscreen mode');\n        } catch (error) {\n            console.warn('❌ Could not exit fullscreen:', error);\n        }\n    }\n\n    // Public methods for external control\n    toggleFullscreen() {\n        if (this.isFullscreen) {\n            this.exitFullscreen();\n        } else {\n            this.enterFullscreen();\n        }\n    }\n\n    getCurrentOrientation() {\n        return this.currentOrientation;\n    }\n\n    isInFullscreen() {\n        return this.isFullscreen;\n    }\n\n    // Enable/disable automatic fullscreen on orientation change\n    setAutoFullscreen(enabled) {\n        this.autoFullscreenEnabled = enabled;\n        if (enabled) {\n            console.log('📱 Auto-fullscreen enabled');\n        } else {\n            console.log('📱 Auto-fullscreen disabled');\n        }\n    }\n\n    isAutoFullscreenEnabled() {\n        return this.autoFullscreenEnabled;\n    }\n\n    showFullscreenPrompt() {\n        if (this.fullscreenPromptShown) return;\n        \n        this.fullscreenPromptShown = true;\n        \n        // Create a non-intrusive message\n        const prompt = document.createElement('div');\n        prompt.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: rgba(0, 0, 0, 0.9);\n            color: white;\n            padding: 15px 20px;\n            border-radius: 8px;\n            font-family: Arial, sans-serif;\n            font-size: 14px;\n            z-index: 10000;\n            pointer-events: auto;\n            cursor: pointer;\n            border: 2px solid #333;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n        `;\n        prompt.innerHTML = `\n            <div style=\"margin-bottom: 8px;\">🔄 Rotate to landscape</div>\n            <div style=\"font-size: 12px; opacity: 0.8;\">Tap to enable fullscreen</div>\n        `;\n        \n        // Add click handler to enter fullscreen\n        prompt.addEventListener('click', () => {\n            this.enterFullscreen();\n            prompt.remove();\n        });\n        \n        // Auto-remove after 5 seconds\n        setTimeout(() => {\n            if (prompt.parentNode) {\n                prompt.remove();\n            }\n            this.fullscreenPromptShown = false;\n        }, 5000);\n        \n        document.body.appendChild(prompt);\n    }\n\n    // Try to enter fullscreen on user interaction if wanted\n    tryEnterFullscreenOnInteraction() {\n        if (this.wantsFullscreen && !this.isFullscreen && \n            this.currentOrientation === 'landscape' && \n            this.isAutoFullscreenEnabled()) {\n            this.enterFullscreen().then(success => {\n                if (success) {\n                    this.wantsFullscreen = false; // Reset flag on success\n                }\n            });\n        }\n    }\n\n    // Reset fullscreen prompt state (useful for debugging)\n    resetFullscreenPrompt() {\n        this.fullscreenPromptShown = false;\n        this.wantsFullscreen = false;\n        console.log('📱 Fullscreen prompt state reset');\n    }\n\n    // Detect if device is mobile\n    detectMobile() {\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || \n               ('ontouchstart' in window) || \n               (navigator.maxTouchPoints > 0) ||\n               window.innerWidth <= 768;\n        \n\n        \n        return isMobile;\n    }\n\n    // Setup touch listeners for mobile controls\n    setupTouchListeners() {\n\n        \n        // Touch start handler\n        const handleTouchStart = (event) => {\n            // Don't interfere with UI elements\n            if (event.target.closest('#ui-container')) {\n                return;\n            }\n            \n            // Only prevent default for game canvas area to avoid blocking UI scrolling\n            if (event.target === this.canvas || event.target.closest('#renderCanvas')) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            \n            if (event.touches.length === 1) {\n                const touch = event.touches[0];\n                this.touchOrigin.x = touch.clientX;\n                this.touchOrigin.y = touch.clientY;\n                this.touchCurrent.x = touch.clientX;\n                this.touchCurrent.y = touch.clientY;\n                this.touchActive = true;\n                \n                // Try to enter fullscreen on user interaction (if landscape)\n                this.tryEnterFullscreenOnInteraction();\n                \n                this.notifyListeners('touchstart', {\n                    x: touch.clientX,\n                    y: touch.clientY,\n                    originalEvent: event\n                });\n            }\n        };\n        \n        // Touch start - add to multiple targets\n        this.canvas.addEventListener('touchstart', handleTouchStart, { passive: false });\n        document.body.addEventListener('touchstart', handleTouchStart, { passive: false });\n\n        // Touch move handler\n        const handleTouchMove = (event) => {\n            // Don't interfere with UI elements\n            if (event.target.closest('#ui-container')) {\n                return;\n            }\n            \n            // Only prevent default for game canvas area to avoid blocking UI scrolling\n            if (event.target === this.canvas || event.target.closest('#renderCanvas')) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            \n            if (event.touches.length === 1 && this.touchActive) {\n                const touch = event.touches[0];\n                this.touchCurrent.x = touch.clientX;\n                this.touchCurrent.y = touch.clientY;\n                \n                // Calculate movement vector relative to origin\n                const deltaX = this.touchCurrent.x - this.touchOrigin.x;\n                const deltaY = this.touchCurrent.y - this.touchOrigin.y;\n                \n                // Normalize movement based on screen size and sensitivity\n                // Invert X to match game logic (Q/D mapping) and Y for game coordinates\n                this.touchMovement.x = -deltaX * this.touchSensitivity;\n                this.touchMovement.y = -deltaY * this.touchSensitivity;\n                \n\n                \n                this.notifyListeners('touchmove', {\n                    x: touch.clientX,\n                    y: touch.clientY,\n                    deltaX,\n                    deltaY,\n                    normalizedX: this.touchMovement.x,\n                    normalizedY: this.touchMovement.y,\n                    originalEvent: event\n                });\n            }\n        };\n        \n        // Touch move - add to multiple targets\n        this.canvas.addEventListener('touchmove', handleTouchMove, { passive: false });\n        document.body.addEventListener('touchmove', handleTouchMove, { passive: false });\n\n        // Touch end handler\n        const handleTouchEnd = (event) => {\n            // Don't interfere with UI elements\n            if (event.target.closest('#ui-container')) {\n                return;\n            }\n            \n            // Only prevent default for game canvas area to avoid blocking UI scrolling\n            if (event.target === this.canvas || event.target.closest('#renderCanvas')) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            \n            if (event.touches.length === 0) {\n                this.touchActive = false;\n                this.touchMovement.x = 0;\n                this.touchMovement.y = 0;\n                \n                this.notifyListeners('touchend', {\n                    originalEvent: event\n                });\n            }\n        };\n        \n        // Touch end - add to multiple targets\n        this.canvas.addEventListener('touchend', handleTouchEnd, { passive: false });\n        document.body.addEventListener('touchend', handleTouchEnd, { passive: false });\n\n        // Touch cancel handler\n        const handleTouchCancel = (event) => {\n            // Don't interfere with UI elements\n            if (event.target.closest('#ui-container')) {\n                return;\n            }\n            \n            // Only prevent default for game canvas area to avoid blocking UI scrolling\n            if (event.target === this.canvas || event.target.closest('#renderCanvas')) {\n                event.preventDefault();\n                event.stopPropagation();\n            }\n            \n            this.touchActive = false;\n            this.touchMovement.x = 0;\n            this.touchMovement.y = 0;\n            \n            this.notifyListeners('touchcancel', {\n                originalEvent: event\n            });\n        };\n        \n        // Touch cancel - add to multiple targets\n        this.canvas.addEventListener('touchcancel', handleTouchCancel, { passive: false });\n        document.body.addEventListener('touchcancel', handleTouchCancel, { passive: false });\n        \n        // Add global touch event prevention to avoid interference\n        document.addEventListener('touchstart', (event) => {\n            // Don't log every global touch to avoid spam\n        }, { passive: false });\n        \n        document.addEventListener('touchmove', (event) => {\n            // Don't log every global touch to avoid spam\n        }, { passive: false });\n        \n\n        \n\n    }\n\n    \n\n    // Register input event listener\n    addEventListener(eventType, callback, priority = 100) {\n        if (!this.inputListeners.has(eventType)) {\n            this.inputListeners.set(eventType, []);\n        }\n\n        const listeners = this.inputListeners.get(eventType);\n        listeners.push({ callback, priority });\n\n        // Sort by priority (lower number = higher priority)\n        listeners.sort((a, b) => a.priority - b.priority);\n    }\n\n    // Remove input event listener\n    removeEventListener(eventType, callback) {\n        if (this.inputListeners.has(eventType)) {\n            const listeners = this.inputListeners.get(eventType);\n            const index = listeners.findIndex(listener => listener.callback === callback);\n            if (index > -1) {\n                listeners.splice(index, 1);\n            }\n        }\n    }\n\n    // Notify all listeners of an input event\n    notifyListeners(eventType, eventData) {\n        if (this.inputListeners.has(eventType)) {\n            const listeners = this.inputListeners.get(eventType);\n            for (const listener of listeners) {\n                try {\n                    // If listener returns true, stop propagation\n                    if (listener.callback(eventData) === true) {\n                        break;\n                    }\n                } catch (error) {\n                    console.error(`❌ Error in input listener for ${eventType}:`, error);\n                }\n            }\n        }\n    }\n\n    // Key state queries\n    isKeyPressed(key) {\n        return this.keys.get(key.toLowerCase()) || false;\n    }\n\n    isKeyReleased(key) {\n        return !this.isKeyPressed(key);\n    }\n\n    // Mouse state queries\n    isMouseButtonPressed(button = 0) {\n        return this.mouseButtons.get(button) || false;\n    }\n\n    getMousePosition() {\n        return { ...this.mousePosition };\n    }\n\n    // Movement input helpers\n    getMovementInput() {\n        return {\n            forward: this.isKeyPressed('z') || this.isKeyPressed('w') || this.isKeyPressed('arrowup'),\n            backward: this.isKeyPressed('s') || this.isKeyPressed('arrowdown'),\n            left: this.isKeyPressed('q') || this.isKeyPressed('a') || this.isKeyPressed('arrowleft'),\n            right: this.isKeyPressed('d') || this.isKeyPressed('arrowright'),\n            up: this.isKeyPressed(' '), // spacebar\n            down: this.isKeyPressed('shift')\n        };\n    }\n\n    // Get ZQSD input vector (French AZERTY layout) + Arrow keys + Touch controls\n    getMovementVector() {\n        // Keyboard input\n        const keyboardX = (this.isKeyPressed('q') || this.isKeyPressed('a') || this.isKeyPressed('arrowleft') ? 1 : 0) - (this.isKeyPressed('d') || this.isKeyPressed('arrowright') ? 1 : 0);\n        const keyboardY = (this.isKeyPressed('z') || this.isKeyPressed('w') || this.isKeyPressed('arrowup') ? 1 : 0) - (this.isKeyPressed('s') || this.isKeyPressed('arrowdown') ? 1 : 0);\n        \n        // Touch input (only if mobile and touch is active)\n        let touchX = 0;\n        let touchY = 0;\n        \n        if ((this.isMobile || true) && this.touchActive) { // Force enable for testing\n            touchX = Math.max(-1, Math.min(1, this.touchMovement.x));\n            touchY = Math.max(-1, Math.min(1, this.touchMovement.y));\n        }\n        \n        // Combine keyboard and touch input (keyboard takes priority)\n        const result = {\n            x: keyboardX !== 0 ? keyboardX : touchX,\n            y: keyboardY !== 0 ? keyboardY : touchY\n        };\n        \n\n        \n        return result;\n    }\n\n    // Touch control utilities\n    isTouchActive() {\n        return this.touchActive;\n    }\n\n    getTouchMovement() {\n        return { ...this.touchMovement };\n    }\n\n    getTouchOrigin() {\n        return { ...this.touchOrigin };\n    }\n\n    getTouchCurrent() {\n        return { ...this.touchCurrent };\n    }\n\n    // Check if device is mobile\n    isMobileDevice() {\n        return this.isMobile;\n    }\n\n    // Check if a key is a game control key\n    isGameKey(key) {\n        const gameKeys = [\n            'z', 'q', 's', 'd', 'w', 'a', // Movement\n            'arrowup', 'arrowdown', 'arrowleft', 'arrowright', // Arrow keys\n            '1', '2', '3', '4', '5', '6', '7', // Masks\n            'escape', ' ', 'shift', 'control', 'alt' // Special keys\n        ];\n        return gameKeys.includes(key);\n    }\n\n    // Focus management\n    focusCanvas() {\n        if (this.canvas) {\n            this.canvas.focus();\n        }\n    }\n\n    // Clear all input states (useful for game state changes)\n    clearInputStates() {\n        this.keys.clear();\n        this.mouseButtons.clear();\n        this.clearTouchStates();\n        console.log('🎮 Input states cleared');\n    }\n\n    // Clear touch states\n    clearTouchStates() {\n        this.touchActive = false;\n        this.touchMovement.x = 0;\n        this.touchMovement.y = 0;\n        this.touchOrigin.x = 0;\n        this.touchOrigin.y = 0;\n        this.touchCurrent.x = 0;\n        this.touchCurrent.y = 0;\n    }\n\n    // Get current input summary for debugging\n    getInputSummary() {\n        const pressedKeys = [];\n        for (const [key, pressed] of this.keys) {\n            if (pressed) pressedKeys.push(key);\n        }\n\n        const pressedButtons = [];\n        for (const [button, pressed] of this.mouseButtons) {\n            if (pressed) pressedButtons.push(button);\n        }\n\n        return {\n            pressedKeys,\n            pressedButtons,\n            mousePosition: this.mousePosition,\n            touchActive: this.touchActive,\n            touchMovement: this.touchMovement,\n            touchOrigin: this.touchOrigin,\n            touchCurrent: this.touchCurrent,\n            isMobile: this.isMobile,\n            orientation: this.currentOrientation,\n            isFullscreen: this.isFullscreen,\n            wantsFullscreen: this.wantsFullscreen,\n            autoFullscreenEnabled: this.isAutoFullscreenEnabled(),\n            fullscreenPromptShown: this.fullscreenPromptShown,\n            totalListeners: this.inputListeners.size\n        };\n    }\n\n    // Cleanup\n    shutdown() {\n        // Clear input states\n        this.clearInputStates();\n        \n        // Clear all event listeners\n        this.inputListeners.clear();\n\n        console.log('🎮 Input Manager shutdown');\n    }\n} ","// core/GameEngine.js - Game engine with separated responsibilities\nimport { SceneManager } from './SceneManager.js';\nimport { SystemManager } from './SystemManager.js';\nimport { InputManager } from './InputManager.js';\nimport { serviceContainer } from './ServiceContainer.js';\nimport { params } from '../params.js';\n\nexport class GameEngine {\n    constructor() {\n        this.sceneManager = null;\n        this.systemManager = null;\n        this.inputManager = null;\n        this.isRunning = false;\n        this.clock = new THREE.Clock();\n        \n        this.setupServices();\n    }\n\n    setupServices() {\n        // Register core services in the container\n        serviceContainer.registerInstance('gameEngine', this);\n        serviceContainer.registerSingleton('sceneManager', SceneManager);\n        serviceContainer.registerSingleton('systemManager', SystemManager);\n        serviceContainer.registerSingleton('inputManager', InputManager);\n        \n        // Resolve services\n        this.sceneManager = serviceContainer.resolve('sceneManager');\n        this.systemManager = serviceContainer.resolve('systemManager');\n        this.inputManager = serviceContainer.resolve('inputManager');\n    }\n\n    async initialize() {\n        console.log('🎮 Initializing Game Engine...');\n        \n        // Initialize core systems in order\n        await this.sceneManager.initialize();\n        await this.inputManager.initialize();\n        await this.systemManager.initialize(this.sceneManager);\n        \n        // Register game systems (will be done by main.js)\n        await this.registerGameSystems();\n        \n        this.isRunning = true;\n        \n        this.gameLoop();\n        \n        console.log('🎮 Game Engine initialized');\n    }\n\n    async registerGameSystems() {\n        // This method will be called by main.js to register all game systems\n        // Keeping it here for extensibility\n        console.log('📋 Game systems will be registered by main application');\n    }\n\n    gameLoop() {\n        if (!this.isRunning) return;\n        \n        const rawDeltaTime = this.clock.getDelta();\n        // Cap deltaTime to prevent physics issues when page loses focus\n        const deltaTime = Math.min(rawDeltaTime, params.MAX_DELTA_TIME);\n        \n        // Update all systems through system manager\n        this.systemManager.update(deltaTime);\n        \n        // Update camera (could be moved to a camera system later)\n        const playerSystem = this.systemManager.getSystem('player');\n        if (playerSystem && playerSystem.getPlayerPosition) {\n            this.sceneManager.updateCamera(playerSystem.getPlayerPosition());\n        }\n        \n        // Billboard NPCs\n        const npcSystem = this.systemManager.getSystem('npc');\n        const camera = this.sceneManager.camera;\n        if (npcSystem && camera) {\n            const npcs = npcSystem.getNPCs();\n            for (const npc of npcs) {\n                if (npc.renderer && npc.renderer.mesh) {\n                    npc.renderer.mesh.quaternion.copy(camera.quaternion);\n                }\n            }\n        }\n        \n        // Render\n        this.sceneManager.render();\n        \n        // Continue loop\n        requestAnimationFrame(() => this.gameLoop());\n    }\n\n    // System management helpers\n    registerSystem(name, system, priority = 100) {\n        this.systemManager.registerSystem(name, system, priority);\n    }\n\n    getSystem(name) {\n        return this.systemManager.getSystem(name);\n    }\n\n    // Game state management\n    notifyGameStateChange(newState) {\n        this.systemManager.notifyGameStateChange(newState);\n    }\n\n    notifyPlayerAction(action) {\n        this.systemManager.notifyPlayerAction(action);\n    }\n\n    // Input management helpers\n    addEventListener(eventType, callback, priority = 100) {\n        this.inputManager.addEventListener(eventType, callback, priority);\n    }\n\n    removeEventListener(eventType, callback) {\n        this.inputManager.removeEventListener(eventType, callback);\n    }\n\n    // Scene management helpers\n    getScene() {\n        return this.sceneManager.getScene();\n    }\n\n    getPlanet() {\n        return this.sceneManager.getPlanet();\n    }\n\n    addToScene(object) {\n        this.sceneManager.addObject(object);\n    }\n\n    removeFromScene(object) {\n        this.sceneManager.removeObject(object);\n    }\n\n    // Service container access\n    getService(name) {\n        return serviceContainer.resolve(name);\n    }\n\n    registerService(name, config) {\n        serviceContainer.register(name, config);\n    }\n\n    // Engine control\n    pause() {\n        this.isRunning = false;\n        console.log('⏸️ Game Engine paused');\n    }\n\n    resume() {\n        if (!this.isRunning) {\n            this.isRunning = true;\n            this.clock.start();\n            this.gameLoop();\n            console.log('▶️ Game Engine resumed');\n        }\n    }\n\n    shutdown() {\n        console.log('🎮 Shutting down Game Engine...');\n        \n        this.isRunning = false;\n        \n        // Shutdown systems in reverse order\n        this.systemManager.shutdown();\n        this.inputManager.shutdown();\n        this.sceneManager.shutdown();\n        \n        // Clear service container\n        serviceContainer.clear();\n        \n        console.log('🎮 Game Engine shutdown complete');\n    }\n\n    // Debug information\n    getEngineStats() {\n        return {\n            isRunning: this.isRunning,\n            systems: this.systemManager.getSystemStats(),\n            services: serviceContainer.getStats()\n        };\n    }\n} ","// interfaces/GameEvents.js - Game event definitions and constants\r\n\r\n/**\r\n * Game Event Types - Centralized event constants\r\n */\r\nexport const GameEventTypes = {\r\n    // Player events\r\n    PLAYER_MOVE: 'player.move',\r\n    PLAYER_MASK_CHANGE: 'player.mask.change',\r\n    PLAYER_ENERGY_CHANGE: 'player.energy.change',\r\n    PLAYER_TELEPORT: 'player.teleport',\r\n    PLAYER_INTERACTION: 'player.interaction',\r\n\r\n    // Game state events\r\n    GAME_STATE_CHANGE: 'gameState.change',\r\n    GAME_OUTRAGE_CHANGE: 'gameState.outrage.change',\r\n    GAME_ENERGY_CHANGE: 'gameState.energy.change',\r\n    GAME_TIMER_UPDATE: 'gameState.timer.update',\r\n    GAME_OVER: 'gameState.gameOver',\r\n    GAME_WIN: 'gameState.win',\r\n    GAME_RESET: 'gameState.reset',\r\n\r\n    // NPC events\r\n    NPC_SPAWN: 'npc.spawn',\r\n    NPC_DESPAWN: 'npc.despawn',\r\n    NPC_STATE_CHANGE: 'npc.state.change',\r\n    NPC_INTERACTION: 'npc.interaction',\r\n    NPC_FLOCKING_UPDATE: 'npc.flocking.update',\r\n\r\n    // Police events\r\n    POLICE_ACTIVATE: 'police.activate',\r\n    POLICE_DEACTIVATE: 'police.deactivate',\r\n    POLICE_PURSUIT: 'police.pursuit',\r\n    POLICE_CATCH_PLAYER: 'police.catch',\r\n\r\n    // UI events\r\n    UI_BUTTON_CLICK: 'ui.button.click',\r\n    UI_MASK_SELECT: 'ui.mask.select',\r\n    UI_TOGGLE_DEBUG: 'ui.debug.toggle',\r\n    UI_HUD_UPDATE: 'ui.hud.update',\r\n\r\n    // System events\r\n    SYSTEM_INITIALIZE: 'system.initialize',\r\n    SYSTEM_SHUTDOWN: 'system.shutdown',\r\n    SYSTEM_ERROR: 'system.error',\r\n\r\n    // Scene events\r\n    SCENE_BACKGROUND_CHANGE: 'scene.background.change',\r\n    SCENE_CAMERA_UPDATE: 'scene.camera.update',\r\n\r\n    // Input events\r\n    INPUT_KEY_DOWN: 'input.key.down',\r\n    INPUT_KEY_UP: 'input.key.up',\r\n    INPUT_MOUSE_CLICK: 'input.mouse.click',\r\n    INPUT_MOVEMENT: 'input.movement'\r\n};\r\n\r\n/**\r\n * Event Data Structures\r\n */\r\n\r\n// Player event data\r\nexport class PlayerMoveEventData {\r\n    constructor(oldPosition, newPosition, velocity) {\r\n        this.oldPosition = oldPosition;\r\n        this.newPosition = newPosition;\r\n        this.velocity = velocity;\r\n    }\r\n}\r\n\r\nexport class PlayerMaskChangeEventData {\r\n    constructor(oldMask, newMask, energyCost) {\r\n        this.oldMask = oldMask;\r\n        this.newMask = newMask;\r\n        this.energyCost = energyCost;\r\n    }\r\n}\r\n\r\nexport class PlayerEnergyChangeEventData {\r\n    constructor(oldEnergy, newEnergy, change, reason) {\r\n        this.oldEnergy = oldEnergy;\r\n        this.newEnergy = newEnergy;\r\n        this.change = change;\r\n        this.reason = reason;\r\n    }\r\n}\r\n\r\nexport class PlayerInteractionEventData {\r\n    constructor(interactionType, targetId, targetType, distance, result) {\r\n        this.interactionType = interactionType;\r\n        this.targetId = targetId;\r\n        this.targetType = targetType;\r\n        this.distance = distance;\r\n        this.result = result;\r\n    }\r\n}\r\n\r\n// Game state event data\r\nexport class GameStateChangeEventData {\r\n    constructor(property, oldValue, newValue, context) {\r\n        this.property = property;\r\n        this.oldValue = oldValue;\r\n        this.newValue = newValue;\r\n        this.context = context;\r\n    }\r\n}\r\n\r\nexport class GameOutrageChangeEventData {\r\n    constructor(oldOutrage, newOutrage, change, reason) {\r\n        this.oldOutrage = oldOutrage;\r\n        this.newOutrage = newOutrage;\r\n        this.change = change;\r\n        this.reason = reason;\r\n    }\r\n}\r\n\r\nexport class GameOverEventData {\r\n    constructor(reason, finalScore, gameTime, stats) {\r\n        this.reason = reason;\r\n        this.finalScore = finalScore;\r\n        this.gameTime = gameTime;\r\n        this.stats = stats;\r\n    }\r\n}\r\n\r\n// NPC event data\r\nexport class NPCSpawnEventData {\r\n    constructor(npcId, npcType, position, maskType, groupId) {\r\n        this.npcId = npcId;\r\n        this.npcType = npcType;\r\n        this.position = position;\r\n        this.maskType = maskType;\r\n        this.groupId = groupId;\r\n    }\r\n}\r\n\r\nexport class NPCStateChangeEventData {\r\n    constructor(npcId, oldState, newState, reason) {\r\n        this.npcId = npcId;\r\n        this.oldState = oldState;\r\n        this.newState = newState;\r\n        this.reason = reason;\r\n    }\r\n}\r\n\r\nexport class NPCInteractionEventData {\r\n    constructor(npcId, interactionType, targetId, targetType, influence, result) {\r\n        this.npcId = npcId;\r\n        this.interactionType = interactionType;\r\n        this.targetId = targetId;\r\n        this.targetType = targetType;\r\n        this.influence = influence;\r\n        this.result = result;\r\n    }\r\n}\r\n\r\n// Police event data\r\nexport class PoliceActivateEventData {\r\n    constructor(outrageLevel, droneCount, activationReason) {\r\n        this.outrageLevel = outrageLevel;\r\n        this.droneCount = droneCount;\r\n        this.activationReason = activationReason;\r\n    }\r\n}\r\n\r\nexport class PolicePursuitEventData {\r\n    constructor(droneId, targetId, distance, pursuitSpeed) {\r\n        this.droneId = droneId;\r\n        this.targetId = targetId;\r\n        this.distance = distance;\r\n        this.pursuitSpeed = pursuitSpeed;\r\n    }\r\n}\r\n\r\n// UI event data\r\nexport class UIButtonClickEventData {\r\n    constructor(buttonId, buttonType, context) {\r\n        this.buttonId = buttonId;\r\n        this.buttonType = buttonType;\r\n        this.context = context;\r\n    }\r\n}\r\n\r\nexport class UIMaskSelectEventData {\r\n    constructor(maskType, previousMask, energyCost) {\r\n        this.maskType = maskType;\r\n        this.previousMask = previousMask;\r\n        this.energyCost = energyCost;\r\n    }\r\n}\r\n\r\n// System event data\r\nexport class SystemEventData {\r\n    constructor(systemName, action, status, details) {\r\n        this.systemName = systemName;\r\n        this.action = action;\r\n        this.status = status;\r\n        this.details = details;\r\n    }\r\n}\r\n\r\nexport class SystemErrorEventData {\r\n    constructor(systemName, error, context) {\r\n        this.systemName = systemName;\r\n        this.error = error;\r\n        this.context = context;\r\n    }\r\n}\r\n\r\n// Input event data\r\nexport class InputEventData {\r\n    constructor(inputType, key, value, modifiers) {\r\n        this.inputType = inputType;\r\n        this.key = key;\r\n        this.value = value;\r\n        this.modifiers = modifiers;\r\n    }\r\n}\r\n\r\nexport class InputMovementEventData {\r\n    constructor(direction, magnitude, deltaTime) {\r\n        this.direction = direction;\r\n        this.magnitude = magnitude;\r\n        this.deltaTime = deltaTime;\r\n    }\r\n}\r\n\r\n/**\r\n * Event Validation Utilities\r\n */\r\nexport class EventValidator {\r\n    static validateEventType(eventType) {\r\n        const validTypes = Object.values(GameEventTypes);\r\n        return validTypes.includes(eventType);\r\n    }\r\n\r\n    static validateEventData(eventType, data) {\r\n        // Add specific validation logic for each event type\r\n        switch (eventType) {\r\n            case GameEventTypes.PLAYER_MASK_CHANGE:\r\n                return data instanceof PlayerMaskChangeEventData;\r\n            case GameEventTypes.GAME_STATE_CHANGE:\r\n                return data instanceof GameStateChangeEventData;\r\n            case GameEventTypes.NPC_SPAWN:\r\n                return data instanceof NPCSpawnEventData;\r\n            // Add more validations as needed\r\n            default:\r\n                return true; // Allow any data for unknown event types\r\n        }\r\n    }\r\n\r\n    static createValidatedEvent(eventType, data, source) {\r\n        if (!this.validateEventType(eventType)) {\r\n            throw new Error(`Invalid event type: ${eventType}`);\r\n        }\r\n\r\n        if (!this.validateEventData(eventType, data)) {\r\n            console.warn(`Invalid event data for type: ${eventType}`, data);\r\n        }\r\n\r\n        return {\r\n            type: eventType,\r\n            data: data,\r\n            source: source,\r\n            timestamp: Date.now(),\r\n            id: Symbol()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Event Priority Constants\r\n */\r\nexport const EventPriorities = {\r\n    CRITICAL: 10,    // System critical events\r\n    HIGH: 25,        // Game state changes\r\n    NORMAL: 50,      // Standard gameplay events\r\n    LOW: 75,         // UI updates\r\n    BACKGROUND: 100  // Non-essential events\r\n};\r\n\r\n/**\r\n * Event Categories for middleware filtering\r\n */\r\nexport const EventCategories = {\r\n    PLAYER: 'player',\r\n    GAME_STATE: 'gameState',\r\n    NPC: 'npc',\r\n    POLICE: 'police',\r\n    UI: 'ui',\r\n    SYSTEM: 'system',\r\n    INPUT: 'input',\r\n    SCENE: 'scene'\r\n};\r\n\r\n/**\r\n * Helper function to get event category from event type\r\n */\r\nexport function getEventCategory(eventType) {\r\n    const parts = eventType.split('.');\r\n    return parts[0] || 'unknown';\r\n}\r\n\r\n/**\r\n * Helper function to create event data objects\r\n */\r\nexport const EventDataFactory = {\r\n    playerMove: (oldPos, newPos, velocity) => new PlayerMoveEventData(oldPos, newPos, velocity),\r\n    playerMaskChange: (oldMask, newMask, energyCost) => new PlayerMaskChangeEventData(oldMask, newMask, energyCost),\r\n    playerEnergyChange: (oldEnergy, newEnergy, change, reason) => new PlayerEnergyChangeEventData(oldEnergy, newEnergy, change, reason),\r\n    gameStateChange: (property, oldValue, newValue, context) => new GameStateChangeEventData(property, oldValue, newValue, context),\r\n    gameOutrageChange: (oldOutrage, newOutrage, change, reason) => new GameOutrageChangeEventData(oldOutrage, newOutrage, change, reason),\r\n    gameOver: (reason, finalScore, gameTime, stats) => new GameOverEventData(reason, finalScore, gameTime, stats),\r\n    npcSpawn: (npcId, npcType, position, maskType, groupId) => new NPCSpawnEventData(npcId, npcType, position, maskType, groupId),\r\n    npcStateChange: (npcId, oldState, newState, reason) => new NPCStateChangeEventData(npcId, oldState, newState, reason),\r\n    policeActivate: (outrageLevel, droneCount, reason) => new PoliceActivateEventData(outrageLevel, droneCount, reason),\r\n    systemError: (systemName, error, context) => new SystemErrorEventData(systemName, error, context)\r\n}; ","// systems/GameStateSystem.js - Game state management following SOLID principles\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\nimport { params } from '../params.js';\r\nimport { serviceContainer } from '../core/ServiceContainer.js';\r\nimport { GameEventTypes, EventDataFactory, EventPriorities } from '../interfaces/GameEvents.js';\r\n\r\nexport class GameStateSystem extends IGameSystem {\r\n    constructor() {\r\n        super('GameState');\r\n        \r\n        // Core meters\r\n        this.outrage = 0;           // 0-100%, triggers police at 90%\r\n        this.energy = 100;          // 0-100%, depletes over time\r\n        \r\n        // Score tracking\r\n        this.gameTime = 0;          // Total survival time\r\n        this.polarisedPeople = 0;   // People affected by masks\r\n        \r\n        // Game flow\r\n        this.isGameOver = false;\r\n        this.currentMask = null;    // null = neutral, 1-7 = mask types\r\n        \r\n        // Timers for win conditions\r\n        this.adultTimer = 0;        // Time with outrage < 10%\r\n        this.chaosTimer = 0;        // Time with outrage >= 100%\r\n        \r\n        // Player status\r\n        this.inCrowd = false;       // Whether player is in a crowd\r\n        this.inWrongCrowd = false;  // Whether player is in a wrong crowd (different mask majority)\r\n        this.isBeingChased = false; // Whether police is chasing\r\n        \r\n        // Event throttling to prevent spam\r\n        this.lastEventTime = {\r\n            outrage: 0,\r\n            energy: 0\r\n        };\r\n        this.eventThrottleInterval = 100; // 100ms minimum between events\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        console.log('🎮 Game State System initialized');\r\n    }\r\n\r\n    update(deltaTime) {\r\n        if (this.isGameOver) return;\r\n        \r\n        // Update game time\r\n        this.gameTime += deltaTime;\r\n        \r\n        // Energy depletion over time\r\n        /* if (this.currentMask !== null) {\r\n            this.addEnergy(-params.ENERGY_DEPLETION_RATE * deltaTime);\r\n            \r\n            // Force neutral if energy depleted\r\n            if (this.energy <= 0) {\r\n                this.setMask(null);\r\n            }\r\n        } */\r\n        \r\n        // Outrage management based on crowd status\r\n        if (this.inWrongCrowd) {\r\n            // Increase outrage when in wrong crowd\r\n            this.addOutrage(params.OUTRAGE_INCREASE_RATE * deltaTime);\r\n        } else if (!this.inCrowd) {\r\n            // Decay outrage when not in crowd\r\n            this.addOutrage(-params.OUTRAGE_DECAY_RATE * deltaTime);\r\n        }\r\n        // Note: No outrage change when in correct crowd (inCrowd && !inWrongCrowd)\r\n        \r\n        // Update win condition timers\r\n        this.updateWinConditionTimers(deltaTime);\r\n        \r\n        // Debug logging occasionally\r\n        if (Math.floor(this.gameTime * 10) % 50 === 0) {\r\n            this.logGameState();\r\n        }\r\n    }\r\n\r\n    shutdown() {\r\n        this.stateChangeListeners = [];\r\n        console.log('🎮 Game State System shutdown');\r\n    }\r\n\r\n    // State management methods\r\n    addOutrage(amount) {\r\n        const oldOutrage = this.outrage;\r\n        this.outrage = Math.min(100, Math.max(0, this.outrage + amount));\r\n        \r\n        if (oldOutrage !== this.outrage) {\r\n            // Throttle outrage events to prevent spam\r\n            const currentTime = Date.now();\r\n            if (currentTime - this.lastEventTime.outrage >= this.eventThrottleInterval) {\r\n                // Publish outrage change event\r\n                const eventData = EventDataFactory.gameOutrageChange(\r\n                    oldOutrage, \r\n                    this.outrage, \r\n                    amount, \r\n                    'outrage_change'\r\n                );\r\n                this.publishEvent(GameEventTypes.GAME_OUTRAGE_CHANGE, eventData);\r\n                \r\n                // Also publish general state change\r\n                const stateChangeData = EventDataFactory.gameStateChange(\r\n                    'outrage', \r\n                    oldOutrage, \r\n                    this.outrage, \r\n                    { change: amount }\r\n                );\r\n                this.publishEvent(GameEventTypes.GAME_STATE_CHANGE, stateChangeData);\r\n                \r\n                this.lastEventTime.outrage = currentTime;\r\n            }\r\n        }\r\n    }\r\n\r\n    addEnergy(amount) {\r\n        const oldEnergy = this.energy;\r\n        this.energy = Math.min(100, Math.max(0, this.energy + amount));\r\n        \r\n        if (oldEnergy !== this.energy) {\r\n            // Throttle energy events to prevent spam\r\n            const currentTime = Date.now();\r\n            if (currentTime - this.lastEventTime.energy >= this.eventThrottleInterval) {\r\n                // Publish energy change event\r\n                const eventData = EventDataFactory.playerEnergyChange(\r\n                    oldEnergy, \r\n                    this.energy, \r\n                    amount, \r\n                    'energy_change'\r\n                );\r\n                this.publishEvent(GameEventTypes.PLAYER_ENERGY_CHANGE, eventData);\r\n                \r\n                // Also publish general state change\r\n                const stateChangeData = EventDataFactory.gameStateChange(\r\n                    'energy', \r\n                    oldEnergy, \r\n                    this.energy, \r\n                    { change: amount }\r\n                );\r\n                this.publishEvent(GameEventTypes.GAME_STATE_CHANGE, stateChangeData);\r\n                \r\n                this.lastEventTime.energy = currentTime;\r\n            }\r\n        }\r\n    }\r\n\r\n    decreaseEnergy(amount) {\r\n        this.addEnergy(-amount);\r\n    }\r\n\r\n    setMask(maskType) {\r\n        const oldMask = this.currentMask;\r\n        this.currentMask = maskType;\r\n        \r\n        // Update scene background color based on mask\r\n        const sceneManager = serviceContainer.resolve('sceneManager');\r\n        if (sceneManager) {\r\n            sceneManager.setBackgroundFromMask(maskType);\r\n        }\r\n        \r\n        console.log(`🎭 Mask changed to: ${maskType || 'Neutral'}`);\r\n        \r\n        // Publish mask change event\r\n        const eventData = EventDataFactory.playerMaskChange(oldMask, maskType, 0);\r\n        this.publishEvent(GameEventTypes.PLAYER_MASK_CHANGE, eventData);\r\n        \r\n        // Also publish general state change\r\n        const stateChangeData = EventDataFactory.gameStateChange(\r\n            'mask', \r\n            oldMask, \r\n            maskType, \r\n            { reason: 'mask_change' }\r\n        );\r\n        this.publishEvent(GameEventTypes.GAME_STATE_CHANGE, stateChangeData);\r\n    }\r\n\r\n    // Helper method to notify about state changes\r\n    notifyStateChange(property, newValue, oldValue, metadata = {}) {\r\n        const stateChangeData = EventDataFactory.gameStateChange(\r\n            property,\r\n            oldValue,\r\n            newValue,\r\n            metadata\r\n        );\r\n        this.publishEvent(GameEventTypes.GAME_STATE_CHANGE, stateChangeData);\r\n    }\r\n\r\n    setInCrowd(inCrowd) {\r\n        if (this.inCrowd !== inCrowd) {\r\n            this.inCrowd = inCrowd;\r\n            this.notifyStateChange('inCrowd', inCrowd, !inCrowd);\r\n        }\r\n    }\r\n\r\n    setInWrongCrowd(inWrongCrowd) {\r\n        if (this.inWrongCrowd !== inWrongCrowd) {\r\n            this.inWrongCrowd = inWrongCrowd;\r\n            this.notifyStateChange('inWrongCrowd', inWrongCrowd, !inWrongCrowd);\r\n        }\r\n    }\r\n\r\n    setBeingChased(isChased) {\r\n        if (this.isBeingChased !== isChased) {\r\n            this.isBeingChased = isChased;\r\n            this.notifyStateChange('beingChased', isChased, !isChased);\r\n        }\r\n    }\r\n\r\n    addPolarisedPeople(count) {\r\n        this.polarisedPeople += count;\r\n        this.notifyStateChange('polarisedPeople', this.polarisedPeople, this.polarisedPeople - count);\r\n    }\r\n\r\n    // Game end methods\r\n    endGame(reason) {\r\n        if (!this.isGameOver) {\r\n            this.isGameOver = true;\r\n            this.notifyStateChange('gameOver', { reason, score: this.getScore() });\r\n            console.log(`🎭 Game Over: ${reason} - Score: ${this.getScore()}`);\r\n        }\r\n    }\r\n\r\n    reset() {\r\n        const oldState = this.getFullState();\r\n        \r\n        this.outrage = 0;\r\n        this.energy = 100;\r\n        this.gameTime = 0;\r\n        this.polarisedPeople = 0;\r\n        this.isGameOver = false;\r\n        this.currentMask = null;\r\n        this.adultTimer = 0;\r\n        this.chaosTimer = 0;\r\n        this.inCrowd = false;\r\n        this.inWrongCrowd = false;\r\n        this.isBeingChased = false;\r\n        \r\n        this.notifyStateChange('reset', this.getFullState(), oldState);\r\n        console.log('🔄 Game state reset');\r\n    }\r\n\r\n    // Score calculation\r\n    getScore() {\r\n        return Math.floor(\r\n            this.gameTime * params.SCORE_ALPHA + \r\n            this.polarisedPeople * params.SCORE_BETA\r\n        );\r\n    }\r\n\r\n    // Win condition checking\r\n    updateWinConditionTimers(deltaTime) {\r\n        // Adult timer: outrage < 10% for 3 minutes\r\n        if (this.outrage < params.ADULT_OUTRAGE_THRESHOLD) {\r\n            this.adultTimer += deltaTime;\r\n            if (this.adultTimer >= params.ADULT_TIME_REQUIRED) {\r\n                this.endGame('ADULT');\r\n                return;\r\n            }\r\n        } else {\r\n            this.adultTimer = 0;\r\n        }\r\n        \r\n        // Chaos timer: outrage >= 100% for 30 seconds\r\n        if (this.outrage >= params.CHAOS_OUTRAGE_THRESHOLD) {\r\n            this.chaosTimer += deltaTime;\r\n            if (this.chaosTimer >= params.CHAOS_TIME_REQUIRED) {\r\n                this.endGame('CHAOS');\r\n                return;\r\n            }\r\n        } else {\r\n            this.chaosTimer = 0;\r\n        }\r\n    }\r\n\r\n    // State queries\r\n    canReturnToNeutral() {\r\n        return !this.isBeingChased && !this.inWrongCrowd;\r\n    }\r\n\r\n    getFullState() {\r\n        return {\r\n            outrage: this.outrage,\r\n            energy: this.energy,\r\n            gameTime: this.gameTime,\r\n            polarisedPeople: this.polarisedPeople,\r\n            isGameOver: this.isGameOver,\r\n            currentMask: this.currentMask,\r\n            adultTimer: this.adultTimer,\r\n            chaosTimer: this.chaosTimer,\r\n            inCrowd: this.inCrowd,\r\n            inWrongCrowd: this.inWrongCrowd,\r\n            isBeingChased: this.isBeingChased,\r\n            score: this.getScore()\r\n        };\r\n    }\r\n\r\n    // Event system - Legacy compatibility methods\r\n    addEventListener(callback) {\r\n        // Convert legacy listener to new event system\r\n        console.warn('🔄 Using legacy addEventListener, consider migrating to new event system');\r\n        this.subscribeToEvent(GameEventTypes.GAME_STATE_CHANGE, (event) => {\r\n            // Convert new event format to legacy format\r\n            const legacyEvent = {\r\n                property: event.data.property,\r\n                newValue: event.data.newValue,\r\n                oldValue: event.data.oldValue,\r\n                timestamp: event.timestamp,\r\n                gameTime: this.gameTime\r\n            };\r\n            callback(legacyEvent);\r\n        });\r\n    }\r\n\r\n    removeEventListener(callback) {\r\n        console.warn('🔄 Legacy removeEventListener not fully supported, use unsubscribe function instead');\r\n        // This would require tracking callback mappings, which is complex\r\n        // Better to use the new event system's unsubscribe functions\r\n    }\r\n\r\n    // Debug logging\r\n    logGameState() {\r\n        console.log(\r\n            `⏱️  Time: ${this.gameTime.toFixed(1)}s | ` +\r\n            `Outrage: ${this.outrage.toFixed(1)}% | ` +\r\n            `Energy: ${this.energy.toFixed(1)}% | ` +\r\n            `Score: ${this.getScore()}`\r\n        );\r\n    }\r\n\r\n    // IGameSystem implementation\r\n    onPlayerAction(action) {\r\n        switch (action.type) {\r\n            case 'maskChange':\r\n                this.setMask(action.maskType);\r\n                break;\r\n            case 'crowdInteraction':\r\n                this.setInCrowd(action.inCrowd);\r\n                if (action.polarisedCount) {\r\n                    this.addPolarisedPeople(action.polarisedCount);\r\n                }\r\n                break;\r\n        }\r\n    }\r\n} ","// components/Transform.js - Transform component following SRP\r\nexport class Transform {\r\n    constructor(position = new THREE.Vector3(), rotation = new THREE.Quaternion()) {\r\n        this.position = position.clone();\r\n        this.rotation = rotation.clone();\r\n        this.scale = new THREE.Vector3(1, 1, 1);\r\n        this.velocity = new THREE.Vector3();\r\n        this.acceleration = new THREE.Vector3();\r\n    }\r\n\r\n    // Position methods\r\n    setPosition(x, y, z) {\r\n        this.position.set(x, y, z);\r\n    }\r\n\r\n    translate(offset) {\r\n        this.position.add(offset);\r\n    }\r\n\r\n    // Rotation methods\r\n    setRotation(quaternion) {\r\n        this.rotation.copy(quaternion);\r\n    }\r\n\r\n    rotateY(angle) {\r\n        const rotation = new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0, 1, 0), angle);\r\n        this.rotation.multiplyQuaternions(rotation, this.rotation);\r\n    }\r\n\r\n    // Physics methods\r\n    applyForce(force) {\r\n        this.acceleration.add(force);\r\n    }\r\n\r\n    updatePhysics(deltaTime) {\r\n        // Apply acceleration to velocity\r\n        this.velocity.addScaledVector(this.acceleration, deltaTime);\r\n        \r\n        // Apply velocity to position\r\n        this.position.addScaledVector(this.velocity, deltaTime);\r\n        \r\n        // Reset acceleration for next frame\r\n        this.acceleration.set(0, 0, 0);\r\n    }\r\n\r\n    // Utility methods\r\n    getWorldMatrix() {\r\n        const matrix = new THREE.Matrix4();\r\n        matrix.compose(this.position, this.rotation, this.scale);\r\n        return matrix;\r\n    }\r\n\r\n    distanceTo(otherTransform) {\r\n        return this.position.distanceTo(otherTransform.position);\r\n    }\r\n\r\n    lookAt(target) {\r\n        const direction = target.clone().sub(this.position).normalize();\r\n        const up = new THREE.Vector3(0, 1, 0);\r\n        const matrix = new THREE.Matrix4().lookAt(this.position, target, up);\r\n        this.rotation.setFromRotationMatrix(matrix);\r\n    }\r\n} ","// components/Renderer.js - Renderer component following SRP\r\nexport class Renderer {\r\n    constructor(geometry, material) {\r\n        this.geometry = geometry;\r\n        this.material = material;\r\n        this.mesh = null;\r\n        this.visible = true;\r\n        this.castShadow = true;\r\n        this.receiveShadow = true;\r\n    }\r\n\r\n    // Mesh management\r\n    createMesh(scene) {\r\n        if (this.mesh) {\r\n            this.destroyMesh();\r\n        }\r\n\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n        this.mesh.castShadow = this.castShadow;\r\n        this.mesh.receiveShadow = this.receiveShadow;\r\n        this.mesh.visible = this.visible;\r\n\r\n        if (scene) {\r\n            scene.add(this.mesh);\r\n        }\r\n\r\n        return this.mesh;\r\n    }\r\n\r\n    destroyMesh() {\r\n        if (this.mesh) {\r\n            if (this.mesh.parent) {\r\n                this.mesh.parent.remove(this.mesh);\r\n            }\r\n            this.mesh = null;\r\n        }\r\n    }\r\n\r\n    // Transform synchronization\r\n    updateTransform(transform) {\r\n        if (this.mesh) {\r\n            this.mesh.position.copy(transform.position);\r\n            this.mesh.quaternion.copy(transform.rotation);\r\n            this.mesh.scale.copy(transform.scale);\r\n        }\r\n    }\r\n\r\n    // Visibility control\r\n    show() {\r\n        this.visible = true;\r\n        if (this.mesh) {\r\n            this.mesh.visible = true;\r\n        }\r\n    }\r\n\r\n    hide() {\r\n        this.visible = false;\r\n        if (this.mesh) {\r\n            this.mesh.visible = false;\r\n        }\r\n    }\r\n\r\n    // Material management\r\n    setMaterial(material) {\r\n        this.material = material;\r\n        if (this.mesh) {\r\n            this.mesh.material = material;\r\n        }\r\n    }\r\n\r\n    // Color shortcuts\r\n    setColor(color) {\r\n        if (this.material && this.material.color) {\r\n            this.material.color.copy(color);\r\n        }\r\n    }\r\n\r\n    setEmissive(color, intensity = 0.2) {\r\n        if (this.material && this.material.emissive) {\r\n            this.material.emissive.copy(color);\r\n            this.material.emissive.multiplyScalar(intensity);\r\n        }\r\n    }\r\n\r\n    // Cleanup\r\n    dispose() {\r\n        this.destroyMesh();\r\n        \r\n        if (this.geometry) {\r\n            this.geometry.dispose();\r\n        }\r\n        \r\n        if (this.material) {\r\n            this.material.dispose();\r\n        }\r\n    }\r\n} ","// systems/PlayerSystem.js - Player management following SOLID principles\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\nimport { Transform } from '../components/Transform.js';\nimport { Renderer } from '../components/Renderer.js';\nimport { params } from '../params.js';\nimport { serviceContainer } from '../core/ServiceContainer.js';\n\nexport class PlayerSystem extends IGameSystem {\n    constructor() {\n        super('Player');\n        \n        // Components\n        this.transform = new Transform();\n        this.renderer = null;\n        this.directionArrow = null; // Red arrow to show player direction\n        \n        // State\n        this.planetRadius = 0;\n        this.planet = null;\n        this.inputManager = null;\n        this.gameStateSystem = null;\n        \n        // Player properties\n        this.currentMask = null;\n        this.normal = new THREE.Vector3(0, 1, 0); // Persistent normal vector\n        this.lastMovementDirection = new THREE.Vector3(0, 0, 1); // Track last movement direction\n        \n        // Texture loading\n        this.textureLoader = new THREE.TextureLoader();\n        \n        // Debug UI\n        this.debugUI = null;\n        this.showDebugUI = false;\n    }\n\n    async initialize(sceneManager) {\n        // Get dependencies\n        this.inputManager = serviceContainer.resolve('inputManager');\n        this.planet = sceneManager.getPlanet();\n        this.planetRadius = sceneManager.getPlanetRadius();\n        \n        // Setup player position\n        const playerHeight = this.planetRadius + params.PLAYER_SIZE / 2;\n        this.transform.setPosition(0, playerHeight, 0);\n        \n        // Create player renderer\n        this.createPlayerRenderer(sceneManager.getScene());\n        \n        // Create direction arrow\n        this.createDirectionArrow(sceneManager.getScene());\n        \n        // Setup input handling\n        this.setupInputHandling();\n        \n        // Create debug UI\n        this.createDebugUI();\n        \n        console.log('🚶 Player System initialized');\n        console.log(`📍 Player position: ${this.transform.position.x}, ${this.transform.position.y}, ${this.transform.position.z}`);\n    }\n\n    // Texture helper - maps mask types to corresponding Joshua textures\n    getJoshuaTextureForMask(maskId) {\n        const textures = {\n            1: 'textures/sprites/joshua_conservative.png',    // Conservatives\n            2: 'textures/sprites/joshua_sjw.png',            // Social Justice\n            3: 'textures/sprites/joshua_libertarian.png',    // Libertarians\n            4: 'textures/sprites/joshua_nationalist.png',    // Nationalists\n            5: 'textures/sprites/joshua_culture.png',        // Culture\n            6: 'textures/sprites/joshua_religious.png',      // Religious\n            7: 'textures/sprites/joshua_antisystem.png'      // Antisystem\n        };\n        return textures[maskId] || 'textures/sprites/joshua_neutre.png'; // Fallback to neutral\n    }\n\n    updatePlayerGeometry() {\n        if (!this.renderer || !this.renderer.mesh) return;\n        \n        const texture = this.renderer.mesh.material.map;\n        if (!texture || !texture.image) return;\n        \n        // Get texture dimensions\n        const textureWidth = texture.image.width;\n        const textureHeight = texture.image.height;\n        \n        if (textureWidth === 0 || textureHeight === 0) return;\n        \n        // Calculate aspect ratio\n        const aspectRatio = textureWidth / textureHeight;\n        \n        // Calculate new dimensions while maintaining the base size\n        let width, height;\n        if (aspectRatio > 1) {\n            // Wider than tall\n            width = params.PLAYER_SIZE;\n            height = params.PLAYER_SIZE / aspectRatio;\n        } else {\n            // Taller than wide or square\n            width = params.PLAYER_SIZE * aspectRatio;\n            height = params.PLAYER_SIZE;\n        }\n        \n        // Create new geometry with correct aspect ratio\n        const newGeometry = new THREE.PlaneGeometry(width, height);\n        \n        // Update the mesh geometry\n        this.renderer.mesh.geometry.dispose(); // Clean up old geometry\n        this.renderer.mesh.geometry = newGeometry;\n        \n        console.log(`📐 Player geometry updated to preserve texture ratio (${textureWidth}x${textureHeight}, aspect: ${aspectRatio.toFixed(2)})`);\n    }\n\n    createPlayerRenderer(scene) {\n        // Load player texture (starts with neutral texture)\n        const texture = this.textureLoader.load('textures/sprites/joshua_neutre.png');\n        \n        // Wait for texture to load to get its dimensions\n        texture.onLoad = () => {\n            this.updatePlayerGeometry();\n        };\n        \n        // Create initial square geometry (will be updated when texture loads)\n        const geometry = new THREE.PlaneGeometry(params.PLAYER_SIZE, params.PLAYER_SIZE);\n        \n        const material = new THREE.MeshBasicMaterial({\n            map: texture,\n            transparent: true,\n            alphaTest: 0.5,\n            side: THREE.DoubleSide\n        });\n        \n        this.renderer = new Renderer(geometry, material);\n        this.renderer.createMesh(scene);\n        \n        // Enable shadow casting\n        if (this.renderer.mesh) {\n            this.renderer.mesh.castShadow = true;\n            this.renderer.mesh.receiveShadow = true;\n        }\n    }\n\n    createDirectionArrow(scene) {\n        // Create a proper arrow using THREE.ArrowHelper\n        const direction = new THREE.Vector3(0, 0, 1); // Initial direction\n        const origin = new THREE.Vector3(0, 0, 0);\n        const length = 0.8; // Arrow length\n        const color = 0xff0000; // Red color\n        \n        this.directionArrow = new THREE.ArrowHelper(direction, origin, length, color, 0.2, 0.1);\n        \n        // Hide the arrow by default\n        this.directionArrow.visible = false;\n        \n        // Position the arrow above the player\n        this.updateDirectionArrow();\n        \n        scene.add(this.directionArrow);\n        \n        console.log('🏹 Direction arrow created and added to scene (hidden by default)');\n    }\n\n    updatePlayerOrientation() {\n        if (!this.renderer || !this.renderer.mesh) return;\n        \n        // Get camera for orientation\n        const camera = serviceContainer.resolve('camera');\n        if (!camera) return;\n        \n        // Get the camera's up vector to ensure player is oriented correctly from camera's perspective\n        const cameraUp = new THREE.Vector3();\n        camera.getWorldDirection(cameraUp); // Get camera's forward direction\n        \n        // Calculate camera's actual up vector from its matrix\n        const cameraUpVector = new THREE.Vector3(0, 1, 0);\n        cameraUpVector.applyQuaternion(camera.quaternion);\n        \n        // Set the mesh \"up\" direction to match camera's up orientation\n        this.renderer.mesh.up.copy(cameraUpVector);\n        \n        // Make the player plane face the camera with correct up orientation\n        this.renderer.mesh.lookAt(camera.position);\n        \n        // Add tilt based on movement direction\n        if (this.lastMovementDirection && this.lastMovementDirection.length() > 0.01) {\n            const tiltAmount = 0.5; // Adjust this value to control tilt intensity (radians)\n            \n            // Get player's surface normal\n            const surfaceNormal = this.normal.clone();\n            \n            // Project movement direction onto the tangent plane\n            const movementDirection = this.lastMovementDirection.clone();\n            const movementDotNormal = movementDirection.dot(surfaceNormal);\n            movementDirection.addScaledVector(surfaceNormal, -movementDotNormal);\n            \n            if (movementDirection.length() > 0.01) {\n                movementDirection.normalize();\n                \n                // Get camera's forward direction (Z axis) to use as tilt axis\n                // This ensures rotation happens in the camera's XY plane\n                const cameraForward = new THREE.Vector3();\n                camera.getWorldDirection(cameraForward);\n                \n                // Use camera's forward direction as the tilt axis\n                const tiltAxis = cameraForward.clone();\n                \n                // Calculate tilt direction based on movement in camera's XY plane\n                // Get camera's right and up vectors\n                const cameraRight = new THREE.Vector3().setFromMatrixColumn(camera.matrixWorld, 0);\n                const cameraUp = new THREE.Vector3().setFromMatrixColumn(camera.matrixWorld, 1);\n                \n                // Project movement direction onto camera's XY plane\n                const movementInCameraSpace = new THREE.Vector3();\n                movementInCameraSpace.x = movementDirection.dot(cameraRight);\n                movementInCameraSpace.y = movementDirection.dot(cameraUp);\n                \n                // Calculate tilt angle based on horizontal movement (X component)\n                const tiltAngle = -movementInCameraSpace.x * tiltAmount; // Negative for correct direction\n                \n                // Apply tilt rotation around camera's Z axis\n                const tiltQuaternion = new THREE.Quaternion().setFromAxisAngle(tiltAxis, tiltAngle);\n                this.renderer.mesh.quaternion.multiply(tiltQuaternion);\n            }\n        }\n    }\n\n    updateDirectionArrow() {\n        if (!this.directionArrow) return;\n        \n        // Position the arrow above the player\n        const playerPosition = this.transform.position.clone();\n        const playerNormal = this.normal.clone();\n        \n        // Place arrow slightly above the player plane\n        const arrowPosition = playerPosition.clone().add(playerNormal.clone().multiplyScalar(0.4));\n        this.directionArrow.position.copy(arrowPosition);\n        \n        // Orient the arrow to show the last movement direction\n        // Project the movement direction onto the tangent plane at player position\n        const movementDirection = this.lastMovementDirection.clone();\n        const movementDotNormal = movementDirection.dot(playerNormal);\n        movementDirection.addScaledVector(playerNormal, -movementDotNormal);\n        \n        if (movementDirection.length() > 0.1) {\n            movementDirection.normalize();\n            this.directionArrow.setDirection(movementDirection);\n        }\n    }\n\n    setupInputHandling() {\n        // Register input listeners\n        this.inputManager.addEventListener('keydown', (event) => {\n            this.handleKeyDown(event.key);\n        }, 10); // High priority for player input\n    }\n\n    createDebugUI() {\n        // Create debug UI container\n        this.debugUI = document.createElement('div');\n        this.debugUI.id = 'player-debug-ui';\n        this.debugUI.style.cssText = `\n            position: fixed;\n            top: 10px;\n            right: 10px;\n            background: rgba(0, 0, 0, 0.8);\n            color: white;\n            padding: 15px;\n            border-radius: 8px;\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            line-height: 1.4;\n            z-index: 1000;\n            display: none;\n            max-width: 400px;\n            border: 2px solid #333;\n        `;\n        \n        document.body.appendChild(this.debugUI);\n        \n        // Create instructions\n        const instructions = document.createElement('div');\n        instructions.style.cssText = `\n            position: fixed;\n            bottom: 10px;\n            left: 10px;\n            background: rgba(0, 0, 0, 0.1);\n            color: white;\n            padding: 10px;\n            border-radius: 8px;\n            font-family: 'Courier New', monospace;\n            font-size: 11px;\n            line-height: 1.3;\n            z-index: 1000;\n        `;\n        instructions.innerHTML = `\n            <strong>🎮 Controls:</strong><br>\n            <strong>ZQSD</strong> - Move player<br>\n            <strong>H</strong> - Toggle axis/camera HUD<br>\n            <strong>F1</strong> - Toggle debug info<br>\n            <strong>1-7</strong> - Switch masks<br>\n            <strong>ESC</strong> - Return to neutral\n        `;\n        \n        // document.body.appendChild(instructions);\n        \n        // Create touch controls overlay for mobile\n        if (this.inputManager.isMobileDevice()) {\n            this.createTouchControlsOverlay();\n        }\n    }\n\n    createTouchControlsOverlay() {\n        const touchOverlay = document.createElement('div');\n        touchOverlay.id = 'touch-controls-overlay';\n        touchOverlay.style.cssText = `\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            width: 60px;\n            height: 60px;\n            background: rgba(255, 255, 255, 0.1);\n            border: 2px solid rgba(255, 255, 255, 0.3);\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 24px;\n            z-index: 1001;\n            pointer-events: none;\n        `;\n        touchOverlay.innerHTML = '📱';\n        \n        document.body.appendChild(touchOverlay);\n        \n        // Add visual feedback for touch controls\n        const touchIndicator = document.createElement('div');\n        touchIndicator.style.cssText = `\n            position: fixed;\n            bottom: 100px;\n            right: 20px;\n            color: white;\n            font-size: 12px;\n            background: rgba(0, 0, 0, 0.7);\n            padding: 8px;\n            border-radius: 5px;\n            z-index: 1001;\n            display: none;\n        `;\n        touchIndicator.textContent = 'Touch & drag to move';\n        \n        document.body.appendChild(touchIndicator);\n        \n        // Show/hide touch indicator based on touch activity\n        const updateTouchIndicator = () => {\n            if (this.inputManager.isTouchActive()) {\n                touchIndicator.style.display = 'block';\n                const movement = this.inputManager.getTouchMovement();\n                touchIndicator.textContent = `Touch: x=${movement.x.toFixed(2)}, y=${movement.y.toFixed(2)}`;\n            } else {\n                touchIndicator.style.display = 'none';\n            }\n        };\n        \n        // Update indicator periodically\n        setInterval(updateTouchIndicator, 100);\n    }\n\n    updateDebugUI(debugInfo) {\n        if (!this.debugUI || !this.showDebugUI) return;\n        \n        this.debugUI.innerHTML = `\n            <strong>🎮 ZQSD Movement Debug</strong><br>\n            <strong>Keys:</strong> ${debugInfo.input}<br>\n            <strong>Input Vector:</strong> ${debugInfo.inputVector}<br>\n            <strong>Forward Dir:</strong> ${debugInfo.forward}<br>\n            <strong>Right Dir:</strong> ${debugInfo.right}<br>\n            <strong>Movement:</strong> ${debugInfo.movement}<br>\n            <strong>Position:</strong> ${debugInfo.position}<br>\n            <strong>Latitude:</strong> ${debugInfo.sphericalCoords.lat}<br>\n            <strong>Longitude:</strong> ${debugInfo.sphericalCoords.lon}<br>\n            <strong>Mask:</strong> ${this.currentMask || 'Neutral'}<br>\n            <strong>Camera Mode:</strong> Third-person orbital\n        `;\n    }\n\n    toggleDebugUI() {\n        this.showDebugUI = !this.showDebugUI;\n        this.debugUI.style.display = this.showDebugUI ? 'block' : 'none';\n        console.log(`🔧 Debug UI ${this.showDebugUI ? 'shown' : 'hidden'}`);\n    }\n\n    handleKeyDown(key) {\n        // Handle mask switching keys\n        switch (key) {\n            case 'escape':\n                if (this.canReturnToNeutral()) {\n                    this.setMask(null);\n                }\n                break;\n            case 'h':\n                // Toggle debug helpers\n                const sceneManager = serviceContainer.resolve('sceneManager');\n                if (sceneManager) {\n                    sceneManager.toggleHelpers();\n                }\n                break;\n            case 'f1':\n                // Toggle debug UI\n                this.toggleDebugUI();\n                break;\n            case '1':\n            case '2':\n            case '3':\n            case '4':\n            case '5':\n            case '6':\n            case '7':\n                const maskType = parseInt(key);\n                if (this.hasEnergy()) {\n                    this.setMask(maskType);\n                }\n                break;\n        }\n    }\n\n    update(deltaTime) {\n        // Handle movement\n        this.handleMovement(deltaTime);\n        \n        // Update renderer\n        if (this.renderer) {\n            this.renderer.updateTransform(this.transform);\n        }\n        \n        // Update player orientation to always face camera\n        this.updatePlayerOrientation();\n        \n        // Update direction arrow\n        this.updateDirectionArrow();\n    }\n\n    handleMovement(deltaTime) {\n        if (!this.planet) return;\n        \n        // Get movement input (includes touch controls)\n        const input = this.inputManager.getMovementVector();\n        \n        if (input.x === 0 && input.y === 0) return;\n        \n        // Debug touch controls on mobile\n        if (this.inputManager.isMobileDevice() && this.inputManager.isTouchActive()) {\n            const touchMovement = this.inputManager.getTouchMovement();\n            console.log(`📱 Touch movement: x=${touchMovement.x.toFixed(3)}, y=${touchMovement.y.toFixed(3)}, input: x=${input.x.toFixed(3)}, y=${input.y.toFixed(3)}`);\n        }\n        \n        // Use quaternion-based movement for constant speed\n        this.handleQuaternionMovement(input, deltaTime);\n    }\n\n    // Handle touch-specific movement with enhanced feedback\n    handleTouchMovement(deltaTime) {\n        if (!this.inputManager.isMobileDevice() || !this.inputManager.isTouchActive()) {\n            return;\n        }\n\n        const touchMovement = this.inputManager.getTouchMovement();\n        const input = {\n            x: Math.max(-1, Math.min(1, touchMovement.x)),\n            y: Math.max(-1, Math.min(1, touchMovement.y))\n        };\n\n        // Only move if touch input is significant enough\n        if (Math.abs(input.x) > 0.1 || Math.abs(input.y) > 0.1) {\n            this.handleQuaternionMovement(input, deltaTime);\n        }\n    }\n    \n    handleQuaternionMovement(input, deltaTime) {\n        const speed = params.PLAYER_SPEED * deltaTime;\n        const radius = this.planetRadius + params.PLAYER_SIZE / 2;\n\n        // Get camera and current position\n        const camera = serviceContainer.resolve('camera');\n        if (!camera) return;\n        const currentPos = this.transform.position.clone();\n\n        // 1. Get Player's \"Up\" Vector (the normal to the sphere surface)\n        const surfaceNormal = currentPos.clone().normalize();\n\n        // 2. Get a Stable \"Right\" Vector from the Camera\n        // We use the camera's local X-axis, which is not affected by pitch.\n        const cameraRight = new THREE.Vector3().setFromMatrixColumn(camera.matrixWorld, 0);\n\n        // 3. Create Player-Relative Movement Vectors on the Tangent Plane\n        // Project the stable cameraRight vector onto the tangent plane to get the player's right.\n        const playerRight = cameraRight.clone().addScaledVector(surfaceNormal, -cameraRight.dot(surfaceNormal));\n        playerRight.normalize();\n\n        // The player's forward is perpendicular to their right and their up (surfaceNormal).\n        // The order of the cross product is important to get \"forward\" instead of \"backward\".\n        const playerForward = new THREE.Vector3().crossVectors(surfaceNormal, playerRight);\n\n        // 4. Calculate Total Movement Vector\n        // Input Y (Z/S -> +1/-1) moves along playerForward.\n        // Input X (Q/D -> +1/-1) moves along playerRight. We must negate X as Q (+1) should move left.\n        const movementDirection = playerForward.clone().multiplyScalar(input.y).add(playerRight.clone().multiplyScalar(-input.x));\n        \n        // If there's no movement, no need to do anything else.\n        if (movementDirection.lengthSq() === 0) return;\n        \n        movementDirection.normalize();\n\n        if (movementDirection.length() > 0.01) {\n            this.lastMovementDirection.copy(movementDirection);\n        }\n\n        // 5. Calculate Rotation from Movement\n        // The axis of rotation is perpendicular to the current position and movement direction.\n        // This ensures we rotate around the sphere's center, not around the surface normal.\n        const rotationAxis = new THREE.Vector3().crossVectors(currentPos, movementDirection);\n        rotationAxis.normalize();\n\n        // The angle of rotation is the distance to travel divided by the sphere's radius.\n        const angularDistance = speed / radius;\n        const rotation = new THREE.Quaternion().setFromAxisAngle(rotationAxis, angularDistance);\n\n        // 6. Apply Rotation to Player Position\n        const newPosition = currentPos.clone().applyQuaternion(rotation);\n        \n        // Ensure the player stays exactly on the surface.\n        newPosition.normalize().multiplyScalar(radius);\n        \n        this.transform.setPosition(newPosition.x, newPosition.y, newPosition.z);\n        this.normal.copy(newPosition.clone().normalize());\n    }\n    \n    handleLinearMovement(input, deltaTime) {\n        // Calculate movement speed\n        const speed = params.PLAYER_SPEED * deltaTime;\n        const radius = this.planetRadius + params.PLAYER_SIZE / 2;\n        \n        // Get current position and normalize to correct radius\n        const currentPos = this.transform.position.clone();\n        const currentDistance = currentPos.length();\n        \n        // Normalize to correct distance if needed\n        if (Math.abs(currentDistance - radius) > 0.01) {\n            currentPos.normalize().multiplyScalar(radius);\n            this.transform.setPosition(currentPos.x, currentPos.y, currentPos.z);\n        }\n        \n        // Calculate the surface normal at current position\n        const surfaceNormal = currentPos.clone().normalize();\n        \n        // Get camera for movement reference\n        const camera = serviceContainer.resolve('camera');\n        if (!camera) return;\n        \n        // IMPROVED ZQSD MOVEMENT SYSTEM\n        // Get camera's forward direction (where camera is looking)\n        const cameraDirection = new THREE.Vector3();\n        camera.getWorldDirection(cameraDirection);\n        \n        // Project camera direction onto the tangent plane at player position\n        const forwardDirection = cameraDirection.clone();\n        const forwardDotNormal = forwardDirection.dot(surfaceNormal);\n        forwardDirection.addScaledVector(surfaceNormal, -forwardDotNormal);\n        \n        // Normalize and check if projection is valid\n        if (forwardDirection.length() < 0.1) {\n            // Camera is pointing directly at/away from surface, use fallback\n            forwardDirection.set(0, 0, 1); // Fallback direction\n        } else {\n            forwardDirection.normalize();\n        }\n        \n        // Calculate right direction using cross product\n        const rightDirection = new THREE.Vector3().crossVectors(forwardDirection, surfaceNormal);\n        rightDirection.normalize();\n        \n        // Calculate movement vector with clearer ZQSD mapping\n        const movement = new THREE.Vector3();\n        \n        // ZQSD Movement mapping (French AZERTY):\n        // Z = forward (positive Y input)\n        // S = backward (negative Y input) \n        // Q = left (positive X input)\n        // D = right (negative X input)\n        \n        // Forward/Backward movement (Z/S keys)\n        if (input.y !== 0) {\n            movement.addScaledVector(forwardDirection, input.y * speed);\n        }\n        \n        // Left/Right movement (Q/D keys)  \n        if (input.x !== 0) {\n            movement.addScaledVector(rightDirection, -input.x * speed); // Q=1 goes left (-right), D=-1 goes right (+right)\n        }\n        \n        // Apply movement\n        let newPosition = currentPos.clone();\n        newPosition.add(movement);\n        \n        // Store movement direction for arrow (before constraining to sphere)\n        if (movement.length() > 0.01) {\n            this.lastMovementDirection.copy(movement.clone().normalize());\n        }\n        \n        // Constrain to sphere surface\n        newPosition.normalize().multiplyScalar(radius);\n        \n        // Update position\n        this.transform.setPosition(newPosition.x, newPosition.y, newPosition.z);\n        \n        // Update player normal\n        this.normal.copy(newPosition.clone().normalize());\n    }\n    \n\n\n    // Mask management\n    setMask(maskType) {\n        this.currentMask = maskType;\n        this.updatePlayerAppearance();\n        \n        // Notify other systems\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\n        if (gameStateSystem) {\n            gameStateSystem.setMask(maskType);\n        }\n        \n        // Update scene background color based on mask\n        const sceneManager = serviceContainer.resolve('sceneManager');\n        if (sceneManager) {\n            sceneManager.setBackgroundFromMask(maskType);\n        }\n        \n        console.log(`🎭 Player mask changed to: ${maskType || 'Neutral'}`);\n    }\n\n    updatePlayerAppearance() {\n        if (!this.renderer || !this.renderer.mesh) return;\n        \n        // Get the appropriate Joshua texture for the current mask\n        const texturePath = this.getJoshuaTextureForMask(this.currentMask);\n        \n        // Load and apply the new texture\n        const texture = this.textureLoader.load(texturePath);\n        \n        // Update geometry when texture loads\n        texture.onLoad = () => {\n            this.updatePlayerGeometry();\n        };\n        \n        this.renderer.mesh.material.map = texture;\n        this.renderer.mesh.material.needsUpdate = true;\n        \n        console.log(`🎭 Player appearance updated with Joshua texture: ${texturePath}`);\n    }\n\n\n\n    // State queries\n    canReturnToNeutral() {\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\n        return gameStateSystem ? gameStateSystem.canReturnToNeutral() : true;\n    }\n\n    hasEnergy() {\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\n        return gameStateSystem ? gameStateSystem.energy > 0 : true;\n    }\n\n    // Getters for other systems\n    getPlayerPosition() {\n        return this.transform.position;\n    }\n\n    getPlayerNormal() {\n        return this.normal;\n    }\n\n    // Setter for position (used by collision system)\n    setPlayerPosition(newPosition) {\n        this.transform.setPosition(newPosition.x, newPosition.y, newPosition.z);\n        this.normal.copy(newPosition.clone().normalize());\n    }\n\n    getDistanceTo(targetPosition) {\n        return this.transform.distanceTo({ position: targetPosition });\n    }\n\n    isNearPosition(targetPosition, range) {\n        return this.getDistanceTo(targetPosition) <= range;\n    }\n\n    getCurrentMask() {\n        return this.currentMask;\n    }\n\n    // IGameSystem implementation\n    onGameStateChange(newState) {\n        if (newState.property === 'energy' && newState.newValue <= 0) {\n            // Force neutral when energy depleted\n            this.setMask(null);\n        }\n    }\n\n    onPlayerAction(action) {\n        switch (action.type) {\n            case 'teleport':\n                this.transform.setPosition(action.x, action.y, action.z);\n                break;\n            case 'forceMask':\n                this.setMask(action.maskType);\n                break;\n        }\n    }\n\n    shutdown() {\n        if (this.renderer) {\n            this.renderer.dispose();\n        }\n        \n        // Clean up direction arrow\n        if (this.directionArrow) {\n            // Remove from scene\n            if (this.directionArrow.parent) {\n                this.directionArrow.parent.remove(this.directionArrow);\n            }\n            this.directionArrow = null;\n        }\n        \n        // Clean up debug UI\n        if (this.debugUI) {\n            document.body.removeChild(this.debugUI);\n            this.debugUI = null;\n        }\n        \n        // Clean up any other UI elements we created\n        const instructions = document.querySelector('div[style*=\"bottom: 10px\"]');\n        if (instructions) {\n            document.body.removeChild(instructions);\n        }\n        \n        console.log('🚶 Player System shutdown');\n    }\n} ","// factories/NPCFactory.js - NPC Factory following Open/Closed Principle\r\nimport * as THREE from 'three';\r\nimport { Transform } from '../components/Transform.js';\r\nimport { Renderer } from '../components/Renderer.js';\r\nimport { params } from '../params.js';\r\n\r\n// Base NPC types registry\r\nconst npcTypes = new Map();\r\nconst textureLoader = new THREE.TextureLoader();\r\n\r\n// Register NPC type\r\nexport function registerNPCType(typeName, createFunction) {\r\n    npcTypes.set(typeName, createFunction);\r\n}\r\n\r\n// Factory function\r\nexport function createNPC(type, config) {\r\n    const creator = npcTypes.get(type);\r\n    if (!creator) {\r\n        throw new Error(`Unknown NPC type: ${type}`);\r\n    }\r\n    return creator(config);\r\n}\r\n\r\n// Texture helper - maps mask types to corresponding group textures\r\nfunction getTextureForMask(maskId) {\r\n    const textures = {\r\n        1: 'textures/sprites/group_conservative.png',    // Conservatives\r\n        2: 'textures/sprites/group_sjw.png',            // Social Justice\r\n        3: 'textures/sprites/group_libertarian.png',    // Libertarians\r\n        4: 'textures/sprites/group_nationalist.png',    // Nationalists\r\n        5: 'textures/sprites/group_culture.png',        // Culture\r\n        6: 'textures/sprites/group_religious.png',      // Religious\r\n        7: 'textures/sprites/group_antisystem.png'      // Antisystem\r\n    };\r\n    return textures[maskId] || 'textures/sprites/group_neutre.png'; // Fallback to neutral\r\n}\r\n\r\n// Generic NPC creator function compatible with NPCSystem\r\nfunction createBasicNPC(config) {\r\n    const {\r\n        maskType = 1,\r\n        planetRadius = 10,\r\n        scene = null,\r\n        color = new THREE.Color(0.5, 0.5, 0.5),\r\n        groupSpawnCenter = null,\r\n        groupSpawnRadius = 3\r\n    } = config;\r\n\r\n    let position;\r\n    \r\n    if (groupSpawnCenter) {\r\n        // Generate position around group spawn center\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const distance = Math.random() * groupSpawnRadius;\r\n        \r\n        // Create random offset from group center\r\n        const offsetX = Math.cos(angle) * distance;\r\n        const offsetZ = Math.sin(angle) * distance;\r\n        \r\n        // Apply offset to group center (keeping on planet surface)\r\n        const centerNormalized = groupSpawnCenter.clone().normalize();\r\n        const right = new THREE.Vector3(0, 1, 0).cross(centerNormalized).normalize();\r\n        const up = centerNormalized.clone().cross(right).normalize();\r\n        \r\n        position = groupSpawnCenter.clone()\r\n            .add(right.multiplyScalar(offsetX))\r\n            .add(up.multiplyScalar(offsetZ));\r\n            \r\n        // Ensure position is on planet surface\r\n        position.normalize().multiplyScalar(planetRadius + (params.NPC_SIZE || 0.5) / 2);\r\n    } else {\r\n        // Fallback to random position on planet surface\r\n        const theta = Math.random() * Math.PI * 2;\r\n        const phi = Math.acos(2 * Math.random() - 1);\r\n        const radius = planetRadius + (params.NPC_SIZE || 0.5) / 2;\r\n        \r\n        position = new THREE.Vector3(\r\n            radius * Math.sin(phi) * Math.cos(theta),\r\n            radius * Math.cos(phi),\r\n            radius * Math.sin(phi) * Math.sin(theta)\r\n        );\r\n    }\r\n\r\n    const npc = {\r\n        // Identity\r\n        id: `npc_${maskType}_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        maskType: maskType,\r\n        \r\n        // Components\r\n        transform: new Transform(),\r\n        renderer: null,\r\n        \r\n        // Physics\r\n        velocity: new THREE.Vector3(),\r\n        targetPosition: null,\r\n        \r\n        // Behavior state\r\n        state: 'IDLE',\r\n        stateTimer: 0,\r\n        minStateDuration: (params.NPC_MIN_STATE_DURATION || 2) + Math.random() * 2,\r\n        \r\n        // Personality\r\n        personality: {\r\n            curiosity: Math.random(),\r\n            energy: 0.5 + Math.random() * 0.5,\r\n            aggressiveness: Math.random(),\r\n            sociability: Math.random()\r\n        },\r\n        \r\n        // Group behavior\r\n        groupInfluence: 0.5 + Math.random() * 0.5,\r\n        lastGroupCheck: 0\r\n    };\r\n\r\n    // Set initial position\r\n    npc.transform.setPosition(position.x, position.y, position.z);\r\n\r\n    // Create renderer immediately\r\n    if (scene) {\r\n        const texture = textureLoader.load(getTextureForMask(maskType));\r\n        \r\n        // Create initial square geometry (will be updated when texture loads)\r\n        const geometry = new THREE.PlaneGeometry((params.NPC_SIZE || 0.5), (params.NPC_SIZE || 0.5));\r\n        \r\n        const material = new THREE.MeshBasicMaterial({ \r\n            map: texture,\r\n            transparent: true,\r\n            alphaTest: 0.5,\r\n            side: THREE.DoubleSide\r\n        });\r\n        \r\n        npc.renderer = new Renderer(geometry, material);\r\n        npc.renderer.createMesh(scene);\r\n        \r\n        // Update geometry when texture loads to preserve aspect ratio\r\n        texture.onLoad = () => {\r\n            updateNPCGeometry(npc);\r\n        };\r\n        \r\n        // Position the mesh\r\n        npc.renderer.updateTransform(npc.transform);\r\n        \r\n        // Add shadow casting\r\n        if (npc.renderer.mesh) {\r\n            npc.renderer.mesh.castShadow = true;\r\n            npc.renderer.mesh.receiveShadow = true;\r\n        }\r\n    }\r\n\r\n    return npc;\r\n}\r\n\r\n// Advanced NPC creator with more complex behavior\r\nfunction createAdvancedNPC(config) {\r\n    const npc = createBasicNPC(config);\r\n    \r\n    // Add advanced behavior properties\r\n    npc.decisionTree = {\r\n        currentGoal: 'wander',\r\n        goalPriority: 1.0,\r\n        memory: [],\r\n        relationships: new Map()\r\n    };\r\n    \r\n    npc.communication = {\r\n        canSpeak: true,\r\n        lastSpeech: 0,\r\n        speechRadius: params.NPC_INTERACTION_RADIUS || 2\r\n    };\r\n    \r\n    return npc;\r\n}\r\n\r\n// Specialized NPC types\r\nfunction createLeaderNPC(config) {\r\n    const npc = createAdvancedNPC(config);\r\n    \r\n    // Leader properties\r\n    npc.isLeader = true;\r\n    npc.leadership = {\r\n        influence: 0.8 + Math.random() * 0.2,\r\n        followers: [],\r\n        maxFollowers: 3 + Math.floor(Math.random() * 3)\r\n    };\r\n    \r\n    // Leaders are slightly larger\r\n    if (npc.renderer && npc.renderer.mesh) {\r\n        npc.renderer.mesh.scale.setScalar(1.2);\r\n    }\r\n    \r\n    return npc;\r\n}\r\n\r\nfunction createFollowerNPC(config) {\r\n    const npc = createBasicNPC(config);\r\n    \r\n    // Follower properties\r\n    npc.isFollower = true;\r\n    npc.following = {\r\n        leader: null,\r\n        loyalty: 0.6 + Math.random() * 0.4,\r\n        followDistance: 1 + Math.random() * 2\r\n    };\r\n    \r\n    return npc;\r\n}\r\n\r\n// Helper function to update NPC geometry to preserve texture aspect ratio\r\nfunction updateNPCGeometry(npc) {\r\n    if (!npc.renderer || !npc.renderer.mesh) return;\r\n    \r\n    const texture = npc.renderer.mesh.material.map;\r\n    if (!texture || !texture.image) return;\r\n    \r\n    // Get texture dimensions\r\n    const textureWidth = texture.image.width;\r\n    const textureHeight = texture.image.height;\r\n    \r\n    if (textureWidth === 0 || textureHeight === 0) return;\r\n    \r\n    // Calculate aspect ratio\r\n    const aspectRatio = textureWidth / textureHeight;\r\n    \r\n    // Calculate new dimensions while maintaining the base size\r\n    const baseSize = params.NPC_SIZE || 0.5;\r\n    let width, height;\r\n    if (aspectRatio > 1) {\r\n        // Wider than tall\r\n        width = baseSize;\r\n        height = baseSize / aspectRatio;\r\n    } else {\r\n        // Taller than wide or square\r\n        width = baseSize * aspectRatio;\r\n        height = baseSize;\r\n    }\r\n    \r\n    // Create new geometry with correct aspect ratio\r\n    const newGeometry = new THREE.PlaneGeometry(width, height);\r\n    \r\n    // Update the mesh geometry\r\n    npc.renderer.mesh.geometry.dispose(); // Clean up old geometry\r\n    npc.renderer.mesh.geometry = newGeometry;\r\n    \r\n    console.log(`📐 NPC geometry updated to preserve texture ratio (${textureWidth}x${textureHeight}, aspect: ${aspectRatio.toFixed(2)})`);\r\n}\r\n\r\n// Color helper\r\nfunction getColorForMask(maskId) {\r\n    const colors = {\r\n        1: new THREE.Color(0.2, 0.4, 0.8),    // Blue - Conservatives\r\n        2: new THREE.Color(0.8, 0.2, 0.2),    // Red - Social Justice\r\n        3: new THREE.Color(1.0, 0.6, 0.2),    // Orange - Libertarians\r\n        4: new THREE.Color(0.2, 0.6, 0.2),    // Green - Nationalists\r\n        5: new THREE.Color(0.6, 0.2, 0.8),    // Purple - Culture\r\n        6: new THREE.Color(0.6, 0.3, 0.1),    // Brown - Religious\r\n        7: new THREE.Color(1.0, 0.4, 0.8)     // Pink - Antisystem\r\n    };\r\n    return colors[maskId] || new THREE.Color(0.5, 0.5, 0.5);\r\n}\r\n\r\n// NPCFactory class for object-oriented usage\r\nexport class NPCFactory {\r\n    constructor() {\r\n        this.createdNPCs = 0;\r\n        this.npcRegistry = new Map();\r\n    }\r\n    \r\n    createNPC(type, config) {\r\n        // Ensure color is set from mask type\r\n        if (config.maskType && !config.color) {\r\n            config.color = getColorForMask(config.maskType);\r\n        }\r\n        \r\n        const npc = createNPC(type, config);\r\n        \r\n        // Register the NPC\r\n        this.npcRegistry.set(npc.id, npc);\r\n        this.createdNPCs++;\r\n        \r\n        console.log(`🏭 NPCFactory created ${type} NPC #${this.createdNPCs} (mask: ${config.maskType})`);\r\n        \r\n        return npc;\r\n    }\r\n    \r\n    registerNPCType(typeName, createFunction) {\r\n        return registerNPCType(typeName, createFunction);\r\n    }\r\n    \r\n    getNPCById(id) {\r\n        return this.npcRegistry.get(id);\r\n    }\r\n    \r\n    getAllNPCs() {\r\n        return Array.from(this.npcRegistry.values());\r\n    }\r\n    \r\n    removeNPC(id) {\r\n        const npc = this.npcRegistry.get(id);\r\n        if (npc) {\r\n            if (npc.renderer) {\r\n                npc.renderer.dispose();\r\n            }\r\n            this.npcRegistry.delete(id);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    \r\n    getStats() {\r\n        return {\r\n            totalCreated: this.createdNPCs,\r\n            currentCount: this.npcRegistry.size,\r\n            types: Array.from(npcTypes.keys())\r\n        };\r\n    }\r\n}\r\n\r\n// Police NPC creator\r\nfunction createPoliceNPC(config) {\r\n    const npc = createBasicNPC(config);\r\n    \r\n    // Police properties\r\n    npc.isPolice = true;\r\n    npc.maskType = 'police'; // Special mask type for police\r\n    npc.speedMultiplier = params.POLICE_SPEED_MULTIPLIER || 1.3; // Store the multiplier, not the final speed\r\n    npc.detectionRadius = params.POLICE_CATCH_DISTANCE || 2;\r\n    npc.damageRate = 10; // Damage per second when near player\r\n    npc.pursuitTarget = null;\r\n    npc.state = 'PURSUING';\r\n    \r\n    // Police don't follow normal NPC behaviors\r\n    npc.groupInfluence = 0;\r\n    npc.personality = {\r\n        curiosity: 0,\r\n        energy: 1,\r\n        aggressiveness: 1,\r\n        sociability: 0\r\n    };\r\n    \r\n    // Update renderer with police texture\r\n    if (npc.renderer && npc.renderer.mesh) {\r\n        const textureLoader = new THREE.TextureLoader();\r\n        const policeTexture = textureLoader.load('textures/sprites/police_fbi.png');\r\n        npc.renderer.mesh.material.map = policeTexture;\r\n        npc.renderer.mesh.material.needsUpdate = true;\r\n        \r\n        // Make police slightly larger\r\n        npc.renderer.mesh.scale.setScalar(1.2);\r\n    }\r\n    \r\n    console.log(`🚔 Police NPC created with speedMultiplier: ${npc.speedMultiplier}`);\r\n    return npc;\r\n}\r\n\r\n// Register default NPC types\r\nregisterNPCType('basic', createBasicNPC);\r\nregisterNPCType('generic', createBasicNPC);\r\nregisterNPCType('civilian', createBasicNPC);\r\nregisterNPCType('advanced', createAdvancedNPC);\r\nregisterNPCType('leader', createLeaderNPC);\r\nregisterNPCType('follower', createFollowerNPC);\r\nregisterNPCType('police', createPoliceNPC);\r\n\r\n// Export for easy extension\r\nexport { createBasicNPC, createAdvancedNPC, createPoliceNPC, getColorForMask, getTextureForMask }; ","// systems/NPCSystem.js - NPC management following SOLID principles\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\nimport { NPCFactory } from '../factories/NPCFactory.js';\r\nimport { Transform } from '../components/Transform.js';\r\nimport { Renderer } from '../components/Renderer.js';\r\nimport { params } from '../params.js';\r\nimport { serviceContainer } from '../core/ServiceContainer.js';\r\n\r\nexport class NPCSystem extends IGameSystem {\r\n    constructor() {\r\n        super('NPC');\r\n        \r\n        this.npcs = [];\r\n        this.groups = new Map();\r\n        this.planetRadius = 0;\r\n        this.planet = null;\r\n        this.scene = null;\r\n        this.npcFactory = new NPCFactory();\r\n        \r\n        // Performance optimization\r\n        this.updateFrequency = 0.1; // Update every 100ms\r\n        this.lastUpdateTime = 0;\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        this.scene = sceneManager.getScene();\r\n        this.planet = sceneManager.getPlanet();\r\n        this.planetRadius = sceneManager.getPlanetRadius();\r\n        \r\n        // Create NPC groups\r\n        this.createNPCGroups();\r\n        \r\n        // Setup console helpers for debugging\r\n        this.setupConsoleHelpers();\r\n        \r\n        console.log('👥 NPC System initialized with flocking behavior');\r\n        console.log(`Created ${this.npcs.length} NPCs in ${this.groups.size} groups`);\r\n    }\r\n\r\n    createNPCGroups() {\r\n        // Create groups for each mask type\r\n        for (let maskType = 1; maskType <= 7; maskType++) {\r\n            const group = this.createGroup(maskType);\r\n            this.groups.set(maskType, group);\r\n            console.log(`Created group ${maskType} with ${group.npcs.length} NPCs`);\r\n        }\r\n    }\r\n\r\n    createGroup(maskType) {\r\n        // Generate a specific spawn area for this group\r\n        const groupSpawnCenter = this.generateGroupSpawnPosition(maskType);\r\n        const groupSpawnRadius = 3; // Radius of the spawn zone for the group\r\n        \r\n        const group = {\r\n            id: `group_${maskType}`,\r\n            maskType: maskType,\r\n            npcs: [],\r\n            color: this.getMaskColor(maskType),\r\n            targetSize: params.NPC_GROUP_SIZE,\r\n            cohesion: 0.5 + Math.random() * 0.5,\r\n            activity: 0.3 + Math.random() * 0.7,\r\n            spawnCenter: groupSpawnCenter,\r\n            spawnRadius: groupSpawnRadius\r\n        };\r\n\r\n        // Create NPCs for this group in the same area\r\n        for (let i = 0; i < group.targetSize; i++) {\r\n            const npc = this.npcFactory.createNPC('basic', {\r\n                maskType: maskType,\r\n                planetRadius: this.planetRadius,\r\n                scene: this.scene,\r\n                color: group.color,\r\n                groupSpawnCenter: groupSpawnCenter,\r\n                groupSpawnRadius: groupSpawnRadius\r\n            });\r\n            \r\n            group.npcs.push(npc);\r\n            this.npcs.push(npc);\r\n        }\r\n\r\n        return group;\r\n    }\r\n\r\n    getNPCs() {\r\n        return this.npcs;\r\n    }\r\n\r\n    getMaskColor(maskType) {\r\n        const colors = {\r\n            1: new THREE.Color(0.2, 0.4, 0.8),    // Blue - Conservatives\r\n            2: new THREE.Color(0.8, 0.2, 0.2),    // Red - Social Justice\r\n            3: new THREE.Color(1.0, 0.6, 0.2),    // Orange - Libertarians\r\n            4: new THREE.Color(0.2, 0.6, 0.2),    // Green - Nationalists\r\n            5: new THREE.Color(0.6, 0.2, 0.8),    // Purple - Culture\r\n            6: new THREE.Color(0.6, 0.3, 0.1),    // Brown - Religious\r\n            7: new THREE.Color(1.0, 0.4, 0.8)     // Pink - Antisystem\r\n        };\r\n        return colors[maskType] || new THREE.Color(0.5, 0.5, 0.5);\r\n    }\r\n\r\n    update(deltaTime) {\r\n        // --- Logic update (throttled) ---\r\n        this.lastUpdateTime += deltaTime;\r\n        if (this.lastUpdateTime >= this.updateFrequency) {\r\n            const actualDeltaTime = this.lastUpdateTime;\r\n            this.fixedUpdate(actualDeltaTime);\r\n            this.lastUpdateTime = 0;\r\n        }\r\n\r\n        // --- Movement and rendering update (every frame) ---\r\n        for (const npc of this.npcs) {\r\n            if (!npc.transform || !npc.renderer) continue;\r\n\r\n            // Apply movement based on current velocity\r\n            this.applyNPCMovement(npc, deltaTime);\r\n        }\r\n\r\n        // --- Collision resolution (every frame) ---\r\n        this.resolveCollisions();\r\n        \r\n        // --- Player-NPC collision resolution (every frame) ---\r\n        this.resolvePlayerNPCCollisions();\r\n\r\n        // --- Final renderer update (every frame) ---\r\n        for (const npc of this.npcs) {\r\n            if (!npc.transform || !npc.renderer) continue;\r\n            \r\n            // Update renderer transform\r\n            npc.renderer.updateTransform(npc.transform);\r\n        }\r\n    }\r\n\r\n    resolveCollisions() {\r\n        for (let i = 0; i < this.npcs.length; i++) {\r\n            for (let j = i + 1; j < this.npcs.length; j++) {\r\n                const npc1 = this.npcs[i];\r\n                const npc2 = this.npcs[j];\r\n\r\n                const distance = npc1.transform.position.distanceTo(npc2.transform.position);\r\n                const minDistance = params.NPC_SIZE; // Use size as collision diameter\r\n\r\n                if (distance < minDistance) {\r\n                    const overlap = minDistance - distance;\r\n                    const direction = new THREE.Vector3().subVectors(npc1.transform.position, npc2.transform.position).normalize();\r\n                    \r\n                    // Move each NPC back by half of the overlap\r\n                    const correction = direction.multiplyScalar(overlap / 2);\r\n                    npc1.transform.position.add(correction);\r\n                    npc2.transform.position.sub(correction);\r\n\r\n                    // Re-project to surface after correction\r\n                    this.projectToSurface(npc1);\r\n                    this.projectToSurface(npc2);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    resolvePlayerNPCCollisions() {\r\n        // Check if collisions are enabled\r\n        if (!params.PLAYER_NPC_COLLISION_ENABLED) return;\r\n        \r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (!playerSystem) return;\r\n        \r\n        const playerPosition = playerSystem.getPlayerPosition();\r\n        if (!playerPosition) return;\r\n        \r\n        // Collision radius with configurable overlap\r\n        const collisionRadius = (params.PLAYER_SIZE + params.NPC_SIZE) * params.PLAYER_NPC_COLLISION_RADIUS;\r\n        \r\n        for (const npc of this.npcs) {\r\n            const distance = npc.transform.position.distanceTo(playerPosition);\r\n            \r\n            if (distance < collisionRadius && distance > 0.01) { // Small threshold to avoid division by zero\r\n                const overlap = collisionRadius - distance;\r\n                \r\n                // Direction from player to NPC (to push NPC away)\r\n                const direction = new THREE.Vector3()\r\n                    .subVectors(npc.transform.position, playerPosition)\r\n                    .normalize();\r\n                \r\n                // Move NPC away from player with configurable push force\r\n                const repulsionStrength = Math.min(overlap * params.PLAYER_NPC_PUSH_FORCE, 2.0);\r\n                const correction = direction.multiplyScalar(repulsionStrength);\r\n                const newNPCPosition = npc.transform.position.clone().add(correction);\r\n                \r\n                // Project NPC to planet surface\r\n                const surfaceNormal = newNPCPosition.clone().normalize();\r\n                const targetDistance = this.planetRadius + params.NPC_SIZE / 2;\r\n                newNPCPosition.copy(surfaceNormal.multiplyScalar(targetDistance));\r\n                \r\n                // Update NPC position\r\n                npc.transform.setPosition(newNPCPosition.x, newNPCPosition.y, newNPCPosition.z);\r\n                \r\n                // Add velocity to the NPC to make the push feel more natural\r\n                const pushVelocity = direction.multiplyScalar(repulsionStrength * params.PLAYER_NPC_PUSH_VELOCITY);\r\n                npc.velocity.add(pushVelocity);\r\n                \r\n                // Optional: Add some visual feedback for collision\r\n                if (window.debugCollisions) {\r\n                    console.log(`💥 Player pushed NPC: distance=${distance.toFixed(2)}, overlap=${overlap.toFixed(2)}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    fixedUpdate(deltaTime) {\r\n        // Update all NPCs' logic\r\n        for (const npc of this.npcs) {\r\n            this.updateNPCLogic(npc, deltaTime);\r\n            \r\n            // Apply friction\r\n            npc.velocity.multiplyScalar(0.95);\r\n        }\r\n        \r\n        // Update group behaviors\r\n        this.updateGroupBehaviors(deltaTime);\r\n        \r\n        // Check if player is in crowd and update game state\r\n        this.updatePlayerCrowdStatus();\r\n        \r\n        // Handle player interactions\r\n        this.handlePlayerInteractions();\r\n        \r\n        // Debug flocking occasionally\r\n        if (window.debugFlocking && Math.random() < 0.01) {\r\n            this.debugFlockingForces(true);\r\n        }\r\n    }\r\n\r\n    updatePlayerCrowdStatus() {\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        \r\n        if (!playerSystem || !gameStateSystem) return;\r\n        \r\n        const playerPosition = playerSystem.getPlayerPosition();\r\n        const playerMask = playerSystem.getCurrentMask();\r\n        \r\n        if (!playerPosition || playerMask === null) {\r\n            // Player is neutral or position unknown - not in crowd\r\n            gameStateSystem.setInCrowd(false);\r\n            gameStateSystem.setInWrongCrowd(false);\r\n            return;\r\n        }\r\n        \r\n        // Count nearby NPCs within crowd detection radius\r\n        const nearbyNPCs = this.getNearbyNPCsFromPosition(playerPosition, params.CROWD_DETECT_DISTANCE);\r\n        \r\n        // Check if player is in a crowd (minimum crowd size)\r\n        if (nearbyNPCs.length >= params.CROWD_SIZE_MIN) {\r\n            gameStateSystem.setInCrowd(true);\r\n            \r\n            // Check if it's a \"wrong\" crowd (different mask types)\r\n            const wrongCrowdNPCs = nearbyNPCs.filter(npc => npc.maskType !== playerMask);\r\n            const wrongCrowdRatio = wrongCrowdNPCs.length / nearbyNPCs.length;\r\n            \r\n            // If majority of crowd has different mask, it's a \"wrong\" crowd\r\n            if (wrongCrowdRatio > 0.5) {\r\n                gameStateSystem.setInWrongCrowd(true);\r\n                console.log(`🎭 Player in wrong crowd (${wrongCrowdRatio.toFixed(2)} wrong mask ratio) - outrage increasing!`);\r\n            } else {\r\n                gameStateSystem.setInWrongCrowd(false);\r\n                console.log(`🎭 Player in correct crowd (${(1-wrongCrowdRatio).toFixed(2)} correct mask ratio) - outrage stable!`);\r\n            }\r\n        } else {\r\n            gameStateSystem.setInCrowd(false);\r\n            gameStateSystem.setInWrongCrowd(false);\r\n        }\r\n    }\r\n\r\n    updateNPCLogic(npc, deltaTime) {\r\n        // Update NPC state machine\r\n        this.updateNPCState(npc, deltaTime);\r\n        \r\n        // Update NPC forces to change velocity\r\n        this.updateNPCForces(npc);\r\n    }\r\n\r\n    updateNPC(npc, deltaTime) {\r\n        if (!npc.transform || !npc.renderer) return;\r\n        \r\n        // This method is now split into updateNPCLogic and the movement part in update()\r\n        // Kept for compatibility if called from elsewhere, but should be deprecated.\r\n        \r\n        // Update NPC state machine\r\n        this.updateNPCState(npc, deltaTime);\r\n        \r\n        // Update NPC forces\r\n        this.updateNPCForces(npc);\r\n        \r\n        // Apply movement\r\n        this.applyNPCMovement(npc, deltaTime);\r\n        \r\n        // Update renderer\r\n        npc.renderer.updateTransform(npc.transform);\r\n    }\r\n\r\n    updateNPCState(npc, deltaTime) {\r\n        npc.stateTimer += deltaTime;\r\n        \r\n        // Update flocking boosters\r\n        this.updateFlockingBoosters(npc, deltaTime);\r\n        \r\n        // Check for state transitions\r\n        if (npc.stateTimer >= npc.minStateDuration) {\r\n            if (Math.random() < params.NPC_STATE_CHANGE_CHANCE * deltaTime) {\r\n                this.changeNPCState(npc);\r\n            }\r\n        }\r\n        \r\n        // Update personality over time\r\n        npc.personality.curiosity = Math.max(0, Math.min(1, \r\n            npc.personality.curiosity + (Math.random() - 0.5) * 0.1 * deltaTime\r\n        ));\r\n        \r\n        // Update player influence over time\r\n        if (npc.playerInfluence > 0) {\r\n            npc.playerInfluence = Math.max(0, npc.playerInfluence - deltaTime * 0.2);\r\n        } else if (npc.playerInfluence < 0) {\r\n            npc.playerInfluence = Math.min(0, npc.playerInfluence + deltaTime * 0.2);\r\n        }\r\n    }\r\n    \r\n    updateFlockingBoosters(npc, deltaTime) {\r\n        // Update flocking boost timer\r\n        if (npc.flockingBoostTimer > 0) {\r\n            npc.flockingBoostTimer -= deltaTime;\r\n            if (npc.flockingBoostTimer <= 0) {\r\n                npc.flockingBoost = 1.0;\r\n            }\r\n        }\r\n        \r\n        // Update separation boost timer\r\n        if (npc.separationBoostTimer > 0) {\r\n            npc.separationBoostTimer -= deltaTime;\r\n            if (npc.separationBoostTimer <= 0) {\r\n                npc.separationBoost = 1.0;\r\n            }\r\n        }\r\n        \r\n        // Initialize boosters if they don't exist\r\n        if (npc.flockingBoost === undefined) npc.flockingBoost = 1.0;\r\n        if (npc.separationBoost === undefined) npc.separationBoost = 1.0;\r\n        if (npc.playerInfluence === undefined) npc.playerInfluence = 0.0;\r\n    }\r\n\r\n    changeNPCState(npc) {\r\n        const possibleStates = ['IDLE', 'WANDERING', 'GATHERING'];\r\n        const newState = possibleStates[Math.floor(Math.random() * possibleStates.length)];\r\n        \r\n        if (newState !== npc.state) {\r\n            npc.state = newState;\r\n            npc.stateTimer = 0;\r\n            npc.minStateDuration = params.NPC_MIN_STATE_DURATION + Math.random() * 2;\r\n            \r\n            // Reset target for new state\r\n            if (newState === 'WANDERING') {\r\n                npc.targetPosition = this.generateRandomPosition();\r\n            }\r\n        }\r\n    }\r\n\r\n    updateNPCForces(npc) {\r\n        const forces = {\r\n            separation: new THREE.Vector3(),\r\n            alignment: new THREE.Vector3(),\r\n            cohesion: new THREE.Vector3(),\r\n            wandering: new THREE.Vector3(),\r\n            interGroupRepulsion: new THREE.Vector3(),\r\n            playerInfluence: new THREE.Vector3()\r\n        };\r\n        \r\n        // Get neighbors for flocking behavior\r\n        const flockingNeighbors = this.getNearbyNPCs(npc, params.NPC_FLOCKING_RADIUS);\r\n        \r\n        // Calculate flocking forces (Craig Reynolds algorithm)\r\n        if (flockingNeighbors.length > 0) {\r\n            this.calculateFlockingSeparation(npc, flockingNeighbors, forces.separation);\r\n            this.calculateFlockingAlignment(npc, flockingNeighbors, forces.alignment);\r\n            this.calculateFlockingCohesion(npc, flockingNeighbors, forces.cohesion);\r\n            this.calculateInterGroupRepulsion(npc, flockingNeighbors, forces.interGroupRepulsion);\r\n        }\r\n        \r\n        this.calculateWanderingForce(npc, forces.wandering);\r\n        \r\n        // Apply forces with weights and boosters\r\n        const separationMultiplier = params.NPC_SEPARATION_FORCE * (npc.separationBoost || 1.0);\r\n        const alignmentMultiplier = params.NPC_ALIGNMENT_FORCE * (npc.flockingBoost || 1.0);\r\n        const cohesionMultiplier = params.NPC_COHESION_FORCE * (npc.flockingBoost || 1.0);\r\n        \r\n        const totalFlockingForce = new THREE.Vector3()\r\n            .add(forces.separation.multiplyScalar(separationMultiplier))\r\n            .add(forces.alignment.multiplyScalar(alignmentMultiplier))\r\n            .add(forces.cohesion.multiplyScalar(cohesionMultiplier));\r\n        \r\n        // Limit the maximum flocking force\r\n        this.limitForce(totalFlockingForce, params.NPC_MAX_FORCE * (npc.flockingBoost || 1.0));\r\n        \r\n        // Calculate player influence force\r\n        this.calculatePlayerInfluence(npc, forces.playerInfluence);\r\n\r\n        // Apply all forces\r\n        npc.velocity.add(totalFlockingForce.multiplyScalar(params.NPC_FLOCKING_WEIGHT));\r\n        npc.velocity.add(forces.wandering.multiplyScalar(params.NPC_WANDER_FORCE));\r\n        npc.velocity.add(forces.interGroupRepulsion.multiplyScalar(params.NPC_INTER_GROUP_REPULSION));\r\n        npc.velocity.add(forces.playerInfluence);\r\n        \r\n        // Apply speed limits\r\n        this.limitNPCSpeed(npc);\r\n    }\r\n\r\n    calculatePlayerInfluence(npc, influenceForce) {\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (!playerSystem) return;\r\n\r\n        const playerMask = playerSystem.getCurrentMask();\r\n        if (playerMask === null) return; // No influence if player is neutral\r\n\r\n        const playerPosition = playerSystem.getPlayerPosition();\r\n        const distance = npc.transform.distanceTo({ position: playerPosition });\r\n\r\n        if (distance < params.PLAYER_INFLUENCE_RADIUS) {\r\n            // Vector from player to NPC\r\n            const direction = new THREE.Vector3().subVectors(npc.transform.position, playerPosition).normalize();\r\n            \r\n            if (npc.maskType === playerMask) {\r\n                // Attraction force (pulls NPC towards player)\r\n                const attractionStrength = params.PLAYER_ATTRACTION_FORCE * (1 - distance / params.PLAYER_INFLUENCE_RADIUS);\r\n                influenceForce.add(direction.multiplyScalar(-attractionStrength)); // Negative to pull towards player\r\n            } else {\r\n                // Repulsion force (pushes NPC away from player)\r\n                const repulsionStrength = params.PLAYER_REPULSION_FORCE * (1 - distance / params.PLAYER_INFLUENCE_RADIUS);\r\n                influenceForce.add(direction.multiplyScalar(repulsionStrength));\r\n            }\r\n        }\r\n    }\r\n\r\n    // Craig Reynolds Flocking Algorithm Implementation\r\n    \r\n    // Rule 1: Separation - avoid crowding neighbors (respects personal space)\r\n    calculateFlockingSeparation(npc, neighbors, separationForce) {\r\n        let count = 0;\r\n        \r\n        for (const neighbor of neighbors) {\r\n            const distance = npc.transform.distanceTo(neighbor.transform);\r\n            \r\n            if (distance < params.NPC_SEPARATION_RADIUS && distance > 0) {\r\n                // Calculate a normalized vector pointing away from the neighbor\r\n                const direction = new THREE.Vector3()\r\n                    .subVectors(npc.transform.position, neighbor.transform.position)\r\n                    .normalize();\r\n                \r\n                // The force should be stronger the closer the NPCs are.\r\n                // Using an inverse square relationship creates a strong \"force field\".\r\n                const repulsionStrength = Math.pow(params.NPC_SEPARATION_RADIUS / distance, 2);\r\n                \r\n                direction.multiplyScalar(repulsionStrength);\r\n                separationForce.add(direction);\r\n                count++;\r\n            }\r\n        }\r\n        \r\n        if (count > 0) {\r\n            separationForce.divideScalar(count);\r\n            // Allow separation to be a much stronger force\r\n            this.limitForce(separationForce, params.NPC_MAX_FORCE * 3);\r\n        }\r\n    }\r\n    \r\n    // Rule 2: Alignment - steer towards average heading of neighbors\r\n    calculateFlockingAlignment(npc, neighbors, alignmentForce) {\r\n        const sameGroupNeighbors = neighbors.filter(n => n.maskType === npc.maskType);\r\n        let count = 0;\r\n        \r\n        for (const neighbor of sameGroupNeighbors) {\r\n            const distance = npc.transform.distanceTo(neighbor.transform);\r\n            if (distance < params.NPC_ALIGNMENT_RADIUS && distance > 0) {\r\n                alignmentForce.add(neighbor.velocity);\r\n                count++;\r\n            }\r\n        }\r\n        \r\n        if (count > 0) {\r\n            alignmentForce.divideScalar(count);\r\n            alignmentForce.normalize();\r\n        }\r\n    }\r\n    \r\n    // Rule 3: Cohesion - steer towards average position of neighbors\r\n    calculateFlockingCohesion(npc, neighbors, cohesionForce) {\r\n        const sameGroupNeighbors = neighbors.filter(n => n.maskType === npc.maskType);\r\n        let count = 0;\r\n        \r\n        for (const neighbor of sameGroupNeighbors) {\r\n            const distance = npc.transform.distanceTo(neighbor.transform);\r\n            if (distance < params.NPC_COHESION_RADIUS && distance > 0) {\r\n                cohesionForce.add(neighbor.transform.position);\r\n                count++;\r\n            }\r\n        }\r\n        \r\n        if (count > 0) {\r\n            cohesionForce.divideScalar(count);\r\n            cohesionForce.sub(npc.transform.position);\r\n            cohesionForce.normalize();\r\n        }\r\n    }\r\n\r\n    calculateInterGroupRepulsion(npc, neighbors, repulsionForce) {\r\n        const otherGroupNeighbors = neighbors.filter(n => n.maskType !== npc.maskType);\r\n        \r\n        for (const neighbor of otherGroupNeighbors) {\r\n            const distance = npc.transform.distanceTo(neighbor.transform);\r\n            if (distance < params.NPC_INTER_GROUP_DISTANCE && distance > 0) {\r\n                const direction = new THREE.Vector3()\r\n                    .subVectors(npc.transform.position, neighbor.transform.position)\r\n                    .normalize();\r\n                \r\n                // Exponential repulsion - stronger when closer\r\n                const repulsionStrength = Math.pow(params.NPC_INTER_GROUP_DISTANCE / distance, 2);\r\n                const force = direction.multiplyScalar(repulsionStrength);\r\n                repulsionForce.add(force);\r\n            }\r\n        }\r\n    }\r\n\r\n    calculateWanderingForce(npc, wanderingForce) {\r\n        if (npc.state === 'WANDERING') {\r\n            // Generate or update wander target\r\n            if (!npc.targetPosition || npc.transform.distanceTo({ position: npc.targetPosition }) < 2) {\r\n                npc.targetPosition = this.generateWanderTarget(npc);\r\n            }\r\n            \r\n            // Steer towards target\r\n            wanderingForce.subVectors(npc.targetPosition, npc.transform.position);\r\n            wanderingForce.normalize();\r\n        } else {\r\n            // Gentle random movement for non-wandering states\r\n            wanderingForce.set(\r\n                (Math.random() - 0.5) * 0.5,\r\n                0,\r\n                (Math.random() - 0.5) * 0.5\r\n            );\r\n        }\r\n    }\r\n    \r\n    generateWanderTarget(npc) {\r\n        // Generate a target position within wander radius but on planet surface\r\n        const angle = Math.random() * Math.PI * 2;\r\n        const distance = Math.random() * params.NPC_WANDER_RADIUS;\r\n        \r\n        const currentPos = npc.transform.position.clone();\r\n        const wanderOffset = new THREE.Vector3(\r\n            Math.cos(angle) * distance,\r\n            0,\r\n            Math.sin(angle) * distance\r\n        );\r\n        \r\n        const targetPos = currentPos.add(wanderOffset);\r\n        \r\n        // Project to planet surface\r\n        const planetDistance = targetPos.length();\r\n        if (planetDistance > 0) {\r\n            const surfaceDistance = this.planetRadius + params.NPC_SIZE / 2;\r\n            targetPos.normalize().multiplyScalar(surfaceDistance);\r\n        }\r\n        \r\n        return targetPos;\r\n    }\r\n\r\n    // Utility method to limit force magnitude\r\n    limitForce(force, maxForce) {\r\n        if (force.length() > maxForce) {\r\n            force.normalize().multiplyScalar(maxForce);\r\n        }\r\n    }\r\n    \r\n    limitNPCSpeed(npc) {\r\n        // Use a more reasonable speed calculation: base speed + small variation\r\n        const speedVariation = (npc.personality.energy - 0.5) * params.NPC_SPEED_VARIATION;\r\n        const maxSpeed = params.NPC_BASE_SPEED + speedVariation;\r\n        \r\n        if (npc.velocity.length() > maxSpeed) {\r\n            npc.velocity.normalize().multiplyScalar(maxSpeed);\r\n        }\r\n    }\r\n\r\n    applyNPCMovement(npc, deltaTime) {\r\n        // Apply velocity to position\r\n        const movement = npc.velocity.clone().multiplyScalar(deltaTime);\r\n        npc.transform.position.add(movement);\r\n        \r\n        // Project to planet surface\r\n        this.projectToSurface(npc);\r\n    }\r\n\r\n    projectToSurface(npc) {\r\n        const position = npc.transform.position;\r\n        const distance = position.length();\r\n        \r\n        if (distance > 0) {\r\n            const targetDistance = this.planetRadius + params.NPC_SIZE / 2;\r\n            const normalizedPos = position.clone().normalize().multiplyScalar(targetDistance);\r\n            npc.transform.setPosition(normalizedPos.x, normalizedPos.y, normalizedPos.z);\r\n        }\r\n    }\r\n\r\n    generateRandomPosition() {\r\n        const theta = Math.random() * Math.PI * 2;\r\n        const phi = Math.acos(2 * Math.random() - 1);\r\n        const radius = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        return new THREE.Vector3(\r\n            radius * Math.sin(phi) * Math.cos(theta),\r\n            radius * Math.cos(phi),\r\n            radius * Math.sin(phi) * Math.sin(theta)\r\n        );\r\n    }\r\n\r\n    generateGroupSpawnPosition(maskType) {\r\n        // Generate specific spawn zones for each group around the planet\r\n        // Each group gets a section of the planet surface\r\n        const groupAngle = (maskType - 1) * (Math.PI * 2 / 7); // 7 groups evenly distributed\r\n        const latitudeVariation = (Math.random() - 0.5) * Math.PI * 0.3; // Some vertical variation\r\n        \r\n        const theta = groupAngle + (Math.random() - 0.5) * 0.5; // Small random offset\r\n        const phi = Math.PI / 2 + latitudeVariation; // Around equator with variation\r\n        const radius = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        return new THREE.Vector3(\r\n            radius * Math.sin(phi) * Math.cos(theta),\r\n            radius * Math.cos(phi),\r\n            radius * Math.sin(phi) * Math.sin(theta)\r\n        );\r\n    }\r\n\r\n    getNearbyNPCs(npc, radius) {\r\n        return this.npcs.filter(other => {\r\n            if (other === npc) return false;\r\n            if (!npc.transform || !other.transform) return false;\r\n            return npc.transform.distanceTo(other.transform) <= radius;\r\n        });\r\n    }\r\n\r\n    // Helper method to find NPCs near a position (used for player crowd detection)\r\n    getNearbyNPCsFromPosition(position, radius) {\r\n        return this.npcs.filter(npc => {\r\n            if (!npc || !npc.transform) return false;\r\n            return position.distanceTo(npc.transform.position) <= radius;\r\n        });\r\n    }\r\n\r\n    updateGroupBehaviors(deltaTime) {\r\n        // Update group-level behaviors\r\n        for (const group of this.groups.values()) {\r\n            this.updateGroupCohesion(group, deltaTime);\r\n        }\r\n    }\r\n\r\n    updateGroupCohesion(group, deltaTime) {\r\n        // Calculate group center\r\n        const center = new THREE.Vector3();\r\n        for (const npc of group.npcs) {\r\n            center.add(npc.transform.position);\r\n        }\r\n        center.divideScalar(group.npcs.length);\r\n        \r\n        group.center = center;\r\n        \r\n        // Update group activity\r\n        group.activity = Math.max(0.1, Math.min(1.0, \r\n            group.activity + (Math.random() - 0.5) * 0.1 * deltaTime\r\n        ));\r\n    }\r\n\r\n    handlePlayerInteractions() {\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (!playerSystem) return;\r\n        \r\n        const playerPosition = playerSystem.getPlayerPosition();\r\n        const playerMask = playerSystem.getCurrentMask();\r\n        \r\n        // Check NPC interactions with player\r\n        for (const npc of this.npcs) {\r\n            const distance = npc.transform.distanceTo({ position: playerPosition });\r\n            \r\n            if (distance <= params.NPC_INTERACTION_RADIUS) {\r\n                this.handleNPCPlayerInteraction(npc, playerMask, distance);\r\n            }\r\n        }\r\n    }\r\n\r\n    handleNPCPlayerInteraction(npc, playerMask, distance) {\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        if (!gameStateSystem) return;\r\n        \r\n        // Throttle interactions to prevent event spam\r\n        const currentTime = Date.now();\r\n        if (!npc.lastInteractionTime) {\r\n            npc.lastInteractionTime = 0;\r\n        }\r\n        \r\n        // Only process interaction if enough time has passed (500ms cooldown)\r\n        const interactionCooldown = 500;\r\n        if (currentTime - npc.lastInteractionTime < interactionCooldown) {\r\n            return;\r\n        }\r\n        \r\n        if (playerMask === null) {\r\n            // Neutral player - mild curiosity but no strong reaction\r\n            npc.playerInfluence = Math.max(0, npc.playerInfluence - 0.1);\r\n            npc.lastInteractionTime = currentTime;\r\n            return;\r\n        }\r\n        \r\n        if (playerMask === npc.maskType) {\r\n            // Same mask - positive interaction\r\n            const influence = params.NPC_SAME_MASK_INFLUENCE;\r\n            gameStateSystem.addOutrage(-influence);\r\n            gameStateSystem.addEnergy(params.ENERGY_RECHARGE_RATE / 60); // Recharge per frame\r\n            \r\n            // NPC becomes more cohesive and attracted to player\r\n            npc.state = 'GATHERING';\r\n            npc.stateTimer = 0;\r\n            npc.playerInfluence = Math.min(1, npc.playerInfluence + 0.2);\r\n            \r\n            // Increase flocking cohesion temporarily\r\n            npc.flockingBoost = 1.5;\r\n            npc.flockingBoostTimer = 3.0;\r\n        } else {\r\n            // Different mask - negative interaction\r\n            const influence = params.NPC_DIFFERENT_MASK_INFLUENCE;\r\n            gameStateSystem.addOutrage(influence);\r\n            gameStateSystem.addEnergy(-params.NPC_ENERGY_DRAIN_RATE);\r\n            \r\n            // NPC becomes more separated and avoids player\r\n            npc.state = 'IDLE'; // Changed from FLEEING to IDLE for better flocking\r\n            npc.stateTimer = 0;\r\n            npc.playerInfluence = Math.max(-1, npc.playerInfluence - 0.3);\r\n            \r\n            // Increase separation force temporarily\r\n            npc.separationBoost = 2.0;\r\n            npc.separationBoostTimer = 4.0;\r\n        }\r\n        \r\n        // Update last interaction time\r\n        npc.lastInteractionTime = currentTime;\r\n        \r\n        // Trigger flocking response in nearby NPCs\r\n        this.triggerFlockingResponse(npc, playerMask);\r\n    }\r\n    \r\n    triggerFlockingResponse(triggerNPC, playerMask) {\r\n        const nearbyNPCs = this.getNearbyNPCs(triggerNPC, params.NPC_FLOCKING_RADIUS * 1.5);\r\n        \r\n        for (const npc of nearbyNPCs) {\r\n            if (npc.maskType === triggerNPC.maskType) {\r\n                // Same group - amplify the response\r\n                if (playerMask === npc.maskType) {\r\n                    npc.flockingBoost = (npc.flockingBoost || 1) * 1.2;\r\n                    npc.flockingBoostTimer = 2.0;\r\n                } else {\r\n                    npc.separationBoost = (npc.separationBoost || 1) * 1.3;\r\n                    npc.separationBoostTimer = 3.0;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Public interface\r\n    getNPCCount() {\r\n        return this.npcs.length;\r\n    }\r\n\r\n    getNPCsInRadius(center, radius) {\r\n        return this.npcs.filter(npc => {\r\n            const distance = npc.transform.distanceTo({ position: center });\r\n            return distance <= radius;\r\n        });\r\n    }\r\n\r\n    getGroupStats() {\r\n        const stats = {};\r\n        for (const [maskType, group] of this.groups) {\r\n            const groupStats = {\r\n                count: group.npcs.length,\r\n                activity: group.activity,\r\n                cohesion: group.cohesion,\r\n                center: group.center,\r\n                flocking: {\r\n                    averageVelocity: new THREE.Vector3(),\r\n                    averageSeparation: 0,\r\n                    averageAlignment: 0,\r\n                    averageCohesion: 0\r\n                }\r\n            };\r\n            \r\n            // Calculate flocking metrics\r\n            let velocitySum = new THREE.Vector3();\r\n            let separationSum = 0;\r\n            let alignmentSum = 0;\r\n            let cohesionSum = 0;\r\n            \r\n            for (const npc of group.npcs) {\r\n                velocitySum.add(npc.velocity);\r\n                separationSum += npc.separationBoost || 1.0;\r\n                alignmentSum += npc.flockingBoost || 1.0;\r\n                cohesionSum += npc.flockingBoost || 1.0;\r\n            }\r\n            \r\n            if (group.npcs.length > 0) {\r\n                groupStats.flocking.averageVelocity = velocitySum.divideScalar(group.npcs.length);\r\n                groupStats.flocking.averageSeparation = separationSum / group.npcs.length;\r\n                groupStats.flocking.averageAlignment = alignmentSum / group.npcs.length;\r\n                groupStats.flocking.averageCohesion = cohesionSum / group.npcs.length;\r\n            }\r\n            \r\n            stats[maskType] = groupStats;\r\n        }\r\n        return stats;\r\n    }\r\n    \r\n    // Debug method to visualize flocking forces (optional)\r\n    debugFlockingForces(enabled = false) {\r\n        if (!enabled) return;\r\n        \r\n        console.log('🐟 Flocking Debug Info:');\r\n        const stats = this.getGroupStats();\r\n        \r\n        for (const [maskType, groupStats] of Object.entries(stats)) {\r\n            console.log(`Group ${maskType}:`, {\r\n                npcs: groupStats.count,\r\n                avgVelocity: groupStats.flocking.averageVelocity.length().toFixed(2),\r\n                avgSeparation: groupStats.flocking.averageSeparation.toFixed(2),\r\n                avgAlignment: groupStats.flocking.averageAlignment.toFixed(2),\r\n                avgCohesion: groupStats.flocking.averageCohesion.toFixed(2)\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Console helper methods for debugging\r\n    setupConsoleHelpers() {\r\n        if (typeof window !== 'undefined') {\r\n            window.npcFlocking = {\r\n                debug: (enabled) => {\r\n                    window.debugFlocking = enabled;\r\n                    console.log(`🐟 Flocking debug ${enabled ? 'enabled' : 'disabled'}`);\r\n                },\r\n                stats: () => this.getGroupStats(),\r\n                setParameter: (param, value) => {\r\n                    if (params[param] !== undefined) {\r\n                        params[param] = value;\r\n                        console.log(`🐟 Set ${param} to ${value}`);\r\n                    } else {\r\n                        console.log(`🐟 Parameter ${param} not found`);\r\n                    }\r\n                },\r\n                resetForces: () => {\r\n                    for (const npc of this.npcs) {\r\n                        npc.flockingBoost = 1.0;\r\n                        npc.separationBoost = 1.0;\r\n                        npc.playerInfluence = 0.0;\r\n                        npc.flockingBoostTimer = 0;\r\n                        npc.separationBoostTimer = 0;\r\n                    }\r\n                    console.log('🐟 Reset all flocking forces');\r\n                }\r\n            };\r\n            \r\n            window.npcCollisions = {\r\n                toggle: () => this.togglePlayerNPCCollisions(),\r\n                setRadius: (radius) => this.setCollisionRadius(radius),\r\n                setPushForce: (force) => this.setPushForce(force),\r\n                setPushVelocity: (velocity) => this.setPushVelocity(velocity),\r\n                debug: (enabled) => {\r\n                    if (enabled) {\r\n                        this.enableCollisionDebug();\r\n                    } else {\r\n                        this.disableCollisionDebug();\r\n                    }\r\n                },\r\n                status: () => {\r\n                    console.log(`💥 Player-NPC Collision System:`);\r\n                    console.log(`   Enabled: ${params.PLAYER_NPC_COLLISION_ENABLED}`);\r\n                    console.log(`   Radius: ${params.PLAYER_NPC_COLLISION_RADIUS}`);\r\n                    console.log(`   Push Force: ${params.PLAYER_NPC_PUSH_FORCE}`);\r\n                    console.log(`   Push Velocity: ${params.PLAYER_NPC_PUSH_VELOCITY}`);\r\n                    console.log(`   Debug: ${window.debugCollisions || false}`);\r\n                }\r\n            };\r\n            \r\n            console.log('🐟 Flocking console helpers available: window.npcFlocking');\r\n            console.log('💥 Collision console helpers available: window.npcCollisions');\r\n        }\r\n    }\r\n\r\n    // Debug methods for collision system\r\n    togglePlayerNPCCollisions() {\r\n        params.PLAYER_NPC_COLLISION_ENABLED = !params.PLAYER_NPC_COLLISION_ENABLED;\r\n        console.log(`💥 Player-NPC collisions: ${params.PLAYER_NPC_COLLISION_ENABLED ? 'ENABLED' : 'DISABLED'}`);\r\n    }\r\n\r\n    setCollisionRadius(radius) {\r\n        params.PLAYER_NPC_COLLISION_RADIUS = Math.max(0.1, Math.min(2.0, radius));\r\n        console.log(`💥 Player-NPC collision radius set to: ${params.PLAYER_NPC_COLLISION_RADIUS}`);\r\n    }\r\n\r\n    setPushForce(force) {\r\n        params.PLAYER_NPC_PUSH_FORCE = Math.max(0.1, Math.min(5.0, force));\r\n        console.log(`💥 Player push force set to: ${params.PLAYER_NPC_PUSH_FORCE}`);\r\n    }\r\n\r\n    setPushVelocity(velocity) {\r\n        params.PLAYER_NPC_PUSH_VELOCITY = Math.max(0.0, Math.min(2.0, velocity));\r\n        console.log(`💥 Player push velocity set to: ${params.PLAYER_NPC_PUSH_VELOCITY}`);\r\n    }\r\n\r\n    enableCollisionDebug() {\r\n        window.debugCollisions = true;\r\n        console.log('💥 Player-NPC collision debugging enabled');\r\n    }\r\n\r\n    disableCollisionDebug() {\r\n        window.debugCollisions = false;\r\n        console.log('💥 Player-NPC collision debugging disabled');\r\n    }\r\n\r\n    // IGameSystem implementation\r\n    onPlayerAction(action) {\r\n        if (action.type === 'polarize') {\r\n            // Player has polarized NPCs\r\n            const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n            if (gameStateSystem) {\r\n                gameStateSystem.addPolarisedPeople(action.count);\r\n            }\r\n        }\r\n    }\r\n\r\n    shutdown() {\r\n        // Clean up NPCs\r\n        for (const npc of this.npcs) {\r\n            if (npc.renderer) {\r\n                npc.renderer.dispose();\r\n            }\r\n        }\r\n        \r\n        this.npcs = [];\r\n        this.groups.clear();\r\n        \r\n        // console.log('👥 NPC System shutdown');\r\n    }\r\n\r\n    // Public method to get all NPCs (for other systems to access)\r\n    getAllNPCs() {\r\n        return this.npcs;\r\n    }\r\n} ","// systems/PoliceSystem.js - Police NPC management following SOLID principles\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\nimport { Transform } from '../components/Transform.js';\r\nimport { Renderer } from '../components/Renderer.js';\r\nimport { params } from '../params.js';\r\nimport { serviceContainer } from '../core/ServiceContainer.js';\r\nimport { NPCFactory } from '../factories/NPCFactory.js';\r\nimport { GameEventTypes } from '../interfaces/GameEvents.js';\r\n\r\nexport class PoliceSystem extends IGameSystem {\r\n    constructor() {\r\n        super('Police');\r\n        \r\n        this.isActive = false;\r\n        this.policeNPCs = [];\r\n        this.planetRadius = 0;\r\n        this.scene = null;\r\n        this.npcFactory = new NPCFactory();\r\n        \r\n        // Use parameter instead of hardcoded value\r\n        this.activationOutrage = params.OUTRAGE_POLICE_THRESHOLD;\r\n        this.maxPolice = 2; // Fewer police NPCs than drones\r\n        this.spawnRadius = this.planetRadius + params.NPC_SIZE / 2;\r\n        this.detectionRadius = params.POLICE_CATCH_DISTANCE || 2;\r\n        this.speed = params.POLICE_SPEED_MULTIPLIER || 1.3;\r\n        \r\n        // Timing\r\n        this.activationTimer = 0;\r\n        this.spawnTimer = 0;\r\n        this.spawnInterval = 1.5; // seconds between police spawns (reduced from 3 to 1.5)\r\n        \r\n        // Damage system\r\n        this.damageInterval = 0.5; // Apply damage every 0.5 seconds\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        this.scene = sceneManager.getScene();\r\n        this.planet = sceneManager.getPlanet();\r\n        this.planetRadius = sceneManager.getPlanetRadius();\r\n        \r\n        // Update spawn radius now that we have planetRadius\r\n        this.spawnRadius = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        console.log('🚔 Police System initialized');\r\n        console.log(`🚔 Police speed multiplier: ${params.POLICE_SPEED_MULTIPLIER || 1.3}`);\r\n        console.log(`🚔 Player speed: ${params.PLAYER_SPEED || 20}`);\r\n        console.log(`🚔 Police catch distance: ${params.POLICE_CATCH_DISTANCE || 2}`);\r\n        console.log(`🚔 Police spawn interval: ${this.spawnInterval}s`);\r\n    }\r\n\r\n    update(deltaTime) {\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        if (!gameStateSystem) return;\r\n        \r\n        // Check activation status\r\n        const shouldBeActive = gameStateSystem.outrage >= this.activationOutrage;\r\n        \r\n        if (shouldBeActive && !this.isActive) {\r\n            this.activate();\r\n        } else if (!shouldBeActive && this.isActive) {\r\n            this.deactivate();\r\n        }\r\n        \r\n        if (this.isActive) {\r\n            this.updateActiveBehavior(deltaTime);\r\n        }\r\n        \r\n        // Update all police NPCs\r\n        for (const policeNPC of this.policeNPCs) {\r\n            this.updatePoliceNPC(policeNPC, deltaTime);\r\n        }\r\n        \r\n        // Resolve collisions between police officers\r\n        this.resolvePoliceCollisions();\r\n        \r\n        // Resolve collisions between police and normal NPCs\r\n        this.resolvePoliceNPCCollisions();\r\n    }\r\n\r\n    activate() {\r\n        this.isActive = true;\r\n        this.spawnTimer = 0;\r\n        console.log('🚔 Police system activated - officers incoming!');\r\n        \r\n        // Spawn first police officer immediately for instant response\r\n        if (this.policeNPCs.length < this.maxPolice) {\r\n            this.spawnPoliceNPC();\r\n            console.log('🚔 First police officer spawned immediately!');\r\n        }\r\n        \r\n        // Notify game state\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        if (gameStateSystem) {\r\n            gameStateSystem.setBeingChased(true);\r\n        }\r\n        \r\n        // Publish police activation event for visual effects\r\n        this.publishEvent(GameEventTypes.POLICE_ACTIVATE, {\r\n            outrageLevel: gameStateSystem?.outrage || 0,\r\n            policeCount: this.policeNPCs.length,\r\n            activationReason: 'outrage_threshold'\r\n        });\r\n    }\r\n\r\n    deactivate() {\r\n        this.isActive = false;\r\n        console.log('🚔 Police system deactivated');\r\n        \r\n        // Notify game state\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        if (gameStateSystem) {\r\n            gameStateSystem.setBeingChased(false);\r\n        }\r\n        \r\n        // Publish police deactivation event for visual effects\r\n        this.publishEvent(GameEventTypes.POLICE_DEACTIVATE, {\r\n            outrageLevel: gameStateSystem?.outrage || 0,\r\n            policeCount: this.policeNPCs.length,\r\n            deactivationReason: 'outrage_low'\r\n        });\r\n        \r\n        // Remove all police NPCs gradually\r\n        for (const policeNPC of this.policeNPCs) {\r\n            policeNPC.isRetreating = true;\r\n        }\r\n    }\r\n\r\n    updateActiveBehavior(deltaTime) {\r\n        // Spawn new police NPCs if needed\r\n        if (this.policeNPCs.length < this.maxPolice) {\r\n            this.spawnTimer += deltaTime;\r\n            \r\n            if (this.spawnTimer >= this.spawnInterval) {\r\n                this.spawnPoliceNPC();\r\n                this.spawnTimer = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    spawnPoliceNPC() {\r\n        const policeNPC = this.createPoliceNPC();\r\n        this.policeNPCs.push(policeNPC);\r\n        console.log(`🚔 Police NPC spawned (${this.policeNPCs.length}/${this.maxPolice})`);\r\n    }\r\n\r\n    createPoliceNPC() {\r\n        // Generate random position on planet surface\r\n        const theta = Math.random() * Math.PI * 2;\r\n        const phi = Math.acos(2 * Math.random() - 1);\r\n        const radius = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        const position = new THREE.Vector3(\r\n            radius * Math.sin(phi) * Math.cos(theta),\r\n            radius * Math.cos(phi),\r\n            radius * Math.sin(phi) * Math.sin(theta)\r\n        );\r\n\r\n        const policeNPC = this.npcFactory.createNPC('police', {\r\n            planetRadius: this.planetRadius,\r\n            scene: this.scene,\r\n            groupSpawnCenter: position,\r\n            groupSpawnRadius: 0 // Spawn exactly at position\r\n        });\r\n        \r\n        // Additional police-specific setup\r\n        policeNPC.isRetreating = false;\r\n        policeNPC.stateTimer = 0;\r\n        policeNPC.lastDamageTime = 0; // Initialize to 0 to allow immediate first damage\r\n        \r\n        return policeNPC;\r\n    }\r\n\r\n    updatePoliceNPC(policeNPC, deltaTime) {\r\n        if (!policeNPC.transform || !policeNPC.renderer) return;\r\n        \r\n        policeNPC.stateTimer += deltaTime;\r\n        \r\n        if (policeNPC.isRetreating) {\r\n            this.updateRetreatingNPC(policeNPC, deltaTime);\r\n        } else {\r\n            this.updatePursuingNPC(policeNPC, deltaTime);\r\n        }\r\n    }\r\n\r\n    updatePursuingNPC(policeNPC, deltaTime) {\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (!playerSystem) return;\r\n        \r\n        const playerPosition = playerSystem.getPlayerPosition();\r\n        const distanceToPlayer = policeNPC.transform.distanceTo({ position: playerPosition });\r\n        \r\n        // Check for collision first\r\n        if (distanceToPlayer <= policeNPC.detectionRadius) {\r\n            // Police is close enough to damage player\r\n            this.handlePoliceCollision(policeNPC, deltaTime);\r\n            return; // Don't move closer if already in collision range\r\n        }\r\n        \r\n        // Move towards player using the same quaternion-based movement as player\r\n        this.movePoliceTowardsPlayer(policeNPC, playerPosition, deltaTime);\r\n        \r\n        // Update renderer\r\n        policeNPC.renderer.updateTransform(policeNPC.transform);\r\n        \r\n        // Ensure police NPC faces camera (like player and other NPCs)\r\n        this.updatePoliceOrientation(policeNPC);\r\n        \r\n        // Log occasionally to avoid spam\r\n        if (Math.floor(Date.now() / 1000) % 3 === 0 && Math.random() < 0.1) {\r\n            const speed = params.PLAYER_SPEED * policeNPC.speedMultiplier * deltaTime;\r\n            console.log(`🚔 Police NPC pursuing player (distance: ${distanceToPlayer.toFixed(2)}, speed: ${speed.toFixed(4)}, playerSpeed: ${(params.PLAYER_SPEED * deltaTime).toFixed(4)})`);\r\n        }\r\n    }\r\n\r\n    updateRetreatingNPC(policeNPC, deltaTime) {\r\n        // Move away from planet center (outward from surface)\r\n        const direction = new THREE.Vector3()\r\n            .copy(policeNPC.transform.position)\r\n            .normalize();\r\n        \r\n        // Retreat faster than normal pursuit speed - use simple linear movement for retreat\r\n        const moveSpeed = params.PLAYER_SPEED * policeNPC.speedMultiplier * 2 * deltaTime;\r\n        const movement = direction.multiplyScalar(moveSpeed);\r\n        policeNPC.transform.position.add(movement);\r\n        \r\n        // Remove NPC if far enough\r\n        if (policeNPC.transform.position.length() > this.planetRadius * 2) {\r\n            this.removePoliceNPC(policeNPC);\r\n        }\r\n        \r\n        // Update renderer\r\n        policeNPC.renderer.updateTransform(policeNPC.transform);\r\n        \r\n        // Ensure police NPC faces camera even while retreating\r\n        this.updatePoliceOrientation(policeNPC);\r\n    }\r\n\r\n    movePoliceTowardsPlayer(policeNPC, playerPosition, deltaTime) {\r\n        // Use the same quaternion-based movement system as the player\r\n        const speed = params.PLAYER_SPEED * policeNPC.speedMultiplier * deltaTime;\r\n        const radius = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        const currentPos = policeNPC.transform.position.clone();\r\n        \r\n        // Calculate direction to player on the sphere surface\r\n        const toPlayerDirection = new THREE.Vector3().subVectors(playerPosition, currentPos);\r\n        \r\n        // Project direction onto the tangent plane at police position\r\n        const surfaceNormal = currentPos.clone().normalize();\r\n        const projectedDirection = toPlayerDirection.clone();\r\n        const dotProduct = projectedDirection.dot(surfaceNormal);\r\n        projectedDirection.addScaledVector(surfaceNormal, -dotProduct);\r\n        \r\n        if (projectedDirection.length() < 0.01) return; // No movement needed\r\n        \r\n        projectedDirection.normalize();\r\n        \r\n        // Calculate rotation from movement (same as player system)\r\n        const rotationAxis = new THREE.Vector3().crossVectors(currentPos, projectedDirection);\r\n        rotationAxis.normalize();\r\n        \r\n        // The angle of rotation is the distance to travel divided by the sphere's radius\r\n        const angularDistance = speed / radius;\r\n        const rotation = new THREE.Quaternion().setFromAxisAngle(rotationAxis, angularDistance);\r\n        \r\n        // Apply rotation to police position\r\n        const newPosition = currentPos.clone().applyQuaternion(rotation);\r\n        \r\n        // Ensure the police stays exactly on the surface\r\n        newPosition.normalize().multiplyScalar(radius);\r\n        \r\n        policeNPC.transform.setPosition(newPosition.x, newPosition.y, newPosition.z);\r\n    }\r\n\r\n    handlePoliceCollision(policeNPC, deltaTime) {\r\n        // Police is in collision range with player\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        if (!gameStateSystem) return;\r\n        \r\n        // Track time since last damage to avoid spam\r\n        const currentTime = Date.now();\r\n        if (currentTime - policeNPC.lastDamageTime < this.damageInterval * 1000) {\r\n            return; // Too soon since last damage\r\n        }\r\n        \r\n        // Apply damage to player's energy\r\n        const damage = policeNPC.damageRate * this.damageInterval;\r\n        gameStateSystem.decreaseEnergy(damage);\r\n        \r\n        policeNPC.lastDamageTime = currentTime;\r\n        \r\n        console.log(`🚔 Police NPC collision! Energy reduced by ${damage.toFixed(1)}`);\r\n        \r\n        // If player energy reaches 0, game over\r\n        if (gameStateSystem.energy <= 0) {\r\n            gameStateSystem.endGame('CAUGHT');\r\n        }\r\n    }\r\n\r\n    updatePoliceOrientation(policeNPC) {\r\n        if (!policeNPC.renderer || !policeNPC.renderer.mesh) return;\r\n        \r\n        // Get camera for orientation\r\n        const camera = serviceContainer.resolve('camera');\r\n        if (!camera) return;\r\n        \r\n        // Calculate camera's up vector from its matrix\r\n        const cameraUpVector = new THREE.Vector3(0, 1, 0);\r\n        cameraUpVector.applyQuaternion(camera.quaternion);\r\n        \r\n        // Set the mesh \"up\" direction to match camera's up orientation\r\n        policeNPC.renderer.mesh.up.copy(cameraUpVector);\r\n        \r\n        // Make the police NPC plane face the camera with correct up orientation\r\n        policeNPC.renderer.mesh.lookAt(camera.position);\r\n    }\r\n\r\n    constrainToSurface(policeNPC) {\r\n        // Keep NPC on planet surface\r\n        const currentDistance = policeNPC.transform.position.length();\r\n        const targetDistance = this.planetRadius + params.NPC_SIZE / 2;\r\n        \r\n        if (Math.abs(currentDistance - targetDistance) > 0.1) {\r\n            policeNPC.transform.position.normalize().multiplyScalar(targetDistance);\r\n        }\r\n    }\r\n\r\n    resolvePoliceCollisions() {\r\n        // Check if police collisions are enabled\r\n        if (!params.POLICE_COLLISION_ENABLED) return;\r\n        \r\n        // Collision detection between police officers\r\n        for (let i = 0; i < this.policeNPCs.length; i++) {\r\n            for (let j = i + 1; j < this.policeNPCs.length; j++) {\r\n                const police1 = this.policeNPCs[i];\r\n                const police2 = this.policeNPCs[j];\r\n\r\n                if (!police1.transform || !police2.transform) continue;\r\n\r\n                const distance = police1.transform.position.distanceTo(police2.transform.position);\r\n                const minDistance = params.NPC_SIZE; // Use same size as NPCs\r\n\r\n                if (distance < minDistance && distance > 0.01) {\r\n                    const overlap = minDistance - distance;\r\n                    const direction = new THREE.Vector3()\r\n                        .subVectors(police1.transform.position, police2.transform.position)\r\n                        .normalize();\r\n                    \r\n                    // Move each police officer back by half of the overlap\r\n                    const correction = direction.multiplyScalar(overlap / 2);\r\n                    police1.transform.position.add(correction);\r\n                    police2.transform.position.sub(correction);\r\n\r\n                    // Re-project to surface after correction\r\n                    this.constrainToSurface(police1);\r\n                    this.constrainToSurface(police2);\r\n                    \r\n                    // Optional debug logging\r\n                    if (window.debugCollisions) {\r\n                        console.log(`🚔💥 Police collision resolved: distance=${distance.toFixed(2)}, overlap=${overlap.toFixed(2)}`);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    resolvePoliceNPCCollisions() {\r\n        // Check if police collisions are enabled\r\n        if (!params.POLICE_COLLISION_ENABLED) return;\r\n        \r\n        // Collision detection between police and normal NPCs\r\n        const npcSystem = serviceContainer.resolve('npcSystem');\r\n        if (!npcSystem) return;\r\n\r\n        const normalNPCs = npcSystem.getAllNPCs();\r\n        if (!normalNPCs) return;\r\n\r\n        for (const policeNPC of this.policeNPCs) {\r\n            if (!policeNPC.transform) continue;\r\n\r\n            for (const normalNPC of normalNPCs) {\r\n                if (!normalNPC.transform) continue;\r\n\r\n                const distance = policeNPC.transform.position.distanceTo(normalNPC.transform.position);\r\n                const minDistance = params.NPC_SIZE; // Both use same size\r\n\r\n                if (distance < minDistance && distance > 0.01) {\r\n                    const overlap = minDistance - distance;\r\n                    const direction = new THREE.Vector3()\r\n                        .subVectors(policeNPC.transform.position, normalNPC.transform.position)\r\n                        .normalize();\r\n                    \r\n                    // Use configurable force ratios from params\r\n                    const policeForceRatio = params.POLICE_FORCE_RATIO; // Police moves back this much\r\n                    const npcForceRatio = params.POLICE_NPC_PUSH_RATIO; // NPC moves back this much\r\n                    \r\n                    const policeCorrection = direction.multiplyScalar(overlap * policeForceRatio);\r\n                    const npcCorrection = direction.multiplyScalar(-overlap * npcForceRatio);\r\n                    \r\n                    policeNPC.transform.position.add(policeCorrection);\r\n                    normalNPC.transform.position.add(npcCorrection);\r\n\r\n                    // Re-project to surface after correction\r\n                    this.constrainToSurface(policeNPC);\r\n                    npcSystem.projectToSurface(normalNPC);\r\n                    \r\n                    // Add some velocity to the NPC for more natural movement\r\n                    if (normalNPC.velocity) {\r\n                        const pushVelocity = direction.multiplyScalar(-overlap * 0.1);\r\n                        normalNPC.velocity.add(pushVelocity);\r\n                    }\r\n                    \r\n                    // Optional debug logging\r\n                    if (window.debugCollisions) {\r\n                        console.log(`🚔👤 Police-NPC collision resolved: distance=${distance.toFixed(2)}, overlap=${overlap.toFixed(2)}`);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // Public method to get all police NPCs (for NPCSystem to access)\r\n    getAllPoliceNPCs() {\r\n        return this.policeNPCs;\r\n    }\r\n\r\n    removePoliceNPC(policeNPC) {\r\n        if (policeNPC.renderer) {\r\n            policeNPC.renderer.dispose();\r\n        }\r\n        \r\n        const index = this.policeNPCs.indexOf(policeNPC);\r\n        if (index > -1) {\r\n            this.policeNPCs.splice(index, 1);\r\n            console.log(`🚔 Police NPC removed (${this.policeNPCs.length} remaining)`);\r\n        }\r\n    }\r\n\r\n    // Public interface methods updated for police NPCs\r\n    getPoliceCount() {\r\n        return this.policeNPCs.length;\r\n    }\r\n\r\n    getPolicePositions() {\r\n        return this.policeNPCs.map(policeNPC => ({\r\n            id: policeNPC.id,\r\n            position: policeNPC.transform.position.clone(),\r\n            state: policeNPC.state,\r\n            isRetreating: policeNPC.isRetreating\r\n        }));\r\n    }\r\n\r\n    // Additional public interface methods\r\n    isPoliceActive() {\r\n        return this.isActive;\r\n    }\r\n\r\n    // Debug methods for collision system\r\n    togglePoliceCollisions() {\r\n        params.POLICE_COLLISION_ENABLED = !params.POLICE_COLLISION_ENABLED;\r\n        console.log(`🚔💥 Police collisions: ${params.POLICE_COLLISION_ENABLED ? 'ENABLED' : 'DISABLED'}`);\r\n    }\r\n\r\n    setPoliceForceRatio(ratio) {\r\n        params.POLICE_FORCE_RATIO = Math.max(0, Math.min(1, ratio));\r\n        console.log(`🚔💥 Police force ratio set to: ${params.POLICE_FORCE_RATIO}`);\r\n    }\r\n\r\n    setPoliceNPCPushRatio(ratio) {\r\n        params.POLICE_NPC_PUSH_RATIO = Math.max(0, Math.min(1, ratio));\r\n        console.log(`🚔💥 Police NPC push ratio set to: ${params.POLICE_NPC_PUSH_RATIO}`);\r\n    }\r\n\r\n    enablePoliceCollisionDebug() {\r\n        window.debugCollisions = true;\r\n        console.log('🚔💥 Police collision debugging enabled');\r\n    }\r\n\r\n    disablePoliceCollisionDebug() {\r\n        window.debugCollisions = false;\r\n        console.log('🚔💥 Police collision debugging disabled');\r\n    }\r\n\r\n    // IGameSystem implementation\r\n    onGameStateChange(newState) {\r\n        if (newState.property === 'outrage') {\r\n            // React to outrage changes\r\n            const shouldBeActive = newState.newValue >= this.activationOutrage;\r\n            \r\n            if (shouldBeActive && !this.isActive) {\r\n                this.activate();\r\n            } else if (!shouldBeActive && this.isActive) {\r\n                this.deactivate();\r\n            }\r\n        }\r\n    }\r\n\r\n    onPlayerAction(action) {\r\n        if (action.type === 'maskChange' && action.maskType === null) {\r\n            // Player went neutral - reduce pursuit intensity\r\n            for (const policeNPC of this.policeNPCs) {\r\n                if (policeNPC.state === 'PURSUING') {\r\n                    policeNPC.detectionRadius *= 0.8; // Reduce detection\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    shutdown() {\r\n        // Clean up all police NPCs\r\n        for (const policeNPC of this.policeNPCs) {\r\n            this.removePoliceNPC(policeNPC);\r\n        }\r\n        \r\n        this.policeNPCs = [];\r\n        this.isActive = false;\r\n        \r\n        console.log('🚔 Police System shutdown');\r\n    }\r\n}","// systems/UISystem.js - UI management following SOLID principles\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\nimport { params } from '../params.js';\r\nimport { serviceContainer } from '../core/ServiceContainer.js';\r\nimport { getTextureForMask } from '../factories/NPCFactory.js';\r\nimport { GameEventTypes, EventDataFactory, EventPriorities } from '../interfaces/GameEvents.js';\r\n\r\nexport class UISystem extends IGameSystem {\r\n    constructor() {\r\n        super('UI');\r\n        \r\n        this.elements = {};\r\n        this.isVisible = true;\r\n        this.gameStateSystem = null;\r\n        \r\n        // UI configuration\r\n        this.updateFrequency = 0.1; // Update every 100ms\r\n        this.lastUpdateTime = 0;\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        this.gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        \r\n        // Create UI elements\r\n        this.createUIElements();\r\n        \r\n        // Subscribe to game events using new event system\r\n        this.subscribeToEvent(\r\n            GameEventTypes.GAME_STATE_CHANGE,\r\n            (event) => this.onGameStateChange(event),\r\n            EventPriorities.LOW // UI updates have low priority\r\n        );\r\n        \r\n        this.subscribeToEvent(\r\n            GameEventTypes.GAME_OUTRAGE_CHANGE,\r\n            (event) => this.onOutrageChange(event),\r\n            EventPriorities.LOW\r\n        );\r\n        \r\n        this.subscribeToEvent(\r\n            GameEventTypes.PLAYER_MASK_CHANGE,\r\n            (event) => this.onPlayerMaskChange(event),\r\n            EventPriorities.LOW\r\n        );\r\n        \r\n        this.subscribeToEvent(\r\n            GameEventTypes.GAME_OVER,\r\n            (event) => this.onGameOver(event),\r\n            EventPriorities.HIGH // Game over needs immediate UI response\r\n        );\r\n        \r\n        console.log('🖥️ UI System initialized with event subscriptions');\r\n    }\r\n\r\n    createUIElements() {\r\n        // Create main UI container\r\n        this.elements.container = document.createElement('div');\r\n        this.elements.container.id = 'ui-container';\r\n        this.elements.container.style.cssText = `\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            pointer-events: none;\r\n            z-index: 1000;\r\n            font-family: 'Arial', sans-serif;\r\n            touch-action: manipulation;\r\n        `;\r\n        document.body.appendChild(this.elements.container);\r\n        \r\n        // Create HUD elements\r\n        this.createHUD();\r\n        this.createMaskSelector();\r\n        this.createGameOverScreen();\r\n        this.createInstructions();\r\n    }\r\n\r\n    createHUD() {\r\n        // Create vertical energy bar (left side)\r\n        this.elements.energyBar = document.createElement('div');\r\n        this.elements.energyBar.style.cssText = `\r\n            position: absolute;\r\n            top: 50%;\r\n            left: 20px;\r\n            transform: translateY(-50%);\r\n            width: 40px;\r\n            height: 300px;\r\n            background: rgba(0, 0, 0, 0.1);\r\n            border-radius: 20px;\r\n            padding: 15px 10px;\r\n            pointer-events: auto;\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n        `;\r\n        \r\n        const energyLabel = document.createElement('div');\r\n        energyLabel.style.cssText = `\r\n            color: white;\r\n            font-size: 12px;\r\n            font-weight: bold;\r\n            margin-bottom: 10px;\r\n            writing-mode: vertical-lr;\r\n            text-orientation: mixed;\r\n        `;\r\n        energyLabel.textContent = 'VIE';\r\n        \r\n        const energyContainer = document.createElement('div');\r\n        energyContainer.style.cssText = `\r\n            width: 20px;\r\n            height: 200px;\r\n            background: #333;\r\n            border-radius: 10px;\r\n            position: relative;\r\n            overflow: hidden;\r\n        `;\r\n        \r\n        const energyFill = document.createElement('div');\r\n        energyFill.id = 'energy-fill';\r\n        energyFill.style.cssText = `\r\n            background: linear-gradient(to top, #00f, #0ff);\r\n            width: 100%;\r\n            height: 100%;\r\n            border-radius: 10px;\r\n            transition: height 0.3s;\r\n            position: absolute;\r\n            bottom: 0;\r\n        `;\r\n        \r\n        const energyText = document.createElement('div');\r\n        energyText.id = 'energy-text';\r\n        energyText.style.cssText = `\r\n            color: white;\r\n            font-size: 10px;\r\n            font-weight: bold;\r\n            margin-top: 10px;\r\n            text-align: center;\r\n        `;\r\n        energyText.textContent = '100%';\r\n        \r\n        energyContainer.appendChild(energyFill);\r\n        this.elements.energyBar.appendChild(energyLabel);\r\n        this.elements.energyBar.appendChild(energyContainer);\r\n        this.elements.energyBar.appendChild(energyText);\r\n        this.elements.container.appendChild(this.elements.energyBar);\r\n        \r\n        // Create vertical outrage bar (right side)\r\n        this.elements.outrageBar = document.createElement('div');\r\n        this.elements.outrageBar.style.cssText = `\r\n            position: absolute;\r\n            top: 50%;\r\n            right: 20px;\r\n            transform: translateY(-50%);\r\n            width: 40px;\r\n            height: 300px;\r\n            background: rgba(0, 0, 0, 0.1);\r\n            border-radius: 20px;\r\n            padding: 15px 10px;\r\n            pointer-events: auto;\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n        `;\r\n        \r\n        const outrageLabel = document.createElement('div');\r\n        outrageLabel.style.cssText = `\r\n            color: white;\r\n            font-size: 12px;\r\n            font-weight: bold;\r\n            margin-bottom: 10px;\r\n            writing-mode: vertical-lr;\r\n            text-orientation: mixed;\r\n        `;\r\n        outrageLabel.textContent = 'OUTRAGE';\r\n        \r\n        const outrageContainer = document.createElement('div');\r\n        outrageContainer.style.cssText = `\r\n            width: 20px;\r\n            height: 200px;\r\n            background: #333;\r\n            border-radius: 10px;\r\n            position: relative;\r\n            overflow: hidden;\r\n        `;\r\n        \r\n        const outrageFill = document.createElement('div');\r\n        outrageFill.id = 'outrage-fill';\r\n        outrageFill.style.cssText = `\r\n            background: linear-gradient(to top, #0f0, #ff0, #f00);\r\n            width: 100%;\r\n            height: 0%;\r\n            border-radius: 10px;\r\n            transition: height 0.3s;\r\n            position: absolute;\r\n            bottom: 0;\r\n        `;\r\n        \r\n        const outrageText = document.createElement('div');\r\n        outrageText.id = 'outrage-text';\r\n        outrageText.style.cssText = `\r\n            color: white;\r\n            font-size: 10px;\r\n            font-weight: bold;\r\n            margin-top: 10px;\r\n            text-align: center;\r\n        `;\r\n        outrageText.textContent = '0%';\r\n        \r\n        outrageContainer.appendChild(outrageFill);\r\n        this.elements.outrageBar.appendChild(outrageLabel);\r\n        this.elements.outrageBar.appendChild(outrageContainer);\r\n        this.elements.outrageBar.appendChild(outrageText);\r\n        this.elements.container.appendChild(this.elements.outrageBar);\r\n        \r\n        // Create score display (bottom center)\r\n        this.elements.scoreDisplay = document.createElement('div');\r\n        this.elements.scoreDisplay.style.cssText = `\r\n            position: absolute;\r\n            bottom: 20px;\r\n            left: 50%;\r\n            transform: translateX(-50%);\r\n            background: rgba(0, 0, 0, 0.1);\r\n            color: white;\r\n            padding: 15px 30px;\r\n            border-radius: 10px;\r\n            pointer-events: auto;\r\n            font-size: 14px;\r\n            display: flex;\r\n            gap: 30px;\r\n            align-items: center;\r\n        `;\r\n        \r\n        this.elements.scoreDisplay.innerHTML = `\r\n            <div style=\"display: flex; align-items: center; gap: 10px;\">\r\n                <span style=\"font-weight: bold;\">Score:</span>\r\n                <span id=\"score-value\" style=\"color: #66ff66; font-weight: bold;\">0</span>\r\n            </div>\r\n            <div style=\"display: flex; align-items: center; gap: 10px;\">\r\n                <span style=\"font-weight: bold;\">Temps:</span>\r\n                <span id=\"time-value\" style=\"color: #66ccff; font-weight: bold;\">0s</span>\r\n            </div>\r\n            <div style=\"display: flex; align-items: center; gap: 10px;\">\r\n                <span style=\"font-weight: bold;\">Polarisés:</span>\r\n                <span id=\"polarised-value\" style=\"color: #ffcc66; font-weight: bold;\">0</span>\r\n            </div>\r\n        `;\r\n        \r\n        this.elements.container.appendChild(this.elements.scoreDisplay);\r\n    }\r\n\r\n    createMaskSelector() {\r\n        this.elements.maskSelector = document.createElement('div');\r\n        \r\n        // Check if mobile device\r\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;\r\n        \r\n        this.elements.maskSelector.style.cssText = `\r\n            position: absolute;\r\n            top: ${isMobile ? '10px' : '20px'};\r\n            left: 50%;\r\n            transform: translateX(-50%);\r\n            background: rgba(0, 0, 0, 0.1);\r\n            color: white;\r\n            padding: ${isMobile ? '5px' : '15px'};\r\n            border-radius: 10px;\r\n            display: flex;\r\n            gap: ${isMobile ? '2px' : '8px'};\r\n            pointer-events: auto;\r\n            z-index: 10000;\r\n            max-width: ${isMobile ? '100vw' : '900px'};\r\n            width: ${isMobile ? 'calc(100vw - 10px)' : 'auto'};\r\n            flex-wrap: wrap;\r\n            justify-content: center;\r\n            touch-action: manipulation;\r\n        `;\r\n        \r\n        // Neutral option\r\n        this.elements.neutralButton = this.createMaskButton('ESC', 'Neutral', '#888');\r\n        this.elements.maskSelector.appendChild(this.elements.neutralButton);\r\n        \r\n        // Mask options\r\n        const maskNames = [\r\n            'Conservative', 'Social Justice', 'Libertarian',\r\n            'Nationalist', 'Culture', 'Religious', 'Antisystem'\r\n        ];\r\n        \r\n        const maskColors = [\r\n            '#2470c8', '#c82424', '#ff9932',\r\n            '#32c832', '#9932c8', '#996633', '#ff4099'\r\n        ];\r\n        \r\n        for (let i = 0; i < 7; i++) {\r\n            const button = this.createMaskButton(\r\n                maskNames[i],\r\n                maskNames[i],\r\n                maskColors[i]\r\n            );\r\n            this.elements.maskSelector.appendChild(button);\r\n        }\r\n        \r\n        this.elements.container.appendChild(this.elements.maskSelector);\r\n    }\r\n\r\n    createMaskButton(key, name, color) {\r\n        const button = document.createElement('div');\r\n        \r\n        // Check if mobile device\r\n        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth <= 768;\r\n        \r\n        button.style.cssText = `\r\n            width: ${isMobile ? 'calc((100vw - 70px) / 8)' : '80px'};\r\n            height: ${isMobile ? '38px' : '60px'};\r\n            min-width: ${isMobile ? '35px' : '80px'};\r\n            max-width: ${isMobile ? '55px' : 'none'};\r\n            background: ${color || 'rgba(80, 80, 80, 0.7)'};\r\n            border: ${isMobile ? '1px solid #fff' : '2px solid #fff'};\r\n            border-radius: ${isMobile ? '6px' : '10px'};\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            justify-content: center;\r\n            cursor: pointer;\r\n            transition: all 0.2s;\r\n            position: relative;\r\n            overflow: hidden;\r\n            pointer-events: auto;\r\n            z-index: 10001;\r\n            touch-action: manipulation;\r\n        `;\r\n        \r\n        // Create sprite image if not neutral\r\n        if (key !== 'ESC') {\r\n            const maskNames = [\r\n                'Conservative', 'Social Justice', 'Libertarian',\r\n                'Nationalist', 'Culture', 'Religious', 'Antisystem'\r\n            ];\r\n            const maskIndex = maskNames.indexOf(key);\r\n            if (maskIndex !== -1) {\r\n                const spriteImg = document.createElement('img');\r\n                spriteImg.src = getTextureForMask(maskIndex + 1);\r\n                spriteImg.style.cssText = `\r\n                    width: ${isMobile ? '24px' : '30px'};\r\n                    height: ${isMobile ? '24px' : '30px'};\r\n                    object-fit: contain;\r\n                    margin-bottom: ${isMobile ? '2px' : '3px'};\r\n                `;\r\n                button.appendChild(spriteImg);\r\n            }\r\n        }\r\n        \r\n        const keySpan = document.createElement('span');\r\n        keySpan.textContent = key === 'ESC' ? 'ESC' : name;\r\n        keySpan.style.cssText = `\r\n            font-weight: bold;\r\n            color: white;\r\n            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);\r\n            font-size: ${isMobile ? '7px' : '9px'};\r\n            text-align: center;\r\n            line-height: 1.0;\r\n            max-width: ${isMobile ? '95%' : '75px'};\r\n            overflow: hidden;\r\n            word-wrap: break-word;\r\n            padding: ${isMobile ? '0 1px' : '0'};\r\n        `;\r\n        \r\n        const tooltip = document.createElement('div');\r\n        tooltip.textContent = name;\r\n        tooltip.style.cssText = `\r\n            position: absolute;\r\n            bottom: 70px;\r\n            left: 50%;\r\n            transform: translateX(-50%);\r\n            background: rgba(0,0,0,0.1);\r\n            color: white;\r\n            padding: 5px 10px;\r\n            border-radius: 5px;\r\n            font-size: 12px;\r\n            white-space: nowrap;\r\n            opacity: 0;\r\n            transition: opacity 0.2s;\r\n            pointer-events: none;\r\n        `;\r\n        \r\n        button.appendChild(keySpan);\r\n        button.appendChild(tooltip);\r\n        \r\n        // Add click handler\r\n        const handleMaskSelect = () => {\r\n            if (key === 'ESC') {\r\n                this.triggerMaskChange(null);\r\n            } else {\r\n                // Find the mask number based on the name\r\n                const maskNames = [\r\n                    'Conservative', 'Social Justice', 'Libertarian',\r\n                    'Nationalist', 'Culture', 'Religious', 'Antisystem'\r\n                ];\r\n                const maskIndex = maskNames.indexOf(key);\r\n                if (maskIndex !== -1) {\r\n                    this.triggerMaskChange(maskIndex + 1);\r\n                }\r\n            }\r\n        };\r\n        \r\n        button.addEventListener('click', handleMaskSelect);\r\n        \r\n        // Add touch handlers for mobile with passive events for better performance\r\n        button.addEventListener('touchstart', (event) => {\r\n            console.log('🎯 Button touchstart:', key);\r\n            button.style.transform = 'scale(0.95)';\r\n            button.style.opacity = '0.8';\r\n        }, { passive: true });\r\n        \r\n        button.addEventListener('touchend', (event) => {\r\n            console.log('🎯 Button touchend:', key);\r\n            button.style.transform = 'scale(1)';\r\n            button.style.opacity = '1';\r\n            handleMaskSelect();\r\n        }, { passive: true });\r\n        \r\n        button.addEventListener('touchcancel', (event) => {\r\n            button.style.transform = 'scale(1)';\r\n            button.style.opacity = '1';\r\n        }, { passive: true });\r\n        \r\n        // Hover effects\r\n        button.addEventListener('mouseenter', () => {\r\n            button.style.transform = 'scale(1.1)';\r\n            tooltip.style.opacity = '1';\r\n        });\r\n        \r\n        button.addEventListener('mouseleave', () => {\r\n            button.style.transform = 'scale(1)';\r\n            tooltip.style.opacity = '0';\r\n        });\r\n        \r\n        return button;\r\n    }\r\n\r\n    triggerMaskChange(maskType) {\r\n        // Only call player system - it will handle the rest via proper flow\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (playerSystem) {\r\n            playerSystem.setMask(maskType);\r\n        }\r\n        \r\n        console.log(`🎭 UI triggered mask change to: ${maskType || 'Neutral'}`);\r\n    }\r\n\r\n    createGameOverScreen() {\r\n        this.elements.gameOverScreen = document.createElement('div');\r\n        this.elements.gameOverScreen.style.cssText = `\r\n            position: absolute;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            background: rgba(0, 0, 0, 0.1);\r\n            display: none;\r\n            align-items: center;\r\n            justify-content: center;\r\n            pointer-events: auto;\r\n        `;\r\n        \r\n        const gameOverContent = document.createElement('div');\r\n        gameOverContent.style.cssText = `\r\n            background: rgba(20, 20, 20, 0.5);\r\n            color: white;\r\n            padding: 40px;\r\n            border-radius: 20px;\r\n            text-align: center;\r\n            max-width: 500px;\r\n            border: 2px solid #666;\r\n        `;\r\n        \r\n        gameOverContent.innerHTML = `\r\n            <h1 id=\"game-over-title\" style=\"margin-bottom: 20px; color: #ff6666;\">Game Over</h1>\r\n            <p id=\"game-over-reason\" style=\"margin-bottom: 20px; font-size: 18px;\"></p>\r\n            <div style=\"margin-bottom: 30px;\">\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <span style=\"font-weight: bold;\">Final Score:</span>\r\n                    <span id=\"final-score\" style=\"float: right; font-size: 24px; color: #66ff66;\">0</span>\r\n                </div>\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <span style=\"font-weight: bold;\">Survival Time:</span>\r\n                    <span id=\"final-time\" style=\"float: right;\">0s</span>\r\n                </div>\r\n                <div>\r\n                    <span style=\"font-weight: bold;\">People Polarised:</span>\r\n                    <span id=\"final-polarised\" style=\"float: right;\">0</span>\r\n                </div>\r\n            </div>\r\n            <button id=\"restart-button\" style=\"\r\n                background: #4CAF50;\r\n                color: white;\r\n                border: none;\r\n                padding: 15px 30px;\r\n                font-size: 16px;\r\n                border-radius: 10px;\r\n                cursor: pointer;\r\n                transition: background 0.3s;\r\n            \">Play Again</button>\r\n        `;\r\n        \r\n        this.elements.gameOverScreen.appendChild(gameOverContent);\r\n        this.elements.container.appendChild(this.elements.gameOverScreen);\r\n        \r\n        // Restart button functionality\r\n        const restartButton = gameOverContent.querySelector('#restart-button');\r\n        restartButton.addEventListener('click', () => {\r\n            this.restartGame();\r\n        });\r\n        \r\n        restartButton.addEventListener('mouseenter', () => {\r\n            restartButton.style.background = '#45a049';\r\n        });\r\n        \r\n        restartButton.addEventListener('mouseleave', () => {\r\n            restartButton.style.background = '#4CAF50';\r\n        });\r\n    }\r\n\r\n    createInstructions() {\r\n        // Instructions supprimées sur demande de l'utilisateur\r\n    }\r\n\r\n    update(deltaTime) {\r\n        if (!this.isVisible) return;\r\n        \r\n        this.lastUpdateTime += deltaTime;\r\n        \r\n        // Throttle updates for performance\r\n        if (this.lastUpdateTime < this.updateFrequency) {\r\n            return;\r\n        }\r\n        \r\n        this.lastUpdateTime = 0;\r\n        \r\n        // Update HUD with current game state\r\n        this.updateHUD();\r\n    }\r\n\r\n    updateHUD() {\r\n        if (!this.gameStateSystem) return;\r\n        \r\n        const state = this.gameStateSystem.getFullState();\r\n        \r\n        // Update outrage meter (vertical bar)\r\n        const outrageFill = document.getElementById('outrage-fill');\r\n        const outrageText = document.getElementById('outrage-text');\r\n        if (outrageFill && outrageText) {\r\n            outrageFill.style.height = `${state.outrage}%`;\r\n            outrageText.textContent = `${Math.round(state.outrage)}%`;\r\n        }\r\n        \r\n        // Update energy meter (vertical bar)\r\n        const energyFill = document.getElementById('energy-fill');\r\n        const energyText = document.getElementById('energy-text');\r\n        if (energyFill && energyText) {\r\n            energyFill.style.height = `${state.energy}%`;\r\n            energyText.textContent = `${Math.round(state.energy)}%`;\r\n        }\r\n        \r\n        // Update score display\r\n        const scoreValue = document.getElementById('score-value');\r\n        const timeValue = document.getElementById('time-value');\r\n        const polarisedValue = document.getElementById('polarised-value');\r\n        \r\n        if (scoreValue) scoreValue.textContent = state.score.toString();\r\n        if (timeValue) timeValue.textContent = `${Math.round(state.gameTime)}s`;\r\n        if (polarisedValue) polarisedValue.textContent = state.polarisedPeople.toString();\r\n    }\r\n\r\n    showGameOver(reason, finalState) {\r\n        this.elements.gameOverScreen.style.display = 'flex';\r\n        \r\n        // Update game over content\r\n        const title = document.getElementById('game-over-title');\r\n        const reasonElement = document.getElementById('game-over-reason');\r\n        const finalScore = document.getElementById('final-score');\r\n        const finalTime = document.getElementById('final-time');\r\n        const finalPolarised = document.getElementById('final-polarised');\r\n        \r\n        const messages = {\r\n            'CAUGHT': 'You were caught by the police!',\r\n            'CHAOS': 'The world descended into chaos!',\r\n            'ADULT': 'You became a responsible adult!',\r\n            'ENERGY': 'You ran out of energy!'\r\n        };\r\n        \r\n        if (title) title.textContent = reason === 'ADULT' ? 'You Win!' : 'Game Over';\r\n        if (reasonElement) reasonElement.textContent = messages[reason] || 'Game ended';\r\n        if (finalScore) finalScore.textContent = finalState.score.toString();\r\n        if (finalTime) finalTime.textContent = `${Math.round(finalState.gameTime)}s`;\r\n        if (finalPolarised) finalPolarised.textContent = finalState.polarisedPeople.toString();\r\n        \r\n        // Color the title based on outcome\r\n        if (title) {\r\n            title.style.color = reason === 'ADULT' ? '#66ff66' : '#ff6666';\r\n        }\r\n    }\r\n\r\n    hideGameOver() {\r\n        this.elements.gameOverScreen.style.display = 'none';\r\n    }\r\n\r\n    restartGame() {\r\n        this.hideGameOver();\r\n        \r\n        if (this.gameStateSystem) {\r\n            this.gameStateSystem.reset();\r\n        }\r\n        \r\n        console.log('🔄 Game restarted via UI');\r\n    }\r\n\r\n    toggle() {\r\n        this.isVisible = !this.isVisible;\r\n        this.elements.container.style.display = this.isVisible ? 'block' : 'none';\r\n    }\r\n\r\n    // IGameSystem implementation\r\n    onGameStateChange(event) {\r\n        // Handle both new and legacy event formats\r\n        if (event.data && event.data.property) {\r\n            // New event format\r\n            this.handleStatePropertyChange(event.data.property, event.data.newValue, event.data.oldValue);\r\n        } else if (event.property) {\r\n            // Legacy format\r\n            this.handleStatePropertyChange(event.property, event.newValue, event.oldValue);\r\n        }\r\n    }\r\n    \r\n    onOutrageChange(event) {\r\n        // Handle specific outrage changes\r\n        const outrageData = event.data;\r\n        console.log(`🎭 Outrage changed: ${outrageData.oldOutrage} → ${outrageData.newOutrage}`);\r\n        \r\n        // Update outrage display with smooth animation\r\n        this.updateOutrageDisplay(outrageData.newOutrage);\r\n    }\r\n    \r\n    onPlayerMaskChange(event) {\r\n        // Handle player mask changes\r\n        const maskData = event.data;\r\n        console.log(`🎭 Player mask changed: ${maskData.oldMask} → ${maskData.newMask}`);\r\n        \r\n        // Update mask display\r\n        this.updateMaskDisplay(maskData.newMask);\r\n        \r\n        // Publish UI event for mask selection\r\n        this.publishEvent(GameEventTypes.UI_MASK_SELECT, {\r\n            maskType: maskData.newMask,\r\n            previousMask: maskData.oldMask,\r\n            source: 'player_action'\r\n        });\r\n    }\r\n    \r\n    onGameOver(event) {\r\n        // Handle game over\r\n        const gameOverData = event.data;\r\n        console.log(`🎮 Game over: ${gameOverData.reason}`);\r\n        \r\n        // Show game over screen\r\n        this.showGameOver(gameOverData.reason, gameOverData.stats);\r\n    }\r\n    \r\n    handleStatePropertyChange(property, newValue, oldValue) {\r\n        switch (property) {\r\n            case 'gameOver':\r\n                if (newValue && newValue.reason) {\r\n                    this.showGameOver(newValue.reason, this.gameStateSystem.getFullState());\r\n                }\r\n                break;\r\n            case 'outrage':\r\n                this.updateOutrageDisplay(newValue);\r\n                break;\r\n            case 'energy':\r\n                this.updateEnergyDisplay(newValue);\r\n                break;\r\n            case 'gameTime':\r\n                this.updateTimeDisplay(newValue);\r\n                break;\r\n            case 'polarisedPeople':\r\n                this.updatePolarisedDisplay(newValue);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // Individual display update methods\r\n    updateOutrageDisplay(outrageValue) {\r\n        const outrageFill = document.getElementById('outrage-fill');\r\n        const outrageText = document.getElementById('outrage-text');\r\n        if (outrageFill && outrageText) {\r\n            outrageFill.style.height = `${outrageValue}%`;\r\n            outrageText.textContent = `${Math.round(outrageValue)}%`;\r\n        }\r\n    }\r\n\r\n    updateEnergyDisplay(energyValue) {\r\n        const energyFill = document.getElementById('energy-fill');\r\n        const energyText = document.getElementById('energy-text');\r\n        if (energyFill && energyText) {\r\n            energyFill.style.height = `${energyValue}%`;\r\n            energyText.textContent = `${Math.round(energyValue)}%`;\r\n        }\r\n    }\r\n\r\n    updateTimeDisplay(timeValue) {\r\n        const timeElement = document.getElementById('time-value');\r\n        if (timeElement) {\r\n            timeElement.textContent = `${Math.round(timeValue)}s`;\r\n        }\r\n    }\r\n\r\n    updatePolarisedDisplay(polarisedValue) {\r\n        const polarisedElement = document.getElementById('polarised-value');\r\n        if (polarisedElement) {\r\n            polarisedElement.textContent = polarisedValue.toString();\r\n        }\r\n    }\r\n\r\n    updateMaskDisplay(maskType) {\r\n        // Update mask selector visual state\r\n        const buttons = this.elements.maskSelector.querySelectorAll('div');\r\n        buttons.forEach((button, index) => {\r\n            if (index === 0) {\r\n                // Neutral button\r\n                button.style.opacity = maskType === null ? '1' : '0.6';\r\n            } else {\r\n                // Mask buttons (1-7), index 1-7 corresponds to maskType 1-7\r\n                button.style.opacity = maskType === index ? '1' : '0.6';\r\n            }\r\n        });\r\n    }\r\n\r\n    shutdown() {\r\n        if (this.elements.container) {\r\n            document.body.removeChild(this.elements.container);\r\n        }\r\n        \r\n        this.elements = {};\r\n        console.log('🖥️ UI System shutdown');\r\n    }\r\n} ","// systems/VisualFXSystem.js - Visual effects system for tension and atmosphere\r\nimport { IGameSystem } from '../interfaces/IGameSystem.js';\r\nimport { params } from '../params.js';\r\nimport { serviceContainer } from '../core/ServiceContainer.js';\r\nimport { GameEventTypes } from '../interfaces/GameEvents.js';\r\n\r\nexport class VisualFXSystem extends IGameSystem {\r\n    constructor() {\r\n        super('VisualFX');\r\n        \r\n        this.camera = null;\r\n        this.sceneManager = null;\r\n        this.renderer = null;\r\n        \r\n        // Camera shake system\r\n        this.cameraShake = {\r\n            enabled: false,\r\n            intensity: 0,\r\n            frequency: 0,\r\n            duration: 0,\r\n            remainingTime: 0,\r\n            basePosition: new THREE.Vector3(),\r\n            shakeOffset: new THREE.Vector3()\r\n        };\r\n        \r\n        // Tension effects\r\n        this.tensionEffects = {\r\n            enabled: false,\r\n            intensity: 0,\r\n            targetIntensity: 0,\r\n            transitionSpeed: 2.0,\r\n            colorShift: {\r\n                r: 0,\r\n                g: 0,\r\n                b: 0\r\n            },\r\n            vignette: {\r\n                enabled: false,\r\n                intensity: 0\r\n            },\r\n            chromatic: {\r\n                enabled: false,\r\n                intensity: 0\r\n            }\r\n        };\r\n        \r\n        // Police tension state\r\n        this.policeActive = false;\r\n        this.policeIntensity = 0;\r\n        \r\n        // Visual element for effects\r\n        this.effectsOverlay = null;\r\n        \r\n        // Effect parameters\r\n        this.effectParams = {\r\n            shake: {\r\n                baseIntensity: params.CAMERA_SHAKE_INTENSITY,\r\n                frequency: params.CAMERA_SHAKE_FREQUENCY,\r\n                duration: params.CAMERA_SHAKE_DURATION\r\n            },\r\n            tension: {\r\n                maxIntensity: params.TENSION_MAX_INTENSITY,\r\n                colorShift: { r: params.TENSION_COLOR_SHIFT, g: -params.TENSION_COLOR_SHIFT * 0.5, b: -params.TENSION_COLOR_SHIFT * 0.5 },\r\n                pulseSpeed: params.TENSION_PULSE_SPEED,\r\n                transitionSpeed: params.TENSION_TRANSITION_SPEED\r\n            }\r\n        };\r\n    }\r\n\r\n    async initialize(sceneManager) {\r\n        this.sceneManager = sceneManager;\r\n        this.camera = serviceContainer.resolve('camera');\r\n        this.renderer = sceneManager.renderer;\r\n        \r\n        // Create effects overlay\r\n        this.createEffectsOverlay();\r\n        \r\n        // Subscribe to police events using GameEventTypes constants\r\n        try {\r\n            this.subscribeToEvent(GameEventTypes.POLICE_ACTIVATE, (event) => {\r\n                if (params.VISUAL_FX_ENABLED) {\r\n                    this.activateTensionEffects();\r\n                }\r\n            });\r\n            \r\n            this.subscribeToEvent(GameEventTypes.POLICE_DEACTIVATE, (event) => {\r\n                if (params.VISUAL_FX_ENABLED) {\r\n                    this.deactivateTensionEffects();\r\n                }\r\n            });\r\n            \r\n            console.log('🎬 Visual FX System initialized with event subscriptions');\r\n        } catch (error) {\r\n            console.error('❌ Error subscribing to police events:', error);\r\n            console.log('🎬 Visual FX System initialized without event subscriptions');\r\n        }\r\n    }\r\n\r\n    createEffectsOverlay() {\r\n        if (!params.OVERLAY_EFFECTS_ENABLED) return;\r\n        \r\n        // Create overlay div for visual effects\r\n        this.effectsOverlay = document.createElement('div');\r\n        this.effectsOverlay.id = 'visual-effects-overlay';\r\n        this.effectsOverlay.style.cssText = `\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            width: 100%;\r\n            height: 100%;\r\n            pointer-events: none;\r\n            z-index: 500;\r\n            background: rgba(0, 0, 0, 0);\r\n            transition: all 0.3s ease;\r\n            mix-blend-mode: screen;\r\n        `;\r\n        \r\n        document.body.appendChild(this.effectsOverlay);\r\n    }\r\n\r\n    update(deltaTime) {\r\n        if (!params.VISUAL_FX_ENABLED || !this.camera || !this.sceneManager) return;\r\n        \r\n        // Update tension effects\r\n        if (params.TENSION_EFFECTS_ENABLED) {\r\n            this.updateTensionEffects(deltaTime);\r\n        }\r\n        \r\n        // Update camera shake\r\n        if (params.CAMERA_SHAKE_ENABLED) {\r\n            this.updateCameraShake(deltaTime);\r\n        }\r\n        \r\n        // Update overlay effects\r\n        if (params.OVERLAY_EFFECTS_ENABLED) {\r\n            this.updateOverlayEffects(deltaTime);\r\n        }\r\n    }\r\n\r\n    updateTensionEffects(deltaTime) {\r\n        if (!this.tensionEffects.enabled) return;\r\n        \r\n        // Smooth transition to target intensity\r\n        const diff = this.tensionEffects.targetIntensity - this.tensionEffects.intensity;\r\n        this.tensionEffects.intensity += diff * this.effectParams.tension.transitionSpeed * deltaTime;\r\n        \r\n        // Clamp to [0, 1]\r\n        this.tensionEffects.intensity = Math.max(0, Math.min(1, this.tensionEffects.intensity));\r\n        \r\n        // Update lighting effects\r\n        this.updateLightingEffects();\r\n        \r\n        // Update background color shift\r\n        this.updateBackgroundColorShift();\r\n    }\r\n\r\n    updateCameraShake(deltaTime) {\r\n        if (!this.cameraShake.enabled || !this.camera) return;\r\n        \r\n        // Update shake timer\r\n        this.cameraShake.remainingTime -= deltaTime;\r\n        \r\n        // If police is active, keep shake going indefinitely\r\n        if (this.policeActive) {\r\n            // Reset timer to keep shake continuous during police activity\r\n            if (this.cameraShake.remainingTime <= 0) {\r\n                this.cameraShake.remainingTime = this.cameraShake.duration;\r\n            }\r\n        } else {\r\n            // Normal behavior: stop shake when timer expires\r\n            if (this.cameraShake.remainingTime <= 0) {\r\n                this.stopCameraShake();\r\n                return;\r\n            }\r\n        }\r\n        \r\n        // Calculate shake offset with continuous time for police activity\r\n        let shakeIntensity;\r\n        let time;\r\n        \r\n        if (this.policeActive) {\r\n            // Continuous shake during police activity with variation\r\n            const currentTime = Date.now() * 0.001;\r\n            const intensityVariation = Math.sin(currentTime * 0.5) * 0.3 + 0.7; // Varies between 0.4 and 1.0\r\n            shakeIntensity = this.cameraShake.intensity * intensityVariation;\r\n            time = currentTime * this.cameraShake.frequency;\r\n        } else {\r\n            // Normal timed shake\r\n            shakeIntensity = this.cameraShake.intensity * (this.cameraShake.remainingTime / this.cameraShake.duration);\r\n            time = (this.cameraShake.duration - this.cameraShake.remainingTime) * this.cameraShake.frequency;\r\n        }\r\n        \r\n        this.cameraShake.shakeOffset.set(\r\n            (Math.sin(time) + Math.sin(time * 2.5) * 0.5) * shakeIntensity,\r\n            (Math.cos(time * 1.3) + Math.cos(time * 3.2) * 0.3) * shakeIntensity,\r\n            (Math.sin(time * 0.7) + Math.sin(time * 1.9) * 0.4) * shakeIntensity * 0.5\r\n        );\r\n        \r\n        // Store shake offset for use in SceneManager instead of directly modifying camera\r\n        // This prevents interference with normal camera updates\r\n        this.sceneManager.cameraShakeOffset = this.cameraShake.shakeOffset.clone();\r\n    }\r\n\r\n    updateOverlayEffects(deltaTime) {\r\n        if (!this.effectsOverlay) return;\r\n        \r\n        let overlayStyle = '';\r\n        \r\n        if (this.tensionEffects.enabled && this.tensionEffects.intensity > 0) {\r\n            // Pulsing red vignette effect with enhanced intensity\r\n            const time = Date.now() * 0.001;\r\n            const pulseIntensity = Math.sin(time * this.effectParams.tension.pulseSpeed) * 0.5 + 0.5;\r\n            const vignetteIntensity = this.tensionEffects.intensity * 0.4 * pulseIntensity;\r\n            \r\n            // Enhanced red tint with multiple gradient layers\r\n            const redTint = this.tensionEffects.intensity * 0.15;\r\n            const edgeIntensity = this.tensionEffects.intensity * 0.3;\r\n            \r\n            overlayStyle = `\r\n                background: \r\n                    radial-gradient(circle at 50% 50%, \r\n                        rgba(255, 0, 0, ${redTint * 0.3}) 0%, \r\n                        rgba(255, 0, 0, ${redTint * 0.5}) 40%, \r\n                        rgba(255, 0, 0, ${redTint + vignetteIntensity * 0.8}) 70%, \r\n                        rgba(150, 0, 0, ${vignetteIntensity * 1.5}) 85%,\r\n                        rgba(100, 0, 0, ${edgeIntensity * 2}) 100%),\r\n                    linear-gradient(45deg, \r\n                        rgba(255, 0, 0, ${redTint * 0.1}) 0%, \r\n                        rgba(0, 0, 0, 0) 50%, \r\n                        rgba(255, 0, 0, ${redTint * 0.1}) 100%);\r\n                animation: tensionPulse ${1 / this.effectParams.tension.pulseSpeed}s ease-in-out infinite;\r\n            `;\r\n            \r\n            // Add CSS animation for tension pulse if not already added\r\n            if (!document.getElementById('tension-effects-style')) {\r\n                const styleElement = document.createElement('style');\r\n                styleElement.id = 'tension-effects-style';\r\n                styleElement.textContent = `\r\n                    @keyframes tensionPulse {\r\n                        0% { opacity: 0.8; filter: blur(0px); }\r\n                        50% { opacity: 1.0; filter: blur(0.5px); }\r\n                        100% { opacity: 0.8; filter: blur(0px); }\r\n                    }\r\n                    \r\n                    @keyframes tensionFlash {\r\n                        0% { opacity: 0; }\r\n                        50% { opacity: 1; }\r\n                        100% { opacity: 0; }\r\n                    }\r\n                `;\r\n                document.head.appendChild(styleElement);\r\n            }\r\n        } else {\r\n            overlayStyle = 'background: rgba(0, 0, 0, 0);';\r\n        }\r\n        \r\n        this.effectsOverlay.style.background = overlayStyle;\r\n    }\r\n\r\n    updateLightingEffects() {\r\n        if (!this.sceneManager.cameraLight) return;\r\n        \r\n        // Enhanced lighting effects with more dramatic changes\r\n        const baseIntensity = 1.5;\r\n        const tensionIntensity = this.tensionEffects.intensity * 0.8;\r\n        \r\n        // Pulsing intensity effect\r\n        const time = Date.now() * 0.001;\r\n        const pulseFactor = Math.sin(time * this.effectParams.tension.pulseSpeed * 2) * 0.2 + 1;\r\n        \r\n        this.sceneManager.cameraLight.intensity = (baseIntensity + tensionIntensity) * pulseFactor;\r\n        \r\n        // Enhanced color shifting - more dramatic red shift\r\n        const redShift = this.tensionEffects.intensity * 0.4;\r\n        const blueShift = this.tensionEffects.intensity * 0.3;\r\n        \r\n        this.sceneManager.cameraLight.color.setRGB(\r\n            Math.min(1.0, 1.0 + redShift * 0.2),\r\n            Math.max(0.3, 1.0 - redShift),\r\n            Math.max(0.2, 1.0 - blueShift)\r\n        );\r\n        \r\n        // Add flickering effect during high tension\r\n        if (this.tensionEffects.intensity > 0.7) {\r\n            const flickerChance = this.tensionEffects.intensity * 0.05;\r\n            if (Math.random() < flickerChance) {\r\n                this.sceneManager.cameraLight.intensity *= 0.7;\r\n            }\r\n        }\r\n    }\r\n\r\n    updateBackgroundColorShift() {\r\n        if (!this.sceneManager.scene) return;\r\n        \r\n        // Get current background color\r\n        const currentColor = this.sceneManager.scene.background;\r\n        if (!currentColor) return;\r\n        \r\n        // Enhanced color shift with more dramatic effects\r\n        const shiftAmount = this.tensionEffects.intensity * 0.3;\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        const currentMask = playerSystem ? playerSystem.getCurrentMask() : null;\r\n        \r\n        // Use current mask color as base or neutral\r\n        const baseColor = new THREE.Color(params.MASK_BACKGROUND_COLORS[currentMask] || params.MASK_BACKGROUND_COLORS[null]);\r\n        \r\n        // Shift towards dark red with pulsing effect\r\n        const time = Date.now() * 0.001;\r\n        const pulseFactor = Math.sin(time * this.effectParams.tension.pulseSpeed) * 0.1 + 0.9;\r\n        \r\n        const shiftedColor = new THREE.Color(\r\n            Math.min(1.0, baseColor.r + shiftAmount * pulseFactor),\r\n            Math.max(0.0, baseColor.g - shiftAmount * 0.7 * pulseFactor),\r\n            Math.max(0.0, baseColor.b - shiftAmount * 0.8 * pulseFactor)\r\n        );\r\n        \r\n        // Smooth transition\r\n        currentColor.lerp(shiftedColor, 0.05);\r\n    }\r\n\r\n    // Public methods for effect control\r\n    activateTensionEffects() {\r\n        if (!params.VISUAL_FX_ENABLED) return;\r\n        \r\n        this.tensionEffects.enabled = true;\r\n        this.tensionEffects.targetIntensity = this.effectParams.tension.maxIntensity;\r\n        this.policeActive = true;\r\n        \r\n        // Start camera shake\r\n        if (params.CAMERA_SHAKE_ENABLED) {\r\n            this.startCameraShake(\r\n                this.effectParams.shake.baseIntensity,\r\n                this.effectParams.shake.frequency,\r\n                this.effectParams.shake.duration\r\n            );\r\n        }\r\n        \r\n        console.log('🎬 Tension effects activated!');\r\n    }\r\n\r\n    deactivateTensionEffects() {\r\n        if (!params.VISUAL_FX_ENABLED) return;\r\n        \r\n        this.tensionEffects.targetIntensity = 0;\r\n        this.policeActive = false;\r\n        \r\n        // Stop camera shake (will now stop properly since policeActive is false)\r\n        this.stopCameraShake();\r\n        \r\n        // Reset lighting to normal\r\n        if (this.sceneManager && this.sceneManager.cameraLight) {\r\n            this.sceneManager.cameraLight.intensity = 1.5;\r\n            this.sceneManager.cameraLight.color.setRGB(1.0, 1.0, 1.0);\r\n        }\r\n        \r\n        // Reset background color\r\n        if (this.sceneManager && this.sceneManager.scene) {\r\n            const playerSystem = serviceContainer.resolve('playerSystem');\r\n            const currentMask = playerSystem ? playerSystem.getCurrentMask() : null;\r\n            const baseColor = params.MASK_BACKGROUND_COLORS[currentMask] || params.MASK_BACKGROUND_COLORS[null];\r\n            this.sceneManager.scene.background = new THREE.Color(baseColor);\r\n        }\r\n        \r\n        // After intensity reaches 0, disable effects\r\n        setTimeout(() => {\r\n            if (this.tensionEffects.intensity < 0.01) {\r\n                this.tensionEffects.enabled = false;\r\n            }\r\n        }, 1000);\r\n        \r\n        console.log('🎬 Tension effects deactivated');\r\n    }\r\n\r\n    startCameraShake(intensity = 0.1, frequency = 20, duration = 0.5) {\r\n        if (!this.camera || !params.CAMERA_SHAKE_ENABLED) return;\r\n        \r\n        this.cameraShake.enabled = true;\r\n        this.cameraShake.intensity = intensity;\r\n        this.cameraShake.frequency = frequency;\r\n        this.cameraShake.duration = duration;\r\n        this.cameraShake.remainingTime = duration;\r\n        \r\n        console.log(`🎬 Camera shake started: intensity=${intensity}, frequency=${frequency}, duration=${duration}`);\r\n    }\r\n\r\n    stopCameraShake() {\r\n        this.cameraShake.enabled = false;\r\n        this.cameraShake.remainingTime = 0;\r\n        this.cameraShake.shakeOffset.set(0, 0, 0);\r\n        \r\n        // Clear shake offset from SceneManager\r\n        if (this.sceneManager) {\r\n            this.sceneManager.cameraShakeOffset = null;\r\n        }\r\n        \r\n        console.log('🎬 Camera shake stopped');\r\n    }\r\n\r\n    // Trigger specific effects\r\n    triggerPoliceSiren() {\r\n        // Flash effect\r\n        if (this.effectsOverlay) {\r\n            this.effectsOverlay.style.background = 'rgba(255, 0, 0, 0.5)';\r\n            setTimeout(() => {\r\n                if (this.effectsOverlay) {\r\n                    this.effectsOverlay.style.background = 'rgba(0, 0, 255, 0.3)';\r\n                }\r\n            }, 100);\r\n            setTimeout(() => {\r\n                if (this.effectsOverlay) {\r\n                    this.effectsOverlay.style.background = 'rgba(0, 0, 0, 0)';\r\n                }\r\n            }, 200);\r\n        }\r\n        \r\n        // Intense camera shake\r\n        this.startCameraShake(0.25, 30, 0.3);\r\n    }\r\n\r\n    triggerPoliceChase() {\r\n        // Continuous tension effects\r\n        this.activateTensionEffects();\r\n        \r\n        // Periodic shake bursts\r\n        const shakeInterval = setInterval(() => {\r\n            if (this.policeActive) {\r\n                this.startCameraShake(0.1, 25, 0.2);\r\n            } else {\r\n                clearInterval(shakeInterval);\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    // Debug methods\r\n    testCameraShake() {\r\n        if (!params.CAMERA_SHAKE_ENABLED) {\r\n            console.log('🎬 Camera shake is disabled in params');\r\n            return;\r\n        }\r\n        \r\n        this.startCameraShake(0.2, 20, 2.0);\r\n        console.log('🎬 Testing camera shake for 2 seconds');\r\n    }\r\n\r\n    testTensionEffects() {\r\n        if (!params.TENSION_EFFECTS_ENABLED) {\r\n            console.log('🎬 Tension effects are disabled in params');\r\n            return;\r\n        }\r\n        \r\n        this.activateTensionEffects();\r\n        setTimeout(() => {\r\n            this.deactivateTensionEffects();\r\n        }, 5000);\r\n        console.log('🎬 Testing tension effects for 5 seconds');\r\n    }\r\n\r\n    testPoliceArrival() {\r\n        console.log('🎬 Testing police arrival sequence...');\r\n        \r\n        // Simulate police siren\r\n        this.triggerPoliceSiren();\r\n        \r\n        // Wait a bit then start chase effects\r\n        setTimeout(() => {\r\n            this.activateTensionEffects();\r\n            console.log('🎬 Police tension effects activated');\r\n        }, 500);\r\n        \r\n        // Stop after 10 seconds\r\n        setTimeout(() => {\r\n            this.deactivateTensionEffects();\r\n            console.log('🎬 Police tension effects deactivated');\r\n        }, 10000);\r\n    }\r\n\r\n    // Configuration methods\r\n    setShakeIntensity(intensity) {\r\n        const clampedIntensity = Math.max(0, Math.min(1, intensity));\r\n        this.effectParams.shake.baseIntensity = clampedIntensity;\r\n        console.log(`🎬 Camera shake intensity set to: ${clampedIntensity}`);\r\n    }\r\n\r\n    setTensionIntensity(intensity) {\r\n        const clampedIntensity = Math.max(0, Math.min(1, intensity));\r\n        this.effectParams.tension.maxIntensity = clampedIntensity;\r\n        console.log(`🎬 Tension intensity set to: ${clampedIntensity}`);\r\n    }\r\n\r\n    setTensionSpeed(speed) {\r\n        const clampedSpeed = Math.max(0.1, Math.min(10, speed));\r\n        this.effectParams.tension.pulseSpeed = clampedSpeed;\r\n        console.log(`🎬 Tension pulse speed set to: ${clampedSpeed}`);\r\n    }\r\n\r\n    // Enhanced police effects\r\n    triggerPoliceArrivalSequence() {\r\n        console.log('🎬 Police arrival sequence initiated!');\r\n        \r\n        // Immediate flash effect\r\n        this.triggerPoliceSiren();\r\n        \r\n        // Strong shake on arrival\r\n        setTimeout(() => {\r\n            this.startCameraShake(0.3, 30, 0.8);\r\n        }, 200);\r\n        \r\n        // Activate tension effects\r\n        setTimeout(() => {\r\n            this.activateTensionEffects();\r\n        }, 400);\r\n        \r\n        // Periodic tension bursts\r\n        const burstInterval = setInterval(() => {\r\n            if (this.policeActive) {\r\n                this.startCameraShake(0.15, 25, 0.3);\r\n            } else {\r\n                clearInterval(burstInterval);\r\n            }\r\n        }, 3000);\r\n    }\r\n\r\n    // Get current visual effects state\r\n    getEffectsState() {\r\n        return {\r\n            visualFXEnabled: params.VISUAL_FX_ENABLED,\r\n            cameraShakeEnabled: params.CAMERA_SHAKE_ENABLED,\r\n            tensionEffectsEnabled: params.TENSION_EFFECTS_ENABLED,\r\n            overlayEffectsEnabled: params.OVERLAY_EFFECTS_ENABLED,\r\n            policeActive: this.policeActive,\r\n            tensionIntensity: this.tensionEffects.intensity,\r\n            cameraShakeActive: this.cameraShake.enabled,\r\n            effectParams: this.effectParams\r\n        };\r\n    }\r\n\r\n    // Toggle individual effects\r\n    toggleCameraShake() {\r\n        params.CAMERA_SHAKE_ENABLED = !params.CAMERA_SHAKE_ENABLED;\r\n        if (!params.CAMERA_SHAKE_ENABLED) {\r\n            this.stopCameraShake();\r\n        }\r\n        console.log(`🎬 Camera shake: ${params.CAMERA_SHAKE_ENABLED ? 'ENABLED' : 'DISABLED'}`);\r\n    }\r\n\r\n    toggleTensionEffects() {\r\n        params.TENSION_EFFECTS_ENABLED = !params.TENSION_EFFECTS_ENABLED;\r\n        if (!params.TENSION_EFFECTS_ENABLED) {\r\n            this.deactivateTensionEffects();\r\n        }\r\n        console.log(`🎬 Tension effects: ${params.TENSION_EFFECTS_ENABLED ? 'ENABLED' : 'DISABLED'}`);\r\n    }\r\n\r\n    toggleOverlayEffects() {\r\n        params.OVERLAY_EFFECTS_ENABLED = !params.OVERLAY_EFFECTS_ENABLED;\r\n        if (!params.OVERLAY_EFFECTS_ENABLED && this.effectsOverlay) {\r\n            this.effectsOverlay.style.background = 'rgba(0, 0, 0, 0)';\r\n        }\r\n        console.log(`🎬 Overlay effects: ${params.OVERLAY_EFFECTS_ENABLED ? 'ENABLED' : 'DISABLED'}`);\r\n    }\r\n\r\n    shutdown() {\r\n        // Clean up overlay\r\n        if (this.effectsOverlay) {\r\n            document.body.removeChild(this.effectsOverlay);\r\n            this.effectsOverlay = null;\r\n        }\r\n        \r\n        // Reset camera\r\n        this.stopCameraShake();\r\n        \r\n        // Reset lighting\r\n        if (this.sceneManager.cameraLight) {\r\n            this.sceneManager.cameraLight.intensity = 1.5;\r\n            this.sceneManager.cameraLight.color.setRGB(1.0, 1.0, 1.0);\r\n        }\r\n        \r\n        console.log('🎬 Visual FX System shutdown');\r\n    }\r\n} ","// main.js - Game initialization using new SOLID architecture\r\nimport * as THREE from 'three';\r\nimport { GameEngine } from './core/GameEngine.js';\r\nimport { GameStateSystem } from './systems/GameStateSystem.js';\r\nimport { PlayerSystem } from './systems/PlayerSystem.js';\r\nimport { NPCSystem } from './systems/NPCSystem.js';\r\nimport { PoliceSystem } from './systems/PoliceSystem.js';\r\nimport { UISystem } from './systems/UISystem.js';\r\nimport { VisualFXSystem } from './systems/VisualFXSystem.js';\r\nimport { serviceContainer } from './core/ServiceContainer.js';\r\nimport { params, initTweakpane } from './params.js';\r\nimport { GameEventTypes } from './interfaces/GameEvents.js';\r\n\r\n// Make THREE available globally for other modules\r\nwindow.THREE = THREE;\r\n\r\nlet gameEngine;\r\n\r\n// Initialize the game\r\nasync function init() {\r\n    try {\r\n        console.log('🎭 Initializing Masques et Outrage with SOLID architecture...');\r\n        \r\n        // Create and initialize game engine\r\n        gameEngine = new GameEngine();\r\n        \r\n        // Register game systems in the service container\r\n        registerGameSystems();\r\n        \r\n        // Register systems in SystemManager before engine initialization\r\n        await registerSystemsInManager();\r\n        \r\n        // Initialize the game engine (this will initialize all registered systems)\r\n        await gameEngine.initialize();\r\n        \r\n        // Initialize tweakpane\r\n        initTweakpane();\r\n        \r\n        console.log('🎭 Masques et Outrage - SOLID architecture initialized');\r\n        \r\n    } catch (error) {\r\n        console.error('❌ Failed to initialize game:', error);\r\n        showErrorScreen(error);\r\n    }\r\n}\r\n\r\n// Register all game systems in the service container\r\nfunction registerGameSystems() {\r\n    // Core systems - registered as singletons to ensure same instances\r\n    serviceContainer.registerSingleton('gameStateSystem', GameStateSystem);\r\n    serviceContainer.registerSingleton('playerSystem', PlayerSystem);\r\n    serviceContainer.registerSingleton('npcSystem', NPCSystem);\r\n    serviceContainer.registerSingleton('policeSystem', PoliceSystem);\r\n    serviceContainer.registerSingleton('uiSystem', UISystem);\r\n    serviceContainer.registerSingleton('visualFXSystem', VisualFXSystem);\r\n    \r\n    console.log('🔧 Game systems registered in service container');\r\n}\r\n\r\n// Register systems in SystemManager with proper priorities\r\nasync function registerSystemsInManager() {\r\n    const systemManager = serviceContainer.resolve('systemManager');\r\n    \r\n    if (systemManager) {\r\n        // Register systems with priorities (lower number = higher priority)\r\n        systemManager.registerSystem('gameState', serviceContainer.resolve('gameStateSystem'), 10);\r\n        systemManager.registerSystem('player', serviceContainer.resolve('playerSystem'), 20);\r\n        systemManager.registerSystem('npc', serviceContainer.resolve('npcSystem'), 30);\r\n        systemManager.registerSystem('police', serviceContainer.resolve('policeSystem'), 40);\r\n        systemManager.registerSystem('visualFX', serviceContainer.resolve('visualFXSystem'), 45);\r\n        systemManager.registerSystem('ui', serviceContainer.resolve('uiSystem'), 50);\r\n        \r\n        console.log('🔧 Game systems registered in SystemManager');\r\n    } else {\r\n        console.error('❌ SystemManager not available for system registration');\r\n    }\r\n}\r\n\r\n// Error handling\r\nfunction showErrorScreen(error) {\r\n    const errorDiv = document.createElement('div');\r\n    errorDiv.style.cssText = `\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: rgba(0, 0, 0, 0.9);\r\n        color: white;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        font-family: Arial, sans-serif;\r\n        z-index: 10000;\r\n    `;\r\n    \r\n    errorDiv.innerHTML = `\r\n        <div style=\"text-align: center; padding: 40px; background: #333; border-radius: 10px;\">\r\n            <h1 style=\"color: #ff6666;\">🎭 Initialization Error</h1>\r\n            <p style=\"margin: 20px 0;\">Failed to initialize the game:</p>\r\n            <p style=\"color: #ffaa66; font-family: monospace;\">${error.message}</p>\r\n            <button onclick=\"location.reload()\" style=\"\r\n                background: #4CAF50;\r\n                color: white;\r\n                border: none;\r\n                padding: 10px 20px;\r\n                font-size: 16px;\r\n                border-radius: 5px;\r\n                cursor: pointer;\r\n                margin-top: 20px;\r\n            \">Reload Page</button>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(errorDiv);\r\n}\r\n\r\n// Debug functions for development\r\nfunction getEngineStats() {\r\n    return gameEngine ? gameEngine.getEngineStats() : null;\r\n}\r\n\r\nfunction getSystemStats() {\r\n    return gameEngine ? gameEngine.getSystem('gameState')?.getFullState() : null;\r\n}\r\n\r\n// Test visual effects\r\nfunction testVisualEffects() {\r\n    if (!gameEngine) {\r\n        console.log('❌ Game engine not initialized');\r\n        return;\r\n    }\r\n    \r\n    const systemManager = gameEngine.systemManager;\r\n    if (!systemManager) {\r\n        console.log('❌ System manager not available');\r\n        return;\r\n    }\r\n    \r\n    const visualFX = systemManager.getSystem('visualFX');\r\n    if (!visualFX) {\r\n        console.log('❌ Visual FX system not available');\r\n        return;\r\n    }\r\n    \r\n    console.log('🎬 Testing Visual FX System...');\r\n    console.log('Current state:', visualFX.getEffectsState());\r\n    \r\n    // Test camera shake\r\n    visualFX.testCameraShake();\r\n    \r\n    // Test tension effects after 2 seconds\r\n    setTimeout(() => {\r\n        visualFX.testTensionEffects();\r\n    }, 2000);\r\n}\r\n\r\n// Test system communication\r\nfunction testSystemCommunication() {\r\n    console.log('🧪 Testing system communication...');\r\n    \r\n    if (!gameEngine) {\r\n        console.log('❌ Game engine not initialized');\r\n        return;\r\n    }\r\n    \r\n    const systemManager = gameEngine.systemManager;\r\n    if (!systemManager) {\r\n        console.log('❌ System manager not available');\r\n        return;\r\n    }\r\n    \r\n    // Test each system\r\n    const systems = ['gameState', 'player', 'npc', 'police', 'visualFX', 'ui'];\r\n    \r\n    for (const systemName of systems) {\r\n        const system = systemManager.getSystem(systemName);\r\n        if (system) {\r\n            console.log(`✅ ${systemName} system: initialized, enabled=${system.enabled}`);\r\n        } else {\r\n            console.log(`❌ ${systemName} system: not found`);\r\n        }\r\n    }\r\n    \r\n    // Test ServiceContainer resolution\r\n    console.log('\\n🔍 Testing ServiceContainer resolution:');\r\n    try {\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        console.log('✅ gameStateSystem resolved:', !!gameStateSystem);\r\n        \r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        console.log('✅ playerSystem resolved:', !!playerSystem);\r\n        \r\n        const npcSystem = serviceContainer.resolve('npcSystem');\r\n        console.log('✅ npcSystem resolved:', !!npcSystem);\r\n        \r\n        // Test if instances are the same\r\n        const gameStateFromManager = systemManager.getSystem('gameState');\r\n        const gameStateFromContainer = serviceContainer.resolve('gameStateSystem');\r\n        console.log('✅ Same instances:', gameStateFromManager === gameStateFromContainer);\r\n        \r\n    } catch (error) {\r\n        console.log('❌ ServiceContainer resolution error:', error.message);\r\n    }\r\n}\r\n\r\n// Test mask changing\r\nfunction testMaskChanging() {\r\n    console.log('🎭 Testing mask changing...');\r\n    \r\n    try {\r\n        const playerSystem = serviceContainer.resolve('playerSystem');\r\n        if (!playerSystem) {\r\n            console.log('❌ Player system not available');\r\n            return;\r\n        }\r\n        \r\n        console.log('🎭 Current mask:', playerSystem.getCurrentMask());\r\n        \r\n        // Try changing mask\r\n        console.log('🎭 Changing to mask 1 (Conservative)...');\r\n        playerSystem.setMask(1);\r\n        \r\n        setTimeout(() => {\r\n            console.log('🎭 Mask after change:', playerSystem.getCurrentMask());\r\n        }, 100);\r\n        \r\n    } catch (error) {\r\n        console.log('❌ Mask changing error:', error.message);\r\n    }\r\n}\r\n\r\n// Test camera shake system\r\nfunction testCameraShake() {\r\n    console.log('🎬 Testing camera shake system...');\r\n    \r\n    try {\r\n        const visualFXSystem = serviceContainer.resolve('visualFXSystem');\r\n        if (!visualFXSystem) {\r\n            console.log('❌ Visual FX system not available');\r\n            return;\r\n        }\r\n        \r\n        console.log('🎬 Visual FX system found, testing camera shake...');\r\n        console.log('🎬 Camera shake enabled in params:', params.CAMERA_SHAKE_ENABLED);\r\n        \r\n        // Test camera shake directly\r\n        visualFXSystem.testCameraShake();\r\n        \r\n        // Test police events\r\n        setTimeout(() => {\r\n            console.log('🎬 Testing police activation...');\r\n            visualFXSystem.activateTensionEffects();\r\n        }, 2000);\r\n        \r\n        setTimeout(() => {\r\n            console.log('🎬 Testing police deactivation...');\r\n            visualFXSystem.deactivateTensionEffects();\r\n        }, 7000);\r\n        \r\n    } catch (error) {\r\n        console.log('❌ Camera shake test error:', error.message);\r\n    }\r\n}\r\n\r\n// Test police system events\r\nfunction testPoliceEvents() {\r\n    console.log('🚔 Testing police system events...');\r\n    \r\n    try {\r\n        const gameStateSystem = serviceContainer.resolve('gameStateSystem');\r\n        const policeSystem = serviceContainer.resolve('policeSystem');\r\n        \r\n        if (!gameStateSystem || !policeSystem) {\r\n            console.log('❌ Game state or police system not available');\r\n            return;\r\n        }\r\n        \r\n        console.log('🚔 Current outrage:', gameStateSystem.outrage);\r\n        console.log('🚔 Police threshold:', params.OUTRAGE_POLICE_THRESHOLD);\r\n        \r\n        // Force outrage to trigger police\r\n        console.log('🚔 Forcing outrage to trigger police...');\r\n        gameStateSystem.setOutrage(params.OUTRAGE_POLICE_THRESHOLD + 1);\r\n        \r\n        setTimeout(() => {\r\n            console.log('🚔 Checking police status...');\r\n            console.log('🚔 Police active:', policeSystem.isPoliceActive());\r\n            console.log('🚔 Police count:', policeSystem.getPolicePositions().length);\r\n        }, 1000);\r\n        \r\n        // Reset outrage after 5 seconds\r\n        setTimeout(() => {\r\n            console.log('🚔 Resetting outrage...');\r\n            gameStateSystem.setOutrage(0);\r\n        }, 5000);\r\n        \r\n    } catch (error) {\r\n        console.log('❌ Police test error:', error.message);\r\n    }\r\n}\r\n\r\n// Test event system\r\nfunction testEventSystem() {\r\n    console.log('📡 Testing event system...');\r\n    \r\n    try {\r\n        const eventManager = serviceContainer.resolve('eventManager');\r\n        if (!eventManager) {\r\n            console.log('❌ Event manager not available');\r\n            return;\r\n        }\r\n        \r\n        console.log('📡 Event manager found');\r\n        \r\n        // Test simple event publish/subscribe\r\n        const testEventType = 'TEST_EVENT';\r\n        let receivedEvent = false;\r\n        \r\n        const unsubscribe = eventManager.subscribe(testEventType, (event) => {\r\n            console.log('📡 Test event received:', event);\r\n            receivedEvent = true;\r\n        });\r\n        \r\n        // Publish test event\r\n        eventManager.publish(testEventType, { message: 'Hello from test!' });\r\n        \r\n        // Check if event was received\r\n        setTimeout(() => {\r\n            if (receivedEvent) {\r\n                console.log('✅ Event system working correctly');\r\n            } else {\r\n                console.log('❌ Event system not working - event not received');\r\n            }\r\n            unsubscribe();\r\n        }, 100);\r\n        \r\n        // Test police events specifically\r\n        setTimeout(() => {\r\n            console.log('📡 Testing police events...');\r\n            \r\n            // Subscribe to police events\r\n            const policeSubscription = eventManager.subscribe(GameEventTypes.POLICE_ACTIVATE, (event) => {\r\n                console.log('📡 POLICE_ACTIVATE event received:', event);\r\n            });\r\n            \r\n            // Manually trigger police activation\r\n            const policeSystem = serviceContainer.resolve('policeSystem');\r\n            if (policeSystem) {\r\n                // Force activate police\r\n                policeSystem.activate();\r\n                \r\n                // Clean up\r\n                setTimeout(() => {\r\n                    policeSubscription();\r\n                }, 2000);\r\n            }\r\n        }, 200);\r\n        \r\n    } catch (error) {\r\n        console.log('❌ Event system test error:', error.message);\r\n    }\r\n}\r\n\r\n// Make debug functions available globally\r\nwindow.getEngineStats = getEngineStats;\r\nwindow.getSystemStats = getSystemStats;\r\nwindow.testVisualEffects = testVisualEffects;\r\nwindow.testSystemCommunication = testSystemCommunication;\r\nwindow.testMaskChanging = testMaskChanging;\r\nwindow.testCameraShake = testCameraShake;\r\nwindow.testPoliceEvents = testPoliceEvents;\r\nwindow.testEventSystem = testEventSystem;\r\n\r\n// Graceful shutdown\r\nfunction shutdown() {\r\n    if (gameEngine) {\r\n        gameEngine.shutdown();\r\n    }\r\n    console.log('🎭 Game shutdown complete');\r\n}\r\n\r\n// Handle page unload\r\nwindow.addEventListener('beforeunload', shutdown);\r\n\r\n// Advanced debugging - access to game engine\r\nwindow.gameEngine = () => gameEngine;\r\nwindow.serviceContainer = () => serviceContainer;\r\n\r\n// Start the game\r\ninit().catch(console.error); "],"names":["isEmpty","value","isObject$1","isRecord","deepEqualsArray","a1","a2","i","deepMerge","r1","r2","result","key","v1","v2","isBinding","CREATE_MESSAGE_MAP","context","TpError","bundleId","id","name","config","_a","BindingTarget","obj","valueObj","Emitter","eventName","handler","opt_options","observers","observer","event","ComplexValue","initialValue","rawValue","options","opts","constrainedValue","prevValue","PrimitiveValue","ReadonlyPrimitiveValue","ev","createValue","constraint","equals","createReadonlyValue","ValueMap","valueMap","o","core","DefiniteRangeConstraint","max","min","RangeConstraint","StepConstraint","step","origin","r","NumberLiteralNode","text","BINARY_OPERATION_MAP","BinaryOperationNode","operator","left","right","op","UNARY_OPERATION_MAP","v","UnaryOperationNode","expr","combineReader","parsers","cursor","readWhitespace","m","readNonZeroDigit","ch","readDecimalDigits","readSignedInteger","ds","sign","sds","readExponentPart","e","si","readDecimalIntegerLiteral","nzd","readDecimalLiteral1","dil","dot","dds","readDecimalLiteral2","readDecimalLiteral3","readDecimalLiteral","parseBinaryDigits","readBinaryIntegerLiteral","prefix","bds","readOctalDigits","readOctalIntegerLiteral","ods","readHexDigits","readHexIntegerLiteral","hds","readNonDecimalIntegerLiteral","readNumericLiteral","parseLiteral","num","parseParenthesizedExpression","parseExpression","cl","parsePrimaryExpression","parseUnaryExpression","readBinaryOperator","ops","createBinaryOperationExpressionParser","exprParser","firstExpr","nextExpr","parseBinaryOperationExpression","parser","parseEcmaNumberExpression","parseNumber","numberFromUnknown","pv","numberToString","createNumberFormatter","digits","mapRange","start1","end1","start2","end2","p","getDecimalDigits","constrainRange","loopRange","getSuitableDecimalDigits","params","getSuitableKeyScale","getSuitablePointerScale","base","createStepConstraint","createRangeConstraint","createNumberTextPropsObject","_b","_c","createNumberTextInputParamsParser","createPointAxis","BladeApi","controller","disabled","hidden","state","TpEvent","target","TpChangeEvent","last","TpFoldEvent","expanded","TpTabSelectEvent","index","TpMouseEvent","nativeEvent","BindingApi","label","tag","bh","InputBindingValue","binding","isInputBindingValue","b","parseObject","keyToParserMap","tmp","parseArray","parseItem","item","isObject","createMicroParserBuilder","parse","optional","createMicroParserBuilders","itemParser","MicroParsers","parseRecord","map","importBladeState","superImport","callback","exportBladeState","superExport","thisState","isValueBladeController","bc","isBindingValue","SVG_NS","forceReflow","element","disableTransitionTemporarily","supportsTouch","doc","getGlobalObject","getWindowDocument","getCanvasContext","canvasElement","win","ICON_ID_TO_INNER_HTML_MAP","createSvgIconElement","document","iconId","elem","insertElementAt","parentElement","removeElement","removeChildElements","removeChildNodes","findNextTarget","bindValue","applyValue","bindValueMap","PREFIX","ClassName","viewName","opt_elementName","opt_modifier","cn$r","createLabelNode","frag","line","lineNode","LabelView","labelElem","valueElem","LabelController","getAllBladePositions","cn$q","POS_TO_CLASS_NAME_MAP","BladeController","pos","parent","LabeledValueBladeController","viewProps","lc","s","excludeValue","BindingController","_s","isBindingController","InputBindingController","isInputBindingController","fillBuffer","buffer","bufferSize","initializeBuffer","createTrimmedBuffer","createPushedBuffer","newValue","newBuffer","MonitorBindingValue","isMonitorBindingValue","MonitorBindingController","isMonitorBindingController","ButtonApi","title","applyClass","className","active","valueToClassName","bindValueToTextContent","cn$p","ButtonView","buttonElem","titleElem","ButtonController","ButtonBladeController","Semver","prerelease","coreComps","VERSION$1","createPlugin","plugin","ButtonBladePlugin","args","addButtonAsBlade","api","addFolderAsBlade","addTabAsBlade","isRefreshable","createBindingTarget","RackApi","pool","object","opt_params","opt_index","c","ContainerBladeApi","ContainerBladeController","isContainerBladeController","NestedOrderedSet","extract","subList","findValueBladeController","bcs","findSubBladeControllerSet","Rack","finder","root","rack","emitter","visibleItems","firstVisibleItem","lastVisibleItem","ps","_ev","_","RackController","createBlade","Foldable","coreObj","exHeight","expandedClassName","onExpand","computeExpandedFolderHeight","folder","containerElement","height","applyHeight","foldable","bindFoldable","h","FolderApi","bladeContainerClassName","FolderView","indentElem","markElem","containerElem","FolderController","view","FolderBladePlugin","cn$o","valueToModifier","modifier","ViewProps","opt_initialValue","disposed","prevParent","cn$n","TabPageView","cn$m","TabItemView","selected","TabItemController","TabPageController","TabApi","pc","papi","TabPageApi","INDEX_NOT_SELECTED","Tab","firstSelIndex","cn$l","TabView","contentsElem","TabController","tab","TabBladePlugin","createBladeController","ac","ListInputBindingApi","ManualTicker","IntervalTicker","interval","inactive","CompositeConstraint","constraints","findConstraint","constraintClass","tmpResult","sc","ListConstraint","parseListOptions","normalizeListOptions","items","createListConstraint","cn$k","ListView","selectElem","optionElem","values","ListController","cn$j","PopupView","PopupController","cn$i","TextView","inputElem","formatter","TextController","parsedValue","boolToString","boolFromUnknown","BooleanFormatter","composeParsers","innerFormatter","formatPercentage","stringFromUnknown","formatString","connectValues","primary","secondary","forward","backward","changing","preventFeedback","getStepForKey","keyScale","keys","getVerticalStepKeys","getHorizontalStepKeys","isVerticalArrowKey","isArrowKey","computeOffset$1","rect","PointerHandler","offset","touch","cn$h","NumberTextView","knobElem","guideElem","bodyElem","headElem","tooltipElem","x","aox","adx","NumberTextController","ph","data","dx","cn$g","SliderView","trackElem","SliderController","d","cn$f","SliderTextView","sliderElem","textElem","SliderTextController","sliderProps","createSliderTextProps","CSS_VAR_MAP","getCssVar","createPointDimensionParser","parsePointDimensionParams","createDimensionConstraint","cs","rs","isCompatible","ver","parsePickerLayout","writePrimitive","cn$e","CheckboxView","wrapperElem","CheckboxController","createConstraint$6","BooleanInputPlugin","_args","cn$d","ColorView","swatchElem","pickerElem","rgbToHslInt","g","rp","gp","bp","cmax","cmin","l","hslToRgbInt","hp","sp","lp","rgbToHsvInt","hsvToRgbInt","vp","hslToHsvInt","sd","hsvToHslInt","removeAlphaComponent","comps","appendAlphaComponent","alpha","MODE_CONVERTER_MAP","getColorMaxComponents","mode","type","loopHueRange","hue","constrainColorComponents","components","ms","convertColorType","from","to","fms","tms","convertColor","intComps","IntColor","opt_mode","rgbComps","cn$c","ColorPickerView","hsvElem","svElem","hElem","rgbElem","aElem","apElem","atElem","elems","parseColorType","parseColorInputParams","getKeyScaleForColor","forAlpha","extractColorType","FloatColor","TYPE_TO_CONSTRUCTOR_MAP","createColor","isFloatColor","isIntColor","convertFloatToInt","cf","convertIntToFloat","ci","mapColorType","equalsStringColorFormat","f1","f2","parseCssNumberOrPercentage","ANGLE_TO_DEG_MAP","angle","parseCssNumberOrAngle","unit","parseFunctionalRgbColorComponents","parseFunctionalRgbColor","parseFunctionalRgbaColorComponents","parseFunctionalRgbaColor","parseFunctionalHslColorComponents","parseFunctionalHslColor","parseHslaColorComponents","parseFunctionalHslaColor","parseHexRgbColorComponents","mRgb","mRrggbb","parseHexRgbColor","parseHexRgbaColorComponents","parseHexRgbaColor","parseObjectRgbColorComponents","createObjectRgbColorParser","parseObjectRgbaColorComponents","createObjectRgbaColorParser","PARSER_AND_RESULT","detectStringColor","prev","detection","detectStringColorFormat","createColorStringParser","readIntColorString","zerofill","comp","hex","colorToHexRgbString","hexes","colorToHexRgbaString","rgbaComps","colorToFunctionalRgbString","colorToFunctionalRgbaString","aFormatter","rgbFormatter","colorToFunctionalHslString","formatters","colorToFunctionalHslaString","colorToObjectRgbString","names","cc","createObjectRgbColorFormatter","colorToObjectRgbaString","createObjectRgbaColorFormatter","FORMAT_AND_STRINGIFIERS","findColorStringifier","format","fas","cn$b","APaletteView","barElem","colorElem","markerElem","previewElem","leftColor","rightColor","gradientComps","APaletteController","cn$a","createModeSelectElement","optElem","ColorTextsView","modeElem","modeMarkerElem","inputsElem","inputViews","compElem","createFormatter$2","createConstraint$5","createComponentController","createComponentControllers","pickedMode","createHexController","isColorMode","ColorTextsController","cn$9","HPaletteView","HPaletteController","cn$8","CANVAS_RESOL","SvPaletteView","canvasElem","ctx","hsvComps","width","imgData","iy","ix","top","SvPaletteController","saturation","a","dv","ColorPickerController","cn$7","ColorSwatchView","ColorSwatchController","ColorController","pickerC","nextTarget","colorToRgbNumber","colorToRgbaNumber","numberToRgbColor","numberToRgbaColor","colorFromRgbNumber","colorFromRgbaNumber","isRgbColorComponent","isRgbColorObject","isRgbaColorObject","isColorObject","equalsColor","comps1","comps2","createColorComponentsFromRgbObject","createColorStringWriter","stringify","createColorNumberWriter","supportsAlpha","colorToNumber","writeRgbaColorObject","writeRgbColorObject","createColorObjectWriter","inValue","shouldSupportAlpha$1","inputParams","createFormatter$1","isForColor","NumberColorInputPlugin","colorFromObject","shouldSupportAlpha","createColorObjectBindingReader","createColorObjectFormatter","ObjectColorInputPlugin","StringColorInputPlugin","stringifier","writer","PointNdConstraint","cn$6","PointNdTextView","axisElem","createAxisController","PointNdTextController","SliderInputBindingApi","createConstraint$4","rc","NumberInputPlugin","textPropsObj","drc","Point2d","y","Point2dAssembly","cn$5","Point2dView","cn$4","Point2dPickerView","padElem","svgElem","xAxisElem","yAxisElem","lineElem","px","py","ipy","computeOffset","keyScales","invertsY","Point2dPickerController","dy","Point2dController","padC","point2dFromUnknown","writePoint2d","createConstraint$3","getSuitableMaxDimensionValue","getSuitableMax","xr","yr","shouldInvertY","yParams","Point2dInputPlugin","dParams","Point3d","z","Point3dAssembly","point3dFromUnknown","writePoint3d","createConstraint$2","Point3dInputPlugin","Point4d","w","Point4dAssembly","point4dFromUnknown","writePoint4d","createConstraint$1","Point4dInputPlugin","createConstraint","StringInputPlugin","Constants","cn$3","MultiLogView","textareaElem","shouldScroll","lines","MultiLogController","cn$2","SingleLogView","lastValue","SingleLogController","BooleanMonitorPlugin","GraphLogMonitorBindingApi","cn$1","GraphLogView","maxIndex","points","tx","ty","GraphLogController","createFormatter","createTextMonitor","createGraphMonitor","shouldShowGraph","NumberMonitorPlugin","StringMonitorPlugin","BladeApiCache","ReadWriteBinding","createInputBindingController","valueArgs","reader","ReadonlyBinding","createTicker","createMonitorBindingController","bindingArgs","PluginPool","apiCache","ic","mc","sharedCache","createDefaultPluginPool","ListBladeApi","SeparatorBladeApi","SliderBladeApi","TextBladeApi","ListBladePlugin","RootApi","RootController","cn","SeparatorView","hrElem","SeparatorController","SeparatorBladePlugin","SliderBladePlugin","vc","TextBladePlugin","createDefaultWrapperElement","embedStyle","css","styleElem","Pane","opt_config","rootController","parentElem","bundle","pane","playerMovementData","initTweakpane","inputFolder","movementFolder","directionsFolder","positionFolder","EventManager","eventType","listener","priority","listenerWrapper","listenerId","listeners","source","middleware","error","cleared","totalListeners","regular","once","total","types","enabled","eventManager","ServiceContainer","serviceClass","dependencies","factoryFunction","instance","factoryInfo","serviceInfo","dep","factory","scope","serviceContainer","SceneManager","ambientLight","directionalLight","atmosphereRadius","planetRadius","roughnessLow","roughnessHigh","textureLoader","earthDayTexture","earthBumpRoughnessCloudsTexture","outerGeometry","outerMaterial","shader","innerGeometry","innerMaterial","hudLight","hudDirectionalLight","cameraGeometry","cameraMaterial","directionGeometry","directionMaterial","arrowGeometry","arrowMaterial","labelContainer","visible","cameraDirection","distance","scale","playerSystem","playerNormal","geometry","positions","vertices","noise","length","normalizedX","normalizedY","normalizedZ","playerPosition","cameraOffset","cameraPosition","cameraToPlayer","lastUpProjected","projectionLength","worldX","worldY","worldZ","dotX","dotY","dotZ","proj","cameraRight","cameraUp","upOffset","rightOffset","lightPosition","sceneCenter","distanceToPlayer","intensityScale","color","colorName","maskType","maskName","masks","currentIndex","testNext","roughness","metalness","clearcoat","material","intensity","opacity","tests","runNextTest","test","atmosphereMaterial","surfaceMaterial","_d","colors","colorData","_e","_f","_g","_h","IGameSystem","sceneManager","deltaTime","newState","action","unsubscribe","eventSource","SystemManager","systemName","system","insertIndex","stats","InputManager","orientation","prompt","success","handleTouchStart","handleTouchMove","deltaX","deltaY","handleTouchEnd","handleTouchCancel","eventData","button","keyboardX","keyboardY","touchX","touchY","pressedKeys","pressed","pressedButtons","GameEngine","rawDeltaTime","npcSystem","camera","npcs","npc","GameEventTypes","PlayerMoveEventData","oldPosition","newPosition","velocity","PlayerMaskChangeEventData","oldMask","newMask","energyCost","PlayerEnergyChangeEventData","oldEnergy","newEnergy","change","reason","GameStateChangeEventData","property","oldValue","GameOutrageChangeEventData","oldOutrage","newOutrage","GameOverEventData","finalScore","gameTime","NPCSpawnEventData","npcId","npcType","position","groupId","NPCStateChangeEventData","oldState","PoliceActivateEventData","outrageLevel","droneCount","activationReason","SystemErrorEventData","EventPriorities","EventDataFactory","oldPos","newPos","GameStateSystem","amount","currentTime","stateChangeData","metadata","inCrowd","inWrongCrowd","isChased","count","legacyEvent","Transform","rotation","quaternion","force","matrix","otherTransform","up","Renderer","scene","transform","PlayerSystem","playerHeight","maskId","texture","textureWidth","textureHeight","aspectRatio","newGeometry","direction","cameraUpVector","surfaceNormal","movementDirection","movementDotNormal","cameraForward","tiltAxis","movementInCameraSpace","tiltAngle","tiltQuaternion","arrowPosition","instructions","touchOverlay","touchIndicator","movement","debugInfo","input","touchMovement","speed","radius","currentPos","playerRight","rotationAxis","angularDistance","currentDistance","forwardDirection","forwardDotNormal","rightDirection","gameStateSystem","texturePath","targetPosition","range","npcTypes","THREE.TextureLoader","registerNPCType","typeName","createFunction","createNPC","creator","getTextureForMask","createBasicNPC","THREE.Color","groupSpawnCenter","groupSpawnRadius","offsetX","offsetZ","centerNormalized","THREE.Vector3","theta","phi","THREE.PlaneGeometry","THREE.MeshBasicMaterial","THREE.DoubleSide","updateNPCGeometry","createAdvancedNPC","createLeaderNPC","createFollowerNPC","baseSize","getColorForMask","NPCFactory","createPoliceNPC","policeTexture","NPCSystem","group","actualDeltaTime","j","npc1","npc2","minDistance","overlap","correction","collisionRadius","repulsionStrength","newNPCPosition","targetDistance","pushVelocity","playerMask","nearbyNPCs","wrongCrowdRatio","possibleStates","forces","flockingNeighbors","separationMultiplier","alignmentMultiplier","cohesionMultiplier","totalFlockingForce","influenceForce","attractionStrength","neighbors","separationForce","neighbor","alignmentForce","sameGroupNeighbors","n","cohesionForce","repulsionForce","otherGroupNeighbors","wanderingForce","wanderOffset","targetPos","surfaceDistance","maxForce","speedVariation","maxSpeed","normalizedPos","groupAngle","latitudeVariation","other","center","interactionCooldown","influence","triggerNPC","groupStats","velocitySum","separationSum","alignmentSum","cohesionSum","param","PoliceSystem","shouldBeActive","policeNPC","moveSpeed","toPlayerDirection","projectedDirection","dotProduct","damage","police1","police2","normalNPCs","normalNPC","policeForceRatio","npcForceRatio","policeCorrection","npcCorrection","ratio","UISystem","energyLabel","energyContainer","energyFill","energyText","outrageLabel","outrageContainer","outrageFill","outrageText","isMobile","maskNames","maskColors","maskIndex","spriteImg","keySpan","tooltip","handleMaskSelect","gameOverContent","restartButton","scoreValue","timeValue","polarisedValue","finalState","reasonElement","finalTime","finalPolarised","messages","outrageData","maskData","gameOverData","outrageValue","energyValue","timeElement","polarisedElement","VisualFXSystem","diff","shakeIntensity","time","intensityVariation","overlayStyle","pulseIntensity","vignetteIntensity","redTint","edgeIntensity","styleElement","baseIntensity","tensionIntensity","pulseFactor","redShift","blueShift","flickerChance","currentColor","shiftAmount","currentMask","baseColor","shiftedColor","frequency","duration","shakeInterval","clampedIntensity","clampedSpeed","burstInterval","THREE","gameEngine","init","registerGameSystems","registerSystemsInManager","showErrorScreen","systemManager","errorDiv","getEngineStats","getSystemStats","testVisualEffects","visualFX","testSystemCommunication","systems","gameStateFromManager","gameStateFromContainer","testMaskChanging","testCameraShake","visualFXSystem","testPoliceEvents","policeSystem","testEventSystem","testEventType","receivedEvent","policeSubscription","shutdown"],"mappings":"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","x_google_ignoreList":[0]}